[{"content":"1.é¢˜ç›® æ¥é›¨æ°´é¢˜è§£ è¿™é¢˜çœŸä»–å¦ˆç»å…¸ï¼Œè€å­æäº†åŠå°æ—¶æ‰å½»åº•ææ‡‚ã€‚è®°å½•ä¸€ä¸‹æ€è·¯ï¼Œå…å¾—ä¸‹æ¬¡åˆå¿˜ã€‚\næ ¸å¿ƒæ€è·¯ æ¯ä¸ªä½ç½®èƒ½æ¥çš„é›¨æ°´é‡ = min(å·¦è¾¹æœ€é«˜çš„æŸ±å­, å³è¾¹æœ€é«˜çš„æŸ±å­) - å½“å‰æŸ±å­é«˜åº¦\nç®€å•æ¥è¯´å°±æ˜¯ï¼š\næ‰¾å½“å‰æŸ±å­å·¦è¾¹æœ€é«˜çš„ï¼ˆä¸åŒ…æ‹¬è‡ªå·±ï¼‰ æ‰¾å½“å‰æŸ±å­å³è¾¹æœ€é«˜çš„ï¼ˆä¸åŒ…æ‹¬è‡ªå·±ï¼‰ å–è¿™ä¿©çš„è¾ƒå°å€¼ å¦‚æœè¿™ä¸ªå€¼æ¯”å½“å‰æŸ±å­é«˜ï¼Œå·®å€¼å°±æ˜¯èƒ½æ¥çš„é›¨æ°´ å…·ä½“å®ç° ç¬¬ä¸€æ­¥ï¼šé¢„å¤„ç†å·¦å³æœ€å¤§å€¼ å…ˆæä¸¤ä¸ªæ•°ç»„ï¼š\nleftMax[i]ï¼šè¡¨ç¤ºç¬¬iä¸ªæŸ±å­å·¦è¾¹æœ€é«˜çš„æŸ±å­é«˜åº¦ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰ rightMax[i]ï¼šè¡¨ç¤ºç¬¬iä¸ªæŸ±å­å³è¾¹æœ€é«˜çš„æŸ±å­é«˜åº¦ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰ è®¡ç®—leftMaxï¼š\nä»å·¦å¾€å³æ‰« ç»´æŠ¤ä¸€ä¸ªå½“å‰æœ€å¤§å€¼max å¯¹äºæ¯ä¸ªä½ç½®iï¼ŒleftMax[i] = maxï¼ˆè®°å½•ä¹‹å‰é‡åˆ°çš„æœ€å¤§å€¼ï¼‰ ç„¶åæ›´æ–°max = Math.max(max, height[i]) 1 2 3 4 5 int max = 0; for (int i = 0; i \u0026lt; n; i++) { leftMax[i] = max; max = Math.max(max, height[i]); } è®¡ç®—rightMaxï¼š\nä»å³å¾€å·¦æ‰« åŒæ ·ç»´æŠ¤ä¸€ä¸ªå½“å‰æœ€å¤§å€¼max å¯¹äºæ¯ä¸ªä½ç½®iï¼ŒrightMax[i] = max ç„¶åæ›´æ–°max = Math.max(max, height[i]) 1 2 3 4 5 max = 0; for (int i = n - 1; i \u0026gt;= 0; i--) { rightMax[i] = max; max = Math.max(max, height[i]); } ç¬¬äºŒæ­¥ï¼šè®¡ç®—é›¨æ°´ ç°åœ¨æœ‰äº†leftMaxå’ŒrightMaxï¼Œå¯¹äºæ¯ä¸ªä½ç½®ï¼š\nå–leftMax[i]å’ŒrightMax[i]çš„è¾ƒå°å€¼ å¦‚æœè¿™ä¸ªå€¼ \u0026gt; height[i]ï¼Œè¯´æ˜èƒ½æ¥é›¨æ°´ é›¨æ°´ = è¾ƒå°å€¼ - height[i] 1 2 3 4 5 6 for (int i = 0; i \u0026lt; n; i++) { int min = Math.min(leftMax[i], rightMax[i]); if (min \u0026gt; height[i]) { ans += (min - height[i]); } } ä¾‹å­åˆ†æ ä»¥[0,1,0,2,1,0,1,3,2,1,2,1]ä¸ºä¾‹ï¼š\nè®¡ç®—leftMaxï¼š\nä»å·¦å¾€å³ï¼Œè®°å½•é‡åˆ°çš„æœ€å¤§å€¼ å¾—åˆ°ï¼š[0,0,1,1,2,2,2,2,3,3,3,3] è®¡ç®—rightMaxï¼š\nä»å³å¾€å·¦ï¼Œè®°å½•é‡åˆ°çš„æœ€å¤§å€¼ å¾—åˆ°ï¼š[3,3,3,3,3,3,3,2,2,2,1,0] è®¡ç®—é›¨æ°´ï¼š\næ¯”å¦‚i=2ï¼Œheight=0 leftMax=1, rightMax=3 min=1 1 \u0026gt; 0ï¼Œæ‰€ä»¥æ¥1å•ä½æ°´ å¤æ‚åº¦ æ—¶é—´ï¼šO(n)ï¼Œæ‰«äº†3éæ•°ç»„ ç©ºé—´ï¼šO(n)ï¼Œç”¨äº†ä¸¤ä¸ªè¾…åŠ©æ•°ç»„ ä¼˜åŒ–æ€è·¯ å…¶å®å¯ä»¥ç”¨åŒæŒ‡é’ˆæŠŠç©ºé—´é™åˆ°O(1)ï¼Œä¸è¿‡è¿™ä¸ªè§£æ³•å·²ç»å¤Ÿç›´è§‚äº†ï¼Œä¸‹æ¬¡å†ç ”ç©¶ä¼˜åŒ–çš„ã€‚\nä»£ç æ€»ç»“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public int trap(int[] height) { int n = height.length; int ans = 0; // å·¦è¾¹æœ€å¤§å€¼ int[] leftMax = new int[n]; int max = 0; for (int i = 0; i \u0026lt; n; i++) { leftMax[i] = max; max = Math.max(max, height[i]); } // å³è¾¹æœ€å¤§å€¼ int[] rightMax = new int[n]; max = 0; for (int i = n - 1; i \u0026gt;= 0; i--) { rightMax[i] = max; max = Math.max(max, height[i]); } // è®¡ç®—é›¨æ°´ for (int i = 0; i \u0026lt; n; i++) { int min = Math.min(leftMax[i], rightMax[i]); if (min \u0026gt; height[i]) { ans += (min - height[i]); } } return ans; } è¿™é¢˜çœŸä»–å¦ˆç»å…¸ï¼Œè®°ä½è¿™ä¸ªæ€è·¯å°±å®Œäº‹äº†ï¼\n","date":"2025-07-03T00:00:00Z","image":"https://nova-bryan.github.io/p/leetcode42.%E6%8E%A5%E9%9B%A8%E6%B0%B4/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/leetcode42.%E6%8E%A5%E9%9B%A8%E6%B0%B4/","title":"LeetCode42.æ¥é›¨æ°´"},{"content":"MapStructå®Œå…¨å­¦ä¹ æŒ‡å—ï¼šä»é›¶åˆ°ä¸€æŒæ¡Javaå¯¹è±¡æ˜ å°„ ğŸ“š ç›®å½• MapStructæ˜¯ä»€ä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MapStructï¼Ÿ ç¯å¢ƒæ­å»ºä¸é…ç½® ç¬¬ä¸€ä¸ªMapStructç¤ºä¾‹ åŸºæœ¬æ˜ å°„ç”¨æ³• é«˜çº§æ˜ å°„æŠ€å·§ é›†åˆä¸å¤æ‚å¯¹è±¡æ˜ å°„ æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ– å®æˆ˜æ¡ˆä¾‹ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ MapStructæ˜¯ä»€ä¹ˆï¼Ÿ MapStruct æ˜¯ä¸€ä¸ªåŸºäºæ³¨è§£å¤„ç†å™¨çš„Javaä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¸“é—¨ç”¨äºç®€åŒ–Java Beanä¹‹é—´çš„æ˜ å°„è½¬æ¢ã€‚å®ƒåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆç±»å‹å®‰å…¨ä¸”é«˜æ€§èƒ½çš„æ˜ å°„ä»£ç ï¼Œå¤§å¤§å‡å°‘äº†æ‰‹å·¥ç¼–å†™æ¨¡æ¿ä»£ç çš„å·¥ä½œé‡ã€‚\næ ¸å¿ƒç‰¹ç‚¹ ğŸš€ ç¼–è¯‘æ—¶ä»£ç ç”Ÿæˆï¼šæ— è¿è¡Œæ—¶åå°„ï¼Œæ€§èƒ½ä¼˜å¼‚ ğŸ”’ ç±»å‹å®‰å…¨ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯ ğŸ“ ç®€æ´æ³¨è§£ï¼šé€šè¿‡ç®€å•æ³¨è§£å³å¯å®Œæˆå¤æ‚æ˜ å°„ ğŸ”„ åŒå‘æ˜ å°„ï¼šæ”¯æŒè‡ªåŠ¨ç”Ÿæˆåå‘æ˜ å°„ ğŸ¯ Springé›†æˆï¼šå®Œç¾æ”¯æŒä¾èµ–æ³¨å…¥æ¡†æ¶ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MapStructï¼Ÿ ä¼ ç»Ÿæ˜ å°„çš„ç—›ç‚¹ åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ä¸åŒçš„å¯¹è±¡ä¹‹é—´è¿›è¡Œæ•°æ®è½¬æ¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 // ä¼ ç»Ÿæ‰‹å·¥æ˜ å°„ - ç¹çä¸”å®¹æ˜“å‡ºé”™ public UserDTO convertToDTO(User user) { UserDTO dto = new UserDTO(); dto.setId(user.getId()); dto.setFirstName(user.getFirstName()); dto.setLastName(user.getLastName()); dto.setEmail(user.getEmail()); dto.setPhoneNumber(user.getPhone()); // ... æ›´å¤šå­—æ®µ return dto; } é—®é¢˜æ˜¾è€Œæ˜“è§ï¼š\nğŸ”´ ä»£ç é‡å¤ï¼Œç»´æŠ¤å›°éš¾ ğŸ”´ å®¹æ˜“é—æ¼å­—æ®µæˆ–å†™é”™å­—æ®µå ğŸ”´ å½“å¯¹è±¡ç»“æ„å˜åŒ–æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ–°æ‰€æœ‰æ˜ å°„ä»£ç  ğŸ”´ æ€§èƒ½é—®é¢˜ï¼ˆå¦‚æœä½¿ç”¨åå°„ï¼‰ MapStructçš„è§£å†³æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 // MapStructæ–¹å¼ - ç®€æ´ä¼˜é›… @Mapper public interface UserMapper { @Mapping(source = \u0026#34;phone\u0026#34;, target = \u0026#34;phoneNumber\u0026#34;) UserDTO toDTO(User user); User toEntity(UserDTO dto); } ä¼˜åŠ¿ç«‹å³æ˜¾ç°ï¼š\nâœ… ä»£ç ç®€æ´ï¼Œä¸€ç›®äº†ç„¶ âœ… è‡ªåŠ¨å­—æ®µåŒ¹é…ï¼Œå‡å°‘é”™è¯¯ âœ… ç¼–è¯‘æ—¶éªŒè¯ï¼ŒåŠæ—©å‘ç°é—®é¢˜ âœ… é«˜æ€§èƒ½ï¼Œæ— åå°„å¼€é”€ ç¯å¢ƒæ­å»ºä¸é…ç½® Mavené…ç½® åœ¨pom.xmlä¸­æ·»åŠ ä¾èµ–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 \u0026lt;properties\u0026gt; \u0026lt;mapstruct.version\u0026gt;1.5.5.Final\u0026lt;/mapstruct.version\u0026gt; \u0026lt;lombok.version\u0026gt;1.18.30\u0026lt;/lombok.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!-- MapStructæ ¸å¿ƒä¾èµ– --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mapstruct\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mapstruct\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${mapstruct.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- Lombokæ”¯æŒï¼ˆå¯é€‰ä½†æ¨èï¼‰ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${lombok.version}\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.11.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;source\u0026gt;11\u0026lt;/source\u0026gt; \u0026lt;target\u0026gt;11\u0026lt;/target\u0026gt; \u0026lt;annotationProcessorPaths\u0026gt; \u0026lt;!-- MapStructæ³¨è§£å¤„ç†å™¨ --\u0026gt; \u0026lt;path\u0026gt; \u0026lt;groupId\u0026gt;org.mapstruct\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mapstruct-processor\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${mapstruct.version}\u0026lt;/version\u0026gt; \u0026lt;/path\u0026gt; \u0026lt;!-- Lombokæ³¨è§£å¤„ç†å™¨ --\u0026gt; \u0026lt;path\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${lombok.version}\u0026lt;/version\u0026gt; \u0026lt;/path\u0026gt; \u0026lt;!-- Lombokä¸MapStructç»‘å®š --\u0026gt; \u0026lt;path\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok-mapstruct-binding\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.2.0\u0026lt;/version\u0026gt; \u0026lt;/path\u0026gt; \u0026lt;/annotationProcessorPaths\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; Gradleé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 plugins { id \u0026#39;java\u0026#39; id \u0026#39;org.springframework.boot\u0026#39; version \u0026#39;3.1.0\u0026#39; } ext { mapstructVersion = \u0026#39;1.5.5.Final\u0026#39; lombokVersion = \u0026#39;1.18.30\u0026#39; } dependencies { implementation \u0026#34;org.mapstruct:mapstruct:${mapstructVersion}\u0026#34; implementation \u0026#34;org.projectlombok:lombok:${lombokVersion}\u0026#34; annotationProcessor \u0026#34;org.mapstruct:mapstruct-processor:${mapstructVersion}\u0026#34; annotationProcessor \u0026#34;org.projectlombok:lombok:${lombokVersion}\u0026#34; annotationProcessor \u0026#34;org.projectlombok:lombok-mapstruct-binding:0.2.0\u0026#34; } ç¬¬ä¸€ä¸ªMapStructç¤ºä¾‹ è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æˆ·å®ä½“å’ŒDTOçš„æ˜ å°„ã€‚\n1. å®šä¹‰å®ä½“ç±» 1 2 3 4 5 6 7 8 9 10 11 12 @Data // Lombokæ³¨è§£ @AllArgsConstructor @NoArgsConstructor public class User { private Long id; private String firstName; private String lastName; private String email; private String phone; private LocalDate birthDate; private Boolean active; } 2. å®šä¹‰DTOç±» 1 2 3 4 5 6 7 8 9 10 11 12 @Data @AllArgsConstructor @NoArgsConstructor public class UserDTO { private Long id; private String firstName; private String lastName; private String email; private String phoneNumber; // æ³¨æ„ï¼šå­—æ®µåä¸å®ä½“ä¸åŒ private String birthDateStr; // ç±»å‹ä¹Ÿä¸åŒ private Boolean isActive; // å­—æ®µåç•¥æœ‰ä¸åŒ } 3. åˆ›å»ºMapperæ¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Mapper(componentModel = \u0026#34;spring\u0026#34;) // Springç»„ä»¶ public interface UserMapper { @Mapping(source = \u0026#34;phone\u0026#34;, target = \u0026#34;phoneNumber\u0026#34;) @Mapping(source = \u0026#34;birthDate\u0026#34;, target = \u0026#34;birthDateStr\u0026#34;, dateFormat = \u0026#34;yyyy-MM-dd\u0026#34;) @Mapping(source = \u0026#34;active\u0026#34;, target = \u0026#34;isActive\u0026#34;) UserDTO toDTO(User user); @InheritInverseConfiguration // è‡ªåŠ¨åå‘é…ç½® User toEntity(UserDTO dto); // æ‰¹é‡è½¬æ¢ List\u0026lt;UserDTO\u0026gt; toDTOList(List\u0026lt;User\u0026gt; users); } 4. ç”Ÿæˆçš„ä»£ç  ç¼–è¯‘åï¼ŒMapStructä¼šè‡ªåŠ¨ç”Ÿæˆå®ç°ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Component // å› ä¸ºcomponentModel = \u0026#34;spring\u0026#34; public class UserMapperImpl implements UserMapper { @Override public UserDTO toDTO(User user) { if (user == null) { return null; } UserDTO userDTO = new UserDTO(); userDTO.setId(user.getId()); userDTO.setFirstName(user.getFirstName()); userDTO.setLastName(user.getLastName()); userDTO.setEmail(user.getEmail()); userDTO.setPhoneNumber(user.getPhone()); userDTO.setIsActive(user.getActive()); if (user.getBirthDate() != null) { userDTO.setBirthDateStr( DateTimeFormatter.ofPattern(\u0026#34;yyyy-MM-dd\u0026#34;) .format(user.getBirthDate()) ); } return userDTO; } @Override public User toEntity(UserDTO dto) { // è‡ªåŠ¨ç”Ÿæˆçš„åå‘æ˜ å°„é€»è¾‘ // ... } } 5. ä½¿ç”¨æ˜ å°„å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Service public class UserService { @Autowired private UserMapper userMapper; public UserDTO getUserDTO(Long id) { User user = userRepository.findById(id); return userMapper.toDTO(user); // ä¸€è¡Œæå®šï¼ } public User createUser(UserDTO dto) { User user = userMapper.toEntity(dto); return userRepository.save(user); } } åŸºæœ¬æ˜ å°„ç”¨æ³• å­—æ®µåæ˜ å°„ 1 2 3 4 5 6 7 8 @Mapper public interface ProductMapper { @Mapping(source = \u0026#34;productName\u0026#34;, target = \u0026#34;name\u0026#34;) @Mapping(source = \u0026#34;productPrice\u0026#34;, target = \u0026#34;price\u0026#34;) @Mapping(source = \u0026#34;productDescription\u0026#34;, target = \u0026#34;desc\u0026#34;) ProductDTO toDTO(Product product); } ç±»å‹è½¬æ¢ MapStructæ”¯æŒå¤šç§è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Mapper public interface ConversionMapper { // æ•°å­—ç±»å‹è½¬æ¢ @Mapping(source = \u0026#34;count\u0026#34;, target = \u0026#34;countStr\u0026#34;) TargetObject convert(SourceObject source); // æ—¥æœŸæ ¼å¼åŒ– @Mapping(source = \u0026#34;createTime\u0026#34;, target = \u0026#34;createTimeStr\u0026#34;, dateFormat = \u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;) TargetObject convertDate(SourceObject source); // å¸ƒå°”å€¼è½¬æ¢ @Mapping(source = \u0026#34;enabled\u0026#34;, target = \u0026#34;status\u0026#34;, expression = \u0026#34;java(source.getEnabled() ? \\\u0026#34;ACTIVE\\\u0026#34; : \\\u0026#34;INACTIVE\\\u0026#34;)\u0026#34;) TargetObject convertBoolean(SourceObject source); } å¸¸é‡èµ‹å€¼ 1 2 3 4 5 6 7 8 @Mapper public interface ConstantMapper { @Mapping(target = \u0026#34;status\u0026#34;, constant = \u0026#34;CREATED\u0026#34;) @Mapping(target = \u0026#34;version\u0026#34;, constant = \u0026#34;1.0\u0026#34;) @Mapping(target = \u0026#34;createdBy\u0026#34;, constant = \u0026#34;SYSTEM\u0026#34;) UserDTO toDTO(User user); } é»˜è®¤å€¼ 1 2 3 4 5 6 7 8 @Mapper public interface DefaultMapper { @Mapping(target = \u0026#34;country\u0026#34;, defaultValue = \u0026#34;CN\u0026#34;) @Mapping(target = \u0026#34;language\u0026#34;, defaultValue = \u0026#34;zh_CN\u0026#34;) @Mapping(target = \u0026#34;timezone\u0026#34;, defaultValue = \u0026#34;Asia/Shanghai\u0026#34;) UserProfileDTO toDTO(UserProfile profile); } å¿½ç•¥å­—æ®µ 1 2 3 4 5 6 7 8 @Mapper public interface IgnoreMapper { @Mapping(target = \u0026#34;password\u0026#34;, ignore = true) @Mapping(target = \u0026#34;internalId\u0026#34;, ignore = true) @Mapping(target = \u0026#34;createdAt\u0026#34;, ignore = true) UserDTO toSafeDTO(User user); } é«˜çº§æ˜ å°„æŠ€å·§ è‡ªå®šä¹‰æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 @Mapper public interface AdvancedUserMapper { @Mapping(source = \u0026#34;firstName\u0026#34;, target = \u0026#34;fullName\u0026#34;, qualifiedByName = \u0026#34;buildFullName\u0026#34;) @Mapping(source = \u0026#34;email\u0026#34;, target = \u0026#34;emailDomain\u0026#34;, qualifiedByName = \u0026#34;extractDomain\u0026#34;) UserDTO toDTO(User user); @Named(\u0026#34;buildFullName\u0026#34;) default String buildFullName(String firstName, String lastName) { if (firstName == null \u0026amp;\u0026amp; lastName == null) { return null; } return (firstName != null ? firstName : \u0026#34;\u0026#34;) + \u0026#34; \u0026#34; + (lastName != null ? lastName : \u0026#34;\u0026#34;); } @Named(\u0026#34;extractDomain\u0026#34;) default String extractDomain(String email) { if (email == null || !email.contains(\u0026#34;@\u0026#34;)) { return null; } return email.substring(email.indexOf(\u0026#34;@\u0026#34;) + 1); } } å¤šæºå¯¹è±¡æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 @Mapper public interface MultiSourceMapper { @Mapping(source = \u0026#34;user.id\u0026#34;, target = \u0026#34;userId\u0026#34;) @Mapping(source = \u0026#34;user.name\u0026#34;, target = \u0026#34;userName\u0026#34;) @Mapping(source = \u0026#34;address.street\u0026#34;, target = \u0026#34;street\u0026#34;) @Mapping(source = \u0026#34;address.city\u0026#34;, target = \u0026#34;city\u0026#34;) @Mapping(source = \u0026#34;profile.bio\u0026#34;, target = \u0026#34;biography\u0026#34;) UserDetailDTO combine(User user, Address address, Profile profile); } æ¡ä»¶æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Mapper public interface ConditionalMapper { @Mapping(target = \u0026#34;discountedPrice\u0026#34;, expression = \u0026#34;java(calculateDiscount(product))\u0026#34;) ProductDTO toDTO(Product product); default BigDecimal calculateDiscount(Product product) { if (product.getCategory().equals(\u0026#34;VIP\u0026#34;)) { return product.getPrice().multiply(new BigDecimal(\u0026#34;0.8\u0026#34;)); } return product.getPrice(); } } æšä¸¾æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // æºæšä¸¾ public enum UserStatus { ACTIVE, INACTIVE, PENDING } // ç›®æ ‡æšä¸¾ public enum UserState { ENABLED, DISABLED, WAITING } @Mapper public interface EnumMapper { @ValueMapping(source = \u0026#34;ACTIVE\u0026#34;, target = \u0026#34;ENABLED\u0026#34;) @ValueMapping(source = \u0026#34;INACTIVE\u0026#34;, target = \u0026#34;DISABLED\u0026#34;) @ValueMapping(source = \u0026#34;PENDING\u0026#34;, target = \u0026#34;WAITING\u0026#34;) UserState mapStatus(UserStatus status); // æˆ–ä½¿ç”¨è¡¨è¾¾å¼ @Mapping(target = \u0026#34;state\u0026#34;, expression = \u0026#34;java(mapUserStatus(user.getStatus()))\u0026#34;) UserDTO toDTO(User user); default UserState mapUserStatus(UserStatus status) { return switch (status) { case ACTIVE -\u0026gt; UserState.ENABLED; case INACTIVE -\u0026gt; UserState.DISABLED; case PENDING -\u0026gt; UserState.WAITING; }; } } é›†åˆä¸å¤æ‚å¯¹è±¡æ˜ å°„ é›†åˆæ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Mapper(componentModel = \u0026#34;spring\u0026#34;) public interface CollectionMapper { // Listæ˜ å°„ List\u0026lt;UserDTO\u0026gt; toDTOList(List\u0026lt;User\u0026gt; users); // Setæ˜ å°„ Set\u0026lt;UserDTO\u0026gt; toDTOSet(Set\u0026lt;User\u0026gt; users); // Mapæ˜ å°„ Map\u0026lt;String, UserDTO\u0026gt; toDTOMap(Map\u0026lt;String, User\u0026gt; userMap); // åµŒå¥—é›†åˆæ˜ å°„ @Mapping(source = \u0026#34;tags\u0026#34;, target = \u0026#34;tagNames\u0026#34;) ArticleDTO toDTO(Article article); // è‡ªå®šä¹‰é›†åˆè½¬æ¢ default List\u0026lt;String\u0026gt; mapTags(List\u0026lt;Tag\u0026gt; tags) { return tags.stream() .map(Tag::getName) .collect(Collectors.toList()); } } åµŒå¥—å¯¹è±¡æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @Mapper(uses = {AddressMapper.class, ProfileMapper.class}) public interface ComplexUserMapper { @Mapping(source = \u0026#34;personalInfo.firstName\u0026#34;, target = \u0026#34;firstName\u0026#34;) @Mapping(source = \u0026#34;personalInfo.lastName\u0026#34;, target = \u0026#34;lastName\u0026#34;) @Mapping(source = \u0026#34;contactInfo.email\u0026#34;, target = \u0026#34;email\u0026#34;) @Mapping(source = \u0026#34;contactInfo.phone\u0026#34;, target = \u0026#34;phoneNumber\u0026#34;) // addresså’Œprofileä¼šè‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„Mapper UserCompleteDTO toDTO(User user); } @Mapper public interface AddressMapper { AddressDTO toDTO(Address address); } @Mapper public interface ProfileMapper { ProfileDTO toDTO(Profile profile); } æ›´æ–°ç°æœ‰å¯¹è±¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Mapper public interface UpdateMapper { @Mapping(target = \u0026#34;id\u0026#34;, ignore = true) // ä¸æ›´æ–°ID @Mapping(target = \u0026#34;createdAt\u0026#34;, ignore = true) // ä¸æ›´æ–°åˆ›å»ºæ—¶é—´ @Mapping(target = \u0026#34;updatedAt\u0026#34;, expression = \u0026#34;java(java.time.LocalDateTime.now())\u0026#34;) void updateUserFromDTO(UserDTO dto, @MappingTarget User user); } // ä½¿ç”¨æ–¹å¼ @Service public class UserService { @Autowired private UpdateMapper updateMapper; public User updateUser(Long id, UserDTO dto) { User existingUser = userRepository.findById(id); updateMapper.updateUserFromDTO(dto, existingUser); return userRepository.save(existingUser); } } æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ– 1. ç»„ä»¶æ¨¡å‹é€‰æ‹© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // æ¨èï¼šSpringç¯å¢ƒä¸‹ä½¿ç”¨springç»„ä»¶æ¨¡å‹ @Mapper(componentModel = \u0026#34;spring\u0026#34;) public interface UserMapper { // ... } // CDIç¯å¢ƒ @Mapper(componentModel = \u0026#34;cdi\u0026#34;) public interface UserMapper { // ... } // é»˜è®¤æ–¹å¼ï¼ˆæ‰‹åŠ¨è·å–å®ä¾‹ï¼‰ @Mapper public interface UserMapper { UserMapper INSTANCE = Mappers.getMapper(UserMapper.class); // ... } 2. ç»§æ‰¿é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Mapper public interface BaseMapper { @Mapping(target = \u0026#34;createdAt\u0026#34;, ignore = true) @Mapping(target = \u0026#34;updatedAt\u0026#34;, ignore = true) @Mapping(target = \u0026#34;version\u0026#34;, ignore = true) BaseDTO toDTO(BaseEntity entity); } // ç»§æ‰¿åŸºç¡€é…ç½® @Mapper public interface UserMapper extends BaseMapper { @InheritConfiguration // ç»§æ‰¿çˆ¶æ¥å£é…ç½® @Mapping(source = \u0026#34;phone\u0026#34;, target = \u0026#34;phoneNumber\u0026#34;) UserDTO toDTO(User user); } 3. æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 @Mapper( componentModel = \u0026#34;spring\u0026#34;, unmappedTargetPolicy = ReportingPolicy.ERROR, // æœªæ˜ å°„å­—æ®µæŠ¥é”™ nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE // å¿½ç•¥nullå€¼ ) public interface OptimizedMapper { // å¯¹äºå¤§å‹å¯¹è±¡ï¼Œè€ƒè™‘ä½¿ç”¨Builderæ¨¡å¼ @Builder @Mapping(source = \u0026#34;user.profile.bio\u0026#34;, target = \u0026#34;biography\u0026#34;) UserDTO toDTO(User user); } 4. è°ƒè¯•ä¸éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Mapper( componentModel = \u0026#34;spring\u0026#34;, unmappedTargetPolicy = ReportingPolicy.WARN, // è­¦å‘Šæœªæ˜ å°„å­—æ®µ unmappedSourcePolicy = ReportingPolicy.WARN // è­¦å‘Šæœªä½¿ç”¨æºå­—æ®µ ) public interface DebuggableMapper { // ä½¿ç”¨@BeanMappingè¿›è¡Œè¯¦ç»†é…ç½® @BeanMapping( nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.SET_TO_NULL, nullValueCheckStrategy = NullValueCheckStrategy.ALWAYS ) UserDTO toDTO(User user); } å®æˆ˜æ¡ˆä¾‹ æ¡ˆä¾‹1ï¼šç”µå•†è®¢å•ç³»ç»Ÿ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œéœ€è¦å¤„ç†è®¢å•æ•°æ®çš„è½¬æ¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 // å®ä½“ç±» @Entity @Data public class Order { private Long id; private String orderNumber; private LocalDateTime orderTime; private OrderStatus status; private BigDecimal totalAmount; private User customer; private List\u0026lt;OrderItem\u0026gt; items; private Address shippingAddress; } @Entity @Data public class OrderItem { private Long id; private Product product; private Integer quantity; private BigDecimal unitPrice; private BigDecimal subtotal; } // DTOç±» @Data public class OrderDTO { private Long orderId; private String orderNumber; private String orderTimeStr; private String statusName; private BigDecimal totalAmount; private String customerName; private List\u0026lt;OrderItemDTO\u0026gt; items; private String shippingAddressStr; private Integer totalItems; private BigDecimal averageItemPrice; } @Data public class OrderItemDTO { private String productName; private String productCode; private Integer quantity; private BigDecimal unitPrice; private BigDecimal subtotal; } // Mapperå®ç° @Mapper( componentModel = \u0026#34;spring\u0026#34;, uses = {OrderItemMapper.class}, imports = {DateTimeFormatter.class, Collectors.class} ) public interface OrderMapper { @Mapping(source = \u0026#34;id\u0026#34;, target = \u0026#34;orderId\u0026#34;) @Mapping(source = \u0026#34;orderTime\u0026#34;, target = \u0026#34;orderTimeStr\u0026#34;, dateFormat = \u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;) @Mapping(source = \u0026#34;status\u0026#34;, target = \u0026#34;statusName\u0026#34;, qualifiedByName = \u0026#34;mapOrderStatus\u0026#34;) @Mapping(source = \u0026#34;customer.firstName\u0026#34;, target = \u0026#34;customerName\u0026#34;, qualifiedByName = \u0026#34;buildCustomerName\u0026#34;) @Mapping(source = \u0026#34;shippingAddress\u0026#34;, target = \u0026#34;shippingAddressStr\u0026#34;, qualifiedByName = \u0026#34;formatAddress\u0026#34;) @Mapping(target = \u0026#34;totalItems\u0026#34;, expression = \u0026#34;java(calculateTotalItems(order.getItems()))\u0026#34;) @Mapping(target = \u0026#34;averageItemPrice\u0026#34;, expression = \u0026#34;java(calculateAveragePrice(order.getItems()))\u0026#34;) OrderDTO toDTO(Order order); @Named(\u0026#34;mapOrderStatus\u0026#34;) default String mapOrderStatus(OrderStatus status) { return switch (status) { case PENDING -\u0026gt; \u0026#34;å¾…å¤„ç†\u0026#34;; case CONFIRMED -\u0026gt; \u0026#34;å·²ç¡®è®¤\u0026#34;; case SHIPPED -\u0026gt; \u0026#34;å·²å‘è´§\u0026#34;; case DELIVERED -\u0026gt; \u0026#34;å·²é€è¾¾\u0026#34;; case CANCELLED -\u0026gt; \u0026#34;å·²å–æ¶ˆ\u0026#34;; }; } @Named(\u0026#34;buildCustomerName\u0026#34;) default String buildCustomerName(String firstName, String lastName) { return (firstName != null ? firstName : \u0026#34;\u0026#34;) + (lastName != null ? \u0026#34; \u0026#34; + lastName : \u0026#34;\u0026#34;); } @Named(\u0026#34;formatAddress\u0026#34;) default String formatAddress(Address address) { if (address == null) return null; return String.format(\u0026#34;%s %s, %s, %s\u0026#34;, address.getStreet(), address.getCity(), address.getState(), address.getZipCode()); } default Integer calculateTotalItems(List\u0026lt;OrderItem\u0026gt; items) { return items.stream() .mapToInt(OrderItem::getQuantity) .sum(); } default BigDecimal calculateAveragePrice(List\u0026lt;OrderItem\u0026gt; items) { if (items.isEmpty()) return BigDecimal.ZERO; BigDecimal total = items.stream() .map(OrderItem::getUnitPrice) .reduce(BigDecimal.ZERO, BigDecimal::add); return total.divide(new BigDecimal(items.size()), 2, RoundingMode.HALF_UP); } } @Mapper(componentModel = \u0026#34;spring\u0026#34;) public interface OrderItemMapper { @Mapping(source = \u0026#34;product.name\u0026#34;, target = \u0026#34;productName\u0026#34;) @Mapping(source = \u0026#34;product.code\u0026#34;, target = \u0026#34;productCode\u0026#34;) OrderItemDTO toDTO(OrderItem item); } æ¡ˆä¾‹2ï¼šç”¨æˆ·æƒé™ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // å¤æ‚çš„ç”¨æˆ·æƒé™æ˜ å°„ @Mapper( componentModel = \u0026#34;spring\u0026#34;, uses = {RoleMapper.class, PermissionMapper.class} ) public interface UserSecurityMapper { @Mapping(source = \u0026#34;user.id\u0026#34;, target = \u0026#34;userId\u0026#34;) @Mapping(source = \u0026#34;user.username\u0026#34;, target = \u0026#34;username\u0026#34;) @Mapping(source = \u0026#34;user.roles\u0026#34;, target = \u0026#34;roleNames\u0026#34;, qualifiedByName = \u0026#34;extractRoleNames\u0026#34;) @Mapping(source = \u0026#34;user.roles\u0026#34;, target = \u0026#34;permissions\u0026#34;, qualifiedByName = \u0026#34;extractAllPermissions\u0026#34;) @Mapping(target = \u0026#34;hasAdminRole\u0026#34;, expression = \u0026#34;java(checkAdminRole(user.getRoles()))\u0026#34;) UserSecurityDTO toSecurityDTO(User user); @Named(\u0026#34;extractRoleNames\u0026#34;) default Set\u0026lt;String\u0026gt; extractRoleNames(Set\u0026lt;Role\u0026gt; roles) { return roles.stream() .map(Role::getName) .collect(Collectors.toSet()); } @Named(\u0026#34;extractAllPermissions\u0026#34;) default Set\u0026lt;String\u0026gt; extractAllPermissions(Set\u0026lt;Role\u0026gt; roles) { return roles.stream() .flatMap(role -\u0026gt; role.getPermissions().stream()) .map(Permission::getName) .collect(Collectors.toSet()); } default Boolean checkAdminRole(Set\u0026lt;Role\u0026gt; roles) { return roles.stream() .anyMatch(role -\u0026gt; \u0026#34;ADMIN\u0026#34;.equals(role.getName())); } } å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ 1. ç¼–è¯‘æ—¶é”™è¯¯ é—®é¢˜ï¼š \u0026ldquo;No property named \u0026lsquo;xxx\u0026rsquo; exists in source parameter\u0026rdquo;\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 // ç¡®ä¿å­—æ®µåæ­£ç¡®ï¼Œæˆ–ä½¿ç”¨@MappingæŒ‡å®š @Mapping(source = \u0026#34;firstName\u0026#34;, target = \u0026#34;fname\u0026#34;) // æ˜ç¡®æŒ‡å®šæ˜ å°„å…³ç³» é—®é¢˜ï¼š å¾ªç¯ä¾èµ–\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 @Mapper(uses = {DepartmentMapper.class}) public interface EmployeeMapper { @Mapping(target = \u0026#34;department.employees\u0026#34;, ignore = true) // å¿½ç•¥å¾ªç¯å¼•ç”¨ EmployeeDTO toDTO(Employee employee); } 2. è¿è¡Œæ—¶é—®é¢˜ é—®é¢˜ï¼š NullPointerException\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 @Mapper( nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE, nullValueCheckStrategy = NullValueCheckStrategy.ALWAYS ) public interface SafeMapper { @Mapping(target = \u0026#34;address\u0026#34;, expression = \u0026#34;java(user.getAddress() != null ? mapAddress(user.getAddress()) : null)\u0026#34;) UserDTO toDTO(User user); } 3. æ€§èƒ½é—®é¢˜ é—®é¢˜ï¼š å¤§é‡å¯¹è±¡è½¬æ¢æ€§èƒ½å·®\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Mapper( componentModel = \u0026#34;spring\u0026#34;, implementationName = \u0026#34;Fast\u0026lt;CLASS_NAME\u0026gt;Impl\u0026#34;, // è‡ªå®šä¹‰å®ç°ç±»å implementationPackage = \u0026#34;com.example.mapper.impl\u0026#34; // æŒ‡å®šåŒ…å ) public interface FastMapper { // ä½¿ç”¨Stream APIè¿›è¡Œæ‰¹é‡è½¬æ¢ default List\u0026lt;UserDTO\u0026gt; toBatchDTO(List\u0026lt;User\u0026gt; users) { return users.parallelStream() // å¹¶è¡Œå¤„ç† .map(this::toDTO) .collect(Collectors.toList()); } } 4. è°ƒè¯•æŠ€å·§ å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š\n1 2 3 4 5 6 7 8 @Mapper( componentModel = \u0026#34;spring\u0026#34;, unmappedTargetPolicy = ReportingPolicy.WARN, unmappedSourcePolicy = ReportingPolicy.WARN ) public interface DebuggableMapper { // MapStructä¼šåœ¨ç¼–è¯‘æ—¶è¾“å‡ºè¯¦ç»†çš„æ˜ å°„ä¿¡æ¯ } æŸ¥çœ‹ç”Ÿæˆçš„ä»£ç ï¼š ç”Ÿæˆçš„å®ç°ç±»ä½äºï¼štarget/generated-sources/annotations/\nğŸ¯ æ€»ç»“ MapStructæ˜¯Javaå¼€å‘ä¸­å¤„ç†å¯¹è±¡æ˜ å°„çš„å¼ºå¤§å·¥å…·ï¼Œé€šè¿‡æœ¬æ•™ç¨‹ä½ å·²ç»æŒæ¡äº†ï¼š\næ ¸å¿ƒçŸ¥è¯†ç‚¹ âœ… MapStructçš„åŸºæœ¬æ¦‚å¿µå’Œä¼˜åŠ¿ âœ… ç¯å¢ƒæ­å»ºå’Œé…ç½®æ–¹æ³• âœ… åŸºç¡€æ˜ å°„å’Œé«˜çº§æ˜ å°„æŠ€å·§ âœ… é›†åˆå’Œå¤æ‚å¯¹è±¡çš„å¤„ç† âœ… æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ– å®ç”¨æŠ€å·§ ğŸ”§ ä½¿ç”¨@Mappingè¿›è¡Œå­—æ®µæ˜ å°„ ğŸ”§ é€šè¿‡@Namedåˆ›å»ºè‡ªå®šä¹‰è½¬æ¢æ–¹æ³• ğŸ”§ åˆ©ç”¨@InheritConfigurationå‡å°‘é‡å¤é…ç½® ğŸ”§ ä½¿ç”¨expressionå¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘ æœ€ä½³å®è·µ é€‰æ‹©åˆé€‚çš„ç»„ä»¶æ¨¡å‹ï¼ˆæ¨èä½¿ç”¨componentModel = \u0026quot;spring\u0026quot;ï¼‰ åˆç†ä½¿ç”¨ç»§æ‰¿é…ç½®å‡å°‘ä»£ç é‡å¤ å¤„ç†nullå€¼é¿å…è¿è¡Œæ—¶å¼‚å¸¸ æ³¨æ„å¾ªç¯ä¾èµ–é—®é¢˜ å…³æ³¨æ€§èƒ½ä¼˜åŒ–ï¼Œç‰¹åˆ«æ˜¯å¤§æ‰¹é‡æ•°æ®è½¬æ¢ ä¸‹ä¸€æ­¥å»ºè®® æ·±å…¥å®è·µï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨MapStruct æ¢ç´¢é«˜çº§ç‰¹æ€§ï¼šå¦‚è£…é¥°å™¨æ¨¡å¼ã€æ¡ä»¶æ˜ å°„ç­‰ é›†æˆæµ‹è¯•ï¼šç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯æ˜ å°„é€»è¾‘ ç›‘æ§æ€§èƒ½ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è§‚å¯Ÿæ˜ å°„æ€§èƒ½ MapStructè®©å¯¹è±¡æ˜ å°„å˜å¾—ç®€å•è€Œé«˜æ•ˆï¼ŒæŒæ¡äº†è¿™ä¸ªå·¥å…·ï¼Œä½ å°†åœ¨Javaå¼€å‘ä¸­å¦‚è™æ·»ç¿¼ï¼ğŸš€\næ¨èé˜…è¯»ï¼š\nMapStructå®˜æ–¹æ–‡æ¡£ Spring Booté›†æˆæœ€ä½³å®è·µ Javaæ€§èƒ½ä¼˜åŒ–æŒ‡å— Happy Coding! ğŸ‰\n","date":"2025-07-03T00:00:00Z","image":"https://nova-bryan.github.io/p/mapstruct%E5%AE%8C%E5%85%A8%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/mapstruct%E5%AE%8C%E5%85%A8%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/","title":"MapStructå®Œå…¨å­¦ä¹ æŒ‡å—"},{"content":"æ•°æ®åº“ç´¢å¼•å®Œå…¨æŒ‡å— ç›®å½• ä»€ä¹ˆæ˜¯æ•°æ®åº“ç´¢å¼• ç´¢å¼•çš„åŸºæœ¬åŸç† ç´¢å¼•çš„ç±»å‹ ç´¢å¼•çš„åˆ›å»ºå’Œä½¿ç”¨ ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ ç´¢å¼•ä¼˜åŒ–å®è·µ æ€»ç»“ ä»€ä¹ˆæ˜¯æ•°æ®åº“ç´¢å¼• æ•°æ®åº“ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒæä¾›äº†å¿«é€Ÿè®¿é—®æ•°æ®åº“è¡¨ä¸­æ•°æ®çš„è·¯å¾„ã€‚å°±åƒä¹¦ç±çš„ç›®å½•ä¸€æ ·ï¼Œç´¢å¼•å¯ä»¥å¸®åŠ©æ•°æ®åº“å¿«é€Ÿå®šä½åˆ°å…·ä½“çš„æ•°æ®è¡Œï¼Œè€Œä¸éœ€è¦æ‰«ææ•´ä¸ªè¡¨ã€‚\nå½¢è±¡åŒ–ç†è§£ æƒ³è±¡ä½ è¦åœ¨ä¸€æœ¬1000é¡µçš„å­—å…¸ä¸­æŸ¥æ‰¾å•è¯\u0026quot;database\u0026quot;ï¼š\næ²¡æœ‰ç´¢å¼•ï¼šä½ éœ€è¦ä»ç¬¬1é¡µå¼€å§‹é€é¡µç¿»é˜…ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ æœ‰ç´¢å¼•ï¼šä½ ç›´æ¥ç¿»åˆ°\u0026quot;D\u0026quot;å¼€å¤´çš„ç›®å½•é¡µï¼Œå¿«é€Ÿå®šä½åˆ°å…·ä½“é¡µç  ç´¢å¼•å°±æ˜¯æ•°æ®åº“çš„\u0026quot;ç›®å½•\u0026quot;ã€‚\næ€§èƒ½å¯¹æ¯”ç¤ºæ„å›¾ 1 2 3 4 5 6 7 8 9 graph TD A[\u0026#34;å…¨è¡¨æ‰«æ\u0026lt;br/\u0026gt;O(n) æ—¶é—´å¤æ‚åº¦\u0026#34;] --\u0026gt; B[\u0026#34;é€è¡Œæ£€æŸ¥æ¯æ¡è®°å½•\u0026#34;] B --\u0026gt; C[\u0026#34;æ‰¾åˆ°åŒ¹é…è®°å½•\u0026#34;] D[\u0026#34;ä½¿ç”¨ç´¢å¼•\u0026lt;br/\u0026gt;O(log n) æ—¶é—´å¤æ‚åº¦\u0026#34;] --\u0026gt; E[\u0026#34;é€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½\u0026#34;] E --\u0026gt; F[\u0026#34;ç›´æ¥è®¿é—®ç›®æ ‡è®°å½•\u0026#34;] G[\u0026#34;1000ä¸‡è®°å½•å¯¹æ¯”\u0026#34;] --\u0026gt; H[\u0026#34;å…¨è¡¨æ‰«æ: æœ€å¤š1000ä¸‡æ¬¡æ¯”è¾ƒ\u0026#34;] G --\u0026gt; I[\u0026#34;B+æ ‘ç´¢å¼•: æœ€å¤š4æ¬¡æ¯”è¾ƒ\u0026#34;] ç´¢å¼•çš„åŸºæœ¬åŸç† æ•°æ®å­˜å‚¨ç»“æ„ æ•°æ®åº“ä¸­çš„æ•°æ®é€šå¸¸å­˜å‚¨åœ¨**é¡µ(Page)**ä¸­ï¼Œæ¯ä¸ªé¡µåŒ…å«å¤šæ¡è®°å½•ã€‚\n1 2 3 4 5 è¡¨æ•°æ®å­˜å‚¨ç¤ºæ„ï¼š é¡µ1: [è®°å½•1, è®°å½•2, è®°å½•3, ...] é¡µ2: [è®°å½•101, è®°å½•102, è®°å½•103, ...] é¡µ3: [è®°å½•201, è®°å½•202, è®°å½•203, ...] ... B+æ ‘ç´¢å¼•åŸç† å¤§å¤šæ•°æ•°æ®åº“ä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼š\n1 2 3 4 5 6 B+æ ‘ç´¢å¼•ç»“æ„ï¼š æ ¹èŠ‚ç‚¹ / \\ å†…éƒ¨èŠ‚ç‚¹1 å†…éƒ¨èŠ‚ç‚¹2 / | \\ / | \\ å¶å­èŠ‚ç‚¹1 å¶å­2 å¶å­3 å¶å­4 å¶å­5 å¶å­6 B+æ ‘çš„ç‰¹ç‚¹ï¼š\næ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ å¶å­èŠ‚ç‚¹ä¹‹é—´æœ‰æŒ‡é’ˆè¿æ¥ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢ æ ‘çš„é«˜åº¦è¾ƒä½ï¼Œå‡å°‘ç£ç›˜I/Oæ¬¡æ•° æ”¯æŒé¡ºåºè®¿é—®å’Œéšæœºè®¿é—® B+æ ‘è¯¦ç»†ç»“æ„å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 graph TD subgraph \u0026#34;B+æ ‘ç´¢å¼•ç»“æ„\u0026#34; Root[\u0026#34;æ ¹èŠ‚ç‚¹\u0026lt;br/\u0026gt;[30, 60]\u0026#34;] Internal1[\u0026#34;å†…éƒ¨èŠ‚ç‚¹1\u0026lt;br/\u0026gt;[10, 20]\u0026#34;] Internal2[\u0026#34;å†…éƒ¨èŠ‚ç‚¹2\u0026lt;br/\u0026gt;[40, 50]\u0026#34;] Internal3[\u0026#34;å†…éƒ¨èŠ‚ç‚¹3\u0026lt;br/\u0026gt;[70, 80]\u0026#34;] Leaf1[\u0026#34;å¶å­èŠ‚ç‚¹1\u0026lt;br/\u0026gt;[1,5,8,10]\u0026lt;br/\u0026gt;â†’ æ•°æ®é¡µ1\u0026#34;] Leaf2[\u0026#34;å¶å­èŠ‚ç‚¹2\u0026lt;br/\u0026gt;[15,18,20,25]\u0026lt;br/\u0026gt;â†’ æ•°æ®é¡µ2\u0026#34;] Leaf3[\u0026#34;å¶å­èŠ‚ç‚¹3\u0026lt;br/\u0026gt;[35,38,40,42]\u0026lt;br/\u0026gt;â†’ æ•°æ®é¡µ3\u0026#34;] Leaf4[\u0026#34;å¶å­èŠ‚ç‚¹4\u0026lt;br/\u0026gt;[45,48,50,55]\u0026lt;br/\u0026gt;â†’ æ•°æ®é¡µ4\u0026#34;] Leaf5[\u0026#34;å¶å­èŠ‚ç‚¹5\u0026lt;br/\u0026gt;[65,68,70,75]\u0026lt;br/\u0026gt;â†’ æ•°æ®é¡µ5\u0026#34;] Leaf6[\u0026#34;å¶å­èŠ‚ç‚¹6\u0026lt;br/\u0026gt;[78,80,85,90]\u0026lt;br/\u0026gt;â†’ æ•°æ®é¡µ6\u0026#34;] Root --\u0026gt; Internal1 Root --\u0026gt; Internal2 Root --\u0026gt; Internal3 Internal1 --\u0026gt; Leaf1 Internal1 --\u0026gt; Leaf2 Internal2 --\u0026gt; Leaf3 Internal2 --\u0026gt; Leaf4 Internal3 --\u0026gt; Leaf5 Internal3 --\u0026gt; Leaf6 Leaf1 -.-\u0026gt; Leaf2 Leaf2 -.-\u0026gt; Leaf3 Leaf3 -.-\u0026gt; Leaf4 Leaf4 -.-\u0026gt; Leaf5 Leaf5 -.-\u0026gt; Leaf6 end ç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹ ä»æ ¹èŠ‚ç‚¹å¼€å§‹ æ ¹æ®æ¯”è¾ƒç»“æœé€‰æ‹©åˆ†æ”¯ é€å±‚å‘ä¸‹ç›´åˆ°å¶å­èŠ‚ç‚¹ åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°ç›®æ ‡æ•°æ® æŸ¥æ‰¾è¿‡ç¨‹æµç¨‹å›¾ 1 2 3 4 5 6 7 8 9 10 11 flowchart TD A[\u0026#34;æŸ¥è¯¢: SELECT * FROM users WHERE id = 42\u0026#34;] --\u0026gt; B[\u0026#34;å¼€å§‹ä»æ ¹èŠ‚ç‚¹æŸ¥æ‰¾\u0026#34;] B --\u0026gt; C[\u0026#34;æ ¹èŠ‚ç‚¹: [30, 60]\u0026lt;br/\u0026gt;42 \u0026gt; 30 ä¸” 42 \u0026lt; 60\u0026#34;] C --\u0026gt; D[\u0026#34;è¿›å…¥ä¸­é—´èŠ‚ç‚¹2: [40, 50]\u0026lt;br/\u0026gt;42 \u0026gt; 40 ä¸” 42 \u0026lt; 50\u0026#34;] D --\u0026gt; E[\u0026#34;è¿›å…¥å¶å­èŠ‚ç‚¹3: [35,38,40,42]\u0026lt;br/\u0026gt;æ‰¾åˆ°ç›®æ ‡å€¼ 42\u0026#34;] E --\u0026gt; F[\u0026#34;é€šè¿‡æŒ‡é’ˆè®¿é—®æ•°æ®é¡µ3\u0026#34;] F --\u0026gt; G[\u0026#34;è¿”å›å®Œæ•´è®°å½•æ•°æ®\u0026#34;] style A fill:#e1f5fe style G fill:#c8e6c9 style E fill:#fff3e0 ç´¢å¼•çš„ç±»å‹ ç´¢å¼•åˆ†ç±»æ€»è§ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 graph TD A[\u0026#34;æ•°æ®åº“ç´¢å¼•åˆ†ç±»\u0026#34;] --\u0026gt; B[\u0026#34;æŒ‰æ•°æ®ç»“æ„\u0026#34;] A --\u0026gt; C[\u0026#34;æŒ‰å­—æ®µæ•°é‡\u0026#34;] A --\u0026gt; D[\u0026#34;æŒ‰åŠŸèƒ½ç‰¹æ€§\u0026#34;] B --\u0026gt; B1[\u0026#34;B+æ ‘ç´¢å¼•\u0026lt;br/\u0026gt;ï¼ˆæœ€å¸¸ç”¨ï¼‰\u0026#34;] B --\u0026gt; B2[\u0026#34;å“ˆå¸Œç´¢å¼•\u0026lt;br/\u0026gt;ï¼ˆç­‰å€¼æŸ¥è¯¢ï¼‰\u0026#34;] B --\u0026gt; B3[\u0026#34;å…¨æ–‡ç´¢å¼•\u0026lt;br/\u0026gt;ï¼ˆæ–‡æœ¬æœç´¢ï¼‰\u0026#34;] C --\u0026gt; C1[\u0026#34;å•åˆ—ç´¢å¼•\u0026lt;br/\u0026gt;CREATE INDEX idx_name ON users(name)\u0026#34;] C --\u0026gt; C2[\u0026#34;å¤åˆç´¢å¼•\u0026lt;br/\u0026gt;CREATE INDEX idx_name_age ON users(name,age)\u0026#34;] D --\u0026gt; D1[\u0026#34;æ™®é€šç´¢å¼•\u0026lt;br/\u0026gt;ï¼ˆå¯é‡å¤ï¼‰\u0026#34;] D --\u0026gt; D2[\u0026#34;å”¯ä¸€ç´¢å¼•\u0026lt;br/\u0026gt;ï¼ˆä¸å¯é‡å¤ï¼‰\u0026#34;] D --\u0026gt; D3[\u0026#34;ä¸»é”®ç´¢å¼•\u0026lt;br/\u0026gt;ï¼ˆä¸»é”®çº¦æŸï¼‰\u0026#34;] style B1 fill:#c8e6c9 style C2 fill:#fff3e0 style D3 fill:#ffcdd2 1. æŒ‰æ•°æ®ç»“æ„åˆ†ç±» B+æ ‘ç´¢å¼•ï¼ˆæœ€å¸¸ç”¨ï¼‰ ç‰¹ç‚¹ï¼šå¹³è¡¡å¤šè·¯æœç´¢æ ‘ é€‚ç”¨ï¼šç­‰å€¼æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢ã€æ’åº å­˜å‚¨å¼•æ“ï¼šInnoDBã€MyISAM å“ˆå¸Œç´¢å¼• ç‰¹ç‚¹ï¼šåŸºäºå“ˆå¸Œè¡¨ é€‚ç”¨ï¼šç­‰å€¼æŸ¥è¯¢ é™åˆ¶ï¼šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æ’åº å­˜å‚¨å¼•æ“ï¼šMemory 2. æŒ‰å­—æ®µæ•°é‡åˆ†ç±» å•åˆ—ç´¢å¼• 1 CREATE INDEX idx_name ON users(name); å¤åˆç´¢å¼•ï¼ˆè”åˆç´¢å¼•ï¼‰ 1 CREATE INDEX idx_name_age ON users(name, age); 3. æŒ‰åŠŸèƒ½åˆ†ç±» æ™®é€šç´¢å¼• 1 CREATE INDEX idx_email ON users(email); å”¯ä¸€ç´¢å¼• 1 CREATE UNIQUE INDEX idx_username ON users(username); ä¸»é”®ç´¢å¼• 1 ALTER TABLE users ADD PRIMARY KEY(id); å…¨æ–‡ç´¢å¼• 1 CREATE FULLTEXT INDEX idx_content ON articles(content); ç´¢å¼•çš„åˆ›å»ºå’Œä½¿ç”¨ åˆ›å»ºç´¢å¼• å»ºè¡¨æ—¶åˆ›å»º 1 2 3 4 5 6 7 8 9 CREATE TABLE users ( id INT PRIMARY KEY, username VARCHAR(50) UNIQUE, email VARCHAR(100), age INT, created_at TIMESTAMP, INDEX idx_email (email), INDEX idx_age_created (age, created_at) ); å»ºè¡¨ååˆ›å»º 1 2 3 4 5 6 7 8 -- æ™®é€šç´¢å¼• CREATE INDEX idx_email ON users(email); -- å”¯ä¸€ç´¢å¼• CREATE UNIQUE INDEX idx_username ON users(username); -- å¤åˆç´¢å¼• CREATE INDEX idx_name_age ON users(name, age); æŸ¥çœ‹ç´¢å¼• 1 2 3 4 5 -- æŸ¥çœ‹è¡¨çš„æ‰€æœ‰ç´¢å¼• SHOW INDEX FROM users; -- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ EXPLAIN SELECT * FROM users WHERE email = \u0026#39;john@example.com\u0026#39;; åˆ é™¤ç´¢å¼• 1 DROP INDEX idx_email ON users; ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ 1. æé«˜æŸ¥è¯¢é€Ÿåº¦ æ— ç´¢å¼•ï¼šå…¨è¡¨æ‰«æï¼Œæ—¶é—´å¤æ‚åº¦ O(n) æœ‰ç´¢å¼•ï¼šB+æ ‘æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ O(log n) 2. åŠ é€Ÿæ’åº 1 2 -- å¦‚æœnameå­—æ®µæœ‰ç´¢å¼•ï¼Œä»¥ä¸‹æŸ¥è¯¢ä¼šå¾ˆå¿« SELECT * FROM users ORDER BY name; 3. æå‡è¿æ¥æ•ˆç‡ 1 2 3 -- å¦‚æœuser_idæœ‰ç´¢å¼•ï¼ŒJOINæ“ä½œä¼šæ›´å¿« SELECT * FROM orders o JOIN users u ON o.user_id = u.id; 4. åŠ é€Ÿåˆ†ç»„ 1 2 -- å¦‚æœstatusæœ‰ç´¢å¼•ï¼ŒGROUP BYä¼šæ›´å¿« SELECT status, COUNT(*) FROM orders GROUP BY status; ç¼ºç‚¹ 1. å ç”¨å­˜å‚¨ç©ºé—´ ç´¢å¼•éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ å¤åˆç´¢å¼•å ç”¨ç©ºé—´æ›´å¤§ 2. é™ä½å†™æ“ä½œæ€§èƒ½ INSERTï¼šéœ€è¦ç»´æŠ¤ç´¢å¼•ç»“æ„ UPDATEï¼šå¯èƒ½éœ€è¦æ›´æ–°ç´¢å¼• DELETEï¼šéœ€è¦ä»ç´¢å¼•ä¸­åˆ é™¤æ¡ç›® 3. ç»´æŠ¤æˆæœ¬ æ•°æ®å˜æ›´æ—¶éœ€è¦åŒæ­¥æ›´æ–°ç´¢å¼• ç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤æˆæœ¬è¶Šé«˜ ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ ç´¢å¼•å¤±æ•ˆåœºæ™¯æ€»è§ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 graph LR A[\u0026#34;ç´¢å¼•å¤±æ•ˆåœºæ™¯\u0026#34;] --\u0026gt; B[\u0026#34;å‡½æ•°æ“ä½œ\u0026lt;br/\u0026gt;WHERE UPPER(name) = \u0026#39;JOHN\u0026#39;\u0026#34;] A --\u0026gt; C[\u0026#34;ç±»å‹è½¬æ¢\u0026lt;br/\u0026gt;WHERE phone = 123456\u0026#34;] A --\u0026gt; D[\u0026#34;å‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢\u0026lt;br/\u0026gt;WHERE name LIKE \u0026#39;%john\u0026#39;\u0026#34;] A --\u0026gt; E[\u0026#34;ORè¿æ¥æ¡ä»¶\u0026lt;br/\u0026gt;WHERE name=\u0026#39;john\u0026#39; OR age=25\u0026#34;] A --\u0026gt; F[\u0026#34;éæœ€å·¦åŒ¹é…\u0026lt;br/\u0026gt;å¤åˆç´¢å¼•(name,age,city)\u0026lt;br/\u0026gt;WHERE age=25\u0026#34;] A --\u0026gt; G[\u0026#34;ä¸ç­‰äºæ“ä½œ\u0026lt;br/\u0026gt;WHERE status != \u0026#39;active\u0026#39;\u0026#34;] A --\u0026gt; H[\u0026#34;NULLå€¼åˆ¤æ–­\u0026lt;br/\u0026gt;WHERE email IS NULL\u0026#34;] style B fill:#ffcdd2 style C fill:#ffcdd2 style D fill:#ffcdd2 style E fill:#ffcdd2 style F fill:#ffcdd2 style G fill:#ffcdd2 style H fill:#ffcdd2 1. å‡½æ•°æ“ä½œ 1 2 3 4 5 -- ç´¢å¼•å¤±æ•ˆ SELECT * FROM users WHERE UPPER(name) = \u0026#39;JOHN\u0026#39;; -- æ­£ç¡®åšæ³• SELECT * FROM users WHERE name = \u0026#39;john\u0026#39;; 2. ç±»å‹è½¬æ¢ 1 2 3 4 5 -- ç´¢å¼•å¤±æ•ˆï¼ˆå‡è®¾phoneæ˜¯VARCHARç±»å‹ï¼‰ SELECT * FROM users WHERE phone = 12345678901; -- æ­£ç¡®åšæ³• SELECT * FROM users WHERE phone = \u0026#39;12345678901\u0026#39;; 3. å‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ 1 2 3 4 5 -- ç´¢å¼•å¤±æ•ˆ SELECT * FROM users WHERE name LIKE \u0026#39;%john\u0026#39;; -- å¯ä»¥ä½¿ç”¨ç´¢å¼• SELECT * FROM users WHERE name LIKE \u0026#39;john%\u0026#39;; 4. ORè¿æ¥çš„æ¡ä»¶ 1 2 3 4 5 6 7 -- å¦‚æœageæ²¡æœ‰ç´¢å¼•ï¼Œæ•´ä¸ªæŸ¥è¯¢æ— æ³•ä½¿ç”¨ç´¢å¼• SELECT * FROM users WHERE name = \u0026#39;john\u0026#39; OR age = 25; -- æ”¹å†™ä¸ºUNIONï¼ˆå¦‚æœä¸¤ä¸ªå­—æ®µéƒ½æœ‰ç´¢å¼•ï¼‰ SELECT * FROM users WHERE name = \u0026#39;john\u0026#39; UNION SELECT * FROM users WHERE age = 25; 5. å¤åˆç´¢å¼•çš„éæœ€å·¦åŒ¹é… 1 2 3 4 5 6 7 8 9 -- å‡è®¾æœ‰å¤åˆç´¢å¼• (name, age, city) -- å¯ä»¥ä½¿ç”¨ç´¢å¼• SELECT * FROM users WHERE name = \u0026#39;john\u0026#39;; SELECT * FROM users WHERE name = \u0026#39;john\u0026#39; AND age = 25; -- ç´¢å¼•å¤±æ•ˆ SELECT * FROM users WHERE age = 25; SELECT * FROM users WHERE city = \u0026#39;beijing\u0026#39;; 6. ä¸ç­‰äºæ“ä½œ 1 2 3 4 5 -- å¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆ SELECT * FROM users WHERE status != \u0026#39;active\u0026#39;; -- å»ºè®®æ”¹å†™ SELECT * FROM users WHERE status IN (\u0026#39;inactive\u0026#39;, \u0026#39;deleted\u0026#39;); 7. NULLå€¼åˆ¤æ–­ 1 2 3 -- ç´¢å¼•æ•ˆæœæœ‰é™ SELECT * FROM users WHERE email IS NULL; SELECT * FROM users WHERE email IS NOT NULL; ç´¢å¼•ä¼˜åŒ–å®è·µ 1. é€‰æ‹©åˆé€‚çš„å­—æ®µåˆ›å»ºç´¢å¼• é«˜é€‰æ‹©æ€§å­—æ®µ 1 2 3 4 5 -- å¥½çš„é€‰æ‹©ï¼šç”¨æˆ·é‚®ç®±ï¼ˆå‡ ä¹å”¯ä¸€ï¼‰ CREATE INDEX idx_email ON users(email); -- å·®çš„é€‰æ‹©ï¼šæ€§åˆ«å­—æ®µï¼ˆåªæœ‰å‡ ä¸ªå€¼ï¼‰ -- ä¸å»ºè®®ï¼šCREATE INDEX idx_gender ON users(gender); ç»å¸¸ç”¨äºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ 1 2 3 4 5 -- ç»å¸¸ç”¨äºWHEREå­å¥ CREATE INDEX idx_status ON orders(status); -- ç»å¸¸ç”¨äºJOIN CREATE INDEX idx_user_id ON orders(user_id); 2. å¤åˆç´¢å¼•è®¾è®¡åŸåˆ™ æœ€å·¦å‰ç¼€åŸåˆ™ 1 2 3 4 5 6 7 8 9 -- ç´¢å¼•ï¼š(name, age, city) -- å¯ä»¥ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ï¼š SELECT * FROM users WHERE name = \u0026#39;john\u0026#39;; -- âœ“ SELECT * FROM users WHERE name = \u0026#39;john\u0026#39; AND age = 25; -- âœ“ SELECT * FROM users WHERE name = \u0026#39;john\u0026#39; AND city = \u0026#39;bj\u0026#39;; -- âœ“ï¼ˆä½†ä¸æ˜¯æœ€ä¼˜ï¼‰ -- ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ï¼š SELECT * FROM users WHERE age = 25; -- âœ— SELECT * FROM users WHERE city = \u0026#39;beijing\u0026#39;; -- âœ— å­—æ®µé¡ºåºä¼˜åŒ– 1 2 3 4 -- åŸåˆ™ï¼šé€‰æ‹©æ€§é«˜çš„å­—æ®µæ”¾å‰é¢ï¼Œç»å¸¸ä¸€èµ·æŸ¥è¯¢çš„å­—æ®µæ”¾ä¸€èµ· -- å‡è®¾æŸ¥è¯¢ï¼šWHERE status = \u0026#39;active\u0026#39; AND created_at \u0026gt; \u0026#39;2023-01-01\u0026#39; -- å¦‚æœstatusé€‰æ‹©æ€§æ›´é«˜ï¼š CREATE INDEX idx_status_created ON orders(status, created_at); 3. è¦†ç›–ç´¢å¼•ä¼˜åŒ– 1 2 3 4 5 6 -- æ™®é€šæŸ¥è¯¢ï¼šéœ€è¦å›è¡¨ CREATE INDEX idx_user_id ON orders(user_id); SELECT order_id, total_amount FROM orders WHERE user_id = 123; -- è¦†ç›–ç´¢å¼•ï¼šæ— éœ€å›è¡¨ CREATE INDEX idx_user_id_cover ON orders(user_id, order_id, total_amount); 4. åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ– 1 2 3 4 5 6 7 8 -- æ·±åˆ†é¡µé—®é¢˜ SELECT * FROM users ORDER BY created_at LIMIT 100000, 20; -- ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨ç´¢å¼•å­—æ®µ SELECT * FROM users WHERE created_at \u0026gt; \u0026#39;2023-01-01 10:30:00\u0026#39; ORDER BY created_at LIMIT 20; 5. ç´¢å¼•ç›‘æ§å’Œç»´æŠ¤ æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 -- MySQL SELECT * FROM sys.schema_unused_indexes; -- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡ SHOW INDEX FROM users; å®šæœŸé‡å»ºç´¢å¼• 1 2 3 4 5 -- é‡å»ºç´¢å¼•ï¼ˆMySQLï¼‰ ALTER TABLE users DROP INDEX idx_email, ADD INDEX idx_email(email); -- æˆ–è€… OPTIMIZE TABLE users; å®é™…æ¡ˆä¾‹åˆ†æ æ¡ˆä¾‹1ï¼šæ…¢æŸ¥è¯¢ä¼˜åŒ– é—®é¢˜æŸ¥è¯¢ï¼š\n1 2 3 4 SELECT * FROM orders WHERE status = \u0026#39;pending\u0026#39; AND created_at \u0026gt;= \u0026#39;2023-01-01\u0026#39; AND user_id IN (1,2,3,4,5); åˆ†æè¿‡ç¨‹ï¼š\nä½¿ç”¨ EXPLAIN åˆ†ææ‰§è¡Œè®¡åˆ’ å‘ç°å…¨è¡¨æ‰«æï¼Œè€—æ—¶å¾ˆé•¿ åˆ†ææŸ¥è¯¢æ¡ä»¶çš„é€‰æ‹©æ€§ ä¼˜åŒ–æ–¹æ¡ˆï¼š\n1 2 3 4 5 -- åˆ›å»ºå¤åˆç´¢å¼• CREATE INDEX idx_status_created_user ON orders(status, created_at, user_id); -- æˆ–è€…æ ¹æ®å®é™…æŸ¥è¯¢æ¨¡å¼åˆ›å»º CREATE INDEX idx_user_status_created ON orders(user_id, status, created_at); æ¡ˆä¾‹2ï¼šå¤åˆç´¢å¼•è®¾è®¡ ä¸šåŠ¡åœºæ™¯ï¼š\nç”¨æˆ·è¡¨ç»å¸¸æŒ‰åœ°åŒºã€å¹´é¾„ã€çŠ¶æ€æŸ¥è¯¢ æŸ¥è¯¢æ¨¡å¼åˆ†æï¼š WHERE region = \u0026lsquo;beijing\u0026rsquo; WHERE region = \u0026lsquo;beijing\u0026rsquo; AND age BETWEEN 20 AND 30 WHERE region = \u0026lsquo;beijing\u0026rsquo; AND status = \u0026lsquo;active\u0026rsquo; ç´¢å¼•è®¾è®¡ï¼š\n1 2 3 4 5 6 -- æ–¹æ¡ˆ1ï¼šæŒ‰æŸ¥è¯¢é¢‘ç‡å’Œé€‰æ‹©æ€§ CREATE INDEX idx_region_age_status ON users(region, age, status); -- æ–¹æ¡ˆ2ï¼šå¦‚æœç»å¸¸åªæŒ‰regionå’ŒstatusæŸ¥è¯¢ CREATE INDEX idx_region_status ON users(region, status); CREATE INDEX idx_region_age ON users(region, age); æ€»ç»“ æ ¸å¿ƒè¦ç‚¹ ç´¢å¼•æœ¬è´¨ï¼šç”¨ç©ºé—´æ¢æ—¶é—´çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼ä¹¦ç±ç›®å½• ä¸»è¦åŸç†ï¼šB+æ ‘ç»“æ„ï¼Œå‡å°‘ç£ç›˜I/Oï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ ä½¿ç”¨åœºæ™¯ï¼šé¢‘ç¹æŸ¥è¯¢ã€æ’åºã€è¿æ¥çš„å­—æ®µ è®¾è®¡åŸåˆ™ï¼š é€‰æ‹©æ€§é«˜çš„å­—æ®µ éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ è€ƒè™‘è¦†ç›–ç´¢å¼• é¿å…è¿‡å¤šç´¢å¼• æœ€ä½³å®è·µæ¸…å• ä¸ºç»å¸¸å‡ºç°åœ¨WHEREå­å¥çš„å­—æ®µåˆ›å»ºç´¢å¼• ä¸ºç»å¸¸ç”¨äºJOINçš„å­—æ®µåˆ›å»ºç´¢å¼• å¤åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ é¿å…åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨å‡½æ•° å®šæœŸç›‘æ§å’Œä¼˜åŒ–ç´¢å¼•ä½¿ç”¨æƒ…å†µ å¹³è¡¡æŸ¥è¯¢æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´ è€ƒè™‘ä¸šåŠ¡åœºæ™¯ï¼Œä¸è¦ç›²ç›®åˆ›å»ºç´¢å¼• è®°ä½è¿™å¥è¯ ç´¢å¼•ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä½†æ²¡æœ‰ç´¢å¼•æ˜¯ä¸‡ä¸‡ä¸èƒ½çš„ã€‚åˆç†ä½¿ç”¨ç´¢å¼•ï¼Œè®©ä½ çš„æ•°æ®åº“æŸ¥è¯¢é£èµ·æ¥ï¼\nè¿™ä»½æŒ‡å—æ¶µç›–äº†æ•°æ®åº“ç´¢å¼•çš„æ–¹æ–¹é¢é¢ï¼Œå»ºè®®ç»“åˆå®é™…é¡¹ç›®ç»ƒä¹ ï¼ŒåŠ æ·±ç†è§£ã€‚\n","date":"2025-07-03T00:00:00Z","image":"https://nova-bryan.github.io/p/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/","title":"æ•°æ®åº“ç´¢å¼•å®Œå…¨æŒ‡å—"},{"content":"ä¸€ã€å¸¸è§é›†åˆç¯‡ 1. ä¸ºä»€ä¹ˆæ•°ç»„ç´¢å¼•ä»0å¼€å§‹å‘¢ï¼Ÿå‡å¦‚ä»1å¼€å§‹ä¸è¡Œå’© æ•°ç»„ï¼ˆArrayï¼‰ï¼šä¸€ç§ç”¨è¿ç»­çš„å†…å­˜ç©ºé—´å­˜å‚¨ç›¸åŒæ•°æ®ç±»å‹æ•°æ®çš„çº¿æ€§æ•°æ®ç»“æ„\nï¼ˆ1ï¼‰åœ¨æ ¹æ®æ•°ç»„ç´¢å¼•è·å–å…ƒç´ çš„æ—¶å€™ï¼Œä¼šç”¨ç´¢å¼•å’Œå¯»å€å…¬å¼æ¥è®¡ç®—å†…å­˜æ‰€å¯¹åº”çš„å…ƒç´ æ•°æ®ï¼Œå¯»å€å…¬å¼æ˜¯:æ•°ç»„çš„é¦–åœ°å€+ç´¢å¼•ä¹˜ä»¥å­˜å‚¨æ•°æ®çš„ç±»å‹å¤§å°\nï¼ˆ2ï¼‰å¦‚æœæ•°ç»„çš„ç´¢å¼•ä»1å¼€å§‹ï¼Œå¯»å€å…¬å¼ä¸­ï¼Œå°±éœ€è¦å¢åŠ ä¸€æ¬¡å‡æ³•æ“ä½œï¼Œå¯¹äºCPUæ¥è¯´å°±å¤šäº†ä¸€æ¬¡æŒ‡ä»¤ï¼Œæ€§èƒ½ä¸é«˜ã€‚\nå¤æ‚åº¦\néšæœº(é€šè¿‡ä¸‹æ ‡)æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)\næŸ¥æ‰¾å…ƒç´ (æœªçŸ¥ä¸‹æ ‡)çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)\næŸ¥æ‰¾å…ƒç´ (æœªçŸ¥ä¸‹æ ‡ä½†æ’åº)é€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn)\næ’å…¥å’Œåˆ é™¤çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ•°ç»„çš„å†…å­˜è¿ç»­æ€§ï¼Œéœ€è¦æŒªåŠ¨æ•°ç»„å…ƒç´ ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(n)\n2. ArrayListæºç åˆ†æ ArrayListåº•å±‚æ˜¯ç”¨åŠ¨æ€çš„æ•°ç»„å®ç°çš„\nåˆå§‹å®¹é‡ ArrayListåˆå§‹å®¹é‡ä¸º0ï¼Œå½“ç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–å®¹é‡ä¸º10\næ‰©å®¹é€»è¾‘ ArrayListåœ¨è¿›è¡Œæ‰©å®¹çš„æ—¶å€™æ˜¯åŸæ¥å®¹é‡çš„1.5å€ï¼Œæ¯æ¬¡æ‰©å®¹éƒ½éœ€è¦æ‹·è´æ•°ç»„\næ·»åŠ é€»è¾‘ ç¡®ä¿æ•°ç»„å·²ä½¿ç”¨é•¿åº¦ï¼ˆsizeï¼‰åŠ 1ä¹‹åè¶³å¤Ÿå­˜ä¸‹ä¸‹ä¸€ä¸ªæ•°æ® è®¡ç®—æ•°ç»„çš„å®¹é‡ï¼Œå¦‚æœå½“å‰æ•°ç»„å·²ä½¿ç”¨é•¿åº¦+1åçš„å¤§äºå½“å‰çš„æ•°ç»„é•¿åº¦ï¼Œåˆ™è°ƒç”¨growæ–¹æ³•æ‰©å®¹ï¼ˆåŸæ¥çš„1.5å€ï¼‰ ç¡®ä¿æ–°å¢çš„æ•°æ®æœ‰åœ°æ–¹å­˜å‚¨ä¹‹åï¼Œåˆ™å°†æ–°å…ƒç´ æ·»åŠ åˆ°ä½äºsizeçš„ä½ç½®ä¸Šã€‚ è¿”å›æ·»åŠ æˆåŠŸå¸ƒå°”å€¼ã€‚ 3. ArrayList list=new ArrayList(10)ä¸­çš„listæ‰©å®¹å‡ æ¬¡ è¯¥è¯­å¥åªæ˜¯å£°æ˜å’Œå®ä¾‹äº†ä¸€ä¸ª ArrayListï¼ŒæŒ‡å®šäº†å®¹é‡ä¸º 10ï¼Œæœªæ‰©å®¹\n4. å¦‚ä½•å®ç°æ•°ç»„å’ŒListä¹‹é—´çš„è½¬æ¢ æ•°ç»„è½¬List ï¼Œä½¿ç”¨JDKä¸­java.util.Arrayså·¥å…·ç±»çš„asListæ–¹æ³• Listè½¬æ•°ç»„ï¼Œä½¿ç”¨Listçš„toArrayæ–¹æ³•ã€‚æ— å‚toArrayæ–¹æ³•è¿”å› Objectæ•°ç»„ï¼Œä¼ å…¥åˆå§‹åŒ–é•¿åº¦çš„æ•°ç»„å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡æ•°ç»„ ç”¨Arrays.asListè½¬Liståï¼Œå¦‚æœä¿®æ”¹äº†æ•°ç»„å†…å®¹ï¼Œlistå—å½±å“å— ä¼šå—å½±å“\nå½“ä½ ä½¿ç”¨ Arrays.asList æ–¹æ³•å°†æ•°ç»„è½¬æ¢ä¸º List æ—¶ï¼ŒArrays.asList è¿”å›çš„ List å®é™…ä¸Šæ˜¯ Arrays ç±»çš„ä¸€ä¸ªå†…éƒ¨ç±» ArrayList çš„å®ä¾‹ã€‚è¿™ä¸ªå†…éƒ¨ç±»å¹¶æ²¡æœ‰åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç‹¬ç«‹çš„åˆ—è¡¨æ¥å­˜å‚¨æ•°ç»„å…ƒç´ ï¼Œè€Œæ˜¯ç›´æ¥å¯¹ä¼ å…¥çš„æ•°ç»„è¿›è¡Œäº†åŒ…è£…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª List å†…éƒ¨ç»´æŠ¤çš„æ˜¯å¯¹åŸå§‹æ•°ç»„çš„å¼•ç”¨ï¼Œå®ƒä»¬æŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜åœ°å€ã€‚\nListç”¨toArrayè½¬æ•°ç»„åï¼Œå¦‚æœä¿®æ”¹äº†Listå†…å®¹ï¼Œæ•°ç»„å—å½±å“å— ä½¿ç”¨æ— å‚çš„ toArray æ–¹æ³•ï¼šè¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª Object ç±»å‹çš„æ•°ç»„ã€‚toArray æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶å°† List ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°è¿™ä¸ªæ–°æ•°ç»„ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œå¤åˆ¶çš„æ˜¯å…ƒç´ çš„å¼•ç”¨ï¼ˆå¯¹äºå¼•ç”¨ç±»å‹ï¼‰ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚æ‰€ä»¥ï¼Œå¦‚æœ List ä¸­çš„å…ƒç´ æ˜¯å¯å˜å¯¹è±¡ï¼Œä¿®æ”¹ List ä¸­å¯¹è±¡çš„å±æ€§ä¼šå½±å“åˆ°æ•°ç»„ä¸­çš„å¯¹åº”å¯¹è±¡ï¼›å¦‚æœåªæ˜¯æ”¹å˜ List ä¸­å…ƒç´ çš„å¼•ç”¨ï¼ˆæ¯”å¦‚æ›¿æ¢æŸä¸ªå…ƒç´ ï¼‰ï¼Œåˆ™ä¸ä¼šå½±å“æ•°ç»„ã€‚ å½“ä¼ å…¥ä¸€ä¸ªæŒ‡å®šç±»å‹çš„æ•°ç»„æ—¶ï¼Œå¦‚æœè¯¥æ•°ç»„é•¿åº¦è¶³å¤Ÿï¼ŒList å…ƒç´ ä¼šç›´æ¥å¡«å……åˆ°è¿™ä¸ªæ•°ç»„ä¸­ï¼›å¦‚æœé•¿åº¦ä¸å¤Ÿï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åŒç±»å‹æ•°ç»„ã€‚åŒæ ·ï¼Œå¯¹äºå¼•ç”¨ç±»å‹çš„å…ƒç´ ï¼Œå¤åˆ¶çš„æ˜¯å¼•ç”¨ï¼Œä¿®æ”¹å…ƒç´ å±æ€§ä¼šç›¸äº’å½±å“ï¼Œä¿®æ”¹å¼•ç”¨åˆ™ä¸ä¼šã€‚ 5. ArrayListå’ŒLinkedListçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ åº•å±‚æ•°æ®ç»“æ„ ArrayList æ˜¯åŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„å®ç° LinkedList æ˜¯åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„å®ç° æ“ä½œæ•°æ®æ•ˆç‡ ArrayListæŒ‰ç…§ä¸‹æ ‡æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦O(1)ã€å†…å­˜æ˜¯è¿ç»­çš„ï¼Œæ ¹æ®å¯»å€å…¬å¼ã€‘ï¼Œ LinkedListä¸æ”¯æŒä¸‹æ ‡æŸ¥è¯¢ æŸ¥æ‰¾ï¼ˆæœªçŸ¥ç´¢å¼•ï¼‰ï¼š ArrayListéœ€è¦éå†ï¼Œé“¾è¡¨ä¹Ÿéœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n) æ–°å¢å’Œåˆ é™¤ ArrayListå°¾éƒ¨æ’å…¥å’Œåˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼›å…¶ä»–éƒ¨åˆ†å¢åˆ éœ€è¦æŒªåŠ¨æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n) LinkedListå¤´å°¾èŠ‚ç‚¹å¢åˆ æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå…¶ä»–éƒ½éœ€è¦éå†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n) å†…å­˜ç©ºé—´å ç”¨ ArrayListåº•å±‚æ˜¯æ•°ç»„ï¼Œå†…å­˜è¿ç»­ï¼ŒèŠ‚çœå†…å­˜ LinkedList æ˜¯åŒå‘é“¾è¡¨éœ€è¦å­˜å‚¨æ•°æ®ï¼Œå’Œä¸¤ä¸ªæŒ‡é’ˆï¼Œæ›´å ç”¨å†…å­˜ çº¿ç¨‹å®‰å…¨ ArrayListå’ŒLinkedListéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š åœ¨æ–¹æ³•å†…ä½¿ç”¨ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œå±€éƒ¨å˜é‡åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ›¿ä»£ç±»ï¼šå¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ ArrayList å’Œ LinkedList æ›¿ä»£ç±»ï¼Œä¾‹å¦‚ Vector ï¼ˆç±»ä¼¼äºçº¿ç¨‹å®‰å…¨çš„ ArrayListï¼‰ï¼Œæˆ–è€…ä½¿ç”¨ Collections.synchronizedList æ–¹æ³•å°† ArrayList æˆ– LinkedList åŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„åˆ—è¡¨ã€‚ 6. äºŒå‰æ ‘ æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªâ€œå‰â€ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ã€‚ä¸è¿‡ï¼ŒäºŒå‰æ ‘å¹¶ä¸è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å·¦å­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å³å­èŠ‚ç‚¹ã€‚\näºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘ä¹Ÿåˆ†åˆ«æ»¡è¶³äºŒå‰æ ‘çš„å®šä¹‰ã€‚\näºŒå‰æœç´¢æ ‘ äºŒå‰æœç´¢æ ‘(Binary Search Tree,BST)åˆåäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæœ‰åºäºŒå‰æ ‘æˆ–è€…æ’åºäºŒå‰æ ‘ï¼Œæ˜¯äºŒå‰æ ‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§ç±»å‹\näºŒå‰æŸ¥æ‰¾æ ‘è¦æ±‚ï¼Œåœ¨æ ‘ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶å·¦å­æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œéƒ½è¦å°äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œè€Œå³å­æ ‘èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼\næ’å…¥ï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦O(logn)ï¼Œæç«¯æƒ…å†µä¸‹äºŒå‰æŸ¥æ‰¾æ ‘å·²ç»é€€åŒ–æˆäº†é“¾è¡¨ï¼ŒäºŒå‰æœç´¢çš„æ—¶é—´å¤æ‚åº¦O(n)\nçº¢é»‘æ ‘ ï¼ˆ1ï¼‰çº¢é»‘æ ‘çš„ç‰¹è´¨\næ€§è´¨1ï¼šèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²,è¦ä¹ˆæ˜¯é»‘è‰²\næ€§è´¨2ï¼šæ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²\næ€§è´¨3ï¼šå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹\næ€§è´¨4ï¼šçº¢é»‘æ ‘ä¸­çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²\næ€§è´¨5ï¼šä»ä»»ä¸€èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹\nåœ¨æ·»åŠ æˆ–åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœä¸ç¬¦åˆè¿™äº›æ€§è´¨ä¼šå‘ç”Ÿæ—‹è½¬ï¼Œä»¥è¾¾åˆ°æ‰€æœ‰çš„æ€§è´¨ï¼Œä¿è¯çº¢é»‘æ ‘çš„å¹³è¡¡\nï¼ˆ2ï¼‰çº¢é»‘æ ‘çš„å¤æ‚åº¦\næŸ¥æ‰¾ï¼š çº¢é»‘æ ‘ä¹Ÿæ˜¯ä¸€æ£µBSTï¼ˆäºŒå‰æœç´¢æ ‘ï¼‰æ ‘ï¼ŒæŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(log n) æ·»åŠ ï¼š æ·»åŠ å…ˆè¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ‰¾åˆ°å…ƒç´ æ·»åŠ çš„ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦O(log n) æ·»åŠ å®Œæˆåæ¶‰åŠåˆ°å¤æ‚åº¦ä¸ºO(1)çš„æ—‹è½¬è°ƒæ•´æ“ä½œ æ•…æ•´ä½“å¤æ‚åº¦ä¸ºï¼šO(log n) åˆ é™¤ï¼š é¦–å…ˆä»æ ¹èŠ‚ç‚¹å¼€å§‹æ‰¾åˆ°è¢«åˆ é™¤å…ƒç´ çš„ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦O(log n) åˆ é™¤å®Œæˆåæ¶‰åŠåˆ°å¤æ‚åº¦ä¸ºO(1)çš„æ—‹è½¬è°ƒæ•´æ“ä½œ æ•…æ•´ä½“å¤æ‚åº¦ä¸ºï¼šO(log n) 7. æ•£åˆ—è¡¨ æ ¹æ®é”®ï¼ˆKeyï¼‰ç›´æ¥è®¿é—®åœ¨å†…å­˜å­˜å‚¨ä½ç½®å€¼ï¼ˆValueï¼‰çš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ç”±æ•°ç»„æ¼”åŒ–è€Œæ¥çš„ï¼Œåˆ©ç”¨äº†æ•°ç»„æ”¯æŒæŒ‰ç…§ä¸‹æ ‡è¿›è¡Œéšæœºè®¿é—®æ•°æ®çš„ç‰¹æ€§ã€‚\næ•£åˆ—å‡½æ•° å°†é”®(key)æ˜ å°„ä¸ºæ•°ç»„ä¸‹æ ‡çš„å‡½æ•°å«åšæ•£åˆ—å‡½æ•°ã€‚å¯ä»¥è¡¨ç¤ºä¸ºï¼šhashValue = hash(key)\næ•£åˆ—å‡½æ•°çš„åŸºæœ¬è¦æ±‚\næ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°çš„æ•£åˆ—å€¼å¿…é¡»æ˜¯å¤§äºç­‰äº0çš„æ­£æ•´æ•°ï¼Œå› ä¸ºhashValueéœ€è¦ä½œä¸ºæ•°ç»„çš„ä¸‹æ ‡ã€‚ å¦‚æœkey1==key2ï¼Œé‚£ä¹ˆç»è¿‡hashåå¾—åˆ°çš„å“ˆå¸Œå€¼ä¹Ÿå¿…ç›¸åŒå³ï¼šhash(key1) == hash(key2ï¼‰ å¦‚æœkey1 != key2ï¼Œé‚£ä¹ˆç»è¿‡hashåå¾—åˆ°çš„å“ˆå¸Œå€¼ä¹Ÿå¿…ä¸ç›¸åŒå³ï¼šhash(key1) != hash(key2) æ•£åˆ—å†²çª æˆ–è€…å“ˆå¸Œå†²çªï¼Œå“ˆå¸Œç¢°æ’ï¼ŒæŒ‡å¤šä¸ªkeyæ˜ å°„åˆ°åŒä¸€ä¸ªæ•°ç»„ä¸‹æ ‡ä½ç½®\næ•£åˆ—å†²çª-é“¾è¡¨æ³•ï¼ˆæ‹‰é“¾ï¼‰ åœ¨æ•£åˆ—è¡¨ä¸­ï¼Œæ•°ç»„çš„æ¯ä¸ªä¸‹æ ‡ä½ç½®æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºæ¡¶ï¼ˆbucketï¼‰æˆ–è€…æ§½ï¼ˆslotï¼‰ï¼Œæ¯ä¸ªæ¡¶(æ§½)ä¼šå¯¹åº”ä¸€æ¡é“¾è¡¨ï¼Œæ‰€æœ‰æ•£åˆ—å€¼ç›¸åŒçš„å…ƒç´ æˆ‘ä»¬éƒ½æ”¾åˆ°ç›¸åŒæ§½ä½å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚\nç®€å•å°±æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªkeyæœ€ç»ˆçš„hashå€¼æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¼šå­˜å…¥æ•°ç»„çš„åŒä¸€ä¸ªä¸‹æ ‡ä¸­ï¼Œä¸‹æ ‡ä¸­æŒ‚ä¸€ä¸ªé“¾è¡¨å­˜å…¥å¤šä¸ªæ•°æ®\næ—¶é—´å¤æ‚åº¦\nå¹³å‡æƒ…å†µä¸‹åŸºäºé“¾è¡¨æ³•è§£å†³å†²çªæ—¶æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)\næ•£åˆ—è¡¨å¯èƒ½ä¼šé€€åŒ–ä¸ºé“¾è¡¨,æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å°±ä» O(1) é€€åŒ–ä¸º O(n)\nå°†é“¾è¡¨æ³•ä¸­çš„é“¾è¡¨æ”¹é€ ä¸ºå…¶ä»–é«˜æ•ˆçš„åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚çº¢é»‘æ ‘ï¼ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)\nå°†é“¾è¡¨æ³•ä¸­çš„é“¾è¡¨æ”¹é€ çº¢é»‘æ ‘è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„åŸå› ï¼Œå¯ä»¥é˜²æ­¢DDosæ”»å‡»\nDDos æ”»å‡»:\nåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»(è‹±æ–‡æ„æ€æ˜¯Distributed Denial of Serviceï¼Œç®€ç§°DDoSï¼‰\næŒ‡å¤„äºä¸åŒä½ç½®çš„å¤šä¸ªæ”»å‡»è€…åŒæ—¶å‘ä¸€ä¸ªæˆ–æ•°ä¸ªç›®æ ‡å‘åŠ¨æ”»å‡»ï¼Œæˆ–è€…ä¸€ä¸ªæ”»å‡»è€…æ§åˆ¶äº†ä½äºä¸åŒä½ç½®çš„å¤šå°æœºå™¨å¹¶åˆ©ç”¨è¿™äº›æœºå™¨å¯¹å—å®³è€…åŒæ—¶å®æ–½æ”»å‡»ã€‚ç”±äºæ”»å‡»çš„å‘å‡ºç‚¹æ˜¯åˆ†å¸ƒåœ¨ä¸åŒåœ°æ–¹çš„ï¼Œè¿™ç±»æ”»å‡»ç§°ä¸ºåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œå…¶ä¸­çš„æ”»å‡»è€…å¯ä»¥æœ‰å¤šä¸ª\n8. è¯´ä¸€ä¸‹HashMapçš„å®ç°åŸç†ï¼Ÿ HashMapçš„æ•°æ®ç»“æ„ï¼š åº•å±‚ä½¿ç”¨hashè¡¨æ•°æ®ç»“æ„ï¼Œå³æ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘\nå½“æˆ‘ä»¬å¾€HashMapä¸­putå…ƒç´ æ—¶ï¼Œåˆ©ç”¨keyçš„hashCodeé‡æ–°hashè®¡ç®—å‡ºå½“å‰å¯¹è±¡çš„å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ å­˜å‚¨æ—¶ï¼Œå¦‚æœå‡ºç°hashå€¼ç›¸åŒçš„keyï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µã€‚ a. å¦‚æœkeyç›¸åŒï¼Œåˆ™è¦†ç›–åŸå§‹å€¼ï¼›\nb. å¦‚æœkeyä¸åŒï¼ˆå‡ºç°å†²çªï¼‰ï¼Œåˆ™å°†å½“å‰çš„key-valueæ”¾å…¥é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­\nè·å–æ—¶ï¼Œç›´æ¥æ‰¾åˆ°hashå€¼å¯¹åº”çš„ä¸‹æ ‡ï¼Œåœ¨è¿›ä¸€æ­¥åˆ¤æ–­keyæ˜¯å¦ç›¸åŒï¼Œä»è€Œæ‰¾åˆ°å¯¹åº”å€¼ã€‚ HashMap åº•å±‚é‡‡ç”¨å“ˆå¸Œè¡¨ï¼Œç»“åˆäº†æ•°ç»„ã€é“¾è¡¨å’Œçº¢é»‘æ ‘ã€‚æ•°ç»„æ˜¯ä¸»ä½“ç»“æ„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªæ¡¶ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œä¼šç”¨é“¾è¡¨æˆ–çº¢é»‘æ ‘æ¥å­˜å‚¨å†²çªå…ƒç´ ã€‚æ­£å¸¸æƒ…å†µä¸‹ç”¨é“¾è¡¨å­˜å‚¨ï¼Œè‹¥é“¾è¡¨é•¿åº¦è¶…è¿‡ 8 ä¸”æ•°ç»„é•¿åº¦å¤§äº 64ï¼Œé“¾è¡¨å°±ä¼šè½¬æˆçº¢é»‘æ ‘ï¼Œå› ä¸ºé“¾è¡¨è¿‡é•¿æ—¶ï¼ŒæŸ¥æ‰¾å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¼šå˜æˆ O (n)ï¼Œè€Œçº¢é»‘æ ‘èƒ½å°†æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ§åˆ¶åœ¨ O (log n)ã€‚å½“çº¢é»‘æ ‘èŠ‚ç‚¹æ•°é‡å°‘äº 6 æ—¶ï¼Œåˆä¼šè½¬å›é“¾è¡¨ã€‚ä»¥æ­¤æå‡æŸ¥æ‰¾æ•ˆç‡ã€‚\n9. HashMapçš„jdk1.7å’Œjdk1.8æœ‰ä»€ä¹ˆåŒºåˆ« JDK1.8ä¹‹å‰é‡‡ç”¨çš„æ˜¯æ‹‰é“¾æ³•ã€‚æ‹‰é“¾æ³•ï¼šå°†é“¾è¡¨å’Œæ•°ç»„ç›¸ç»“åˆã€‚ä¹Ÿå°±æ˜¯è¯´åˆ›å»ºä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€æ ¼å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚è‹¥é‡åˆ°å“ˆå¸Œå†²çªï¼Œåˆ™å°†å†²çªçš„å€¼åŠ åˆ°é“¾è¡¨ä¸­å³å¯ã€‚ jdk1.8åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰ æ—¶å¹¶ä¸”æ•°ç»„é•¿åº¦è¾¾åˆ°64æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚æ‰©å®¹ resize( ) æ—¶ï¼Œçº¢é»‘æ ‘æ‹†åˆ†æˆçš„æ ‘çš„ç»“ç‚¹æ•°å°äºç­‰äºä¸´ç•Œå€¼6ä¸ªï¼Œåˆ™é€€åŒ–æˆé“¾è¡¨ 10. HashMapçš„putæ–¹æ³•çš„å…·ä½“æµç¨‹ åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„tableæ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼ˆåˆå§‹åŒ–ï¼‰\næ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ•°ç»„ç´¢å¼•\nåˆ¤æ–­table[i]==nullï¼Œæ¡ä»¶æˆç«‹ï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ \nå¦‚æœtable[i]==null ,ä¸æˆç«‹\n4.1 åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–value\n4.2 åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹\n4.3 éå†table[i]ï¼Œé“¾è¡¨çš„å°¾éƒ¨æ’å…¥æ•°æ®ï¼Œç„¶ååˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ ä½œï¼Œéå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value\næ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼ˆæ•°ç»„é•¿åº¦*0.75ï¼‰ï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚\n11. è®²ä¸€è®²HashMapçš„æ‰©å®¹æœºåˆ¶ HashMap çš„æ‰©å®¹æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯å…¶æ€§èƒ½ï¼Œé¿å…å“ˆå¸Œå†²çªè¿‡å¤šå¯¼è‡´æŸ¥è¯¢å’Œæ’å…¥æ•ˆç‡ä¸‹é™ã€‚å½“å…ƒç´ æ•°é‡è¾¾åˆ°æ‰©å®¹é˜ˆå€¼ï¼ˆæ•°ç»„é•¿åº¦ * è´Ÿè½½å› å­ï¼Œé»˜è®¤è´Ÿè½½å› å­æ˜¯ 0.75ï¼‰æ—¶ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹æ“ä½œã€‚\nåœ¨æ·»åŠ å…ƒç´ æˆ–åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®åˆå§‹åŒ–æ•°ç»„é•¿åº¦ä¸º16ï¼Œä»¥åæ¯æ¬¡æ¯æ¬¡æ‰©å®¹éƒ½æ˜¯è¾¾åˆ°äº†æ‰©å®¹é˜ˆå€¼ï¼ˆæ•°ç»„é•¿åº¦ * 0.75ï¼‰ æ¯æ¬¡æ‰©å®¹çš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‰©å®¹ä¹‹å‰å®¹é‡çš„2å€ï¼› æ‰©å®¹ä¹‹åï¼Œä¼šæ–°åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦æŠŠè€æ•°ç»„ä¸­çš„æ•°æ®æŒªåŠ¨åˆ°æ–°çš„æ•°ç»„ä¸­ æ— å“ˆå¸Œå†²çªçš„èŠ‚ç‚¹ï¼šåˆ™ç›´æ¥ä½¿ç”¨ e.hash \u0026amp; (newCap - 1) è®¡ç®—æ–°æ•°ç»„çš„ç´¢å¼•ä½ç½® çº¢é»‘æ ‘èŠ‚ç‚¹ï¼šæŒ‰ç…§çº¢é»‘æ ‘çš„è§„åˆ™å°†èŠ‚ç‚¹æ·»åŠ åˆ°æ–°æ•°ç»„å¯¹åº”çš„ä½ç½®ã€‚çº¢é»‘æ ‘æ˜¯è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæ·»åŠ èŠ‚ç‚¹æ—¶ä¼šè¿›è¡Œæ—‹è½¬å’Œå˜è‰²ç­‰æ“ä½œæ¥ä¿æŒå¹³è¡¡ã€‚ **é“¾è¡¨èŠ‚ç‚¹ï¼š**éœ€è¦éå†é“¾è¡¨ï¼Œå¯èƒ½ä¼šæ‹†åˆ†é“¾è¡¨ã€‚é€šè¿‡e.hash \u0026amp; oldCapåˆ¤æ–­å…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ï¼š è‹¥ç»“æœä¸º 0ï¼Œè¯´æ˜è¯¥å…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®å’ŒåŸæ•°ç»„ç›¸åŒã€‚å› ä¸ºæ‰©å®¹åå¤šè€ƒè™‘çš„é‚£ä¸€ä½äºŒè¿›åˆ¶ä¸º 0ï¼Œå¯¹ç´¢å¼•è®¡ç®—ç»“æœæ— å½±å“ã€‚ è‹¥ç»“æœä¸ä¸º 0ï¼Œè¯¥å…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®æ˜¯åŸæ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®åŠ ä¸Š oldCapã€‚è¿™æ˜¯å› ä¸ºæ‰©å®¹åå¤šè€ƒè™‘çš„é‚£ä¸€ä½äºŒè¿›åˆ¶ä¸º 1ï¼Œä½¿å¾—ç´¢å¼•ç»“æœå¢åŠ äº†åŸæ•°ç»„çš„é•¿åº¦ã€‚ 12. hashMapçš„å¯»å€ç®—æ³• é¦–å…ˆè·å–keyçš„hashCodeå€¼ï¼Œç„¶åzå†è°ƒç”¨hash()æ–¹æ³•è¿›è¡ŒäºŒæ¬¡å“ˆå¸Œï¼Œå³ç§»16ä½ å¼‚æˆ–è¿ç®— åŸæ¥çš„hashCodeå€¼ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯ä½¿åŸæ¥çš„hashå€¼æ›´åŠ å‡åŒ€ï¼Œå‡å°‘hashå†²çª\næœ€åï¼ˆcapacity-1ï¼‰\u0026amp; hashå¾—åˆ°ç´¢å¼•\n13. å…³äºhashå€¼çš„å…¶ä»–é¢è¯•é¢˜ï¼šä¸ºä½•HashMapçš„æ•°ç»„é•¿åº¦ä¸€å®šæ˜¯2çš„æ¬¡å¹‚ï¼Ÿ è®¡ç®—ç´¢å¼•æ—¶æ•ˆç‡æ›´é«˜ï¼šå¦‚æœæ˜¯ 2 çš„ n æ¬¡å¹‚å¯ä»¥ä½¿ç”¨ä½ä¸è¿ç®—ä»£æ›¿å–æ¨¡ æ‰©å®¹æ—¶é‡æ–°è®¡ç®—ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼š hash \u0026amp; oldCap == 0 çš„å…ƒç´ ç•™åœ¨åŸæ¥ä½ç½® ï¼Œå¦åˆ™æ–°ä½ç½® = æ—§ä½ç½® + oldCap 14. hashmapåœ¨1.7æƒ…å†µä¸‹çš„å¤šçº¿ç¨‹æ­»å¾ªç¯é—®é¢˜ åœ¨ JDK 1.7 é‡Œï¼ŒHashMap æ‰©å®¹æ—¶æŠŠæ—§æ•°ç»„çš„æ•°æ®è¿ç§»åˆ°æ–°æ•°ç»„ï¼Œé“¾è¡¨é‡‡ç”¨çš„æ˜¯å¤´æ’æ³•ã€‚\nå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ HashMap çš„æ‰©å®¹ã€‚\nçº¿ç¨‹ä¸€è¯»å–æ•°æ®å‡†å¤‡æ‰©å®¹ï¼šçº¿ç¨‹ä¸€è¯»å–å½“å‰ HashMap çš„æ•°æ®ï¼Œå‘ç°æœ‰ä¸€ä¸ªé“¾è¡¨ï¼Œå‡†å¤‡å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ã€‚å¯å°±åœ¨è¿™æ—¶å€™ï¼Œçº¿ç¨‹äºŒä»‹å…¥äº†ã€‚ çº¿ç¨‹äºŒå®Œæˆæ‰©å®¹ï¼šçº¿ç¨‹äºŒä¹Ÿè¯»å–äº† HashMap çš„æ•°æ®ï¼Œç„¶åç›´æ¥å¼€å§‹æ‰©å®¹ã€‚å› ä¸ºç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œæ‰©å®¹åé“¾è¡¨çš„é¡ºåºå°±é¢ å€’äº†ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼ŒåŸæ¥é“¾è¡¨é¡ºåºæ˜¯ A -\u0026gt; Bï¼Œæ‰©å®¹åå°±å˜æˆ B -\u0026gt; A äº†ï¼Œä¹‹åçº¿ç¨‹äºŒæ‰§è¡Œç»“æŸã€‚ çº¿ç¨‹ä¸€ç»§ç»­æ‰©å®¹å¼•å‘æ­»å¾ªç¯ï¼šçº¿ç¨‹ä¸€æ¥ç€å¹²æ´»ï¼Œå…ˆæŠŠ A ç§»åˆ°æ–°é“¾è¡¨ï¼Œå†æŠŠ B æ’åˆ°æ–°é“¾è¡¨çš„å¤´éƒ¨ã€‚ä½†ç”±äºçº¿ç¨‹äºŒå·²ç»æŠŠé“¾è¡¨é¡ºåºé¢ å€’äº†ï¼ŒB çš„ next æŒ‡é’ˆæŒ‡å‘äº† Aã€‚è¿™æ ·ä¸€æ¥ï¼Œæ–°é“¾è¡¨å°±å˜æˆ B -\u0026gt; A -\u0026gt; Bï¼Œå½¢æˆäº†ä¸€ä¸ªå¾ªç¯ã€‚ä¹‹åè¦æ˜¯æœ‰çº¿ç¨‹å»è®¿é—®è¿™ä¸ªé“¾è¡¨ï¼Œå°±ä¼šä¸€ç›´åœ¨è¿™ä¸ªå¾ªç¯é‡Œå‡ºä¸æ¥ï¼Œä¹Ÿå°±æ˜¯å‡ºç°äº†æ­»å¾ªç¯é—®é¢˜ã€‚ JDK 8 å¯¹æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œé“¾è¡¨æ•°æ®è¿ç§»æ—¶ç”¨çš„æ˜¯å°¾æ’æ³•ï¼Œå°±æ˜¯æ–°å…ƒç´ ä¼šè¢«æ’åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚è¿™æ ·æ‰©å®¹åé“¾è¡¨å…ƒç´ çš„é¡ºåºå’Œæ‰©å®¹å‰æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸ä¼šå‡ºç°å› ä¸ºé“¾è¡¨é¡ºåºé¢ å€’è€Œå¯¼è‡´çš„æ­»å¾ªç¯é—®é¢˜äº†ã€‚\næ€»çš„æ¥è¯´ï¼ŒJDK 1.7 çš„ HashMap åœ¨å¤šçº¿ç¨‹æ‰©å®¹æ—¶ï¼Œå¤´æ’æ³•å¯èƒ½ä¼šè®©é“¾è¡¨é¡ºåºé”™ä¹±ï¼Œè¿›è€Œå¼•å‘æ­»å¾ªç¯ï¼›è€Œ JDK 8 é‡‡ç”¨å°¾æ’æ³•ï¼Œé¿å…äº†è¿™ä¸ªé—®é¢˜ï¼Œæå‡äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§ã€‚\nå…³äº HashMapã€HashTableã€ConcurrentHashMapã€TreeMap å’Œ HashSet 1. åŸºæœ¬æ¦‚å¿µ\nHashMapï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°çš„ Map æ¥å£ï¼Œå…è®¸ null é”®å’Œ null å€¼ï¼Œéçº¿ç¨‹å®‰å…¨ï¼Œé€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸‹å¿«é€ŸæŸ¥æ‰¾å’Œå­˜å‚¨é”®å€¼å¯¹ã€‚ HashTableï¼šå¤è€çš„ Map å®ç°ç±»ï¼Œä¸ HashMap ç±»ä¼¼ï¼Œä½†ä¸å…è®¸ null é”®å’Œ null å€¼ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆæ–¹æ³•éƒ½è¢« synchronized ä¿®é¥°ï¼‰ï¼Œä¸è¿‡æ€§èƒ½ç›¸å¯¹ HashMap è¾ƒå·®ï¼Œç°åœ¨å·²ä¸å¸¸ç”¨ã€‚ ConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨çš„ Map å®ç°ç±»ï¼Œé‡‡ç”¨åˆ†æ®µé”ï¼ˆé”åˆ†æ®µæŠ€æœ¯ï¼‰æé«˜å¹¶å‘æ€§èƒ½ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸åŒçš„æ®µï¼Œé€‚ç”¨äºé«˜å¹¶å‘ç¯å¢ƒä¸‹çš„é”®å€¼å¯¹å­˜å‚¨å’Œè®¿é—®ã€‚ TreeMapï¼šå®ç°äº† SortedMap æ¥å£ï¼ŒåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œä¼šå¯¹é”®è¿›è¡Œæ’åºï¼ˆé»˜è®¤å‡åºï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼‰ï¼Œä¸å…è®¸ null é”®ï¼Œå€¼å¯ä»¥ä¸º nullï¼Œéçº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆéœ€è¦å¯¹é”®è¿›è¡Œæœ‰åºæ“ä½œçš„åœºæ™¯ã€‚ HashSetï¼šå®ç°äº† Set æ¥å£ï¼ŒåŸºäº HashMap å®ç°ï¼ˆå…ƒç´ å­˜å‚¨åœ¨ HashMap çš„é”®ä¸­ï¼Œå€¼ä¸ºä¸€ä¸ªé»˜è®¤çš„ Object å¯¹è±¡ï¼‰ï¼Œä¸å…è®¸é‡å¤å…ƒç´ ï¼Œå…è®¸ null å…ƒç´ ï¼Œéçº¿ç¨‹å®‰å…¨ï¼Œç”¨äºå­˜å‚¨ä¸é‡å¤çš„å…ƒç´ é›†åˆã€‚ 2. çº¿ç¨‹å®‰å…¨æ€§\nHashMap å’Œ HashSetï¼šéçº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚ HashTableï¼šçº¿ç¨‹å®‰å…¨ï¼Œé€šè¿‡ synchronized ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å…¶æ–¹æ³•ã€‚ ConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨ï¼Œé‡‡ç”¨åˆ†æ®µé”æŠ€æœ¯ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸åŒçš„æ®µã€‚ TreeMapï¼šéçº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®æ··ä¹±ã€‚ 3. æ€§èƒ½ç‰¹ç‚¹\næŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œ HashMap å’Œ HashSetï¼šåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼ŒåŸºäºå“ˆå¸Œè¡¨çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œä½†åœ¨å“ˆå¸Œå†²çªä¸¥é‡æ—¶æ€§èƒ½ä¼šä¸‹é™ã€‚ HashTableï¼šç”±äºçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹å¼ï¼ˆsynchronizedï¼‰ï¼Œåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹æ€§èƒ½æ¯” HashMap å·®ï¼Œæ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ HashMap ç±»ä¼¼ï¼Œä½†åœ¨å¤šçº¿ç¨‹å¹¶å‘æ—¶ä¼šæœ‰é”ç«äº‰ã€‚ ConcurrentHashMapï¼šå¹¶å‘æ€§èƒ½è¾ƒå¥½ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œç”±äºåˆ†æ®µé”æœºåˆ¶ï¼Œä¸åŒæ®µçš„æ“ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œæ€»ä½“æ€§èƒ½ä¼˜äº HashTableã€‚ TreeMapï¼šåŸºäºçº¢é»‘æ ‘ï¼ŒæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(logn)ï¼Œå› ä¸ºéœ€è¦ç»´æŠ¤æ ‘çš„å¹³è¡¡å’Œæ’åºã€‚ 4. é”®å’Œå€¼çš„å…è®¸æƒ…å†µ\nHashMapï¼šé”®å’Œå€¼éƒ½å¯ä»¥ä¸º nullï¼Œä½†é”®çš„ null åªèƒ½æœ‰ä¸€ä¸ªã€‚ HashTableï¼šé”®å’Œå€¼éƒ½ä¸å…è®¸ä¸º nullï¼Œå¦åˆ™ä¼šæŠ›å‡º NullPointerExceptionã€‚ ConcurrentHashMapï¼šé”®å’Œå€¼éƒ½ä¸å…è®¸ä¸º nullï¼Œå¦åˆ™ä¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¼è‡´ä¸ç¡®å®šè¡Œä¸ºã€‚ TreeMapï¼šé”®ä¸å…è®¸ä¸º nullï¼ˆå› ä¸ºéœ€è¦è¿›è¡Œæ¯”è¾ƒå’Œæ’åºï¼‰ï¼Œå€¼å¯ä»¥ä¸º nullã€‚ HashSetï¼šå…è®¸ä¸€ä¸ª null å…ƒç´ ï¼Œä¸å…è®¸é‡å¤å…ƒç´ ã€‚ 5. æ’åºåŠŸèƒ½\nHashMapã€HashTable å’Œ HashSetï¼šä¸å…·å¤‡æ’åºåŠŸèƒ½ï¼Œå…ƒç´ çš„å­˜å‚¨é¡ºåºä¸æ’å…¥é¡ºåºæ— å…³ï¼ˆHashMap åœ¨ JDK 8 åå¼•å…¥äº†é“¾è¡¨è½¬çº¢é»‘æ ‘æœºåˆ¶ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“å…ƒç´ é¡ºåºï¼Œä½†ä¸æ˜¯çœŸæ­£çš„æ’åºï¼‰ã€‚ TreeMapï¼šå®ç°äº† SortedMap æ¥å£ï¼Œä¼šæ ¹æ®é”®çš„è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰æ¯”è¾ƒå™¨å¯¹é”®è¿›è¡Œæ’åºã€‚ 6. åº”ç”¨åœºæ™¯\nHashMap å’Œ HashSetï¼šé€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹å…ƒç´ é¡ºåºæ— è¦æ±‚ï¼Œåªéœ€è¦å¿«é€ŸæŸ¥æ‰¾å’Œå­˜å‚¨ä¸é‡å¤å…ƒç´ çš„åœºæ™¯ï¼Œå¦‚ç¼“å­˜ã€æ•°æ®ç»Ÿè®¡ç­‰ã€‚ HashTableï¼šç”±äºæ€§èƒ½é—®é¢˜ï¼Œç°åœ¨å¾ˆå°‘ä½¿ç”¨ï¼Œä»…åœ¨ä¸€äº›é—ç•™ä»£ç æˆ–å¯¹çº¿ç¨‹å®‰å…¨æœ‰ä¸¥æ ¼è¦æ±‚ä¸”æ€§èƒ½è¦æ±‚ä¸é«˜çš„åœºæ™¯ä¸­å¯èƒ½ä¼šç”¨åˆ°ã€‚ ConcurrentHashMapï¼šé€‚ç”¨äºé«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„ Map æ“ä½œï¼Œå¦‚å¤šçº¿ç¨‹çš„è®¡æ•°å™¨ã€ç¼“å­˜ç­‰ã€‚ TreeMapï¼šé€‚ç”¨äºéœ€è¦å¯¹é”®è¿›è¡Œæ’åºï¼Œå¹¶ä¸”æŒ‰ç…§é¡ºåºéå†æˆ–æŸ¥æ‰¾å…ƒç´ çš„åœºæ™¯ï¼Œå¦‚æŒ‰ç…§æ—¶é—´é¡ºåºå­˜å‚¨å’ŒæŸ¥è¯¢æ—¥å¿—è®°å½•ç­‰ã€‚ 15. HashSetä¸HashMapçš„åŒºåˆ« (1)HashSetå®ç°äº†Setæ¥å£, ä»…å­˜å‚¨å¯¹è±¡; HashMapå®ç°äº† Mapæ¥å£, å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹.\n(2)HashSetåº•å±‚å…¶å®æ˜¯ç”¨HashMapå®ç°å­˜å‚¨çš„, HashSetå°è£…äº†ä¸€ç³»åˆ—HashMapçš„æ–¹æ³•. ä¾é HashMapæ¥å­˜å‚¨å…ƒç´ å€¼,(åˆ©ç”¨hashMapçš„keyé”®è¿›è¡Œå­˜å‚¨), è€Œvalueå€¼é»˜è®¤ä¸ºObjectå¯¹è±¡. æ‰€ä»¥HashSetä¹Ÿä¸å…è®¸å‡ºç°é‡å¤å€¼, åˆ¤æ–­æ ‡å‡†å’ŒHashMapåˆ¤æ–­æ ‡å‡†ç›¸åŒ, ä¸¤ä¸ªå…ƒç´ çš„hashCodeç›¸ç­‰å¹¶ä¸”é€šè¿‡equals()æ–¹æ³•è¿”å›true.\n16. HashTableä¸HashMapçš„åŒºåˆ« å—¯ï¼Œä»–ä»¬çš„ä¸»è¦åŒºåˆ«æ˜¯æœ‰å‡ ä¸ªå§\nç¬¬ä¸€ï¼Œæ•°æ®ç»“æ„ä¸ä¸€æ ·ï¼Œhashtableæ˜¯æ•°ç»„+é“¾è¡¨ï¼Œhashmapåœ¨1.8ä¹‹åæ”¹ä¸ºäº†æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘\nç¬¬äºŒï¼Œhashtableå­˜å‚¨æ•°æ®çš„æ—¶å€™éƒ½ä¸èƒ½ä¸ºnullï¼Œè€Œhashmapæ˜¯å¯ä»¥çš„\nç¬¬ä¸‰ï¼Œhashç®—æ³•ä¸åŒï¼Œhashtableæ˜¯ç”¨æœ¬åœ°ä¿®é¥°çš„hashcodeå€¼ï¼Œè€Œhashmapè¿›è¡Œäº†äºŒæ¬¡hash\nç¬¬å››ï¼Œæ‰©å®¹æ–¹å¼ä¸åŒï¼Œhashtableæ˜¯å½“å‰å®¹é‡ç¿»å€+1ï¼Œhashmapæ˜¯å½“å‰å®¹é‡ç¿»å€\nç¬¬äº”ï¼Œhashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ“ä½œæ•°æ®çš„æ—¶å€™åŠ äº†é”synchronizedï¼Œhashmapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ•ˆç‡æ›´é«˜ä¸€äº›\nåœ¨å®é™…å¼€ä¸­ä¸å»ºè®®ä½¿ç”¨HashTableï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨ConcurrentHashMapç±»\n17. TreeMapä¸HashMapçš„åŒºåˆ« HashMap å’Œ TreeMap éƒ½ç»§æ‰¿è‡ª AbstractMapã€‚ä½† TreeMap è¿˜å®ç°äº† NavigableMap å’Œ SortedMap æ¥å£ï¼Œè¿™æ˜¯å®ƒä¸ HashMap çš„ä¸»è¦åŒºåˆ«ã€‚\nTreeMap å®ç° NavigableMap æ¥å£åï¼š\nèƒ½å®šå‘æœç´¢ï¼Œåƒ ceilingEntry() æ‰¾å¤§äºç­‰äºé”®çš„æœ€è¿‘å…ƒç´ ï¼ŒfloorEntry() æ‰¾å°äºç­‰äºé”®çš„æœ€è¿‘å…ƒç´ ç­‰ã€‚ å¯è¿›è¡Œå­é›†æ“ä½œï¼Œå¦‚ submap()ã€headMap()ã€tailMap() æ¥è·å–å­é›†è§†å›¾ï¼Œä¸å¤åˆ¶å…¨é›†åˆã€‚ æœ‰é€†åºè§†å›¾ï¼ŒdescendingMap() èƒ½åå‘è¿­ä»£é›†åˆã€‚ æ–¹ä¾¿è¾¹ç•Œæ“ä½œï¼ŒfirstEntry() å–é¦–å…ƒç´ ï¼ŒlastEntry() å–å°¾å…ƒç´ ï¼ŒpollFirstEntry() å’Œ pollLastEntry() å–å¹¶ç§»é™¤é¦–ã€å°¾å…ƒç´ ã€‚ è¿™äº›åŸºäºçº¢é»‘æ ‘å®ç°ï¼Œæœç´¢æ—¶é—´å¤æ‚åº¦ O(logn)ã€‚ å®ç° SortedMap æ¥å£åï¼ŒTreeMap èƒ½æŒ‰é”®æ’åºï¼Œé»˜è®¤å‡åºï¼Œä¹Ÿèƒ½è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚\nè€Œ HashMap åŸºäºå“ˆå¸Œè¡¨ï¼Œä¾§é‡å¿«é€Ÿé”®å€¼å¯¹æ“ä½œï¼Œæ— ä¸Šè¿°é¡ºåºç›¸å…³åŠŸèƒ½ï¼Œç†æƒ³æ—¶æ“ä½œæ—¶é—´å¤æ‚åº¦ O(1)ã€‚\n18. ConcurrentHashMap ä¸ Hashtable çš„åŒºåˆ« çº¿ç¨‹å®‰å…¨å®ç°æ–¹å¼ Hashtableï¼š å®ç°æ–¹å¼ï¼šä½¿ç”¨ synchronized æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ ç‰¹ç‚¹ï¼šæ‰€æœ‰æ“ä½œï¼ˆå¦‚ putã€getï¼‰éƒ½æ˜¯åŒæ­¥çš„ï¼Œè¿™æ„å‘³ç€åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®æ•´ä¸ªå“ˆå¸Œè¡¨ã€‚ ç¼ºç‚¹ï¼šæ•ˆç‡è¾ƒä½ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå› ä¸ºæ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç«äº‰åŒä¸€æŠŠé”ï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œæ€§èƒ½ä¸‹é™ã€‚ ConcurrentHashMapï¼š JDK 1.7ï¼š å®ç°æ–¹å¼ï¼šä½¿ç”¨åˆ†æ®µé”ï¼ˆSegmentï¼‰æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚ ç‰¹ç‚¹ï¼šå°†å“ˆå¸Œè¡¨åˆ†æˆå¤šä¸ªæ®µï¼ˆSegmentï¼‰ï¼Œæ¯ä¸ªæ®µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é”ã€‚ä¸åŒæ®µçš„æ•°æ®å¯ä»¥è¢«ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œå¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ã€‚ ä¼˜ç‚¹ï¼šå‡å°‘äº†é”ç«äº‰ï¼Œæé«˜äº†å¹¶å‘è®¿é—®ç‡ã€‚ JDK 1.8ï¼š å®ç°æ–¹å¼ï¼šå–æ¶ˆäº† Segment çš„æ¦‚å¿µï¼Œæ”¹ä¸ºä½¿ç”¨ Node æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ã€‚ ç‰¹ç‚¹ï¼šä½¿ç”¨ synchronized å’Œ CASï¼ˆCompare-And-Swapï¼‰æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚é”ç²’åº¦æ›´ç»†ï¼Œsynchronized åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘æ ‘çš„é¦–èŠ‚ç‚¹ã€‚ ä¼˜ç‚¹ï¼šè¿›ä¸€æ­¥å‡å°‘äº†é”ç«äº‰ï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œé“¾è¡¨ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä¼˜åŒ–äº†æŸ¥æ‰¾æ€§èƒ½ã€‚ åº•å±‚æ•°æ®ç»“æ„ Hashtableï¼š æ•°æ®ç»“æ„ï¼šæ•°ç»„ + é“¾è¡¨ã€‚ ç‰¹ç‚¹ï¼šæ•°ç»„æ˜¯å“ˆå¸Œè¡¨çš„ä¸»ä½“ï¼Œé“¾è¡¨ç”¨äºè§£å†³å“ˆå¸Œå†²çªã€‚ ç¼ºç‚¹ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½éœ€è¦ç«äº‰åŒä¸€æŠŠé”ï¼Œå¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚ ConcurrentHashMapï¼š JDK 1.7ï¼š æ•°æ®ç»“æ„ï¼šSegment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨ã€‚ ç‰¹ç‚¹ï¼šæ¯ä¸ª Segment åŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œæ¯ä¸ª HashEntry æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ã€‚é€šè¿‡åˆ†æ®µé”æœºåˆ¶ï¼Œä¸åŒæ®µçš„æ•°æ®å¯ä»¥è¢«ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®ã€‚ JDK 1.8ï¼š æ•°æ®ç»“æ„ï¼šNode æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚ ç‰¹ç‚¹ï¼šå½“é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œé“¾è¡¨ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä»¥ä¼˜åŒ–æŸ¥æ‰¾æ€§èƒ½ã€‚ä½¿ç”¨ synchronized å’Œ CAS æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé”ç²’åº¦æ›´ç»†ã€‚ å¹¶å‘åº¦ Hashtableï¼š å¹¶å‘åº¦ï¼šæœ€å¤§å¹¶å‘åº¦ä¸º 1ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½åŒæ­¥åœ¨åŒä¸€ä¸ªé”ä¸Šã€‚ ç‰¹ç‚¹ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºæ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç«äº‰åŒä¸€æŠŠé”ã€‚ ConcurrentHashMapï¼š JDK 1.7ï¼š å¹¶å‘åº¦ï¼šæœ€å¤§å¹¶å‘åº¦ä¸º Segment æ•°ç»„çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 16ã€‚ ç‰¹ç‚¹ï¼šé€šè¿‡åˆ†æ®µé”æœºåˆ¶ï¼Œä¸åŒæ®µçš„æ•°æ®å¯ä»¥è¢«ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚ JDK 1.8ï¼š å¹¶å‘åº¦ï¼šæœ€å¤§å¹¶å‘åº¦ä¸º Node æ•°ç»„çš„å¤§å°ï¼Œé€šå¸¸æ¯” JDK 1.7 æ›´é«˜ã€‚ ç‰¹ç‚¹ï¼šé”ç²’åº¦æ›´ç»†ï¼Œå‡å°‘äº†é”ç«äº‰ï¼Œè¿›ä¸€æ­¥æé«˜äº†å¹¶å‘æ€§èƒ½ã€‚ 19. JDK 1.7 å’Œ JDK 1.8 çš„ ConcurrentHashMap å®ç°å·®å¼‚ çº¿ç¨‹å®‰å…¨å®ç°æ–¹å¼ JDK 1.7ï¼š å®ç°æ–¹å¼ï¼šä½¿ç”¨åˆ†æ®µé”ï¼ˆSegmentï¼‰æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚ ç‰¹ç‚¹ï¼šæ¯ä¸ª Segment æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é”ï¼Œä¸åŒ Segment çš„æ•°æ®å¯ä»¥è¢«ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œå‡å°‘äº†é”ç«äº‰ã€‚ JDK 1.8ï¼š å®ç°æ–¹å¼ï¼šå–æ¶ˆäº† Segment çš„æ¦‚å¿µï¼Œæ”¹ä¸ºä½¿ç”¨ Node æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚ ç‰¹ç‚¹ï¼šä½¿ç”¨ synchronized å’Œ CAS æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé”ç²’åº¦æ›´ç»†ï¼Œsynchronized åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†é”ç«äº‰ã€‚ åº•å±‚æ•°æ®ç»“æ„ JDK 1.7ï¼š æ•°æ®ç»“æ„ï¼šSegment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨ã€‚ ç‰¹ç‚¹ï¼šæ¯ä¸ª Segment åŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œæ¯ä¸ª HashEntry æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ã€‚é€šè¿‡åˆ†æ®µé”æœºåˆ¶ï¼Œä¸åŒæ®µçš„æ•°æ®å¯ä»¥è¢«ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®ã€‚ JDK 1.8ï¼š æ•°æ®ç»“æ„ï¼šNode æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚ ç‰¹ç‚¹ï¼šå½“é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œé“¾è¡¨ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä»¥ä¼˜åŒ–æŸ¥æ‰¾æ€§èƒ½ã€‚ä½¿ç”¨ synchronized å’Œ CAS æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé”ç²’åº¦æ›´ç»†ã€‚ æ€§èƒ½ä¼˜åŒ– JDK 1.7ï¼š ä¼˜åŒ–ï¼šé€šè¿‡åˆ†æ®µé”æœºåˆ¶ï¼Œå‡å°‘äº†é”ç«äº‰ï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚ JDK 1.8ï¼š ä¼˜åŒ–ï¼šé”ç²’åº¦æ›´ç»†ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†é”ç«äº‰ã€‚é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä¼˜åŒ–äº†æŸ¥æ‰¾æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å†²çªæƒ…å†µä¸‹ã€‚ 20. ä¸ºä»€ä¹ˆ ConcurrentHashMap çš„ key å’Œ value ä¸èƒ½ä¸º null åœ¨ Java é›†åˆæ¡†æ¶ä¸­ï¼ŒConcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå…¶è®¾è®¡ä¸Šä¸å…è®¸keyå’Œvalueä¸ºnullã€‚\n1. é¿å…äºŒä¹‰æ€§\nnullä½œä¸ºä¸€ç§ç‰¹æ®Šå€¼ï¼Œä»£è¡¨æ²¡æœ‰å¯¹è±¡æˆ–å¼•ç”¨ã€‚åœ¨ConcurrentHashMapä¸­ï¼Œè‹¥å…è®¸nullä½œä¸ºkeyï¼Œå°†æ— æ³•åŒºåˆ†è¯¥keyæ˜¯å®é™…å­˜åœ¨äºConcurrentHashMapä¸­ä¸”å€¼ä¸ºnullï¼Œè¿˜æ˜¯æ ¹æœ¬ä¸å­˜åœ¨æ­¤keyã€‚åŒç†ï¼Œå¯¹äºvalueï¼Œä¹Ÿéš¾ä»¥åˆ¤æ–­è¿”å›çš„nullæ˜¯çœŸå®å­˜å‚¨çš„å€¼ï¼Œè¿˜æ˜¯å› æœªæ‰¾åˆ°å¯¹åº”keyè€Œäº§ç”Ÿçš„ç»“æœã€‚ä¾‹å¦‚getæ–¹æ³•è¿”å›nullæ—¶ï¼Œå­˜åœ¨å€¼ä¸åœ¨é›†åˆä¸­ä»¥åŠå€¼æœ¬èº«ä¸ºnullè¿™ä¸¤ç§å¯èƒ½ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„äºŒä¹‰æ€§ã€‚\n2. å¤šçº¿ç¨‹ç¯å¢ƒçš„å¤æ‚æ€§\nåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ“ä½œConcurrentHashMapæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½åŒæ—¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ— æ³•ä¾èµ–containsKey(key)æ–¹æ³•æ¥å‡†ç¡®åˆ¤æ–­é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ã€‚å› ä¸ºåœ¨è°ƒç”¨containsKeyæ–¹æ³•ä¹‹åï¼Œåˆ°ä¾æ®è¯¥ç»“æœè¿›è¡Œåç»­æ“ä½œä¹‹å‰çš„è¿™æ®µæ—¶é—´å†…ï¼ŒConcurrentHashMapå¯èƒ½å·²è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œä»è€Œå¯¼è‡´åˆ¤æ–­å¤±è¯¯ï¼Œä½¿å¾—äºŒä¹‰æ€§é—®é¢˜æ— æ³•å¾—åˆ°æœ‰æ•ˆè§£å†³ã€‚\n3. ä¸ HashMap å¯¹æ¯”\nHashMapåˆ™æœ‰æ‰€ä¸åŒï¼Œå®ƒå…è®¸nullä½œä¸ºkeyå’Œvalueã€‚å…¶ä¸­nullä½œä¸ºkeyåªèƒ½æœ‰ä¸€ä¸ªï¼Œnullä½œä¸ºvalueå¯ä»¥æœ‰å¤šä¸ªã€‚åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ï¼Œç”±äºä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹åŒæ—¶ä¿®æ”¹HashMapçš„æƒ…å†µï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡containsKey(key)æ–¹æ³•å‡†ç¡®åˆ¤æ–­é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ï¼Œè¿›è€Œåšå‡ºç›¸åº”å¤„ç†ï¼Œä¸ä¼šå‡ºç°äºŒä¹‰æ€§é—®é¢˜ã€‚\n21. comparable å’Œ Comparator çš„åŒºåˆ« æ¥å£æ¥æºå’Œå®šä¹‰ comparableï¼šæ¥å£å‡ºè‡ªjava.langåŒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªcompareTo(Object obj)æ–¹æ³•ç”¨äºæ’åºã€‚å®ç°äº†Comparableæ¥å£çš„ç±»ï¼Œæ„å‘³ç€è¯¥ç±»çš„å¯¹è±¡å…·æœ‰è‡ªç„¶æ’åºçš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼ŒStringç±»ã€Integerç±»ç­‰éƒ½å®ç°äº†Comparableæ¥å£ï¼Œå®ƒä»¬çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›è¡Œæ¯”è¾ƒå’Œæ’åºã€‚ Comparatorï¼šæ¥å£å‡ºè‡ªjava.utilåŒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªcompare(Object obj1, Object obj2)æ–¹æ³•ç”¨äºæ’åºã€‚Comparatoræ¥å£ç”¨äºå®šä¹‰ä¸€ç§å¤–éƒ¨æ¯”è¾ƒè§„åˆ™ï¼Œå½“ä¸€ä¸ªç±»æ²¡æœ‰å®ç°Comparableæ¥å£ï¼Œæˆ–è€…éœ€è¦ä½¿ç”¨ä¸è‡ªç„¶æ’åºä¸åŒçš„æ’åºè§„åˆ™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Comparatoræ¥å£ã€‚ ä½¿ç”¨åœºæ™¯ comparableï¼šä¸€èˆ¬ç”¨äºå¯¹ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ è¿›è¡Œç»Ÿä¸€çš„è‡ªç„¶æ’åºã€‚æ¯”å¦‚ï¼Œè¦å¯¹ä¸€ä¸ªArrayList\u0026lt;Integer\u0026gt;è¿›è¡Œå‡åºæ’åºï¼Œç”±äºIntegerç±»å®ç°äº†Comparableæ¥å£ï¼Œç›´æ¥è°ƒç”¨Collections.sort()æ–¹æ³•å³å¯æŒ‰ç…§è‡ªç„¶é¡ºåºï¼ˆå‡åºï¼‰å¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚ Comparatorï¼šå½“éœ€è¦å¯¹æŸä¸€ä¸ªé›†åˆå®ç°è‡ªå®šä¹‰æ’åºæ–¹å¼ï¼Œæˆ–è€…éœ€è¦å¯¹ä¸€ä¸ªé›†åˆå®ç°å¤šç§æ’åºæ–¹å¼æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªSongç±»ï¼Œéœ€è¦å¯¹å…¶å¯¹è±¡æ ¹æ®æ­Œåå’Œæ­Œæ‰‹ååˆ†åˆ«é‡‡ç”¨ä¸åŒçš„æ’åºæ–¹å¼ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡å®ç°Comparatoræ¥å£æ¥å®šä¹‰ä¸åŒçš„æ¯”è¾ƒè§„åˆ™ã€‚å¯ä»¥åˆ›å»ºä¸¤ä¸ªä¸åŒçš„Comparatorå®ç°ç±»ï¼Œä¸€ä¸ªç”¨äºæŒ‰æ­Œåæ’åºï¼Œä¸€ä¸ªç”¨äºæŒ‰æ­Œæ‰‹åæ’åºï¼Œç„¶ååœ¨è°ƒç”¨Collections.sort()æ–¹æ³•æ—¶ä¼ å…¥ç›¸åº”çš„Comparatorå®ä¾‹æ¥å®ç°ä¸åŒçš„æ’åºéœ€æ±‚ã€‚ äºŒã€å¤šçº¿ç¨‹ç¯‡ 1. çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ è¿›ç¨‹ï¼šç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ã€‚å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚\nçº¿ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ\näºŒè€…å¯¹æ¯”\nï¼ˆ1ï¼‰è¿›ç¨‹æ˜¯æ­£åœ¨è¿è¡Œç¨‹åºçš„å®ä¾‹ï¼Œè¿›ç¨‹ä¸­åŒ…å«äº†çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸åŒçš„ä»»åŠ¡\nï¼ˆ2ï¼‰ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œåœ¨å½“å‰è¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹å¯ä»¥å…±äº«å†…å­˜ç©ºé—´\nï¼ˆ3ï¼‰çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½(ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‡çš„æ˜¯ä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹)\n2. å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç°åœ¨éƒ½æ˜¯å¤šæ ¸CPUï¼Œåœ¨å¤šæ ¸CPUä¸‹\nå¹¶å‘æ˜¯åŒä¸€æ—¶é—´åº”å¯¹å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼Œå¤šä¸ªçº¿ç¨‹è½®æµä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªCPUï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„æ—¶é—´ç‰‡å†…è·å¾— CPU èµ„æºæ¥æ‰§è¡Œä»»åŠ¡ã€‚\nå¹¶è¡Œæ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšå¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ª 4 æ ¸ CPU å¯ä»¥åŒæ—¶æ‰§è¡Œ 4 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ CPU æ ¸å¿ƒä¸Šè¿è¡Œï¼Œè¿™äº›çº¿ç¨‹çš„æ‰§è¡Œæ˜¯å®Œå…¨å¹¶è¡Œçš„ï¼Œä¸ä¼šç›¸äº’ç­‰å¾… CPU èµ„æºã€‚\n3. åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼ åœ¨javaä¸­ä¸€å…±æœ‰å››ç§å¸¸è§çš„åˆ›å»ºæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼šç»§æ‰¿Threadç±»ã€å®ç°runnableæ¥å£ã€å®ç°Callableæ¥å£ã€çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­éƒ½ä¼šé‡‡ç”¨çº¿ç¨‹æ± çš„æ–¹å¼åˆ›å»ºçº¿ç¨‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class MyExecutors implements Runnable{ @Override public void run() { System.out.println(\u0026#34;MyRunnable...run...\u0026#34;); } public static void main(String[] args) { // åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡ ExecutorService threadPool = Executors.newFixedThreadPool(3); threadPool.submit(new MyExecutors()) ; // å…³é—­çº¿ç¨‹æ±  threadPool.shutdown(); } } 4. runnable å’Œ callable æœ‰ä»€ä¹ˆåŒºåˆ« Runnable æ¥å£runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼›Callableæ¥å£callæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œæ˜¯ä¸ªæ³›å‹ï¼Œå’ŒFutureã€FutureTaské…åˆå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœ Callalbeæ¥å£æ”¯æŒè¿”å›æ‰§è¡Œç»“æœï¼Œéœ€è¦è°ƒç”¨FutureTask.get()å¾—åˆ°ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ä¸»è¿›ç¨‹çš„ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦‚æœä¸è°ƒç”¨ä¸ä¼šé˜»å¡ã€‚ Callableæ¥å£çš„call()æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ï¼›è€ŒRunnableæ¥å£çš„run()æ–¹æ³•çš„å¼‚å¸¸åªèƒ½åœ¨å†…éƒ¨æ¶ˆåŒ–ï¼Œä¸èƒ½ç»§ç»­ä¸ŠæŠ› 5. çº¿ç¨‹çš„ run()å’Œ start()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ start(): ç”¨æ¥å¯åŠ¨çº¿ç¨‹ï¼Œé€šè¿‡è¯¥çº¿ç¨‹è°ƒç”¨runæ–¹æ³•æ‰§è¡Œrunæ–¹æ³•ä¸­æ‰€å®šä¹‰çš„é€»è¾‘ä»£ç ã€‚startæ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚\nrun(): å°è£…äº†è¦è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œå¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ã€‚\n6. çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„ åœ¨JDKä¸­çš„Threadç±»ä¸­çš„æšä¸¾Stateé‡Œé¢å®šä¹‰äº†6ç§çº¿ç¨‹çš„çŠ¶æ€åˆ†åˆ«æ˜¯ï¼šæ–°å»ºã€å¯è¿è¡Œã€ç»ˆç»“ã€é˜»å¡ã€ç­‰å¾…å’Œæœ‰æ—¶é™ç­‰å¾…å…­ç§ã€‚\nå…³äºçº¿ç¨‹çš„çŠ¶æ€åˆ‡æ¢æƒ…å†µæ¯”è¾ƒå¤šã€‚æˆ‘åˆ†åˆ«ä»‹ç»ä¸€ä¸‹\nå½“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡è¢«åˆ›å»ºï¼Œä½†è¿˜æœªè°ƒç”¨ start æ–¹æ³•æ—¶å¤„äºæ–°å»ºçŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œçº¿ç¨‹ä»…ä»…æ˜¯åœ¨ Java å †ä¸­åˆ†é…äº†å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿè¿˜æ²¡æœ‰ä¸ºå…¶åˆ†é…ä»»ä½•èµ„æºï¼Œçº¿ç¨‹å°šæœªå¯åŠ¨ã€‚è°ƒç”¨äº† start æ–¹æ³•ï¼Œå°±ä¼šç”±æ–°å»ºè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹å†…ä»£ç å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”±å¯è¿è¡Œè¿›å…¥ç»ˆç»“çŠ¶æ€ã€‚å½“ç„¶è¿™äº›æ˜¯ä¸€ä¸ªçº¿ç¨‹æ­£å¸¸æ‰§è¡Œæƒ…å†µã€‚\nå½“çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„é”æ—¶ï¼Œå¦‚æœè¯¥é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œçº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚çº¿ç¨‹ä¼šè¢«æ”¾å…¥è¯¥å¯¹è±¡çš„ Monitor é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚åªæœ‰å½“æŒé”çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™å”¤é†’é˜»å¡é˜Ÿåˆ—ä¸­çš„é˜»å¡çº¿ç¨‹ï¼Œå”¤é†’åçš„çº¿ç¨‹è¿›å…¥å¯è¿è¡ŒçŠ¶æ€\nå¦‚æœçº¿ç¨‹è·å–é”æˆåŠŸåï¼Œä½†ç”±äºæ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨äº† wait() æ–¹æ³•ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„é”ï¼Œå¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å½“å…¶å®ƒæŒé”çº¿ç¨‹è°ƒç”¨ notify() æˆ– notifyAll() æ–¹æ³•ï¼Œä¼šæ¢å¤ä¸ºå¯è¿è¡ŒçŠ¶æ€ï¼Œç­‰å¾…è·å–é”å¹¶ç»§ç»­æ‰§è¡Œã€‚\nè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯è°ƒç”¨ sleep(long) æ–¹æ³•ä¹Ÿä¼šä»å¯è¿è¡ŒçŠ¶æ€è¿›å…¥æœ‰æ—¶é™ç­‰å¾…çŠ¶æ€ï¼Œä¸éœ€è¦ä¸»åŠ¨å”¤é†’ï¼Œè¶…æ—¶æ—¶é—´åˆ°è‡ªç„¶æ¢å¤ä¸ºå¯è¿è¡ŒçŠ¶æ€ã€‚\n7. æ–°å»º T1ã€T2ã€T3 ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ å—¯~~ï¼Œæˆ‘æ€è€ƒä¸€ä¸‹ ï¼ˆé€‚å½“çš„æ€è€ƒæˆ–æƒ³ä¸€ä¸‹å±äºæ­£å¸¸æƒ…å†µï¼Œè„±å£è€Œå‡ºåè€Œå¤ªå‡[èƒŒè¯µç—•è¿¹]ï¼‰\nå¯ä»¥è¿™ä¹ˆåšï¼Œåœ¨å¤šçº¿ç¨‹ä¸­æœ‰å¤šç§æ–¹æ³•è®©çº¿ç¨‹æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œå¯ä»¥ç”¨çº¿ç¨‹ç±»çš„join()æ–¹æ³•åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¯åŠ¨å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å®Œæˆè¯¥çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚\næ¯”å¦‚è¯´ï¼š\nä½¿ç”¨joinæ–¹æ³•ï¼ŒT3è°ƒç”¨T2ï¼ŒT2è°ƒç”¨T1ï¼Œè¿™æ ·å°±èƒ½ç¡®ä¿T1å°±ä¼šå…ˆå®Œæˆè€ŒT3æœ€åå®Œæˆ\n8. notify()å’Œ notifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ notifyAllï¼šå”¤é†’æ‰€æœ‰waitçš„çº¿ç¨‹\nnotifyï¼šåªéšæœºå”¤é†’ä¸€ä¸ª wait çº¿ç¨‹\n9. åœ¨ java ä¸­ wait å’Œ sleep æ–¹æ³•çš„ä¸åŒï¼Ÿ å…±åŒç‚¹\nwait() ï¼Œwait(long) å’Œ sleep(long) çš„æ•ˆæœéƒ½æ˜¯è®©å½“å‰çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒ CPU çš„ä½¿ç”¨æƒï¼Œè¿›å…¥é˜»å¡çŠ¶æ€\nè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é€šè¿‡è°ƒç”¨ interrupt() æ–¹æ³•æ‰“æ–­å”¤é†’ï¼Œæ­¤æ—¶ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ï¼Œéœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œæ•è·å’Œå¤„ç†ã€‚\nä¸åŒç‚¹\næ–¹æ³•å½’å±ä¸åŒ sleep(long) æ˜¯ Thread çš„é™æ€æ–¹æ³• è€Œ wait()ï¼Œwait(long) éƒ½æ˜¯ Objectç±»çš„æˆå‘˜æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ é†’æ¥æ—¶æœºä¸åŒ æ‰§è¡Œ sleep(long) å’Œ wait(long) çš„çº¿ç¨‹éƒ½ä¼šåœ¨ç­‰å¾…ç›¸åº”æ¯«ç§’åé†’æ¥ wait(long) å’Œ wait() è¿˜å¯ä»¥è¢« notify å”¤é†’ï¼Œwait() å¦‚æœä¸å”¤é†’å°±ä¸€ç›´ç­‰ä¸‹å» å®ƒä»¬éƒ½å¯ä»¥è¢«æ‰“æ–­å”¤é†’ é”ç‰¹æ€§ä¸åŒï¼ˆé‡ç‚¹ï¼‰ wait æ–¹æ³•çš„è°ƒç”¨å¿…é¡»å…ˆè·å– wait å¯¹è±¡çš„é”ï¼Œä¹Ÿå°±æ˜¯è¯´ wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä»£ç å—æˆ–æ–¹æ³•ä¸­ä½¿ç”¨ã€‚è€Œ sleep æ–¹æ³•åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ã€‚ wait æ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—è¯¥å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½†ä½ ä»¬è¿˜å¯ä»¥ç”¨ï¼‰ è€Œ sleep å¦‚æœåœ¨ synchronized ä»£ç å—ä¸­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½ ä»¬ä¹Ÿç”¨ä¸äº†ï¼‰ 10. å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥åœæ­¢çº¿ç¨‹\nâ€‹\tä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢\nâ€‹\tä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢ï¼ˆä¸æ¨èï¼Œæ–¹æ³•å·²ä½œåºŸï¼‰\nâ€‹\tä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹\n11. è®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„åº•å±‚åŸç†ï¼Ÿ synchronized ç¿»è¯‘æˆä¸­æ–‡æ˜¯åŒæ­¥çš„çš„æ„æ€ï¼Œä¸»è¦è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œå¯ä»¥ä¿ è¯è¢«å®ƒä¿®é¥°çš„â½…æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰â¼€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚\nsynchronized å±äºæ‚²è§‚é”ã€‚åº•å±‚ä½¿ç”¨çš„JVMçº§åˆ«ä¸­çš„Monitor æ¥å†³å®šå½“å‰çº¿ç¨‹æ˜¯å¦è·å¾—äº†é”ï¼Œå¦‚æœæŸä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œåœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯ä¸èƒ½æˆ–å¾—åˆ°é”çš„ã€‚\nsynchronized å› ä¸ºéœ€è¦ä¾èµ–äºJVMçº§åˆ«çš„Monitor ï¼Œç›¸å¯¹æ€§èƒ½ä¹Ÿæ¯”è¾ƒä½ã€‚\nMonitor å¯¹è±¡å­˜åœ¨äºæ¯ä¸ª Java å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ï¼Œæ‰€ä»¥æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé” ã€‚å¯¹è±¡å¤´æ˜¯ Java å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡çš„ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚å“ˆå¸Œç ã€åˆ†ä»£å¹´é¾„ç­‰ï¼ŒåŒæ—¶ä¹ŸåŒ…å«äº†æŒ‡å‘ Monitor çš„æŒ‡é’ˆã€‚å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–æŸä¸ªå¯¹è±¡çš„é”æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨å°è¯•è·å–è¯¥å¯¹è±¡å¯¹åº”çš„ Monitorã€‚\nmonitorå†…éƒ¨ç»´æŠ¤äº†ä¸‰ä¸ªå˜é‡\nWaitSetï¼šä¿å­˜å¤„äºWaitingçŠ¶æ€çš„çº¿ç¨‹ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”çš„æƒ…å†µä¸‹è°ƒç”¨äº†å¯¹è±¡çš„ wait() æ–¹æ³•ï¼Œå®ƒä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„é”ï¼Œå¹¶è¿›å…¥ WaitSet ä¸­ç­‰å¾…ã€‚åªæœ‰å½“å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥å¯¹è±¡çš„ notify() æˆ– notifyAll() æ–¹æ³•æ—¶ï¼ŒWaitSet ä¸­çš„çº¿ç¨‹æ‰æœ‰å¯èƒ½è¢«å”¤é†’ï¼Œé‡æ–°å‚ä¸é”çš„ç«äº‰ã€‚ EntryListï¼šä¿å­˜å¤„äºBlockedçŠ¶æ€çš„çº¿ç¨‹ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„é”æ—¶ï¼Œå®ƒä¼šè¢«æ”¾å…¥ EntryList ä¸­è¿›è¡Œé˜»å¡ç­‰å¾…ã€‚è¿™äº›çº¿ç¨‹ä¼šåœ¨æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åï¼Œè¢«å”¤é†’å¹¶å‚ä¸é”çš„ç«äº‰ã€‚ Ownerï¼šç”¨äºè®°å½•å½“å‰æŒæœ‰é”çš„çº¿ç¨‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æˆåŠŸè·å–åˆ° Monitor æ—¶ï¼ŒMonitor ä¸­çš„ Owner ä¼šè¢«è®¾ç½®ä¸ºè¯¥çº¿ç¨‹ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹æˆä¸ºäº†é”çš„æŒæœ‰è€…ã€‚ åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°çš„æ ‡å¿—å°±æ˜¯åœ¨monitorä¸­è®¾ç½®æˆåŠŸäº†Ownerï¼Œä¸€ä¸ªmonitorä¸­åªèƒ½æœ‰ä¸€ä¸ªOwner\nåœ¨ä¸Šé”çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿæ¥æŠ¢é”ï¼Œåˆ™è¿›å…¥EntryList è¿›è¡Œé˜»å¡ï¼Œå½“è·å¾—é”çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†ï¼Œé‡Šæ”¾äº†é”ï¼Œå°±ä¼šå”¤é†’EntryList ä¸­ç­‰å¾…çš„çº¿ç¨‹ç«äº‰é”ï¼Œç«äº‰çš„æ—¶å€™æ˜¯éå…¬å¹³çš„ã€‚\n12. è®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„ä½¿ç”¨æ–¹å¼ï¼Ÿ åœ¨ Java é‡Œï¼Œsynchronized å…³é”®å­—ä¸»è¦æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œç›®çš„æ˜¯å®ç°çº¿ç¨‹é—´çš„åŒæ­¥ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®è¢«ä¿æŠ¤çš„ä»£ç æˆ–èµ„æºã€‚\nä¿®é¥°å®ä¾‹æ–¹æ³•ï¼šç»™å½“å‰å¯¹è±¡å®ä¾‹åŠ é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥å®ä¾‹æ–¹æ³•æ—¶ï¼Œåœ¨è¿›å…¥åŒæ­¥ä»£ç ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å–è¿™ä¸ªå¯¹è±¡å®ä¾‹çš„é”ã€‚åªæœ‰è·å¾—é”åï¼Œçº¿ç¨‹æ‰èƒ½æ‰§è¡Œæ–¹æ³•é‡Œçš„ä»£ç ï¼›å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œå½“å‰çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚ ä¿®é¥°é™æ€æ–¹æ³•ï¼šç»™å½“å‰ç±»åŠ é”ï¼Œè¿™ä¸ªé”ä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ã€‚ç”±äºé™æ€æˆå‘˜å½’æ•´ä¸ªç±»æ‰€æœ‰ï¼Œè¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ï¼Œæ‰€ä»¥è¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å–å½“å‰ class çš„é”ã€‚è¦æ³¨æ„ï¼Œé™æ€ synchronized æ–¹æ³•å’Œéé™æ€ synchronized æ–¹æ³•ä¹‹é—´çš„è°ƒç”¨ä¸ä¼šäº’æ–¥ã€‚æ¯”å¦‚çº¿ç¨‹ A è°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€ synchronized æ–¹æ³•ï¼ŒåŒæ—¶çº¿ç¨‹ B è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ synchronized æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µæ˜¯å…è®¸çš„ï¼Œå› ä¸ºå®ƒä»¬å ç”¨çš„é”ä¸åŒï¼Œå‰è€…æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”ï¼Œåè€…æ˜¯å½“å‰ç±»çš„é”ã€‚ **ä¿®é¥°ä»£ç å—ï¼š**å¯¹æ‹¬å·é‡ŒæŒ‡å®šçš„å¯¹è±¡æˆ–ç±»åŠ é”ã€‚ synchronized(object)ï¼šè¡¨ç¤ºåœ¨è¿›å…¥åŒæ­¥ä»£ç å—ä¹‹å‰ï¼Œéœ€è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚åªæœ‰æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œçº¿ç¨‹æ‰èƒ½æ‰§è¡Œä»£ç å—ä¸­çš„å†…å®¹ã€‚ synchronized(ç±».class)ï¼šæ„å‘³ç€è¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—ç»™å®š Class çš„é”ã€‚è¿™ç§æ–¹å¼å’Œä¿®é¥°é™æ€æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ç±»è¿›è¡ŒåŠ é”ã€‚ 12. Monitorå®ç°çš„é”å±äºé‡é‡çº§é”ï¼Œä½ äº†è§£è¿‡é”å‡çº§å—ï¼Ÿ Javaä¸­çš„synchronizedæœ‰åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ä¸‰ç§å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”äº†é”åªè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€ä¸åŒçº¿ç¨‹äº¤æ›¿æŒæœ‰é”ã€å¤šçº¿ç¨‹ç«äº‰é”ä¸‰ç§æƒ…å†µã€‚\nåå‘é” åå‘é”é€‚ç”¨äºåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨é”çš„åœºæ™¯ã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è·å–é”æ—¶ï¼Œä¼šé€šè¿‡ CAS æ“ä½œæŠŠè‡ªå·±çš„çº¿ç¨‹ ID è®°å½•åœ¨å¯¹è±¡å¤´çš„ mark word é‡Œã€‚ä¹‹åè¿™ä¸ªçº¿ç¨‹å†æ¬¡è·å–è¿™æŠŠé”æ—¶ï¼Œåªéœ€æ£€æŸ¥ mark word ä¸­çš„çº¿ç¨‹ ID æ˜¯ä¸æ˜¯è‡ªå·±çš„ï¼Œæ˜¯çš„è¯å°±èƒ½ç›´æ¥è·å–é”ï¼Œé¿å…äº†é¢‘ç¹ CAS æ“ä½œçš„å¼€é”€ã€‚\nè½»é‡çº§é” è½»é‡çº§é”é€‚ç”¨äºä¸åŒçº¿ç¨‹äº¤æ›¿æŒæœ‰é”ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹åŠ é”æ—¶é—´é”™å¼€ã€æ²¡æœ‰é”ç«äº‰çš„æƒ…å†µã€‚çº¿ç¨‹å°è¯•è·å–è½»é‡çº§é”æ—¶ï¼Œä¼šå…ˆåœ¨è‡ªå·±çš„æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•ï¼Œç„¶åç”¨ CAS æ“ä½œæŠŠå¯¹è±¡å¤´çš„ mark word å¤åˆ¶åˆ°é”è®°å½•é‡Œï¼Œå¹¶è®©å¯¹è±¡å¤´æŒ‡å‘é”è®°å½•ã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œå°±è·å–åˆ°äº†è½»é‡çº§é”ï¼›å¦‚æœå¤±è´¥ï¼Œå°±è‡ªæ—‹ç­‰å¾…ã€‚è½»é‡çº§é”ä¸»è¦é€šè¿‡ä¿®æ”¹å¯¹è±¡å¤´çš„é”æ ‡å¿—å®ç°ï¼Œé¿å…äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ€§èƒ½æ¯”é‡é‡çº§é”å¥½å¾ˆå¤šã€‚è¿™å°±åƒä¸¤ä¸ªäººäº¤æ›¿ç”¨ä¸€ä¸ªæˆ¿é—´ï¼Œä¸€ä¸ªäººæ¥çš„æ—¶å€™åœ¨è‡ªå·±æœ¬å­ä¸Šè®°æˆ¿é—´ä¿¡æ¯ï¼ŒæŠŠé—¨å£ç‰Œå­æŒ‡å‘è‡ªå·±æœ¬å­ï¼Œå¦ä¸€ä¸ªäººæ¥å‘ç°ç‰Œå­æŒ‡å‘åˆ«äººæœ¬å­å°±ç­‰ä¸€ä¼šå„¿ã€‚\né‡é‡çº§é” é‡é‡çº§é”é€‚ç”¨äºå¤šçº¿ç¨‹ç«äº‰é”çš„åœºæ™¯ã€‚å®ƒåº•å±‚ç”¨ Monitor å®ç°ï¼Œå½“çº¿ç¨‹ç«äº‰é”å¤±è´¥æ—¶ä¼šè¢«é˜»å¡ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚è¿™æ¶‰åŠåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬é«˜ï¼Œæ€§èƒ½ä½ã€‚å°±åƒå¾ˆå¤šäººåŒæ—¶æŠ¢ä¸€ä¸ªæˆ¿é—´ï¼Œé—¨å£æœ‰ç®¡ç†å‘˜ç®¡ç†ï¼Œç«äº‰ä¸åˆ°çš„äººè¦å»ç­‰å¾…åŒºï¼Œç­‰æˆ¿é—´ç©ºäº†ç®¡ç†å‘˜å†å«äººè¿›æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆéº»çƒ¦ï¼Œæ•ˆç‡ä½ã€‚\né”å‡çº§æœºåˆ¶ é”çš„çŠ¶æ€ä¼šæ ¹æ®ç«äº‰æƒ…å†µå‡çº§ï¼Œä¸€æ—¦å‡ºç°ç«äº‰ï¼Œä¼šæŒ‰ç…§åå‘é” -\u0026gt; è½»é‡çº§é” -\u0026gt; é‡é‡çº§é”çš„é¡ºåºå‡çº§ï¼Œè€Œä¸”é”å‡çº§æ˜¯å•å‘çš„ï¼Œå‡ä¸ºé‡é‡çº§é”åå°±ä¸ä¼šå†é™çº§ã€‚\n13. ä½ è°ˆè°ˆ JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰ Javaå†…å­˜æ¨¡å‹æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§éå¸¸é‡è¦çš„å†…å­˜æ¨¡å‹ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯æè¿°Javaç¨‹åºä¸­çº¿ç¨‹å…±äº«å˜é‡çš„è®¿é—®è§„åˆ™ï¼Œä»¥åŠè¿™äº›å˜é‡åœ¨JVMä¸­æ˜¯å¦‚ä½•è¢«å­˜å‚¨å’Œè¯»å–çš„ï¼Œè¿™äº›è§„åˆ™ä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®çš„ä¸€è‡´æ€§å’Œç¨‹åºçš„æ­£ç¡®æ€§ã€‚\nè¿™ä¸ªæ¨¡å‹æœ‰å‡ ä¸ªæ ¸å¿ƒçš„ç‰¹ç‚¹ã€‚é¦–å…ˆï¼Œæ‰€æœ‰çš„å…±äº«å˜é‡ï¼ŒåŒ…æ‹¬å®ä¾‹å˜é‡ï¼ˆå±äºå¯¹è±¡çš„å˜é‡ï¼‰å’Œç±»å˜é‡ï¼ˆç”¨ static ä¿®é¥°çš„å˜é‡ï¼‰ï¼Œéƒ½è¢«å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—æœºçš„RAMã€‚ä¸»å†…å­˜å°±åƒæ˜¯ä¸€ä¸ªå…¬å…±ä»“åº“ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½èƒ½è®¿é—®å®ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå±€éƒ¨å˜é‡å¹¶ä¸åŒ…å«åœ¨å†…ï¼Œå› ä¸ºå®ƒä»¬æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚\nå…¶æ¬¡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹ä¼šæŠŠä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡å¤åˆ¶ä¸€ä»½åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œå½¢æˆå·¥ä½œå‰¯æœ¬ã€‚è¿™æ„å‘³ç€ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼Œæ— è®ºæ˜¯è¯»è¿˜æ˜¯å†™ï¼Œéƒ½å¿…é¡»åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­å®Œæˆï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚\næœ€åï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ã€‚å¦‚æœçº¿ç¨‹é—´éœ€è¦ä¼ é€’å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å¿…é¡»é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚threadA å…ˆæŠŠä¿®æ”¹åçš„å€¼å†™å›ä¸»å†…å­˜ï¼ŒthreadB å†ä»ä¸»å†…å­˜è¯»å–è¿™ä¸ªå€¼ï¼Œè¿™æ ·å°±å®Œæˆäº†å˜é‡çš„ä¼ é€’ã€‚\n14. CAS ä½ çŸ¥é“å—ï¼Ÿ CASï¼Œæ˜¯ä¸€ç§æ— é”ç®—æ³•ï¼Œç”¨äºå®ç°å¤šçº¿ç¨‹åŒæ­¥çš„åŸå­æ“ä½œ\nCAS æ˜¯ä¸€ç§**ä¹è§‚é”**ç­–ç•¥ï¼Œå®ƒå‡è®¾åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ä¼šå‘ç”Ÿå†²çªï¼Œå› æ­¤åœ¨æ“ä½œå…±äº«èµ„æºæ—¶ä¸ä¼šåŠ é”ï¼Œè€Œæ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡ã€‚\nåŸç†\nCAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼ï¼ˆBï¼‰ã€‚æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šå…ˆæ¯”è¾ƒå†…å­˜ä½ç½® V çš„å€¼æ˜¯å¦ä¸é¢„æœŸåŸå€¼ A ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œå°±å°†å†…å­˜ä½ç½® V çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ Bï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ä¸è¿›è¡Œæ›´æ–°ã€‚æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œç”± CPU ç¡¬ä»¶ä¿è¯ã€‚\nä¼˜ç¼ºç‚¹\nä¼˜ç‚¹ï¼šé¿å…äº†é”çš„ä½¿ç”¨ï¼Œå‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œåœ¨å¹¶å‘å†²çªè¾ƒå°‘æ—¶æ€§èƒ½è¾ƒé«˜ã€‚\nç¼ºç‚¹ï¼šå­˜åœ¨ ABA é—®é¢˜ï¼Œå³ä¸€ä¸ªå€¼ä» A å˜ä¸º B å†å˜å› Aï¼ŒCAS ä¼šè®¤ä¸ºå€¼æœªæ”¹å˜ï¼›å¹¶ä¸”åœ¨å¹¶å‘å†²çªæ¿€çƒˆæ—¶ï¼Œçº¿ç¨‹ä¼šé¢‘ç¹è‡ªæ—‹ï¼Œæ¶ˆè€—å¤§é‡ CPU èµ„æºã€‚å¯¹äº ABA é—®é¢˜ï¼ŒJava æä¾›äº† AtomicStampedReference ç±»æ¥è§£å†³ã€‚\n15. ä»€ä¹ˆæ˜¯AQSï¼Ÿ ä»€ä¹ˆæ˜¯ AQSï¼Ÿ AQSï¼ˆAbstractQueuedSynchronizerï¼‰æ˜¯ Java æä¾›çš„ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºæ„å»ºé”å’Œå…¶ä»–åŒæ­¥ç»„ä»¶ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ä¸€ä¸ªæ•´æ•°å˜é‡ï¼ˆstateï¼‰æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªFIFOé˜Ÿåˆ—æ¥ç®¡ç†çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’ã€‚å®ƒæ˜¯ä¸€ä¸ªæ„å»ºåŒæ­¥å™¨çš„åŸºç¡€ï¼Œæä¾›äº†è®¸å¤šé˜»å¡é”å’ŒåŒæ­¥å·¥å…·çš„å®ç°ï¼Œå¦‚ ReentrantLockã€Semaphore å’Œ CountDownLatch ç­‰ã€‚\nAQS çš„å·¥ä½œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ AQS é€šè¿‡ç»´æŠ¤ä¸€ä¸ª state å±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—æ¥ç®¡ç†è·å–é”çš„çº¿ç¨‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¦‚æœé”ä¸å¯ç”¨ï¼Œè¯¥çº¿ç¨‹ä¼šè¢«åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚AQS è¿˜æ”¯æŒæ¡ä»¶å˜é‡å’Œç›¸åº”çš„ç­‰å¾…/å”¤é†’æœºåˆ¶ã€‚\nAQS å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨åœ°ä¿®æ”¹ stateï¼Ÿ AQS ä½¿ç”¨ CASï¼ˆCompare-AndSwapï¼‰æ“ä½œæ¥å®‰å…¨åœ°ä¿®æ”¹ state å±æ€§ï¼Œç¡®ä¿è¿™ä¸€æ“ä½œçš„åŸå­æ€§ï¼Œé¿å…å¤šçº¿ç¨‹åŒæ—¶ä¿®æ”¹å¯¼è‡´çš„é—®é¢˜ã€‚\nAQS æ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Ÿ AQS æœ¬èº«å¹¶ä¸ç›´æ¥å®ç°å…¬å¹³æ€§æˆ–éå…¬å¹³æ€§ï¼Œä½†åŸºäº AQS å®ç°çš„é”å¯ä»¥æ˜¯å…¬å¹³æˆ–éå…¬å¹³çš„ã€‚ä¾‹å¦‚ï¼ŒReentrantLock é»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œä½†å¯ä»¥é…ç½®ä¸ºå…¬å¹³é”ã€‚å…¬å¹³é”ç¡®ä¿ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚\nAQS å¸¸è§çš„å®ç°ç±»æœ‰å“ªäº›ï¼Ÿ å¸¸è§çš„åŸºäº AQS å®ç°çš„ç±»åŒ…æ‹¬ï¼š\nReentrantLockï¼šä¸€ç§å¯é‡å…¥çš„äº’æ–¥é”ã€‚ Semaphoreï¼šç”¨äºæ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚ CountDownLatchï¼šå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œã€‚ é¢è¯•è¯´ï¼šAQSæ˜¯Javaå¹¶å‘åŒ…ä¸­çš„ä¸€ä¸ªåŸºç¡€æ¡†æ¶ï¼Œç”¨äºæ„å»ºé”å’Œå…¶ä»–åŒæ­¥å™¨ã€‚å®ƒé€šè¿‡ä¸€ä¸ªstateå˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªFIFOé˜Ÿåˆ—æ¥ç®¡ç†çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’ã€‚AQSæœ‰ä¸¤ç§æ¨¡å¼ï¼šç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ã€‚ç‹¬å æ¨¡å¼ä¸‹ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–é”ï¼›å…±äº«æ¨¡å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«èµ„æºã€‚AQSçš„æ ¸å¿ƒåœ¨äºå®ƒæä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ–¹æ³•æ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´æ–¹ä¾¿åœ°å®ç°è‡ªå·±çš„åŒæ­¥å™¨ã€‚\n16. ReentrantLockçš„å®ç°åŸç† é¦–å…ˆï¼ŒReentrantLockæ˜¯ä¸€ç§å¯é‡å…¥çš„æ’å®ƒé”ï¼Œä¸»è¦ç”¨æ¥è§£å†³å¤šçº¿ç¨‹å¯¹å…±äº«èµ„æºç«äº‰çš„é—®é¢˜ã€‚\nå®ƒçš„æ ¸å¿ƒç‰¹æ€§æœ‰å‡ ä¸ªï¼š\nå®ƒæ”¯æŒå¯é‡å…¥ï¼Œä¹Ÿå°±æ˜¯è·å¾—é”çš„çº¿ç¨‹åœ¨é‡Šæ”¾é”ä¹‹å‰å†æ¬¡å»ç«äº‰åŒä¸€æŠŠé”çš„æ—¶å€™ï¼Œä¸éœ€è¦åŠ é”å°±å¯ä»¥ç›´æ¥è®¿é—®ã€‚\nå®ƒæ”¯æŒå…¬å¹³å’Œéå…¬å¹³ç‰¹æ€§\nå®ƒæä¾›äº†é˜»å¡ç«äº‰é”å’Œéé˜»å¡ç«äº‰é”çš„ä¸¤ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯lock()å’ŒtryLock()ã€‚\nç„¶åï¼ŒReentrantLockçš„åº•å±‚å®ç°æœ‰å‡ ä¸ªéå¸¸å…³é”®çš„æŠ€æœ¯ã€‚\né”çš„ç«äº‰ï¼ŒReentrantLockæ˜¯é€šè¿‡äº’æ–¥å˜é‡ï¼Œä½¿ç”¨CASæœºåˆ¶æ¥å®ç°çš„ã€‚\næ²¡æœ‰ç«äº‰åˆ°é”çš„çº¿ç¨‹ï¼Œä½¿ç”¨äº†AbstractQueuedSynchronizerè¿™æ ·ä¸€ä¸ªé˜Ÿåˆ—åŒæ­¥å™¨æ¥å­˜å‚¨ï¼Œåº•å±‚æ˜¯é€šè¿‡åŒå‘é“¾è¡¨æ¥å®ç°çš„ã€‚å½“é”è¢«é‡Šæ”¾ä¹‹åï¼Œä¼šä»AQSé˜Ÿåˆ—é‡Œé¢çš„å¤´éƒ¨å”¤é†’ä¸‹ä¸€ä¸ªç­‰å¾…é”çš„çº¿ç¨‹ã€‚\nå…¬å¹³å’Œéå…¬å¹³çš„ç‰¹æ€§ï¼Œä¸»è¦æ˜¯ä½“ç°åœ¨ç«äº‰é”çš„æ—¶å€™ï¼Œæ˜¯å¦éœ€è¦åˆ¤æ–­AQSé˜Ÿåˆ—å­˜åœ¨ç­‰å¾…ä¸­çš„çº¿ç¨‹ã€‚\næœ€åï¼Œå…³äºé”çš„é‡å…¥ç‰¹æ€§ï¼Œåœ¨AQSé‡Œé¢æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡æ¥ä¿å­˜å½“å‰è·å¾—é”çš„çº¿ç¨‹ï¼Œå½“åŒä¸€ä¸ªçº¿ç¨‹ä¸‹æ¬¡å†æ¥ç«äº‰é”çš„æ—¶å€™ï¼Œå°±ä¸ä¼šå»èµ°é”ç«äº‰çš„é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥å¢åŠ é‡å…¥æ¬¡æ•°ã€‚\n17. synchronizedå’ŒLockæœ‰ä»€ä¹ˆåŒºåˆ« ? ç¬¬ä¸€ï¼Œè¯­æ³•å±‚é¢\nsynchronized æ˜¯å…³é”®å­—ï¼Œæºç åœ¨ jvm ä¸­ï¼Œç”¨ c++ è¯­è¨€å®ç°ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—é”ä¼šè‡ªåŠ¨é‡Šæ”¾ Lock æ˜¯æ¥å£ï¼Œæºç ç”± jdk æä¾›ï¼Œç”¨ java è¯­è¨€å®ç°ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ unlock æ–¹æ³•é‡Šæ”¾é” ç¬¬äºŒï¼ŒåŠŸèƒ½å±‚é¢\näºŒè€…å‡å±äºæ‚²è§‚é”ã€éƒ½å…·å¤‡åŸºæœ¬çš„äº’æ–¥ã€åŒæ­¥ã€é”é‡å…¥åŠŸèƒ½ Lock æä¾›äº†è®¸å¤š synchronized ä¸å…·å¤‡çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è·å–ç­‰å¾…çŠ¶æ€ã€å…¬å¹³é”ã€å¯æ‰“æ–­ã€å¯è¶…æ—¶ã€å¤šæ¡ä»¶å˜é‡ï¼ŒåŒæ—¶Lock å¯ä»¥å®ç°ä¸åŒçš„åœºæ™¯ï¼Œå¦‚ ReentrantLockï¼Œ ReentrantReadWriteLock ç¬¬ä¸‰ï¼Œæ€§èƒ½å±‚é¢\nåœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œsynchronized åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ï¼Œæ€§èƒ½ä¸èµ– åœ¨ç«äº‰æ¿€çƒˆæ—¶ï¼ŒLock çš„å®ç°é€šå¸¸ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œæ¯”å¦‚å¯ä¸­æ–­è·å–é”ï¼Œå¯è¶…æ—¶è·å–é”ï¼Œå…¬å¹³é”çš„é€‰æ‹©ï¼Œå¤šæ¡ä»¶å˜é‡çš„å®ç°ã€‚ Lock ç›¸æ¯” synchronized æ‰€å…·å¤‡çš„è¿™äº›ç‹¬ç‰¹åŠŸèƒ½ï¼š 1. è·å–ç­‰å¾…çŠ¶æ€ synchronized çš„å±€é™ï¼šä½¿ç”¨ synchronized æ—¶ï¼Œæˆ‘ä»¬æ²¡åŠæ³•çŸ¥é“å½“å‰æœ‰æ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è·å–è¿™æŠŠé”ï¼Œä¹Ÿä¸æ¸…æ¥šç­‰å¾…çš„çº¿ç¨‹æ•°é‡ã€‚å°±å¥½æ¯”ä½ å»ä¸€ä¸ªå…¬å…±å«ç”Ÿé—´ï¼Œç”¨ synchronized çš„è¯ï¼Œä½ åªèƒ½çŸ¥é“é‡Œé¢æœ‰æ²¡æœ‰äººï¼Œä½†ä¸çŸ¥é“å¤–é¢æ’äº†å¤šå°‘äººç­‰ç€è¿›å»ã€‚ Lock çš„ä¼˜åŠ¿ï¼šLock å¯ä»¥è®©æˆ‘ä»¬è·å–åˆ°ç­‰å¾…é”çš„çº¿ç¨‹çš„ç›¸å…³çŠ¶æ€ã€‚ä»¥ ReentrantLock ä¸ºä¾‹ï¼Œå€ŸåŠ© getQueueLength() æ–¹æ³•å°±èƒ½çŸ¥é“æœ‰å¤šå°‘çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–è¿™æŠŠé”ã€‚è¿™å°±å¥½åƒå«ç”Ÿé—´é—¨å£æœ‰ä¸ªæ˜¾ç¤ºå±ï¼Œèƒ½æ˜¾ç¤ºæ’é˜Ÿçš„äººæ•°ï¼Œè®©æˆ‘ä»¬å¯¹æ•´ä½“æƒ…å†µæœ‰æ›´æ¸…æ™°çš„äº†è§£ã€‚ 2. å…¬å¹³é” synchronized çš„æƒ…å†µï¼šsynchronized å®ç°çš„æ˜¯éå…¬å¹³é”ã€‚è¿™å°±å¥½æ¯”å¤§å®¶åœ¨æŠ¢å…¬äº¤è½¦çš„åº§ä½ï¼Œä¸ç®¡è°å…ˆæ¥ï¼Œåªè¦æœ‰ç©ºåº§ï¼Œè°æŠ¢åˆ°å°±æ˜¯è°çš„ã€‚å¯èƒ½å…ˆæ¥çš„äººåè€Œæ²¡æŠ¢åˆ°åº§ï¼Œåæ¥çš„äººå´æ·è¶³å…ˆç™»äº†ã€‚ Lock çš„å…¬å¹³é”ï¼šLock å¯ä»¥å®ç°å…¬å¹³é”ã€‚å…¬å¹³é”å°±åƒæ˜¯å¤§å®¶æ’é˜Ÿåå…¬äº¤è½¦ï¼Œå…ˆåˆ°çš„äººå…ˆä¸Šè½¦æœ‰åº§åï¼Œååˆ°çš„äººä¾æ¬¡æ’é˜Ÿç­‰å¾…ã€‚ReentrantLock å¯ä»¥åœ¨åˆ›å»ºæ—¶é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šä¸ºå…¬å¹³é”ï¼Œå³ new ReentrantLock(true)ï¼Œè¿™æ ·çº¿ç¨‹è·å–é”çš„é¡ºåºå°±å’Œå®ƒä»¬è¯·æ±‚é”çš„é¡ºåºä¸€è‡´äº†ã€‚ 3. å¯æ‰“æ–­ synchronized çš„é—®é¢˜ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ synchronized è·å–é”æ—¶ï¼Œå¦‚æœè¿™ä¸ªé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œå½“å‰çº¿ç¨‹å°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œè€Œä¸”åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ã€‚è¿™å°±å¥½æ¯”ä½ åœ¨æ’é˜Ÿä¹°ä¸œè¥¿ï¼Œå‰é¢çš„äººä¸€ç›´ä¸ä¹°å®Œï¼Œä½ å°±åªèƒ½å¹²ç­‰ç€ï¼Œæ²¡åŠæ³•ä¸­é€”ç¦»å¼€å»åšåˆ«çš„äº‹ã€‚ Lock çš„å¯æ‰“æ–­ç‰¹æ€§ï¼šLock æä¾›äº†å¯æ‰“æ–­çš„åŠŸèƒ½ã€‚ä½¿ç”¨ lockInterruptibly() æ–¹æ³•è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œå®ƒä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ï¼Œç„¶åçº¿ç¨‹å¯ä»¥å»åšå…¶ä»–äº‹æƒ…ã€‚å°±åƒæ’é˜Ÿä¹°ä¸œè¥¿æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨ç­‰å¾—ä¸è€çƒ¦çš„æ—¶å€™ï¼Œå¬åˆ°åˆ«äººå«ä½ å»åšåˆ«çš„äº‹ï¼Œä½ å°±å¯ä»¥ç¦»å¼€é˜Ÿä¼å»å¤„ç†å…¶ä»–äº‹æƒ…ã€‚ 4. å¯è¶…æ—¶ synchronized çš„ä¸è¶³ï¼šsynchronized æ²¡æœ‰è¶…æ—¶æœºåˆ¶ï¼Œçº¿ç¨‹ä¸€æ—¦å¼€å§‹ç­‰å¾…é”ï¼Œå°±ä¼šä¸€ç›´ç­‰ä¸‹å»ï¼Œå¯èƒ½ä¼šé€ æˆé•¿æ—¶é—´çš„é˜»å¡ã€‚è¿™å°±å¥½æ¯”ä½ å»é¤å…åƒé¥­ï¼Œå‰é¢çš„äººä¸€ç›´å ç€æ¡Œå­ä¸èµ°ï¼Œä½ åªèƒ½ä¸€ç›´ç­‰ï¼Œæ²¡æœ‰åˆ«çš„é€‰æ‹©ã€‚ Lock çš„å¯è¶…æ—¶åŠŸèƒ½ï¼šLock å¯ä»¥è®¾ç½®è·å–é”çš„è¶…æ—¶æ—¶é—´ã€‚ä½¿ç”¨ tryLock(long timeout, TimeUnit unit) æ–¹æ³•æ—¶ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œçº¿ç¨‹å°±ä¼šæ”¾å¼ƒç­‰å¾…ï¼Œè¿”å› falseã€‚è¿™å°±åƒä½ å»é¤å…åƒé¥­ï¼Œç­‰äº†ä¸€æ®µæ—¶é—´æ¡Œå­è¿˜æ²¡è…¾å‡ºæ¥ï¼Œä½ å°±å¯ä»¥é€‰æ‹©å»åˆ«çš„é¤å…ï¼Œä¸ç”¨ä¸€ç›´å¹²ç­‰ç€ã€‚ 5. å¤šæ¡ä»¶å˜é‡ synchronized çš„å•ä¸€æ€§ï¼šsynchronized é…åˆ wait()ã€notify() å’Œ notifyAll() æ–¹æ³•åªèƒ½å®ç°å•ä¸€çš„æ¡ä»¶ç­‰å¾…å’Œå”¤é†’ã€‚å°±å¥½æ¯”ä¸€ä¸ªæˆ¿é—´é‡Œåªæœ‰ä¸€ä¸ªé—¨é“ƒï¼Œä¸ç®¡æ˜¯è°åœ¨ç­‰æ¶ˆæ¯ï¼Œé—¨é“ƒä¸€å“æ‰€æœ‰äººéƒ½å¾—é†’æ¥çœ‹æ˜¯ä¸æ˜¯è‡ªå·±çš„æ¶ˆæ¯ã€‚ Lock çš„å¤šæ¡ä»¶å˜é‡ï¼šLock å¯ä»¥é€šè¿‡ newCondition() æ–¹æ³•åˆ›å»ºå¤šä¸ªæ¡ä»¶å˜é‡ã€‚æ¯ä¸ªæ¡ä»¶å˜é‡éƒ½å¯ä»¥å•ç‹¬è¿›è¡Œç­‰å¾…å’Œå”¤é†’æ“ä½œã€‚çº¿ç¨‹å¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶åœ¨ä¸åŒçš„é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œå”¤é†’æ—¶ä¹Ÿå¯ä»¥ç²¾ç¡®åœ°å”¤é†’ç‰¹å®šæ¡ä»¶ä¸‹ç­‰å¾…çš„çº¿ç¨‹ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„å”¤é†’å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæé«˜äº†çº¿ç¨‹é—´åä½œçš„æ•ˆç‡ã€‚ 18. æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ å—¯ï¼Œæ˜¯è¿™æ ·çš„ï¼Œä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”ï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼š\nt1 çº¿ç¨‹è·å¾—Aå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Bå¯¹è±¡çš„é”\nt2 çº¿ç¨‹è·å¾—Bå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Aå¯¹è±¡çš„é”\nè¿™ä¸ªæ—¶å€™t1çº¿ç¨‹å’Œt2çº¿ç¨‹éƒ½åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„é”ï¼Œå°±äº§ç”Ÿäº†æ­»é”\n19. å¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ å¯ä»¥ä½¿ç”¨jdkè‡ªå¸¦çš„å·¥å…·ï¼šjpså’Œ jstack\nå…ˆé€šè¿‡jpsæ¥æŸ¥çœ‹å½“å‰javaç¨‹åºè¿è¡Œçš„è¿›ç¨‹id\nç„¶åé€šè¿‡jstackæ¥æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹idï¼Œå°±èƒ½å±•ç¤ºå‡ºæ¥æ­»é”çš„é—®é¢˜ï¼Œå¹¶ä¸”ï¼Œå¯ä»¥å®šä½ä»£ç çš„å…·ä½“è¡Œå·èŒƒå›´ï¼Œæˆ‘ä»¬å†å»æ‰¾åˆ°å¯¹åº”çš„ä»£ç è¿›è¡Œæ’æŸ¥å°±è¡Œäº†ã€‚\næˆ–è€…ç”¨ä¸€äº›å¯è§†åŒ–å·¥å…·ï¼šjconsoleã€VisualVMï¼Œbinç›®å½•ä¸‹ ç›´æ¥å¯åŠ¨å°±è¡Œ\n20. ConcurrentHashMap ConcurrentHashMap æ˜¯ä¸€ç§çº¿ç¨‹å®‰å…¨çš„é«˜æ•ˆMapé›†åˆï¼Œjdk1.7å’Œ1.8ä¹Ÿåšäº†å¾ˆå¤šè°ƒæ•´ã€‚\nJDK1.7çš„åº•å±‚é‡‡ç”¨æ˜¯åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨ å®ç° JDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ã€‚ åœ¨jdk1.7ä¸­ ConcurrentHashMap é‡ŒåŒ…å«ä¸€ä¸ª Segment æ•°ç»„ã€‚Segment çš„ç»“æ„å’ŒHashMapç±»ä¼¼ï¼Œæ˜¯ä¸€ ç§æ•°ç»„å’Œé“¾è¡¨ç»“æ„ï¼Œä¸€ä¸ª Segment åŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œæ¯ä¸ª HashEntry æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼ŒSegment æ˜¯ä¸€ç§å¯é‡å…¥çš„é” ReentrantLockï¼Œæ¯ä¸ªSegment å®ˆæŠ¤ç€ä¸€ä¸ªHashEntryæ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå½“å¯¹ HashEntry æ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å¯¹åº”çš„ Segmentçš„é”ã€‚\nåœ¨jdk1.8ä¸­çš„ConcurrentHashMap åšäº†è¾ƒå¤§çš„ä¼˜åŒ–ï¼Œæ€§èƒ½æå‡äº†ä¸å°‘ã€‚é¦–å…ˆæ˜¯å®ƒçš„æ•°æ®ç»“æ„ä¸jdk1.8çš„hashMapæ•°æ®ç»“æ„å®Œå…¨ä¸€è‡´ã€‚å…¶æ¬¡æ˜¯æ”¾å¼ƒäº†Segmentè‡ƒè‚¿çš„è®¾è®¡ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯é‡‡ç”¨Node + CAS + Synchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨è¿›è¡Œå®ç°ï¼Œsynchronizedåªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ ·åªè¦hashä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ , æ•ˆç‡å¾—åˆ°æå‡\nåœ¨ JDK 1.8 ä¸­ï¼ŒConcurrentHashMapå°†é”æœºåˆ¶ä»Segmentï¼ˆç»§æ‰¿è‡ªReentrantLockï¼‰æ”¹ä¸ºsynchronizedåæ•ˆç‡å¾—åˆ°æå‡ï¼Œä¸»è¦åŸå› å¦‚ä¸‹ï¼š 1. é”ç²’åº¦çš„å‡å°\nJDK 1.7 çš„ Segment é”ï¼šåœ¨ JDK 1.7 ä¸­ï¼ŒConcurrentHashMapä½¿ç”¨Segmentæ•°ç»„æ¥åˆ†æ®µç®¡ç†æ•°æ®ï¼Œæ¯ä¸ªSegmentæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ï¼Œå¹¶ä¸”å®ˆæŠ¤ç€ä¸€ä¸ªHashEntryæ•°ç»„ã€‚è¿™æ„å‘³ç€å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒSegmentçš„æ•°æ®ï¼Œè¿™äº›çº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œï¼›ä½†å¦‚æœè®¿é—®åŒä¸€ä¸ªSegmentçš„æ•°æ®ï¼Œå°±ä¼šè¢«é˜»å¡ã€‚ç”±äºé”çš„ç²’åº¦æ˜¯Segmentçº§åˆ«ï¼Œè€Œä¸€ä¸ªSegmentå¯èƒ½åŒ…å«å¤šä¸ªé”®å€¼å¯¹ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸åŒçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªSegmenté”çš„æ¦‚ç‡è¾ƒé«˜ï¼Œä»è€Œé™åˆ¶äº†å¹¶å‘æ€§èƒ½ã€‚ JDK 1.8 çš„ synchronized é”ï¼šJDK 1.8 ä¸­ï¼ŒConcurrentHashMapæ”¾å¼ƒäº†Segmentï¼Œç›´æ¥ä½¿ç”¨Nodeæ•°ç»„æ¥å­˜å‚¨æ•°æ®ã€‚å½“éœ€è¦ä¿®æ”¹æ•°æ®æ—¶ï¼Œsynchronizedåªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®çš„èŠ‚ç‚¹ä½äºä¸åŒçš„é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘ï¼Œæˆ–è€…å³ä½¿åœ¨åŒä¸€ä¸ªé“¾è¡¨ / æ ‘ä¸­ä½†é¦–èŠ‚ç‚¹ä¸åŒï¼Œè¿™äº›çº¿ç¨‹å°±å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚é”ç²’åº¦ä»Segmentï¼ˆåŒ…å«å¤šä¸ªé”®å€¼å¯¹ï¼‰ç»†åŒ–åˆ°äº†é“¾è¡¨æˆ–æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œå¤§å¤§é™ä½äº†çº¿ç¨‹ä¹‹é—´çš„é”ç«äº‰ï¼Œæé«˜äº†å¹¶å‘è®¿é—®çš„æ•ˆç‡ã€‚ 2. CASï¼ˆCompare and Swapï¼‰æ“ä½œçš„è¾…åŠ©\nCAS æ“ä½œåŸç†ï¼šCAS æ˜¯ä¸€ç§æ— é”çš„åŸå­æ“ä½œï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼å’Œæ–°å€¼ã€‚å½“ä¸”ä»…å½“å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼ç›¸åŒæ—¶ï¼ŒCAS æ‰ä¼šå°†å†…å­˜ä½ç½®çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ã€‚åœ¨ JDK 1.8 çš„ConcurrentHashMapä¸­ï¼Œå¯¹äºä¸€äº›æ“ä½œï¼ˆå¦‚æ’å…¥æ–°èŠ‚ç‚¹ï¼‰ï¼Œé¦–å…ˆä¼šå°è¯•ä½¿ç”¨ CAS æ“ä½œæ¥å®Œæˆã€‚åªæœ‰åœ¨ CAS æ“ä½œå¤±è´¥ï¼ˆä¾‹å¦‚å‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œå¯¼è‡´ CAS æ›´æ–°æ“ä½œå¤±è´¥ï¼‰æ—¶ï¼Œæ‰ä¼šä½¿ç”¨synchronizedé”æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ æå‡æ•ˆç‡æ–¹å¼ï¼šç”±äºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ’å…¥æ“ä½œä¸ä¼šå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œå› æ­¤ CAS æ“ä½œèƒ½å¤Ÿå¿«é€Ÿå®Œæˆï¼Œé¿å…äº†ä½¿ç”¨é”å¸¦æ¥çš„å¼€é”€ã€‚è¿™ä½¿å¾—åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒConcurrentHashMapå¯ä»¥åˆ©ç”¨ CAS çš„é«˜æ•ˆæ€§æ¥å¤„ç†å¤§éƒ¨åˆ†çš„æ“ä½œï¼Œä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨synchronizedé”ï¼Œä»è€Œæ•´ä½“ä¸Šæå‡äº†æ•ˆç‡ã€‚ 3. çº¢é»‘æ ‘çš„å¼•å…¥ä¼˜åŒ–æ•°æ®ç»“æ„\né“¾è¡¨ä¸çº¢é»‘æ ‘çš„è½¬æ¢ï¼šJDK 1.8 çš„ConcurrentHashMapä¸­ï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆ8ï¼‰æ—¶ï¼Œé“¾è¡¨ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘ç›¸æ¯”äºé“¾è¡¨ï¼Œåœ¨æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œä¸Šå…·æœ‰æ›´å¥½çš„æ—¶é—´å¤æ‚åº¦ï¼ˆé“¾è¡¨çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º O (n)ï¼Œçº¢é»‘æ ‘ä¸º O (log n)ï¼‰ã€‚ å¯¹é”æ•ˆç‡çš„å½±å“ï¼šå½“ä½¿ç”¨synchronizedé”å®šé¦–èŠ‚ç‚¹æ—¶ï¼Œç”±äºçº¢é»‘æ ‘çš„ç»“æ„ç‰¹æ€§ï¼Œåœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œå³ä½¿å­˜åœ¨é”ç«äº‰ï¼ŒåŸºäºçº¢é»‘æ ‘çš„æ“ä½œæ•ˆç‡ä¹Ÿæ¯”åŸºäºé“¾è¡¨çš„æ“ä½œæ•ˆç‡æ›´é«˜ã€‚è¿™æ„å‘³ç€åœ¨ç›¸åŒçš„å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒJDK 1.8 çš„ConcurrentHashMapèƒ½å¤Ÿæ›´å¿«åœ°å®Œæˆå„ç§æ“ä½œï¼Œä»è€Œæå‡äº†æ•´ä½“æ•ˆç‡ã€‚ 4. JVM å¯¹ synchronized çš„ä¼˜åŒ–\né”å‡çº§æœºåˆ¶ï¼šJVM åœ¨ JDK 1.6 åŠä¹‹åå¯¹synchronizedè¿›è¡Œäº†ä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œå¼•å…¥äº†åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”çš„é”å‡çº§æœºåˆ¶ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—æ—¶ï¼Œé¦–å…ˆä¼šå°è¯•è·å–åå‘é”ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ï¼Œä¸éœ€è¦è¿›è¡Œ CAS æ“ä½œå’Œé‡é‡çº§é”çš„è·å–ï¼Œä»è€Œé™ä½äº†é”çš„å¼€é”€ã€‚åªæœ‰åœ¨å‡ºç°é”ç«äº‰æ—¶ï¼Œæ‰ä¼šé€æ­¥å‡çº§åˆ°è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚ åœ¨ ConcurrentHashMap ä¸­çš„ä½œç”¨ï¼šåœ¨ JDK 1.8 çš„ConcurrentHashMapä¸­ï¼Œsynchronizedé”çš„ä½¿ç”¨æ­£å¥½å¯ä»¥åˆ©ç”¨ JVM çš„è¿™äº›ä¼˜åŒ–æœºåˆ¶ã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç”±äºé”ç²’åº¦å°ï¼Œç«äº‰ä¸æ¿€çƒˆï¼Œsynchronizedèƒ½å¤Ÿä»¥è¾ƒä½çš„å¼€é”€å·¥ä½œï¼Œè¿›ä¸€æ­¥æå‡äº†ConcurrentHashMapçš„æ€§èƒ½ã€‚ åœ¨ Java ä¸­ï¼ŒConcurrentHashMapåœ¨ä¸åŒç‰ˆæœ¬ä¸­ä½¿ç”¨äº†ä¸åŒçš„æ•°æ®ç»“æ„æ¥å®ç°å¹¶å‘å®‰å…¨çš„å“ˆå¸Œæ˜ å°„ï¼ŒSegmentæ•°ç»„å’ŒNodeæ•°ç»„æ˜¯å…¶ä¸­ä¸¤ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥ä¸‹æ˜¯å¯¹å®ƒä»¬çš„è¯¦ç»†ä»‹ç»ï¼š JDK 1.7 ä¸­çš„Segmentæ•°ç»„\nç»“æ„ä¸ä½œç”¨ï¼šConcurrentHashMapåœ¨ JDK 1.7 ä¸­ä½¿ç”¨Segmentæ•°ç»„æ¥å®ç°åˆ†æ®µé”æœºåˆ¶ã€‚æ¯ä¸ªSegmentå†…éƒ¨åŒ…å«ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œç±»ä¼¼äºHashMapçš„ç»“æ„ï¼Œå®ƒå°†æ•´ä¸ªå“ˆå¸Œè¡¨åˆ†æˆå¤šä¸ªæ®µï¼Œæ¯ä¸ªæ®µç‹¬ç«‹è¿›è¡Œé”æ§åˆ¶ã€‚è¿™æ ·ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘è®¿é—®æ—¶ï¼Œä¸åŒçš„çº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ä¸åŒçš„Segmentï¼Œä»è€Œæé«˜å¹¶å‘æ€§èƒ½ã€‚ é”æœºåˆ¶ï¼šSegmentç»§æ‰¿è‡ªReentrantLockï¼Œå½“å¯¹Segmentä¸­çš„HashEntryæ•°ç»„è¿›è¡Œä¿®æ”¹æ“ä½œï¼ˆå¦‚æ’å…¥ã€åˆ é™¤ã€æ›´æ–°ç­‰ï¼‰æ—¶ï¼Œéœ€è¦å…ˆè·å–å¯¹åº”çš„Segmentçš„é”ã€‚è¿™æ„å‘³ç€åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªSegmentä¸­çš„æ•°æ®ï¼Œè€Œä¸åŒSegmentä¹‹é—´çš„æ“ä½œå¯ä»¥å¹¶å‘è¿›è¡Œã€‚ JDK 1.8 ä¸­çš„Nodeæ•°ç»„\nç»“æ„ä¸ä½œç”¨ï¼šJDK 1.8 ä¸­çš„ConcurrentHashMapæ‘’å¼ƒäº†Segmentæ•°ç»„çš„è®¾è®¡ï¼Œé‡‡ç”¨äº†Nodeæ•°ç»„æ¥å­˜å‚¨æ•°æ®ã€‚Nodeæ˜¯å“ˆå¸Œè¡¨ä¸­çš„åŸºæœ¬èŠ‚ç‚¹ç±»å‹ï¼Œæ¯ä¸ªNodeåŒ…å«é”®å€¼å¯¹ä»¥åŠæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼ˆç”¨äºè§£å†³å“ˆå¸Œå†²çªï¼Œå½¢æˆé“¾è¡¨æˆ–çº¢é»‘æ ‘ç»“æ„ï¼‰ã€‚æ•°ç»„çš„æ¯ä¸ªä½ç½®è¦ä¹ˆæ˜¯ä¸€ä¸ªNodeèŠ‚ç‚¹ï¼Œè¦ä¹ˆæ˜¯nullï¼Œé€šè¿‡å“ˆå¸Œå€¼æ¥ç¡®å®šé”®å€¼å¯¹åœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ã€‚ é”æœºåˆ¶ä¸å¹¶å‘æ§åˆ¶ï¼šåœ¨ JDK 1.8 ä¸­ï¼ŒConcurrentHashMapé€šè¿‡Node + CAS + Synchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚å½“å¯¹Nodeæ•°ç»„è¿›è¡Œæ“ä½œæ—¶ï¼Œé¦–å…ˆä¼šå°è¯•ä½¿ç”¨CASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æ“ä½œæ¥æ›´æ–°æ•°ç»„ä¸­çš„èŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸€ç§æ— é”çš„å¹¶å‘æ“ä½œæ–¹å¼ï¼Œèƒ½åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æé«˜å¹¶å‘æ€§èƒ½ã€‚å¯¹äºä¸€äº›å¤æ‚çš„æ“ä½œï¼Œå¦‚åœ¨é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­æ’å…¥ã€åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¼šä½¿ç”¨synchronizedå…³é”®å­—æ¥é”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘æ ‘çš„é¦–èŠ‚ç‚¹ã€‚è¿™ç§æ–¹å¼ç›¸æ¯” JDK 1.7 çš„Segmenté”æ›´åŠ ç²¾ç»†ï¼Œåªé”å®šå½“å‰æ“ä½œçš„èŠ‚ç‚¹æ‰€åœ¨çš„é“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼Œè€Œä¸æ˜¯æ•´ä¸ªSegmentï¼Œä»è€Œå‡å°‘äº†é”çš„ç²’åº¦ï¼Œæé«˜äº†å¹¶å‘è®¿é—®çš„æ•ˆç‡ã€‚ 21. å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ Javaå¹¶å‘ç¼–ç¨‹æœ‰ä¸‰å¤§æ ¸å¿ƒç‰¹æ€§ï¼Œåˆ†åˆ«æ˜¯åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ã€‚\né¦–å…ˆï¼ŒåŸå­æ€§æŒ‡çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹åœ¨CPUä¸­çš„æ“ä½œæ˜¯ä¸å¯æš‚åœä¹Ÿä¸å¯ä¸­æ–­çš„ï¼Œè¦ä¹ˆæ‰§è¡Œå®Œæˆï¼Œè¦ä¹ˆä¸æ‰§è¡Œã€‚æ¯”å¦‚ï¼Œä¸€äº›ç®€å•çš„æ“ä½œå¦‚èµ‹å€¼å¯èƒ½æ˜¯åŸå­çš„ï¼Œä½†å¤åˆæ“ä½œå¦‚è‡ªå¢å°±ä¸æ˜¯åŸå­çš„ã€‚ä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—æˆ–JUCé‡Œé¢çš„Lockæ¥è¿›è¡ŒåŠ é”ã€‚\nå…¶æ¬¡ï¼Œå¯è§æ€§æ˜¯æŒ‡è®©ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚ç”±äºçº¿ç¨‹å¯èƒ½åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å…±äº«å˜é‡çš„å‰¯æœ¬ï¼Œå› æ­¤ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯èƒ½ä¸ä¼šç«‹å³åæ˜ åœ¨å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—ã€volatileå…³é”®å­—æˆ–Lockæ¥ç¡®ä¿å¯è§æ€§ã€‚\næœ€åï¼Œæœ‰åºæ€§æ˜¯æŒ‡å¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå¯¼è‡´ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºä¸ä»£ç ä¸­çš„é¡ºåºä¸ä¸€è‡´ã€‚è™½ç„¶å¤„ç†å™¨ä¼šä¿è¯ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœä¸ä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½éœ€è¦ç¡®ä¿ç‰¹å®šçš„æ‰§è¡Œé¡ºåºã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨volatileå…³é”®å­—æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚\n22. è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›ï¼‰ åœ¨çº¿ç¨‹æ± ä¸­ä¸€å…±æœ‰7ä¸ªæ ¸å¿ƒå‚æ•°ï¼š\ncorePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›® - æ± ä¸­ä¼šä¿ç•™çš„æœ€å¤šçº¿ç¨‹æ•° maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›® - æ ¸å¿ƒçº¿ç¨‹+æ•‘æ€¥çº¿ç¨‹çš„æœ€å¤§æ•°ç›® keepAliveTime ç”Ÿå­˜æ—¶é—´ - æ•‘æ€¥çº¿ç¨‹çš„ç”Ÿå­˜æ—¶é—´ï¼Œç”Ÿå­˜æ—¶é—´å†…æ²¡æœ‰æ–°ä»»åŠ¡ï¼Œæ­¤çº¿ç¨‹èµ„æºä¼šé‡Šæ”¾ unit æ—¶é—´å•ä½ - æ•‘æ€¥çº¿ç¨‹çš„ç”Ÿå­˜æ—¶é—´å•ä½ï¼Œå¦‚ç§’ã€æ¯«ç§’ç­‰ workQueue - å½“æ²¡æœ‰ç©ºé—²æ ¸å¿ƒçº¿ç¨‹æ—¶ï¼Œæ–°æ¥ä»»åŠ¡ä¼šåŠ å…¥åˆ°æ­¤é˜Ÿåˆ—æ’é˜Ÿï¼Œé˜Ÿåˆ—æ»¡ä¼šåˆ›å»ºæ•‘æ€¥çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ threadFactory çº¿ç¨‹å·¥å‚ - å¯ä»¥å®šåˆ¶çº¿ç¨‹å¯¹è±¡çš„åˆ›å»ºï¼Œä¾‹å¦‚è®¾ç½®çº¿ç¨‹åå­—ã€æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ç­‰ handler æ‹’ç»ç­–ç•¥ - å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ç€ï¼ˆæ ¸å¿ƒçº¿ç¨‹+ä¸´æ—¶çº¿ç¨‹ï¼‰ï¼Œåˆ™èµ°æ‹’ç»ç­–ç•¥ï¼Œæ‹’ç»ç­–ç•¥æœ‰4ç§ 1.AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼›\n2.CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›\n3.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›\n4.DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›\n23. çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ— Jdkä¸­æä¾›äº†å¾ˆå¤šé˜»å¡é˜Ÿåˆ—ï¼Œå¼€å‘ä¸­å¸¸è§çš„æœ‰ä¸¤ä¸ªï¼šArrayBlockingQueueå’ŒLinkedBlockingQueue\nArrayBlockingQueueå’ŒLinkedBlockingQueueæ˜¯Javaä¸­ä¸¤ç§å¸¸è§çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®ƒä»¬åœ¨å®ç°å’Œä½¿ç”¨ä¸Šæœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚\né¦–å…ˆï¼ŒArrayBlockingQueueæ˜¯ä¸€ä¸ªæœ‰ç•Œé˜Ÿåˆ—ï¼Œå®ƒåœ¨åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå®¹é‡ï¼Œå¹¶ä¸”è¿™ä¸ªå®¹é‡ä¸èƒ½æ”¹å˜ã€‚è€ŒLinkedBlockingQueueé»˜è®¤æ˜¯æ— ç•Œçš„ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºæ—¶æŒ‡å®šæœ€å¤§å®¹é‡ï¼Œä½¿å…¶å˜ä¸ºæœ‰ç•Œé˜Ÿåˆ—ã€‚\nå…¶æ¬¡ï¼Œå®ƒä»¬åœ¨å†…éƒ¨æ•°æ®ç»“æ„ä¸Šä¹Ÿæœ‰æ‰€ä¸åŒã€‚ArrayBlockingQueueæ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œè€ŒLinkedBlockingQueueåˆ™æ˜¯åŸºäºé“¾è¡¨å®ç°çš„ã€‚è¿™æ„å‘³ç€ArrayBlockingQueueåœ¨è®¿é—®å…ƒç´ æ—¶å¯èƒ½ä¼šæ›´å¿«ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›´æ¥é€šè¿‡ç´¢å¼•è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ã€‚è€ŒLinkedBlockingQueueåˆ™åœ¨æ·»åŠ å’Œåˆ é™¤å…ƒç´ æ—¶å¯èƒ½æ›´å¿«ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ç§»åŠ¨å…¶ä»–å…ƒç´ æ¥å¡«å……ç©ºé—´ã€‚\nå¦å¤–ï¼Œå®ƒä»¬åœ¨åŠ é”æœºåˆ¶ä¸Šä¹Ÿæœ‰æ‰€ä¸åŒã€‚ArrayBlockingQueueä½¿ç”¨ä¸€æŠŠé”æ¥æ§åˆ¶å¯¹é˜Ÿåˆ—çš„è®¿é—®ï¼Œè¿™æ„å‘³ç€è¯»å†™æ“ä½œéƒ½æ˜¯äº’æ–¥çš„ã€‚è€ŒLinkedBlockingQueueåˆ™ä½¿ç”¨ä¸¤æŠŠé”ï¼Œä¸€æŠŠç”¨äºæ§åˆ¶è¯»æ“ä½œï¼Œå¦ä¸€æŠŠç”¨äºæ§åˆ¶å†™æ“ä½œï¼Œè¿™æ ·å¯ä»¥æé«˜å¹¶å‘æ€§èƒ½ã€‚\n24. å¦‚ä½•ç¡®å®šæ ¸å¿ƒçº¿ç¨‹æ•° åœ¨è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ä¹‹å‰ï¼Œéœ€è¦å…ˆç†Ÿæ‚‰ä¸€äº›æ‰§è¡Œçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡çš„ç±»å‹\nIOå¯†é›†å‹ä»»åŠ¡ ä¸€èˆ¬æ¥è¯´ï¼šæ–‡ä»¶è¯»å†™ã€DBè¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰\næ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°è®¾ç½®ä¸º2N+1 ï¼ˆNä¸ºè®¡ç®—æœºçš„CPUæ ¸æ•°ï¼‰\nCPUå¯†é›†å‹ä»»åŠ¡ ä¸€èˆ¬æ¥è¯´ï¼šè®¡ç®—å‹ä»£ç ã€Bitmapè½¬æ¢ã€Gsonè½¬æ¢ç­‰\næ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°è®¾ç½®ä¸ºN+1 ï¼ˆNä¸ºè®¡ç®—æœºçš„CPUæ ¸æ•°ï¼‰\nâ‘  é«˜å¹¶å‘ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­ \u0026ndash;\u0026gt;ï¼ˆ CPUæ ¸æ•°+1 ï¼‰ï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œå› ä¸ºä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­ï¼Œçº¿ç¨‹å¾ˆå¿«å°±èƒ½å®Œæˆä»»åŠ¡å¹¶é‡Šæ”¾èµ„æºï¼Œè¾ƒå°‘çš„çº¿ç¨‹æ•°å¯ä»¥é¿å…é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚\nâ‘¡ å¹¶å‘ä¸é«˜ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿\nIOå¯†é›†å‹çš„ä»»åŠ¡ \u0026ndash;\u0026gt; (CPUæ ¸æ•° * 2 + 1) ç”±äºä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿ä¸”æ¶‰åŠå¤§é‡ IO æ“ä½œï¼Œè¾ƒå¤šçš„çº¿ç¨‹å¯ä»¥åœ¨æŸä¸ªçº¿ç¨‹ç­‰å¾… IO æ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œæé«˜ CPU çš„åˆ©ç”¨ç‡ã€‚ è®¡ç®—å¯†é›†å‹ä»»åŠ¡ \u0026ndash;\u0026gt; ï¼ˆ CPUæ ¸æ•°+1 ï¼‰å› ä¸ºä»»åŠ¡ä¸»è¦æ˜¯è®¡ç®—å·¥ä½œï¼Œè¿‡å¤šçš„çº¿ç¨‹ä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œæ‰€ä»¥ä¿æŒä¸ CPU æ ¸æ•°ç›¸è¿‘çš„çº¿ç¨‹æ•°è¾ƒä¸ºåˆé€‚ã€‚ â‘¢ å¹¶å‘é«˜ã€ä¸šåŠ¡æ‰§è¡Œæ—¶é—´é•¿ï¼Œè§£å†³è¿™ç§ç±»å‹ä»»åŠ¡çš„å…³é”®ä¸åœ¨äºçº¿ç¨‹æ± è€Œåœ¨äºæ•´ä½“æ¶æ„çš„è®¾è®¡ï¼Œé¦–å…ˆè¦è€ƒè™‘ä¸šåŠ¡ä¸­çš„æŸäº›æ•°æ®æ˜¯å¦å¯ä»¥åšç¼“å­˜ï¼Œé€šè¿‡ç¼“å­˜å¯ä»¥å‡å°‘ä¸å¿…è¦çš„è®¡ç®—å’Œ IO æ“ä½œï¼Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚å…¶æ¬¡ï¼Œå¦‚æœç¼“å­˜æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘å¢åŠ æœåŠ¡å™¨æ¥åˆ†æ‹…å‹åŠ›ã€‚\n25. çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº› åœ¨jdkä¸­é»˜è®¤æä¾›äº†4ç§æ–¹å¼åˆ›å»ºçº¿ç¨‹æ± \nç¬¬ä¸€ä¸ªæ˜¯ï¼šnewCachedThreadPoolåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± \nçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æ˜¯çµæ´»å¯å˜çš„ã€‚å½“æœ‰æ–°ä»»åŠ¡æäº¤æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­æœ‰ç©ºé—²çº¿ç¨‹ï¼Œå°±ä¼šå¤ç”¨è¿™äº›ç©ºé—²çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›å¦‚æœæ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚ å¯¹äºç©ºé—²çº¿ç¨‹æœ‰ä¸€å®šçš„å›æ”¶æœºåˆ¶ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹åœ¨ 60 ç§’å†…éƒ½å¤„äºç©ºé—²çŠ¶æ€ï¼Œå°±ä¼šè¢«å›æ”¶é”€æ¯ï¼Œè¿™æ ·å¯ä»¥é¿å…èµ„æºçš„æµªè´¹ã€‚ ç¬¬äºŒä¸ªæ˜¯ï¼šnewFixedThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ é€‚ç”¨äºéœ€è¦æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡çš„åœºæ™¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥æ± ï¼Œä¸ºäº†é¿å…è¿‡å¤šçš„çº¿ç¨‹åŒæ—¶è®¿é—®æ•°æ®åº“å¯¼è‡´èµ„æºè€—å°½ï¼Œå¯ä»¥ä½¿ç”¨å®šé•¿çº¿ç¨‹æ± æ¥é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°ã€‚\nç¬¬ä¸‰ä¸ªæ˜¯ï¼šnewScheduledThreadPool åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ é€‚ç”¨äºéœ€è¦å®šæ—¶æ‰§è¡Œä»»åŠ¡æˆ–å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ï¼Œä¾‹å¦‚å®šæ—¶æ•°æ®å¤‡ä»½ã€å®šæ—¶ç»Ÿè®¡ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ç­‰ã€‚\nç¬¬å››ä¸ªæ˜¯ï¼šnewSingleThreadExecutor åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚\n26. ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ±  ä¸»è¦åŸå› æ˜¯å¦‚æœä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± çš„è¯ï¼Œå®ƒå…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é»˜è®¤é•¿åº¦æ˜¯Integer.MAX_VALUEï¼Œè¿™æ ·çš„è¯ï¼Œæœ‰å¯èƒ½å¯¼è‡´å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¨èä½¿ç”¨ThreadPoolExecutoræ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œè¿™æ ·å¯ä»¥æ˜ç¡®è§„å®šçº¿ç¨‹æ± çš„å‚æ•°ï¼Œé¿å…èµ„æºçš„è€—å°½ã€‚\n27. ä½ ä»¬é¡¹ç›®å“ªé‡Œç”¨åˆ°äº†å¤šçº¿ç¨‹ å‚è€ƒåœºæ™¯ä¸€ï¼š\nesæ•°æ®æ‰¹é‡å¯¼å…¥\nåœ¨æˆ‘ä»¬é¡¹ç›®ä¸Šçº¿ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®é‡çš„æ•°æ®ä¸€æ¬¡æ€§çš„åŒæ­¥åˆ°esç´¢å¼•åº“ä¸­ï¼Œä½†æ˜¯å½“æ—¶çš„æ•°æ®å¥½åƒæ˜¯1000ä¸‡å·¦å³ï¼Œä¸€æ¬¡æ€§è¯»å–æ•°æ®è‚¯å®šä¸è¡Œï¼ˆoomå¼‚å¸¸ï¼‰ï¼Œå¦‚æœåˆ†æ‰¹æ‰§è¡Œçš„è¯ï¼Œè€—æ—¶ä¹Ÿå¤ªä¹…äº†ã€‚æ‰€ä»¥ï¼Œå½“æ—¶æˆ‘å°±æƒ³åˆ°å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼å¯¼å…¥ï¼Œåˆ©ç”¨CountDownLatch+Futureæ¥æ§åˆ¶ï¼Œå°±èƒ½å¤§å¤§æå‡å¯¼å…¥çš„æ—¶é—´ã€‚\nå‚è€ƒåœºæ™¯äºŒï¼š\nåœ¨æˆ‘åšé‚£ä¸ªxxç”µå•†ç½‘ç«™çš„æ—¶å€™ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®æ±‡æ€»çš„åŠŸèƒ½ï¼Œåœ¨ç”¨æˆ·ä¸‹å•ä¹‹åéœ€è¦æŸ¥è¯¢è®¢å•ä¿¡æ¯ï¼Œä¹Ÿéœ€è¦è·å¾—è®¢å•ä¸­çš„å•†å“è¯¦ç»†ä¿¡æ¯ï¼ˆå¯èƒ½æ˜¯å¤šä¸ªï¼‰ï¼Œè¿˜éœ€è¦æŸ¥çœ‹ç‰©æµå‘è´§ä¿¡æ¯ã€‚å› ä¸ºå®ƒä»¬ä¸‰ä¸ªå¯¹åº”çš„åˆ†åˆ«ä¸‰ä¸ªå¾®æœåŠ¡ï¼Œå¦‚æœä¸€ä¸ªä¸€ä¸ªçš„æ“ä½œçš„è¯ï¼Œäº’ç›¸ç­‰å¾…çš„æ—¶é—´æ¯”è¾ƒé•¿ã€‚æ‰€ä»¥ï¼Œæˆ‘å½“æ—¶å°±æƒ³åˆ°å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± ï¼Œè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†ï¼Œæœ€ç»ˆå†æ±‡æ€»ç»“æœå°±å¯ä»¥äº†ï¼Œå½“ç„¶é‡Œé¢éœ€è¦ç”¨åˆ°Futureæ¥è·å–æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¹‹åçš„ç»“æœæ‰è¡Œ\nå‚è€ƒåœºæ™¯ä¸‰ï¼š\nã€Šé»‘é©¬å¤´æ¡ã€‹é¡¹ç›®ä¸­ä½¿ç”¨çš„\næˆ‘å½“æ—¶åšäº†ä¸€ä¸ªæ–‡ç« æœç´¢çš„åŠŸèƒ½ï¼Œç”¨æˆ·è¾“å…¥å…³é”®å­—è¦æœç´¢æ–‡ç« ï¼ŒåŒæ—¶éœ€è¦ä¿å­˜ç”¨æˆ·çš„æœç´¢è®°å½•ï¼ˆæœç´¢å†å²ï¼‰ï¼Œè¿™å—æˆ‘è®¾è®¡çš„æ—¶å€™ï¼Œä¸ºäº†ä¸å½±å“ç”¨æˆ·çš„æ­£å¸¸æœç´¢ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œä¿å­˜çš„ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬åŠ å…¥äº†çº¿ç¨‹æ± ï¼Œä¹Ÿå°±è¯´åœ¨è°ƒç”¨å¼‚æ­¥æ–¹æ³•çš„æ—¶å€™ï¼Œç›´æ¥ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹ä½¿ç”¨\n28. å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡ï¼Ÿ åœ¨jdkä¸­æä¾›äº†ä¸€ä¸ªSemaphore[semÉ™fÉ”Ër]ç±»ï¼ˆä¿¡å·é‡ï¼‰\nå®ƒæä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œsemaphore.acquire() è¯·æ±‚ä¿¡å·é‡ï¼Œå¯ä»¥é™åˆ¶çº¿ç¨‹çš„ä¸ªæ•°ï¼Œæ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œå¦‚æœä¿¡å·é‡æ˜¯-1,å°±ä»£è¡¨å·²ç»ç”¨å®Œäº†ä¿¡å·é‡ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦é˜»å¡äº†\nç¬¬äºŒä¸ªæ–¹æ³•æ˜¯semaphore.release()ï¼Œä»£è¡¨æ˜¯é‡Šæ”¾ä¸€ä¸ªä¿¡å·é‡ï¼Œæ­¤æ—¶ä¿¡å·é‡çš„ä¸ªæ•°+1\n29. è°ˆè°ˆä½ å¯¹ThreadLocalçš„ç†è§£ ThreadLocal ä¸»è¦åŠŸèƒ½æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯ä»¥å®ç°èµ„æºå¯¹è±¡çš„çº¿ç¨‹éš”ç¦»ï¼Œè®©æ¯ä¸ªçº¿ç¨‹å„ç”¨å„çš„èµ„æºå¯¹è±¡ï¼Œé¿å…äº‰ç”¨å¼•å‘çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯å®ç°äº†çº¿ç¨‹å†…çš„èµ„æºå…±äº«\n30. çŸ¥é“ThreadLocalçš„åº•å±‚åŸç†å®ç°å—ï¼Ÿ åœ¨ThreadLocalå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸€ä¸ª ThreadLocalMap ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡\nå½“æˆ‘ä»¬è°ƒç”¨ set æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œèµ„æºå¯¹è±¡ä½œä¸º valueï¼Œæ”¾å…¥å½“å‰çº¿ç¨‹çš„ ThreadLocalMap é›†åˆä¸­\nå½“è°ƒç”¨ get æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œåˆ°å½“å‰çº¿ç¨‹ä¸­æŸ¥æ‰¾å…³è”çš„èµ„æºå€¼\nå½“è°ƒç”¨ remove æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œç§»é™¤å½“å‰çº¿ç¨‹å…³è”çš„èµ„æºå€¼\n31. å…³äºThreadLocalä¼šå¯¼è‡´å†…å­˜æº¢å‡ºè¿™ä¸ªäº‹æƒ…ï¼Œäº†è§£å—ï¼Ÿ ThreadLocalMap ä¸­çš„ Entry ç±»çš„key æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œè€Œ value æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚å¼±å¼•ç”¨çš„ç‰¹ç‚¹æ˜¯ï¼Œå½“åƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨ï¼Œé‚£ä¹ˆæ— è®ºå½“å‰å†…å­˜æ˜¯å¦å……è¶³ï¼Œè¯¥å¯¹è±¡éƒ½ä¼šè¢«å›æ”¶ã€‚æ‰€ä»¥ï¼Œå½“å¤–éƒ¨å¯¹ ThreadLocal å¯¹è±¡çš„å¼ºå¼•ç”¨è¢«é‡Šæ”¾åï¼ŒThreadLocalMap ä¸­çš„ key ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œå³ key å˜ä¸º nullã€‚\nç„¶è€Œï¼Œvalue æ˜¯å¼ºå¼•ç”¨ï¼Œåªè¦å½“å‰çº¿ç¨‹è¿˜å­˜åœ¨ï¼ŒThreadLocalMap å°±ä¸ä¼šè¢«å›æ”¶ï¼Œvalue ä¹Ÿä¸ä¼šè¢«å›æ”¶ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ ThreadLocalMap ä¸­å­˜åœ¨ä¸€äº› key ä¸º nullï¼Œä½† value ä¸ä¸º null çš„ Entryï¼Œè¿™äº› Entry æ— æ³•è¢«è®¿é—®åˆ°ï¼Œå´å ç”¨ç€å†…å­˜ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nè§£å†³åŠæ³• ä¸ºäº†é¿å… ThreadLocal å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä½¿ç”¨å®Œ ThreadLocal åï¼ŒåŠæ—¶è°ƒç”¨ remove æ–¹æ³•ã€‚\nå¦å¤–ï¼Œåœ¨ä½¿ç”¨ ThreadLocal æ—¶ï¼Œå°½é‡é¿å…å°†å…¶ä½œä¸ºé™æ€å˜é‡ä½¿ç”¨ï¼Œå› ä¸ºé™æ€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œç±»çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œå¯èƒ½ä¼šå¯¼è‡´ ThreadLocal å¯¹è±¡ä¸€ç›´å­˜åœ¨ï¼Œå¢åŠ å†…å­˜æ³„æ¼çš„é£é™©ã€‚åŒæ—¶ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œç”±äºçº¿ç¨‹ä¼šè¢«å¤ç”¨ï¼Œæ›´è¦æ³¨æ„åŠæ—¶è°ƒç”¨ remove æ–¹æ³•ï¼Œé˜²æ­¢ ThreadLocal ä¸­çš„æ•°æ®åœ¨ä¸åŒä»»åŠ¡ä¹‹é—´äº§ç”Ÿæ··æ·†ï¼Œä¹Ÿé¿å…å†…å­˜æ³„æ¼é—®é¢˜çš„å‘ç”Ÿã€‚\n32. è¯´è¯´çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€? Java çº¿ç¨‹å…·æœ‰ 6 ç§ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œåˆ†åˆ«ä¸ºï¼š\nNEWï¼ˆåˆå§‹çŠ¶æ€ï¼‰ï¼šçº¿ç¨‹å·²åˆ›å»ºï¼Œä½†å°šæœªè°ƒç”¨start()æ–¹æ³•å¯åŠ¨ã€‚ RUNNABLEï¼ˆè¿è¡ŒçŠ¶æ€ï¼‰ï¼šè°ƒç”¨start()æ–¹æ³•åè¿›å…¥è¯¥çŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹ç­‰å¾…è·å– CPU èµ„æºä»¥æ‰§è¡Œã€‚ BLOCKEDï¼ˆé˜»å¡çŠ¶æ€ï¼‰ï¼šçº¿ç¨‹åœ¨è·å–å¯¹è±¡é”æ—¶è¢«é˜»å¡ï¼Œéœ€ç­‰å¾…é”çš„é‡Šæ”¾ã€‚ WAITINGï¼ˆç­‰å¾…çŠ¶æ€ï¼‰ï¼šçº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œç‰¹å®šåŠ¨ä½œï¼ˆå¦‚é€šçŸ¥æˆ–ä¸­æ–­ï¼‰ï¼Œä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°æ”¶åˆ°ç›¸åº”ä¿¡å·ã€‚ TIME_WAITINGï¼ˆè¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼‰ï¼šä¸ WAITING ç±»ä¼¼ï¼Œä½†å¯åœ¨æŒ‡å®šæ—¶é—´åè‡ªè¡Œè¿”å›ï¼Œæ— éœ€ä¸€ç›´ç­‰å¾…ã€‚ TERMINATEDï¼ˆç»ˆæ­¢çŠ¶æ€ï¼‰ï¼šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸã€‚ çº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šä¾æ®ä»£ç çš„æ‰§è¡Œæƒ…å†µåœ¨è¿™äº›çŠ¶æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œå¹¶éå›ºå®šå¤„äºæŸä¸€çŠ¶æ€ ã€‚\n33. çº¿ç¨‹æ± å¦‚ä½•çŸ¥é“ä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œæˆ çº¿ç¨‹æ± åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œå¯ä»çº¿ç¨‹æ± å†…éƒ¨æœºåˆ¶å’Œçº¿ç¨‹æ± å¤–éƒ¨è·å–çŠ¶æ€ä¸¤ä¸ªæ–¹é¢æ¥ç†è§£ï¼š\nçº¿ç¨‹æ± å†…éƒ¨æœºåˆ¶\nå½“å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡åï¼Œçº¿ç¨‹æ± ä¼šè°ƒåº¦å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„runæ–¹æ³•ã€‚å·¥ä½œçº¿ç¨‹é€šè¿‡åŒæ­¥è°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•ï¼Œç­‰å¾…runæ–¹æ³•è¿”å›ï¼Œä¸€æ—¦runæ–¹æ³•æ­£å¸¸ç»“æŸï¼Œå³è¡¨æ˜ä»»åŠ¡å®Œæˆï¼Œæ­¤æ—¶å·¥ä½œçº¿ç¨‹ä¼šç»Ÿè®¡ä»»åŠ¡çš„å®Œæˆæ•°é‡ã€‚\nçº¿ç¨‹æ± å¤–éƒ¨è·å–çŠ¶æ€\nä½¿ç”¨isTerminated()æ–¹æ³•ï¼šçº¿ç¨‹æ± æä¾›äº†isTerminated()æ–¹æ³•ç”¨äºåˆ¤æ–­å…¶è¿è¡ŒçŠ¶æ€ã€‚é€šè¿‡å¾ªç¯åˆ¤æ–­è¯¥æ–¹æ³•çš„è¿”å›ç»“æœï¼Œå¯äº†è§£çº¿ç¨‹æ± çŠ¶æ€ã€‚å½“çº¿ç¨‹æ± çŠ¶æ€ä¸ºTerminatedæ—¶ï¼Œæ„å‘³ç€æ‰€æœ‰ä»»åŠ¡éƒ½å·²æ‰§è¡Œå®Œæ¯•ã€‚ä¸è¿‡ï¼Œä½¿ç”¨æ­¤æ–¹æ³•çš„å‰ææ˜¯ç¨‹åºä¸­ä¸»åŠ¨è°ƒç”¨äº†çº¿ç¨‹æ± çš„shutdown()æ–¹æ³•ã€‚åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œä¸»åŠ¨å…³é—­çº¿ç¨‹æ± çš„æƒ…å†µå¹¶ä¸å¸¸è§ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•åœ¨å®ç”¨æ€§å’Œçµæ´»æ€§ä¸Šæœ‰æ‰€æ¬ ç¼ºã€‚ åˆ©ç”¨submit()æ–¹æ³•çš„Futureè¿”å›å€¼ï¼šçº¿ç¨‹æ± çš„submit()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ã€‚é€šè¿‡è°ƒç”¨Future.get()æ–¹æ³•å¯è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚åœ¨ä»»åŠ¡æœªæ‰§è¡Œå®Œæˆå‰ï¼ŒFuture.get()æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´è‡³ä»»åŠ¡æ‰§è¡Œç»“æŸæ­£å¸¸è¿”å›ï¼Œè¿™ä¹Ÿå°±è¡¨æ˜ä¼ å…¥çº¿ç¨‹æ± çš„ä»»åŠ¡å·²æ‰§è¡Œå®Œæˆã€‚ å€ŸåŠ©CountDownLatchè®¡æ•°å™¨ï¼šCountDownLatchå¯ä»¥é€šè¿‡åˆå§‹åŒ–æŒ‡å®šä¸€ä¸ªè®¡æ•°å™¨è¿›è¡Œå€’è®¡æ—¶ï¼Œå…¶æœ‰await()æ–¹æ³•ç”¨äºé˜»å¡çº¿ç¨‹ï¼Œä»¥åŠcountDown()æ–¹æ³•ç”¨äºå€’è®¡æ—¶ã€‚åŸºäºæ­¤åŸç†ï¼Œå¯å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ä¸º 1 çš„CountDownLatchå¯¹è±¡ï¼Œåœ¨çº¿ç¨‹æ± ä»£ç å—åé¢è°ƒç”¨await()æ–¹æ³•é˜»å¡ä¸»çº¿ç¨‹ã€‚å½“ä¼ å…¥çº¿ç¨‹æ± çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œè°ƒç”¨countDown()æ–¹æ³•è¡¨ç¤ºä»»åŠ¡ç»“æŸã€‚æ­¤æ—¶è®¡æ•°å™¨å½’é›¶ï¼Œè¢«é˜»å¡åœ¨await()æ–¹æ³•çš„çº¿ç¨‹å°†è¢«å”¤é†’ã€‚ æ€»çš„æ¥è¯´ï¼Œæ— è®ºæ˜¯åœ¨çº¿ç¨‹æ± å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ï¼Œè¦çŸ¥æ™“çº¿ç¨‹æ˜¯å¦æ‰§è¡Œç»“æŸï¼Œå…³é”®åœ¨äºè·å–çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„çŠ¶æ€ã€‚ç”±äºçº¿ç¨‹æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥å¸¸é€šè¿‡é˜»å¡ - å”¤é†’çš„æ–¹å¼æ¥è¾¾æˆï¼ŒFuture.getå’ŒCountDownLatchéƒ½æ˜¯åŸºäºè¿™ä¸€åŸç†ã€‚\n34. çº¿ç¨‹æ± æœ‰å“ªå‡ ç§çŠ¶æ€ æ¯ç§çŠ¶æ€åˆ†åˆ«è¡¨ç¤ºä»€ä¹ˆ åœ¨ Java çº¿ç¨‹æ± ä¸­ï¼Œçº¿ç¨‹æ± å…±æœ‰ä»¥ä¸‹ 5 ç§çŠ¶æ€ï¼Œæ¯ç§çŠ¶æ€éƒ½æœ‰å…¶ç‰¹å®šçš„å«ä¹‰å’Œè¡Œä¸ºï¼š\nRUNNINGï¼ˆè¿è¡ŒçŠ¶æ€ï¼‰ï¼šçº¿ç¨‹æ± å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¯ä»¥æ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶å¤„ç†å·²æäº¤çš„ä»»åŠ¡ã€‚è¿™æ˜¯çº¿ç¨‹æ± åˆ›å»ºåçš„åˆå§‹çŠ¶æ€ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹æ± ä¼šæ ¹æ®ä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹æ•°é‡çš„æƒ…å†µï¼ŒåŠ¨æ€åœ°åˆ›å»ºå’Œç®¡ç†å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ SHUTDOWNï¼ˆå…³é—­çŠ¶æ€ï¼‰ï¼šå½“è°ƒç”¨çº¿ç¨‹æ± çš„ shutdown() æ–¹æ³•åï¼Œçº¿ç¨‹æ± è¿›å…¥æ­¤çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹æ± ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä½†ä¼šç»§ç»­å¤„ç†å·²æäº¤åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å°šæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚åªæœ‰å½“ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œçº¿ç¨‹æ± æ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚åœ¨å¤„ç†ä»»åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹æ± ä¸ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…ä»»åŠ¡è‡ªç„¶ç»“æŸã€‚ STOPï¼ˆåœæ­¢çŠ¶æ€ï¼‰ï¼šå½“è°ƒç”¨çº¿ç¨‹æ± çš„ shutdownNow() æ–¹æ³•åï¼Œçº¿ç¨‹æ± è¿›å…¥æ­¤çŠ¶æ€ã€‚ä¸ SHUTDOWN çŠ¶æ€ä¸åŒï¼ŒSTOP çŠ¶æ€ä¸‹çº¿ç¨‹æ± ä¸ä»…ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œè¿˜ä¼šå°è¯•ç«‹å³åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šä¸­æ–­ç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»»åŠ¡çš„çº¿ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤„äº STOP çŠ¶æ€çš„çº¿ç¨‹æ± ä¼šç«‹å³ç»ˆæ­¢æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œè€Œä¸ä¼šç­‰å¾…ä»»åŠ¡å®Œæˆã€‚ TIDYINGï¼ˆæ•´ç†çŠ¶æ€ï¼‰ï¼šå½“çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½å·²æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹æ•°é‡ä¸º 0 æ—¶ï¼Œçº¿ç¨‹æ± ä¼šè‡ªåŠ¨è¿›å…¥ TIDYING çŠ¶æ€ã€‚åœ¨è¿›å…¥è¯¥çŠ¶æ€æ—¶ï¼Œçº¿ç¨‹æ± ä¼šè°ƒç”¨ terminated() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰å®ç°ï¼Œç”¨äºåœ¨çº¿ç¨‹æ± å…³é—­å‰è¿›è¡Œä¸€äº›æ¸…ç†å’Œèµ„æºé‡Šæ”¾çš„æ“ä½œã€‚ TERMINATEDï¼ˆç»ˆæ­¢çŠ¶æ€ï¼‰ï¼šå½“ terminated() æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œçº¿ç¨‹æ± å°±ä¼šè¿›å…¥ TERMINATED çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹æ± å·²ç»å®Œå…¨å…³é—­ï¼Œä¸å†æœ‰ä»»ä½•æ´»åŠ¨ï¼Œæ‰€æœ‰çš„èµ„æºä¹Ÿéƒ½å·²é‡Šæ”¾ã€‚ æ‚²è§‚é”ä¸ä¹è§‚é”ï¼šæ¦‚å¿µã€å®ç°åŠåº”ç”¨åœºæ™¯ ä¸€ã€æ‚²è§‚é”\nï¼ˆä¸€ï¼‰å®šä¹‰ä¸åŸç†\næ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œå³å…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®æ—¶ï¼Œææœ‰å¯èƒ½å‘ç”Ÿå†²çªã€‚æ‰€ä»¥ï¼Œå®ƒåœ¨æ¯æ¬¡æ“ä½œå…±äº«èµ„æºå‰ï¼Œéƒ½ä¼šå…ˆè·å–é”ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®è¯¥èµ„æºï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”èµ„æºã€‚è¿™ç§ç­–ç•¥å¦‚åŒåœ¨ä¸€ä¸ªå…¬å…±èµ„æºå‰è®¾ç½®äº†ä¸€é“å…³å¡ï¼Œæ¯æ¬¡åªå…è®¸ä¸€ä¸ªäººé€šè¿‡ï¼Œå…¶ä»–äººå¿…é¡»æ’é˜Ÿç­‰å¾…ã€‚\nï¼ˆäºŒï¼‰Java ä¸­çš„å®ç°æ–¹å¼\nsynchronized å…³é”®å­—ï¼šè¿™æ˜¯ Java å†…ç½®çš„ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¢«synchronizedä¿®é¥°çš„ä»£ç å—æˆ–æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è·å–å¯¹è±¡é”ï¼ˆè‹¥æ˜¯é™æ€æ–¹æ³•ï¼Œåˆ™è·å–ç±»é”ï¼‰ã€‚ä¾‹å¦‚ï¼š 1 2 3 4 5 6 7 public class SynchronizedExample { private int sharedResource; public synchronized void performTask() { // éœ€è¦åŒæ­¥çš„æ“ä½œ sharedResource++; } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒperformTaskæ–¹æ³•è¢«synchronizedä¿®é¥°ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹è‹¥ä¹Ÿæƒ³æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å¹¶é‡Šæ”¾é”ã€‚\nReentrantLock ç±»ï¼šè¿™æ˜¯ Java å¹¶å‘åŒ…java.util.concurrent.locksä¸­æä¾›çš„ä¸€ä¸ªå¯é‡å…¥çš„äº’æ–¥é”ã€‚ä½¿ç”¨æ—¶ï¼Œéœ€è¦å…ˆåˆ›å»ºReentrantLockå¯¹è±¡ï¼Œç„¶ååœ¨éœ€è¦åŒæ­¥çš„ä»£ç å—å‰ååˆ†åˆ«è°ƒç”¨lock()å’Œunlock()æ–¹æ³•ã€‚é€šå¸¸ï¼Œä¸ºäº†ç¡®ä¿é”ä¸€å®šèƒ½è¢«é‡Šæ”¾ï¼Œä¼šå°†unlock()æ–¹æ³•æ”¾åœ¨finallyå—ä¸­ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; public class ReentrantLockExample { private int sharedResource; private Lock lock = new ReentrantLock(); public void performTask() { lock.lock(); try { // éœ€è¦åŒæ­¥çš„æ“ä½œ sharedResource++; } finally { lock.unlock(); } } } ReentrantLockç›¸è¾ƒäºsynchronizedï¼Œæä¾›äº†æ›´çµæ´»çš„é”æ§åˆ¶ï¼Œå¦‚å¯ä¸­æ–­çš„é”è·å–ã€å…¬å¹³é”ä¸éå…¬å¹³é”çš„é€‰æ‹©ç­‰ã€‚\nï¼ˆä¸‰ï¼‰ä¼˜ç¼ºç‚¹åŠé€‚ç”¨åœºæ™¯\nä¼˜ç‚¹ï¼šæ‚²è§‚é”èƒ½å¤Ÿä¸¥æ ¼ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ï¼Œå› ä¸ºå®ƒé€šè¿‡åŠ é”æœºåˆ¶é¿å…äº†å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«èµ„æºçš„æƒ…å†µã€‚ ç¼ºç‚¹ æ€§èƒ½å¼€é”€å¤§ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œç”±äºå¤§é‡çº¿ç¨‹ç«äº‰é”èµ„æºï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„çº¿ç¨‹é˜»å¡å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚çº¿ç¨‹é˜»å¡æ„å‘³ç€çº¿ç¨‹éœ€è¦ç­‰å¾…é”ï¼Œè¿™æœŸé—´çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œç™½ç™½å ç”¨ç³»ç»Ÿèµ„æºï¼›è€Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ™æ˜¯æŒ‡æ“ä½œç³»ç»Ÿåœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´åˆ‡æ¢æ‰§è¡Œç¯å¢ƒï¼Œè¿™ä¸€è¿‡ç¨‹éœ€è¦ä¿å­˜å’Œæ¢å¤çº¿ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¹Ÿä¼šæ¶ˆè€—ä¸€å®šçš„æ—¶é—´å’Œèµ„æºã€‚ æ­»é”é£é™©ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºä¸å½“ï¼Œå°±å¯èƒ½å‡ºç°æ­»é”ç°è±¡ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ A æŒæœ‰é” 1ï¼Œç­‰å¾…è·å–é” 2ï¼Œè€Œçº¿ç¨‹ B æŒæœ‰é” 2ï¼Œç­‰å¾…è·å–é” 1ï¼Œæ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå½¢æˆæ­»é”ï¼Œä¸¥é‡å½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºå†™æ“ä½œé¢‘ç¹ã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜ä¸”å¹¶å‘å†²çªå¯èƒ½æ€§è¾ƒå¤§çš„åœºæ™¯ã€‚æ¯”å¦‚ï¼Œåœ¨é“¶è¡Œè½¬è´¦ç³»ç»Ÿä¸­ï¼Œå¯¹è´¦æˆ·ä½™é¢çš„ä¿®æ”¹æ“ä½œå°±éœ€è¦ä½¿ç”¨æ‚²è§‚é”ï¼Œä»¥ç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè½¬è´¦æ“ä½œèƒ½å¯¹è´¦æˆ·ä½™é¢è¿›è¡Œä¿®æ”¹ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ äºŒã€ä¹è§‚é”\nï¼ˆä¸€ï¼‰å®šä¹‰ä¸åŸç†\nä¹è§‚é”ç§‰æŒä¹è§‚çš„æ€åº¦ï¼Œæ€»æ˜¯å‡è®¾å…±äº«èµ„æºåœ¨æ¯æ¬¡è¢«è®¿é—®æ—¶ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œçº¿ç¨‹å¯ä»¥è‡ªç”±åœ°æ‰§è¡Œæ“ä½œï¼Œæ— éœ€åŠ é”ç­‰å¾…ã€‚å®ƒä»…åœ¨æäº¤ä¿®æ”¹æ—¶ï¼Œæ‰ä¼šå»éªŒè¯å¯¹åº”çš„å…±äº«èµ„æºæ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡ã€‚è‹¥æœªè¢«ä¿®æ”¹ï¼Œåˆ™æäº¤æˆåŠŸï¼›è‹¥å·²è¢«ä¿®æ”¹ï¼Œåˆ™é‡è¯•æ“ä½œï¼Œç›´è‡³æˆåŠŸæäº¤ã€‚è¿™ç§ç­–ç•¥å°±åƒæ˜¯åœ¨ä¸€ä¸ªç›¸å¯¹å’Œè°çš„ç¯å¢ƒä¸­ï¼Œå¤§å®¶éƒ½å…ˆå‡è®¾è‡ªå·±çš„æ“ä½œä¸ä¼šä¸ä»–äººå†²çªï¼Œå„è‡ªå…ˆè¿›è¡Œå·¥ä½œï¼Œæœ€åå†æ£€æŸ¥æ˜¯å¦æœ‰å†²çªå‘ç”Ÿã€‚\nï¼ˆäºŒï¼‰Java ä¸­çš„å®ç°æ–¹å¼\nåŸå­å˜é‡ç±»ï¼ˆåŸºäº CAS ç®—æ³•ï¼‰\nåœ¨ Java çš„java.util.concurrent.atomicåŒ…ä¸­ï¼Œæä¾›äº†ä¸€ç³»åˆ—åŸå­å˜é‡ç±»ï¼Œå¦‚AtomicIntegerã€AtomicLongã€LongAdderç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡ CASï¼ˆCompare And Swapï¼Œæ¯”è¾ƒä¸äº¤æ¢ï¼‰ç®—æ³•å®ç°äº†ä¹è§‚é”æœºåˆ¶ã€‚\nCAS ç®—æ³•åŸç†ï¼šCAS æ“ä½œæ¶‰åŠä¸‰ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯è¦æ›´æ–°çš„å˜é‡å€¼ï¼ˆVarï¼‰ã€é¢„æœŸå€¼ï¼ˆExpectedï¼‰å’Œæ‹Ÿå†™å…¥çš„æ–°å€¼ï¼ˆNewï¼‰ã€‚å½“ä¸”ä»…å½“ Var çš„å€¼ç­‰äº Expected æ—¶ï¼ŒCAS æ‰ä¼šé€šè¿‡åŸå­æ–¹å¼ç”¨ New å€¼æ¥æ›´æ–° Var çš„å€¼ã€‚è‹¥ä¸¤è€…ä¸ç›¸ç­‰ï¼Œè¯´æ˜åœ¨å½“å‰çº¿ç¨‹æ“ä½œæœŸé—´ï¼Œå·²ç»æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº† Var çš„å€¼ï¼Œå½“å‰çº¿ç¨‹åˆ™æ”¾å¼ƒæ›´æ–°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªAtomicIntegerå¯¹è±¡atomicIntï¼Œå…¶åˆå§‹å€¼ä¸º 5ï¼Œçº¿ç¨‹ A å¸Œæœ›å°†å…¶å€¼æ›´æ–°ä¸º 10ï¼Œæ­¤æ—¶çº¿ç¨‹ A ä¼šå…ˆè·å–atomicIntçš„å½“å‰å€¼ï¼ˆå³ 5ï¼‰ä½œä¸ºé¢„æœŸå€¼ï¼Œç„¶åå°è¯•å°†å…¶æ›´æ–°ä¸º 10ã€‚è‹¥åœ¨æ›´æ–°å‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹atomicIntçš„å€¼ï¼Œé‚£ä¹ˆæ›´æ–°æ“ä½œä¼šæˆåŠŸï¼›è‹¥æœ‰å…¶ä»–çº¿ç¨‹å·²ç»ä¿®æ”¹äº†atomicIntçš„å€¼ï¼Œæ›´æ–°æ“ä½œåˆ™å¤±è´¥ï¼Œçº¿ç¨‹ A å¯ä»¥é€‰æ‹©å†æ¬¡å°è¯•æ›´æ–°ã€‚ LongAdder ç±»çš„ç‰¹æ®Šä¼˜åŒ–ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒLongAdderç±»ç›¸æ¯”AtomicIntegerå’ŒAtomicLongå…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚LongAdderå†…éƒ¨é‡‡ç”¨äº†åˆ†æ®µç´¯åŠ çš„æ–¹å¼ï¼Œå°†å¯¹ä¸€ä¸ªå˜é‡çš„æ“ä½œåˆ†æ•£åˆ°å¤šä¸ªä¸åŒçš„å•å…ƒæ ¼ï¼ˆCellï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨å¯¹å˜é‡è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šå…ˆè®¿é—®ä¸åŒçš„å•å…ƒæ ¼ï¼Œå‡å°‘äº†çº¿ç¨‹é—´çš„ç«äº‰ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸ºæ¯ä¸ªå•å…ƒæ ¼åˆ†é…å†…å­˜ï¼Œæœ¬è´¨ä¸Šæ˜¯ç”¨ç©ºé—´æ¢å–æ—¶é—´ã€‚ä¾‹å¦‚ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 import java.util.concurrent.atomic.LongAdder; public class LongAdderExample { private static LongAdder sum = new LongAdder(); public static void main(String[] args) { Thread[] threads = new Thread[10]; for (int i = 0; i \u0026lt; 10; i++) { threads[i] = new Thread(() -\u0026gt; { for (int j = 0; j \u0026lt; 1000; j++) { sum.increment(); } }); threads[i].start(); } for (Thread thread : threads) { try { thread.join(); } catch (InterruptedException e) { e.printStackTrace(); } } System.out.println(\u0026#34;Sum: \u0026#34; + sum.sum()); } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé€šè¿‡å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹LongAdderå¯¹è±¡sumè¿›è¡Œç´¯åŠ æ“ä½œï¼Œå±•ç¤ºäº†LongAdderåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„é«˜æ•ˆæ€§ã€‚\nç‰ˆæœ¬å·æœºåˆ¶ åœ¨æ•°æ®åº“æ“ä½œä¸­ï¼Œå¸¸ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æ¥å®ç°ä¹è§‚é”ã€‚ä¸€èˆ¬åœ¨æ•°æ®è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·versionå­—æ®µï¼Œç”¨äºè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversionå€¼ä¼šè‡ªåŠ¨åŠ  1ã€‚çº¿ç¨‹åœ¨è¯»å–æ•°æ®çš„åŒæ—¶ï¼Œä¹Ÿä¼šè¯»å–versionå€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œåªæœ‰å½“è¯»å–åˆ°çš„versionå€¼ä¸å½“å‰æ•°æ®åº“ä¸­çš„versionå€¼ç›¸ç­‰æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œæ›´æ–°æ“ä½œï¼›å¦åˆ™ï¼Œä¼šé‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯è¡¨user_infoï¼Œå…¶ä¸­åŒ…å«idã€nameã€balanceå’Œversionå­—æ®µï¼Œå½“å‰æœ‰ä¸€æ¡è®°å½•id = 1ï¼Œname = \u0026quot;å¼ ä¸‰\u0026quot;ï¼Œbalance = 1000ï¼Œversion = 1ã€‚\nçº¿ç¨‹ A è¯»å–è¯¥è®°å½•ï¼Œæ­¤æ—¶version = 1ï¼Œå¹¶å¯¹balanceè¿›è¡Œä¿®æ”¹ï¼Œå°†å…¶å€¼å‡å°‘ 100ï¼Œå³balance = 900ã€‚ åœ¨çº¿ç¨‹ A æ“ä½œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ B ä¹Ÿè¯»å–äº†è¯¥è®°å½•ï¼ŒversionåŒæ ·ä¸º 1ï¼Œå¹¶å¯¹balanceè¿›è¡Œä¿®æ”¹ï¼Œå°†å…¶å€¼å‡å°‘ 200ï¼Œå³balance = 800ã€‚ çº¿ç¨‹ A å®Œæˆä¿®æ”¹åï¼Œæäº¤æ›´æ–°æ“ä½œï¼Œæ­¤æ—¶ä¼šæ¯”å¯¹è¯»å–çš„versionå€¼ï¼ˆ1ï¼‰å’Œæ•°æ®åº“ä¸­å½“å‰è®°å½•çš„versionå€¼ï¼ˆå‡è®¾æ­¤æ—¶æ•°æ®åº“ä¸­è¯¥è®°å½•çš„versionå€¼ä»ä¸º 1ï¼Œå› ä¸ºçº¿ç¨‹ B è¿˜æœªæäº¤æ›´æ–°ï¼‰ï¼Œä¸¤è€…ç›¸ç­‰ï¼Œæ›´æ–°æ“ä½œæˆåŠŸï¼Œæ•°æ®åº“ä¸­è¯¥è®°å½•çš„versionå€¼æ›´æ–°ä¸º 2ï¼Œbalanceå€¼æ›´æ–°ä¸º 900ã€‚ çº¿ç¨‹ B å®Œæˆæ“ä½œåï¼Œæäº¤æ›´æ–°æ“ä½œï¼Œæ­¤æ—¶æ¯”å¯¹è¯»å–çš„versionå€¼ï¼ˆ1ï¼‰å’Œæ•°æ®åº“ä¸­å½“å‰è®°å½•çš„versionå€¼ï¼ˆ2ï¼‰ï¼Œä¸¤è€…ä¸ç›¸ç­‰ï¼Œæ›´æ–°æ“ä½œå¤±è´¥ï¼Œçº¿ç¨‹ B éœ€è¦é‡æ–°è¯»å–æ•°æ®å¹¶è¿›è¡Œä¿®æ”¹å’Œæäº¤ï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚ ï¼ˆä¸‰ï¼‰ä¼˜ç¼ºç‚¹åŠé€‚ç”¨åœºæ™¯\nä¼˜ç‚¹ é«˜å¹¶å‘æ€§èƒ½ä¼˜è¶Šï¼šç”±äºä¹è§‚é”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦åŠ é”ï¼Œçº¿ç¨‹å¯ä»¥è‡ªç”±æ‰§è¡Œï¼Œé¿å…äº†çº¿ç¨‹é˜»å¡å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼Œå› æ­¤åœ¨é«˜å¹¶å‘ä¸”è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œçš„åœºæ™¯ä¸­ï¼Œæ€§èƒ½è¡¨ç°å‡ºè‰²ã€‚ æ— æ­»é”é—®é¢˜ï¼šä¹è§‚é”ä¸éœ€è¦æ˜¾å¼åœ°è·å–å’Œé‡Šæ”¾é”ï¼Œä¸å­˜åœ¨å› è·å–é”é¡ºåºä¸å½“è€Œå¯¼è‡´çš„æ­»é”é—®é¢˜ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ ç¼ºç‚¹ é¢‘ç¹é‡è¯•å¼€é”€ï¼šåœ¨å†™æ“ä½œé¢‘ç¹çš„åœºæ™¯ä¸‹ï¼Œç”±äºæ•°æ®è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹çš„æ¦‚ç‡è¾ƒé«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„æ›´æ–°æ“ä½œå¤±è´¥å¹¶éœ€è¦é‡è¯•ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡çš„ CPU èµ„æºï¼Œä¸¥é‡å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´ CPU ä½¿ç”¨ç‡é£™å‡ã€‚ é€‚ç”¨èŒƒå›´æœ‰é™ï¼šä¹è§‚é”ä¸»è¦é€‚ç”¨äºå¯¹å•ä¸ªå…±äº«å˜é‡çš„æ“ä½œï¼Œå¯¹äºæ¶‰åŠå¤šä¸ªå…±äº«å˜é‡çš„å¤æ‚æ“ä½œï¼Œä½¿ç”¨ä¹è§‚é”å¯èƒ½æ— æ³•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œä¾‹å¦‚åœ¨ä¸€äº›ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œæ•°æ®çš„è¯»å–æ“ä½œè¿œè¿œå¤šäºå†™å…¥æ“ä½œï¼Œä½¿ç”¨ä¹è§‚é”å¯ä»¥åœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œæå¤§åœ°æé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚ ä¸‰ã€MySQLç¯‡ 1. MySQLä¸­ï¼Œå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ï¼Ÿ åœ¨ MySQL ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—æ¥å®šä½æ‰§è¡Œç¼“æ…¢çš„æŸ¥è¯¢ã€‚å…·ä½“æ“ä½œæ˜¯åœ¨ MySQL çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½® slow_query_log=1 æ¥å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå¹¶é€šè¿‡ long_query_time=2 å‚æ•°è®¾ç½®æ…¢æŸ¥è¯¢çš„é˜ˆå€¼ï¼Œä¾‹å¦‚è¶…è¿‡ 2 ç§’ã€‚æ—¥å¿—é»˜è®¤å­˜æ”¾åœ¨ MySQL æ•°æ®ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º slow.logã€‚é€šè¿‡åˆ†æè¿™ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºå“ªäº›æŸ¥è¯¢æ“ä½œçš„æ€§èƒ½ä¸ä½³ï¼Œè¿›è€Œè¿›è¡Œä¼˜åŒ–ã€‚\u0026quot;\né™¤äº†æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ SQL Profile å·¥å…·æ¥è·å– SQL è¯­å¥çš„è¯¦ç»†æ‰§è¡Œä¿¡æ¯ã€‚åœ¨ä¼šè¯ä¸­å¼€å¯ profiling åŠŸèƒ½ï¼ˆSET profiling = 1;ï¼‰ï¼Œæ‰§è¡Œ SQL è¯­å¥åï¼Œé€šè¿‡ SHOW PROFILES; å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥è¯­å¥çš„æ‰§è¡Œç»†èŠ‚ï¼ŒåŒ…æ‹¬æ¶ˆè€—çš„æ—¶é—´ã€æ‰«æçš„è¡Œæ•°ç­‰ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬åˆ†æå’Œä¼˜åŒ–æ…¢æŸ¥è¯¢ã€‚\n2. é‚£è¿™ä¸ªSQLè¯­å¥æ‰§è¡Œå¾ˆæ…¢ï¼Œå¦‚ä½•åˆ†æå‘¢ï¼Ÿ å¦‚æœä¸€æ¡SQLæ‰§è¡Œå¾ˆæ…¢ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨MySQLçš„EXPLAINå‘½ä»¤æ¥åˆ†æè¿™æ¡SQLçš„æ‰§è¡Œæƒ…å†µã€‚é€šè¿‡keyå’Œkey_lenå¯ä»¥æ£€æŸ¥æ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Œå¦‚æœå·²ç»æ·»åŠ äº†ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥åˆ¤æ–­ç´¢å¼•æ˜¯å¦æœ‰æ•ˆã€‚é€šè¿‡typeå­—æ®µå¯ä»¥æŸ¥çœ‹SQLæ˜¯å¦æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œæ¯”å¦‚æ˜¯å¦å­˜åœ¨å…¨ç´¢å¼•æ‰«ææˆ–å…¨è¡¨æ‰«æã€‚é€šè¿‡extraå»ºè®®å¯ä»¥åˆ¤æ–­æ˜¯å¦å‡ºç°å›è¡¨æƒ…å†µï¼Œå¦‚æœå‡ºç°ï¼Œå¯ä»¥å°è¯•æ·»åŠ ç´¢å¼•æˆ–ä¿®æ”¹è¿”å›å­—æ®µæ¥ä¼˜åŒ–ã€‚\n3. äº†è§£è¿‡ç´¢å¼•å— å—¯ï¼Œç´¢å¼•åœ¨é¡¹ç›®ä¸­éå¸¸å¸¸è§ï¼Œå®ƒæ˜¯ä¸€ç§å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨æ¥æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„I/Oæˆæœ¬ã€‚åŒæ—¶ï¼Œç´¢å¼•åˆ—å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œä¹Ÿèƒ½å‡å°‘CPUçš„æ¶ˆè€—ã€‚\n4. ç´¢å¼•çš„åº•å±‚æ•°æ®ç»“æ„äº†è§£è¿‡å—ï¼Ÿ MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“InnoDBä½¿ç”¨çš„æ˜¯B+æ ‘ä½œä¸ºç´¢å¼•çš„å­˜å‚¨ç»“æ„ã€‚é€‰æ‹©B+æ ‘çš„åŸå› åŒ…æ‹¬ï¼šèŠ‚ç‚¹å¯ä»¥æœ‰æ›´å¤šå­èŠ‚ç‚¹ï¼Œè·¯å¾„æ›´çŸ­ï¼›ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼å’ŒæŒ‡é’ˆï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼›B+æ ‘é€‚åˆèŒƒå›´æŸ¥è¯¢å’Œæ‰«æï¼Œå› ä¸ºå¶å­èŠ‚ç‚¹å½¢æˆäº†ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚\n5. Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ Bæ ‘çš„éå¶å­èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½å­˜æ”¾æ•°æ®ï¼Œè€ŒB+æ ‘çš„æ‰€æœ‰æ•°æ®åªå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ï¼Œè¿™ä½¿å¾—B+æ ‘åœ¨æŸ¥è¯¢æ—¶æ•ˆç‡æ›´ç¨³å®šã€‚ B+æ ‘åœ¨è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºæ‰€æœ‰æ•°æ®éƒ½åœ¨å¶å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹ä¹‹é—´å½¢æˆäº†åŒå‘é“¾è¡¨ã€‚ 6. ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•ï¼Ÿ åœ¨æ•°æ®åº“ä¸­ï¼Œç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ä¸¤ç§ç±»å‹ã€‚èšç°‡ç´¢å¼•ï¼ŒB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†æ•´è¡Œæ•°æ®ï¼Œé€šå¸¸åªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸€èˆ¬æ˜¯ç”±ä¸»é”®æ„æˆã€‚éèšç°‡ç´¢å¼•åˆ™å­˜å‚¨çš„æ˜¯æ•°æ®çš„å¼•ç”¨ï¼ŒB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯ä¸»é”®å€¼ï¼Œå¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ï¼Œé€šå¸¸æˆ‘ä»¬è‡ªå®šä¹‰çš„ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚\n7. çŸ¥é“ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢å—ï¼Ÿ å›è¡¨æŸ¥è¯¢æ˜¯æŒ‡é€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ä¸»é”®å€¼ï¼Œç„¶åå†é€šè¿‡ä¸»é”®å€¼æŸ¥è¯¢èšç°‡ç´¢å¼•ä¸­å¯¹åº”çš„æ•´è¡Œæ•°æ®çš„è¿‡ç¨‹ã€‚\n8. çŸ¥é“ä»€ä¹ˆå«è¦†ç›–ç´¢å¼•å—ï¼Ÿ è¦†ç›–ç´¢å¼•æ˜¯æŒ‡åœ¨SELECTæŸ¥è¯¢ä¸­ï¼Œè¿”å›çš„åˆ—å…¨éƒ¨èƒ½åœ¨ç´¢å¼•ä¸­æ‰¾åˆ°ï¼Œé¿å…äº†å›è¡¨æŸ¥è¯¢ï¼Œæé«˜äº†æ€§èƒ½ã€‚ä½¿ç”¨è¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘å¯¹ä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚\n9. MySQLè¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ è¶…å¤§åˆ†é¡µé€šå¸¸å‘ç”Ÿåœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨LIMITåˆ†é¡µæŸ¥è¯¢ä¸”éœ€è¦æ’åºæ—¶æ•ˆç‡è¾ƒä½ã€‚å¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•å’Œå­æŸ¥è¯¢æ¥è§£å†³ã€‚é¦–å…ˆæŸ¥è¯¢æ•°æ®çš„IDå­—æ®µè¿›è¡Œåˆ†é¡µï¼Œç„¶åæ ¹æ®IDåˆ—è¡¨ç”¨å­æŸ¥è¯¢æ¥è¿‡æ»¤åªæŸ¥è¯¢è¿™äº›IDçš„æ•°æ®ï¼Œå› ä¸ºæŸ¥è¯¢IDæ—¶ä½¿ç”¨çš„æ˜¯è¦†ç›–ç´¢å¼•ï¼Œæ‰€ä»¥æ•ˆç‡å¯ä»¥æå‡ã€‚\n10. ç´¢å¼•åˆ›å»ºåŸåˆ™æœ‰å“ªäº›ï¼Ÿ åˆ›å»ºç´¢å¼•çš„åŸåˆ™åŒ…æ‹¬ï¼š\nè¡¨ä¸­çš„æ•°æ®é‡è¶…è¿‡10ä¸‡ä»¥ä¸Šæ—¶è€ƒè™‘åˆ›å»ºç´¢å¼•ã€‚ é€‰æ‹©æŸ¥è¯¢é¢‘ç¹çš„å­—æ®µä½œä¸ºç´¢å¼•ï¼Œå¦‚æŸ¥è¯¢æ¡ä»¶ã€æ’åºå­—æ®µæˆ–åˆ†ç»„å­—æ®µã€‚ å°½é‡ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œè¦†ç›–SQLçš„è¿”å›å€¼ã€‚ å¦‚æœå­—æ®µåŒºåˆ†åº¦ä¸é«˜ï¼Œå¯ä»¥å°†å…¶æ”¾åœ¨ç»„åˆç´¢å¼•çš„åé¢ã€‚ å¯¹äºå†…å®¹è¾ƒé•¿çš„å­—æ®µï¼Œè€ƒè™‘ä½¿ç”¨å‰ç¼€ç´¢å¼•ã€‚ æ§åˆ¶ç´¢å¼•æ•°é‡ï¼Œå› ä¸ºç´¢å¼•è™½ç„¶å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†ä¹Ÿä¼šå½±å“æ’å…¥ã€æ›´æ–°çš„é€Ÿåº¦ã€‚ 11. ä»€ä¹ˆæƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ ç´¢å¼•å¤±æ•ˆå¯èƒ½å‘ç”Ÿåœ¨å‡ ç§æƒ…å†µä¸‹ã€‚é¦–å…ˆï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰éµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œå³æ²¡æœ‰ä»å¤åˆç´¢å¼•çš„æœ€å·¦è¾¹åˆ—å¼€å§‹ï¼Œç´¢å¼•å¯èƒ½ä¸ä¼šç”Ÿæ•ˆã€‚å…¶æ¬¡ï¼Œå¦‚æœå¯¹å­—ç¬¦ä¸²ç±»å‹çš„ç´¢å¼•åˆ—ä½¿ç”¨äº†ä»¥ % å¼€å¤´çš„ LIKE æŸ¥è¯¢ï¼Œç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œäº†è¿ç®—æˆ–ç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚æ•°å­¦è¿ç®—æˆ–å‡½æ•°æ“ä½œï¼Œç´¢å¼•åŒæ ·ä¼šå¤±æ•ˆã€‚å¯¹äºå¤åˆç´¢å¼•ï¼Œå¦‚æœåœ¨ç´¢å¼•çš„ä¸­é—´åˆ—ä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆè¯¥åˆ—å³è¾¹çš„æ‰€æœ‰åˆ—ç´¢å¼•éƒ½å°†å¤±æ•ˆã€‚\n12. SQLçš„ä¼˜åŒ–ç»éªŒæœ‰å“ªäº›ï¼Ÿ å»ºè¡¨æ—¶é€‰æ‹©åˆé€‚çš„å­—æ®µç±»å‹ã€‚ ä½¿ç”¨ç´¢å¼•ï¼Œéµå¾ªåˆ›å»ºç´¢å¼•çš„åŸåˆ™ã€‚ ç¼–å†™é«˜æ•ˆçš„SQLè¯­å¥ï¼Œæ¯”å¦‚é¿å…ä½¿ç”¨SELECT *ï¼Œå°½é‡ä½¿ç”¨UNION ALLä»£æ›¿UNIONï¼Œä»¥åŠåœ¨è¡¨å…³è”æ—¶ä½¿ç”¨INNER JOINã€‚ æŸ¥è¯¢ä¼˜åŒ–ï¼šä½¿ç”¨ EXPLAIN åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œç¡®ä¿æŸ¥è¯¢æœ‰æ•ˆä½¿ç”¨ç´¢å¼•ã€‚ é¿å…è¿”å›è¿‡å¤šæ•°æ®ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘å…¨è¡¨æ‰«æã€‚ åœ¨æ•°æ®é‡å¤§æ—¶è€ƒè™‘åˆ†åº“åˆ†è¡¨ã€‚ 13. åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œä½ ä»¬æ˜¯å¦‚ä½•ä¼˜åŒ–çš„å‘¢ï¼Ÿ é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ï¼šæ ¹æ®æ•°æ®çš„ç‰¹æ€§é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼Œå¯¹äºå°æ•´æ•°ä½¿ç”¨ TINYINTï¼Œå¤§æ•´æ•°ä½¿ç”¨ INT æˆ– BIGINTï¼Œå­—ç¬¦ä¸²æ ¹æ®é•¿åº¦é€‰æ‹© CHARã€ã€VARCHARæˆ–TEXT`ã€‚ å®šä¹‰å­—ç¬¦é›†ï¼šé€‰æ‹©é€‚å½“çš„å­—ç¬¦é›†ï¼Œå¦‚ utf8ï¼Œä»¥æ”¯æŒå¤šè¯­è¨€æ–‡æœ¬ã€‚ å®šä¹‰é•¿åº¦ï¼šå¯¹äºå¯å˜é•¿å­—æ®µï¼Œå®šä¹‰åˆç†çš„é•¿åº¦ï¼Œé¿å…ä¸å¿…è¦çš„ç©ºé—´æµªè´¹ã€‚ åˆ›å»ºç´¢å¼•ï¼šä¸ºæŸ¥è¯¢ã€æ’åºæˆ–è¿æ¥æ“ä½œé¢‘ç¹çš„åˆ—åˆ›å»ºç´¢å¼•ï¼ŒåŒ…æ‹¬ä¸»é”®å’Œå¤–é”®ã€‚ è§„èŒƒåŒ–è®¾è®¡ï¼šåº”ç”¨æ•°æ®åº“è§„èŒƒåŒ–åŸåˆ™ï¼Œå‡å°‘æ•°æ®å†—ä½™ï¼Œæé«˜æ•°æ®ä¸€è‡´æ€§ã€‚ åˆ†åŒºï¼šå¯¹äºå¤§æ•°æ®é‡çš„è¡¨ï¼Œè€ƒè™‘åˆ†åŒºæ¥æé«˜æŸ¥è¯¢å’Œç®¡ç†æ•ˆç‡ã€‚ å¤–é”®ï¼šä½¿ç”¨å¤–é”®æ¥ç»´æŠ¤è¡¨ä¹‹é—´çš„å…³ç³»ï¼Œç¡®ä¿å¼•ç”¨å®Œæ•´æ€§ã€‚ é»˜è®¤å€¼ï¼šä¸ºå…·æœ‰é»˜è®¤å€¼çš„åˆ—å®šä¹‰é»˜è®¤å€¼ã€‚ é¿å…å†—ä½™ï¼šè®¾è®¡è¡¨ç»“æ„æ—¶é¿å…é‡å¤å­˜å‚¨ç›¸åŒæ•°æ®ã€‚ æ€§èƒ½æµ‹è¯•ï¼šåœ¨å¼€å‘ç¯å¢ƒä¸­å¯¹è¡¨ç»“æ„è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼Œç¡®ä¿æŸ¥è¯¢å’Œæ›´æ–°æ“ä½œçš„æ•ˆç‡ã€‚ 14. åœ¨ä½¿ç”¨ç´¢å¼•çš„æ—¶å€™ï¼Œæ˜¯å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ åœ¨ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬éµå¾ªç´¢å¼•åˆ›å»ºåŸåˆ™ï¼Œç¡®ä¿ç´¢å¼•å­—æ®µæ˜¯æŸ¥è¯¢é¢‘ç¹çš„ï¼Œä½¿ç”¨å¤åˆç´¢å¼•è¦†ç›–SQLè¿”å›å€¼ï¼Œå°½é‡é¿å…å¯¼è‡´å›è¡¨æŸ¥è¯¢çš„æŸ¥è¯¢æ¡ä»¶ï¼Œä»¥å‡å°‘é¢å¤–çš„ I/O å¼€é”€ã€‚\n15. ä½ å¹³æ—¶å¯¹SQLè¯­å¥åšäº†å“ªäº›ä¼˜åŒ–å‘¢ï¼Ÿ é¦–å…ˆï¼Œæˆ‘ä¼šé¿å…ä½¿ç”¨ SELECT *ï¼Œè€Œæ˜¯æ˜ç¡®æŒ‡å®šæ‰€éœ€çš„å­—æ®µï¼Œè¿™æœ‰åŠ©äºå‡å°‘æ•°æ®ä¼ è¾“å¹¶æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚å…¶æ¬¡ï¼Œæˆ‘ä¼šç¡®ä¿åœ¨æŸ¥è¯¢æ¡ä»¶åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œå¹¶åœ¨æŸ¥è¯¢ä¸­å°½é‡ä½¿ç”¨è¿™äº›ç´¢å¼•ã€‚æ­¤å¤–ï¼Œæˆ‘ä¼šä¼˜åŒ– JOIN æ“ä½œï¼Œå°½é‡ä½¿ç”¨ INNER JOINï¼Œå› ä¸ºå®ƒåœ¨å†…è¿æ¥æ—¶ä¼šè¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘éœ€è¦å¤„ç†çš„æ•°æ®é‡ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨ LEFT JOIN æˆ– RIGHT JOINï¼Œç¡®ä¿å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå³å·¦è¿æ¥çš„å°è¡¨åœ¨å·¦è¾¹ï¼Œå³è¿æ¥çš„å°è¡¨åœ¨å³è¾¹ã€‚\næˆ‘è¿˜ä¼šä½¿ç”¨ LIMIT è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶å°½é‡å‡å°‘ OFFSET çš„ä½¿ç”¨ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚åŒæ—¶ï¼Œæˆ‘ä¼šåˆ›å»ºè¦†ç›–ç´¢å¼•ä»¥å‡å°‘å›è¡¨æŸ¥è¯¢çš„éœ€è¦ã€‚æ­¤å¤–ï¼Œæˆ‘ä¼šé‡å†™å¤æ‚çš„å­æŸ¥è¯¢ä¸ºè¿æ¥æŸ¥è¯¢ï¼Œå‡å°‘æŸ¥è¯¢çš„å¤æ‚åº¦å’Œæ‰§è¡Œæ—¶é—´ã€‚\n16. äº‹åŠ¡çš„ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥è¯¦ç»†è¯´ä¸€ä¸‹å—ï¼Ÿ äº‹åŠ¡çš„ç‰¹æ€§æ˜¯ACIDï¼Œå³åŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚ä¾‹å¦‚ï¼ŒAå‘Bè½¬è´¦500å…ƒï¼Œè¿™ä¸ªæ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼Œä½“ç°äº†åŸå­æ€§ã€‚è½¬è´¦è¿‡ç¨‹ä¸­æ•°æ®è¦ä¿æŒä¸€è‡´ï¼ŒAæ‰£é™¤äº†500å…ƒï¼ŒBå¿…é¡»å¢åŠ 500å…ƒã€‚éš”ç¦»æ€§ä½“ç°åœ¨Aå‘Bè½¬è´¦æ—¶ï¼Œä¸å—å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚æŒä¹…æ€§ä½“ç°åœ¨äº‹åŠ¡æäº¤åï¼Œæ•°æ®è¦è¢«æŒä¹…åŒ–å­˜å‚¨ã€‚\n17. å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿ è„è¯»ï¼ˆDirty Readï¼‰ï¼š è„è¯»å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ã€‚å¦‚æœè¯¥ä¿®æ”¹è¢«å›æ»šï¼Œé‚£ä¹ˆè¯»å–çš„æ•°æ®å°±æ˜¯æ— æ•ˆçš„ã€‚ ä¸å¯é‡å¤è¯»ï¼ˆNon-Repeatable Readï¼‰ï¼š è¿™å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œç”±äºå…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¼è‡´è¯»å–çš„æ•°æ®åœ¨äº‹åŠ¡å†…å‡ºç°ä¸ä¸€è‡´ã€‚ å¹»è¯»ï¼ˆPhantom Readï¼‰ï¼š å¹»è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸¤æ¬¡è¯»å–åŒä¸€èŒƒå›´çš„æ•°æ®ï¼Œç¬¬äºŒæ¬¡è¯»å–çš„ç»“æœåŒ…å«äº†å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡æäº¤çš„æ–°æ•°æ®ã€‚ ä¸¢å¤±æ›´æ–°ï¼ˆLost Updateï¼‰ï¼š å½“ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åŒæ—¶æ›´æ–°åŒä¸€è¡Œæ•°æ®æ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°å¯èƒ½è¢«å¦ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°è¦†ç›–ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ æ­»é”ï¼ˆDeadlockï¼‰ï¼š å½“ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºæ—¶ï¼Œå¯èƒ½å¯¼è‡´æ­»é”ï¼Œè¿™ä¼šé˜»å¡äº‹åŠ¡çš„è¿›ä¸€æ­¥æ‰§è¡Œã€‚ é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ï¼š é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡å¯èƒ½ä¼šé”å®šå¤§é‡èµ„æºï¼Œè¿™ä¼šé˜»å¡å…¶ä»–äº‹åŠ¡ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½ã€‚ ç³»ç»Ÿèµ„æºç«äº‰ï¼š å¹¶å‘äº‹åŠ¡å¯èƒ½å¯¼è‡´æ•°æ®åº“çš„èµ„æºï¼ˆå¦‚é”ã€æ—¥å¿—ç©ºé—´ã€å†…å­˜ç­‰ï¼‰ç«äº‰ï¼Œå½±å“ç³»ç»Ÿç¨³å®šæ€§ã€‚ 18. æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ï¼Ÿ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰\nè„è¯»ï¼šå¯å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸º â€œè¯»å·²æäº¤ï¼ˆREAD COMMITTEDï¼‰â€ åŠä»¥ä¸Šçº§åˆ«æ¥é˜²æ­¢ï¼Œè¿™æ ·äº‹åŠ¡åªèƒ½è¯»å–åˆ°å·²æäº¤çš„æ•°æ®ï¼Œé¿å…è¯»å–åˆ°æœªæäº¤çš„è„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯»ï¼šé€šå¸¸éœ€è¦å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸º â€œå¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰â€ æˆ–æ›´é«˜çš„ â€œä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰â€ çº§åˆ«ã€‚åœ¨ â€œå¯é‡å¤è¯»â€ éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ä¼šå¯¹æ•°æ®åŠ é”ï¼Œåœ¨äº‹åŠ¡æäº¤å‰ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•ä¿®æ”¹è¯¥æ•°æ®ï¼Œä»è€Œä¿è¯åœ¨åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚ å¹»è¯»ï¼šé€šå¸¸å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸º â€œä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰â€ å¯é¿å…ï¼Œæ­¤çº§åˆ«ä¼šå¯¹äº‹åŠ¡æ“ä½œçš„èŒƒå›´æ•°æ®åŠ é”ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥èŒƒå›´å†…æ’å…¥æˆ–åˆ é™¤æ•°æ®ï¼Œä½†ä¼šé™ä½å¹¶å‘æ€§èƒ½ã€‚ ä¸¢å¤±æ›´æ–°ï¼šå¯ä½¿ç”¨æ’ä»–é”æˆ–ä¹è§‚é”æœºåˆ¶ï¼Œç¡®ä¿åœ¨æ›´æ–°æ•°æ®æ—¶åªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æˆåŠŸæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œé˜²æ­¢æ›´æ–°è¢«è¦†ç›–ã€‚ æ­»é”ï¼šåˆç†è®¾è®¡äº‹åŠ¡é€»è¾‘ï¼Œé¿å…äº‹åŠ¡ä¹‹é—´å¾ªç¯ç­‰å¾…èµ„æºï¼›ä¹Ÿå¯è®¾ç½®æ­»é”æ£€æµ‹æœºåˆ¶ï¼Œå½“æ£€æµ‹åˆ°æ­»é”æ—¶è‡ªåŠ¨å›æ»šå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡æ¥æ‰“ç ´æ­»é”ã€‚ é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ï¼šä¼˜åŒ–äº‹åŠ¡é€»è¾‘ï¼Œå‡å°‘ä¸å¿…è¦çš„æ“ä½œå’Œèµ„æºå ç”¨ï¼›å¯¹äºç¡®å®éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ï¼Œå¯é€‚å½“è°ƒæ•´èµ„æºé…ç½®å’Œæ•°æ®åº“å‚æ•°ã€‚ ç³»ç»Ÿèµ„æºç«äº‰ï¼šåˆç†é…ç½®æ•°æ®åº“èµ„æºï¼Œæ ¹æ®å¹¶å‘é‡ç­‰æƒ…å†µè°ƒæ•´ç¼“å­˜å¤§å°ã€è¿æ¥æ•°ç­‰å‚æ•°ï¼›ä¼˜åŒ–äº‹åŠ¡æ‰§è¡Œé¡ºåºï¼Œå‡å°‘èµ„æºç«äº‰ã€‚ 19. äº‹åŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä¸»è¦é€šè¿‡å“ªäº›æœºåˆ¶æ¥ç¡®ä¿å…¶ ACID ç‰¹æ€§ï¼Ÿ äº‹åŠ¡çš„å®ç°ä¸»è¦ä¾èµ–äºå‡ ä¸ªå…³é”®æœºåˆ¶ï¼šé”æœºåˆ¶ã€æ—¥å¿—ç³»ç»Ÿï¼ˆåŒ…æ‹¬ redo log å’Œ undo logï¼‰ï¼Œä»¥åŠ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ã€‚è¿™äº›æœºåˆ¶å…±åŒåä½œä»¥ç¡®ä¿äº‹åŠ¡çš„ ACID ç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚\né”æœºåˆ¶ï¼š é”æœºåˆ¶ç”¨äºæ§åˆ¶æ•°æ®çš„å¹¶å‘è®¿é—®ï¼Œç¡®ä¿åœ¨äº‹åŠ¡è¿›è¡Œä¸­æ•°æ®ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ï¼Œä»è€Œæ»¡è¶³éš”ç¦»æ€§ã€‚æ ¹æ®é”çš„ç²’åº¦ä¸åŒï¼Œå¯ä»¥æ˜¯è¡Œçº§é”ã€è¡¨çº§é”ç­‰ã€‚ redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ï¼š redo log è®°å½•äº†äº‹åŠ¡å¯¹æ•°æ®æ‰€åšçš„ä¿®æ”¹ã€‚åœ¨ç³»ç»Ÿå´©æºƒåï¼Œå¯ä»¥é€šè¿‡é‡æ”¾è¿™äº›æ—¥å¿—æ¥æ¢å¤æ•°æ®ï¼Œä»è€Œæ»¡è¶³æŒä¹…æ€§è¦æ±‚ã€‚ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ï¼š undo log è®°å½•äº†äº‹åŠ¡æ‰§è¡Œå‰çš„æ•°æ®çŠ¶æ€ï¼Œç”¨äºåœ¨äº‹åŠ¡å›æ»šæ—¶æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œæ»¡è¶³åŸå­æ€§å’Œéš”ç¦»æ€§ã€‚ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼š MVCC æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œå®ƒé€šè¿‡ä¸ºæ¯ä¸ªäº‹åŠ¡æä¾›ä¸€ä¸ªæ•°æ®çš„ä¸€è‡´æ€§è§†å›¾æ¥æ»¡è¶³éš”ç¦»æ€§ã€‚è¿™æ ·ï¼Œå³ä½¿æ•°æ®è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ï¼Œå½“å‰äº‹åŠ¡ä¹Ÿçœ‹ä¸åˆ°è¿™äº›ä¿®æ”¹ï¼Œä»è€Œé¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚ 20. undo logå’Œredo logçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ undo logï¼ˆæ’¤é”€æ—¥å¿—ï¼‰å’Œredo logï¼ˆé‡åšæ—¥å¿—ï¼‰\nundo log ä¸»è¦ç”¨äºäº‹åŠ¡å›æ»šæ—¶æ¢å¤æ•°æ®ï¼Œå®ƒè®°å½•äº†äº‹åŠ¡æ›´æ”¹ä¹‹å‰çš„æ•°æ®çŠ¶æ€ï¼Œç¡®ä¿æˆ‘ä»¬å¯ä»¥æ’¤é”€äº‹åŠ¡å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™æœ‰åŠ©äºç»´æŠ¤äº‹åŠ¡çš„åŸå­æ€§ï¼Œå³äº‹åŠ¡è¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œã€‚\nç›¸åï¼Œredo log ç”¨äºåœ¨ç³»ç»Ÿæ•…éšœåæ¢å¤æ•°æ®ï¼Œå®ƒè®°å½•äº†äº‹åŠ¡æäº¤æ—¶çš„æ•°æ®æ›´æ”¹ï¼Œç¡®ä¿è¿™äº›æ›´æ”¹åœ¨ç³»ç»Ÿé‡å¯åå¯ä»¥è¢«é‡æ–°åº”ç”¨ï¼Œä»è€Œä¿éšœäº‹åŠ¡çš„æŒä¹…æ€§ã€‚è¿™æœ‰åŠ©äºç¡®ä¿å³ä½¿åœ¨ç³»ç»Ÿå´©æºƒçš„æƒ…å†µä¸‹ï¼Œå·²æäº¤çš„äº‹åŠ¡æ›´æ”¹ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚\n21. é‚£äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ äº‹åŠ¡çš„éš”ç¦»çº§åˆ«é€šå¸¸æœ‰å››ç§ï¼Œç”±ä½åˆ°é«˜åˆ†åˆ«æ˜¯ï¼šè¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ã€è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ã€ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚\nè¯»æœªæäº¤ï¼šå…è®¸äº‹åŠ¡è¯»å–å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€‚ è¯»å·²æäº¤ï¼šåªèƒ½è¯»å–å·²ç»æäº¤çš„æ•°æ®ï¼Œé¿å…äº†è„è¯»ï¼Œä½†å¯èƒ½ä¼šå‡ºç°ä¸å¯é‡å¤è¯»ã€‚ å¯é‡å¤è¯»ï¼šä¿è¯äº†åœ¨åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·çš„æ•°æ®ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œé¿å…äº†ä¸å¯é‡å¤è¯»ï¼Œä½†å¯èƒ½ä¼šå‡ºç°å¹»è¯»ã€‚ ä¸²è¡ŒåŒ–ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œé€šè¿‡å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œæ¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ï¼Œä½†æ€§èƒ½å¼€é”€ä¹Ÿæœ€å¤§ã€‚ 22. äº‹åŠ¡ä¸­çš„éš”ç¦»æ€§æ˜¯å¦‚ä½•ä¿è¯çš„å‘¢ï¼Ÿï¼ˆä½ è§£é‡Šä¸€ä¸‹MVCCï¼‰ äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯æŒ‡å½“å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œæ•°æ®åº“å¦‚ä½•ç®¡ç†è¿™äº›äº‹åŠ¡å¯¹æ•°æ®çš„è®¿é—®ï¼Œä»¥é˜²æ­¢æ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ã€‚MySQL ä½¿ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ¥æä¾›äº‹åŠ¡éš”ç¦»ã€‚\näº‹åŠ¡çš„éš”ç¦»æ€§é€šè¿‡é”å’Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ¥ä¿è¯ã€‚MVCCé€šè¿‡ç»´æŠ¤æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬æ¥é¿å…è¯»å†™å†²çªã€‚åº•å±‚å®ç°åŒ…æ‹¬éšè—å­—æ®µã€undo logå’Œread viewã€‚éšè—å­—æ®µåŒ…æ‹¬trx_idå’Œroll_pointerã€‚trx_idï¼Œå®ƒæ˜¯ä¸€ä¸ªäº‹åŠ¡IDï¼Œç”¨äºæ ‡è¯†å¯¹æ•°æ®è¡Œè¿›è¡Œæ›´æ”¹çš„äº‹åŠ¡ã€‚undo logè®°å½•äº†ä¸åŒç‰ˆæœ¬çš„æ•°æ®ï¼Œé€šè¿‡roll_pointerå½¢æˆç‰ˆæœ¬é“¾ã€‚read viewå®šä¹‰äº†ä¸åŒéš”ç¦»çº§åˆ«ä¸‹çš„å¿«ç…§è¯»ï¼Œå†³å®šäº†äº‹åŠ¡è®¿é—®å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚\n23. MySQLä¸»ä»åŒæ­¥åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ MySQLçš„ä¸»ä»åŒæ­¥æ˜¯ä¸€ç§æ•°æ®åº“å¤åˆ¶æŠ€æœ¯ï¼Œå®ƒå…è®¸å°†ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ï¼ˆä¸»åº“ï¼‰çš„æ•°æ®å˜æ›´å¤åˆ¶åˆ°å¦ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼ˆä»åº“ï¼‰ä¸Šã€‚\nMySQLä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒæ˜¯äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinlogï¼‰ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š\nä¸»åº“åœ¨äº‹åŠ¡æäº¤æ—¶è®°å½•æ•°æ®å˜æ›´åˆ°Binlogã€‚ ä»åº“è¿æ¥åˆ°ä¸»åº“å¹¶è¯»å– Binlogï¼Œå°† Binlog ä¸­çš„äº‹ä»¶å†™å…¥åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—ï¼ˆRelay Logï¼‰ã€‚ ä»åº“æ ¹æ®ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œé‡æ”¾ï¼ˆReplayï¼‰è¿™äº›äº‹ä»¶åˆ°è‡ªå·±çš„æ•°æ®ä¸­ï¼Œä»è€Œå®ç°æ•°æ®çš„åŒæ­¥ã€‚ 24. ä½ ä»¬é¡¹ç›®ç”¨è¿‡MySQLçš„åˆ†åº“åˆ†è¡¨å—ï¼Ÿ å‚ç›´åˆ†åº“ï¼šå‚ç›´åˆ†åº“æ˜¯æŒ‰ç…§ä¸šåŠ¡å°†ä¸åŒçš„è¡¨æ‹†åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­\næˆ‘ä»¬é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæ¯ä¸ªå¾®æœåŠ¡å¯¹åº”ä¸€ä¸ªæ•°æ®åº“ï¼Œæ˜¯æ ¹æ®ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†çš„ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯å‚ç›´æ‹†åˆ†ã€‚\næ°´å¹³åˆ†åº“ï¼šæ°´å¹³åˆ†åº“æ˜¯å°†æ•°æ®æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼ˆå¦‚ç”¨æˆ· ID å–æ¨¡ã€å“ˆå¸Œç­‰ï¼‰åˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚æ¯”å¦‚ï¼Œæ ¹æ®ç”¨æˆ· ID å¯¹ 10 å–æ¨¡ï¼Œå°†ç”¨æˆ·æ•°æ®åˆ†å¸ƒåˆ° 10 ä¸ªä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªæ•°æ®åº“éƒ½ä¿å­˜ç€å®Œæ•´çš„æ•°æ®è¡¨ç»“æ„\nå‚ç›´åˆ†è¡¨ï¼šå‚ç›´åˆ†è¡¨æ˜¯å°†ä¸€å¼ è¡¨æŒ‰ç…§åˆ—çš„ç›¸å…³æ€§æ‹†åˆ†æˆå¤šå¼ è¡¨ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªåŒ…å«å¤§é‡å­—æ®µçš„ç”¨æˆ·è¡¨ï¼Œæ‹†åˆ†ä¸ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨å’Œç”¨æˆ·æ‰©å±•ä¿¡æ¯è¡¨ã€‚å‚ç›´åˆ†è¡¨é€‚åˆè¡¨ä¸­å­˜åœ¨ä¸å¸¸ç”¨å¹¶ä¸”å ç”¨äº†å¤§é‡ç©ºé—´çš„è¡¨æ‹†åˆ†å‡ºå»ã€‚\næ°´å¹³åˆ†è¡¨ï¼šæ°´å¹³åˆ†è¡¨æ˜¯å°†ä¸€å¼ è¡¨çš„æ•°æ®æŒ‰ç…§è¡Œè¿›è¡Œæ‹†åˆ†ã€‚ä¾‹å¦‚æŒ‰ç…§ç”¨æˆ· ID çš„èŒƒå›´æˆ–è€…å“ˆå¸Œå€¼å°†æ•°æ®æ‹†åˆ†åˆ°ä¸åŒçš„è¡¨ä¸­ã€‚æ°´å¹³åˆ†è¡¨å°±é€‚åˆç”¨æˆ·è¡¨è¡Œæ•°å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬å•è¡¨è¡Œæ•°è¶…è¿‡5000ä¸‡å°±å¾—åˆ†è¡¨ï¼Œå¦‚æœå•è¡¨çš„æ•°æ®æ¯”è¾ƒå¤æ‚é‚£å¯èƒ½2000ä¸‡ç”šè‡³1000ä¸‡å°±å¾—åˆ†äº†ã€‚\nå››ã€Redis ä¸€ã€Redis åŸºç¡€æ•°æ®ç»“æ„(äº”ç§) ï¼ˆä¸€ï¼‰Stringï¼ˆå­—ç¬¦ä¸²ï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šRedis ä¸­æœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œå¯å­˜å‚¨å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼Œæœ€å¤§èƒ½å­˜å‚¨ 512MB çš„æ•°æ®ã€‚åœ¨å†…å­˜ä¸­ä»¥ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰å½¢å¼å­˜å‚¨ï¼Œç›¸æ¯”ä¼ ç»Ÿ C å­—ç¬¦ä¸²ï¼ŒSDS å…·æœ‰è·å–é•¿åº¦æ—¶é—´å¤æ‚åº¦ä¸º O (1)ã€æœç»ç¼“å†²åŒºæº¢å‡ºç­‰ä¼˜åŠ¿ã€‚ åº”ç”¨åœºæ™¯ æ•°æ®ç¼“å­˜ï¼šå¸¸ç”¨æ¥ç¼“å­˜å„ç±»å¸¸è§„æ•°æ®ï¼Œåƒç”¨æˆ·çš„ session ä¿¡æ¯ã€ç”¨äºèº«ä»½éªŒè¯çš„ tokenã€åºåˆ—åŒ–åçš„å¯¹è±¡ç­‰ã€‚é€šè¿‡å°†è¿™äº›æ•°æ®ç¼“å­˜äº Redisï¼Œå¯æ˜¾è‘—å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ï¼Œæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚ä¾‹å¦‚åœ¨ Web åº”ç”¨ä¸­ï¼Œé¢‘ç¹è®¿é—®çš„ç”¨æˆ·ä¿¡æ¯å¯å…ˆä» Redis çš„ String ç±»å‹ç¼“å­˜ä¸­è·å–ï¼Œè‹¥ä¸å­˜åœ¨å†æŸ¥è¯¢æ•°æ®åº“å¹¶å†™å…¥ç¼“å­˜ã€‚ è®¡æ•°åœºæ™¯ï¼šå€ŸåŠ© INCRã€INCRBY ç­‰å‘½ä»¤ï¼Œå¯æ–¹ä¾¿åœ°å¯¹æ•°å€¼è¿›è¡ŒåŸå­é€’å¢æ“ä½œï¼Œç”¨äºç»Ÿè®¡ç”¨æˆ·å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°ã€é¡µé¢å•ä½æ—¶é—´çš„è®¿é—®æ•°ç­‰ã€‚æ¯”å¦‚åœ¨ä¸€ä¸ªç®€å•é™æµç³»ç»Ÿä¸­ï¼Œå¯è®¾å®šç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤šè¯·æ±‚ 100 æ¬¡ï¼Œé€šè¿‡å¯¹ç”¨æˆ·è¯·æ±‚è®¡æ•°ï¼ˆå­˜å‚¨åœ¨ String ç±»å‹é”®ä¸­ï¼‰ä¸é˜ˆå€¼æ¯”è¾ƒï¼Œè¶…è¿‡åˆ™é™æµã€‚ åˆ†å¸ƒå¼é”ï¼šåˆ©ç”¨ SETNXï¼ˆSET if Not eXistsï¼‰å‘½ä»¤å¯å®ç°ç®€æ˜“åˆ†å¸ƒå¼é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ SETNX key value æ—¶ï¼Œè‹¥é”®ä¸å­˜åœ¨ï¼Œä¼šè®¾ç½®æˆåŠŸå¹¶è·å–é”ï¼›è‹¥é”®å·²å­˜åœ¨ï¼Œè·å–é”å¤±è´¥ã€‚é‡Šæ”¾é”æ—¶å¯é€šè¿‡åˆ é™¤è¯¥é”®å®ç°ã€‚ä½†è¿™ç§ç®€å•å®ç°æœªå¤„ç†é”è¶…æ—¶ç­‰å¤æ‚æƒ…å†µï¼Œå®é™…åº”ç”¨ä¸­éœ€å®Œå–„ã€‚ å…±äº«é…ç½®ä¿¡æ¯ï¼šå­˜å‚¨åº”ç”¨ç¨‹åºçš„é…ç½®å‚æ•°ï¼Œå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€ç³»ç»Ÿå¼€å…³é…ç½®ç­‰ã€‚åº”ç”¨å¯åŠ¨æ—¶ä» Redis è¯»å–é…ç½®ï¼Œé…ç½®å˜æ›´æ—¶å¯å®æ—¶æ›´æ–° Redis ä¸­çš„å€¼ï¼Œåº”ç”¨é€šè¿‡ç›‘å¬æœºåˆ¶è·å–å˜æ›´ï¼Œå®ç°é…ç½®åŠ¨æ€æ›´æ–°ã€‚ ä¸ Hash å­˜å‚¨å¯¹è±¡å¯¹æ¯” å­˜å‚¨æ–¹å¼ï¼šString å­˜å‚¨çš„æ˜¯åºåˆ—åŒ–åçš„æ•´ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚å°†ä¸€ä¸ªåŒ…å«å¤šä¸ªå­—æ®µçš„ Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²åå­˜å‚¨ã€‚Hash åˆ™æ˜¯å°†å¯¹è±¡çš„æ¯ä¸ªå­—æ®µä½œä¸ºä¸€ä¸ªé”®å€¼å¯¹å•ç‹¬å­˜å‚¨ï¼Œä¾‹å¦‚å­˜å‚¨ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼ŒHash å¯å°†ç”¨æˆ·çš„å§“åã€å¹´é¾„ã€é‚®ç®±ç­‰å­—æ®µåˆ†åˆ«ä»¥ â€œfield:valueâ€ å½¢å¼å­˜å‚¨ã€‚ å†…å­˜å ç”¨ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¼“å­˜ç›¸åŒæ•°é‡çš„å¯¹è±¡æ•°æ®ï¼ŒString æ¶ˆè€—å†…å­˜çº¦ä¸º Hash çš„ä¸€åŠã€‚å› ä¸º Hash ç»“æ„æœ¬èº«ä¼šæœ‰é¢å¤–å¼€é”€ç”¨äºå­˜å‚¨å­—æ®µåç­‰ä¿¡æ¯ã€‚ä½†å¦‚æœå¯¹è±¡å­—æ®µè¾ƒå°‘ï¼Œè¿™ç§å†…å­˜å·®å¼‚å¯èƒ½ä¸æ˜æ˜¾ã€‚ æŸ¥è¯¢ä¸ä¿®æ”¹çµæ´»æ€§ï¼šString é€‚åˆå¯¹è±¡æ•´ä½“è¯»å–å’Œæ›´æ–°åœºæ™¯ã€‚è‹¥è¦è·å–æˆ–ä¿®æ”¹å¯¹è±¡éƒ¨åˆ†å­—æ®µï¼Œéœ€å…ˆååºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡ï¼Œæ“ä½œåå†åºåˆ—åŒ–å­˜å‚¨ï¼Œæ€§èƒ½å¼€é”€å¤§ã€‚Hash å¯ç›´æ¥å¯¹å•ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ã€ä¿®æ”¹ã€æ·»åŠ æ“ä½œï¼Œæ— éœ€å¤„ç†æ•´ä¸ªå¯¹è±¡ï¼Œåœ¨è´­ç‰©è½¦è¿™ç±»å•†å“é¢‘ç¹å˜åŠ¨åœºæ™¯ä¸­ä¼˜åŠ¿æ˜æ˜¾ã€‚ä¾‹å¦‚è´­ç‰©è½¦ä¸­å•†å“æ•°é‡ã€æ·»åŠ æ–°å•†å“ç­‰æ“ä½œï¼Œä½¿ç”¨ Hash å¯é«˜æ•ˆå®Œæˆã€‚ å»ºè®®ï¼šå¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè‹¥å¯¹å¯¹è±¡æ“ä½œä»¥æ•´ä½“ä¸ºä¸»ï¼Œæˆ–ç³»ç»Ÿå¯¹å†…å­˜èµ„æºæ•æ„Ÿï¼Œä¼˜å…ˆä½¿ç”¨ String å­˜å‚¨å¯¹è±¡æ•°æ®ã€‚ä½†å¯¹å¯¹è±¡éƒ¨åˆ†å­—æ®µé¢‘ç¹æ“ä½œçš„åœºæ™¯ï¼ŒHash æ›´åˆé€‚ã€‚ ï¼ˆäºŒï¼‰Listï¼ˆåˆ—è¡¨ï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šæŒ‰æ’å…¥é¡ºåºæ’åºçš„å­—ç¬¦ä¸²é“¾è¡¨ï¼Œå¯åœ¨é“¾è¡¨å¤´éƒ¨ï¼ˆLPUSHï¼‰æˆ–å°¾éƒ¨ï¼ˆRPUSHï¼‰æ’å…¥å…ƒç´ ï¼Œä¹Ÿå¯ä»å¤´éƒ¨ï¼ˆLPOPï¼‰æˆ–å°¾éƒ¨ï¼ˆRPOPï¼‰åˆ é™¤å…ƒç´ ã€‚æ”¯æŒè·å–æŒ‡å®šèŒƒå›´å…ƒç´ ï¼ˆLRANGEï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (S + N)ï¼ŒS ä¸ºèµ·å§‹ä½ç½®åç§»é‡ï¼ŒN ä¸ºè¿”å›å…ƒç´ æ•°é‡ã€‚ åº”ç”¨åœºæ™¯ æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¯ä½œä¸ºç®€å•æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨ã€‚ç”Ÿäº§è€…é€šè¿‡ RPUSH å‘åˆ—è¡¨å°¾éƒ¨å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨ LPOP ä»åˆ—è¡¨å¤´éƒ¨è¯»å–æ¶ˆæ¯ï¼Œå®ç°æ¶ˆæ¯çš„æœ‰åºå¤„ç†ã€‚ä½† Redis åŸç”Ÿ List ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ç¼ºä¹ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œå¦‚æ¶ˆæ¯æŒä¹…åŒ–ã€ACK æœºåˆ¶ç­‰ï¼Œé€‚ç”¨äºå¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚ä¸é«˜çš„ç®€å•åœºæ™¯ã€‚ æœ€æ–°æ¶ˆæ¯å±•ç¤ºï¼šç”¨äºå­˜å‚¨æœ€æ–°å‘å¸ƒçš„æ¶ˆæ¯ã€æ–‡ç« ç­‰å†…å®¹ã€‚ä¾‹å¦‚åœ¨ç¤¾äº¤åª’ä½“åº”ç”¨ä¸­ï¼Œç”¨æˆ·å‘å¸ƒçš„åŠ¨æ€å¯æŒ‰æ—¶é—´é¡ºåºé€šè¿‡ RPUSH å­˜å…¥ Listï¼Œå±•ç¤ºæ—¶ä½¿ç”¨ LRANGE è·å–æœ€æ–°çš„è‹¥å¹²æ¡åŠ¨æ€ã€‚ æ“ä½œæ—¥å¿—è®°å½•ï¼šè®°å½•ç³»ç»Ÿæ“ä½œæ—¥å¿—ï¼Œæ¯æ¬¡æ“ä½œç›¸å…³ä¿¡æ¯ï¼ˆå¦‚æ“ä½œæ—¶é—´ã€æ“ä½œäººã€æ“ä½œå†…å®¹ï¼‰ä½œä¸ºä¸€ä¸ªå…ƒç´ ï¼Œé€šè¿‡ RPUSH è¿½åŠ åˆ° List ä¸­ã€‚åç»­å¯æ ¹æ®éœ€è¦æŸ¥è¯¢ç‰¹å®šæ—¶é—´æ®µæˆ–ç‰¹å®šç±»å‹çš„æ“ä½œè®°å½•ã€‚ ç›¸å…³å‘½ä»¤ LPUSH key value [value\u0026hellip;]ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨ã€‚ RPUSH key value [value\u0026hellip;]ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å°¾éƒ¨ã€‚ LPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„å¤´å…ƒç´ ã€‚ RPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„å°¾å…ƒç´ ã€‚ LRANGE key start stopï¼šè¿”å›åˆ—è¡¨ä¸­æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼Œstart å’Œ stop ä¸ºå…ƒç´ ç´¢å¼•ï¼Œ0 è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ - 1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ã€‚ ï¼ˆä¸‰ï¼‰Setï¼ˆé›†åˆï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šæ— åºçš„å­—ç¬¦ä¸²é›†åˆï¼Œé›†åˆä¸­å…ƒç´ å…·æœ‰å”¯ä¸€æ€§ï¼Œé‡å¤æ·»åŠ ç›¸åŒå…ƒç´ ä¸ä¼šäº§ç”Ÿæ–°å‰¯æœ¬ã€‚å†…éƒ¨å®ç°åŸºäºå“ˆå¸Œè¡¨ï¼Œæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å¹³å‡ä¸º O (1)ã€‚ åº”ç”¨åœºæ™¯ å»é‡åœºæ™¯ï¼šåœ¨æ•°æ®å¤„ç†ä¸­ï¼Œå¯åˆ©ç”¨ Set çš„å”¯ä¸€æ€§å¯¹æ•°æ®è¿›è¡Œå»é‡ã€‚ä¾‹å¦‚ç»Ÿè®¡ç½‘ç«™è®¿é—®ç”¨æˆ·çš„å”¯ä¸€ IP åœ°å€ï¼Œæ¯æ¬¡å°†è®¿é—® IP é€šè¿‡ SADD å‘½ä»¤æ·»åŠ åˆ° Set ä¸­ï¼Œæœ€ç»ˆ Set çš„å…ƒç´ æ•°é‡å³ä¸ºå”¯ä¸€ IP æ•°é‡ã€‚ æ ‡ç­¾ç®¡ç†ï¼šç”¨äºç®¡ç†å¯¹è±¡æ ‡ç­¾ã€‚å¦‚åœ¨ä¸€ä¸ªå•†å“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå•†å“å¯å…³è”å¤šä¸ªæ ‡ç­¾ï¼ˆå¦‚ç”µå­äº§å“ã€æ‰“æŠ˜å•†å“ç­‰ï¼‰ï¼Œå°†å•†å“ ID ä½œä¸º keyï¼Œæ ‡ç­¾ä½œä¸º Set çš„å…ƒç´ å­˜å‚¨ã€‚é€šè¿‡ SISMEMBER å‘½ä»¤å¯åˆ¤æ–­å•†å“æ˜¯å¦å…·æœ‰æŸä¸ªæ ‡ç­¾ï¼Œé€šè¿‡ SMEMBERS å¯è·å–å•†å“æ‰€æœ‰æ ‡ç­¾ã€‚ äº¤é›†ã€å¹¶é›†ã€å·®é›†è¿ç®—ï¼šåœ¨ç¤¾äº¤åº”ç”¨ä¸­ï¼Œå¯é€šè¿‡é›†åˆè¿ç®—å®ç°å…±åŒå…³æ³¨ã€å…±åŒçˆ±å¥½ç­‰åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ· A çš„å…³æ³¨åˆ—è¡¨å’Œç”¨æˆ· B çš„å…³æ³¨åˆ—è¡¨ä½œä¸ºä¸¤ä¸ª Setï¼Œé€šè¿‡ SINTER å‘½ä»¤æ±‚äº¤é›†ï¼Œå¯å¾—åˆ° A å’Œ B å…±åŒå…³æ³¨çš„äººã€‚ ç›¸å…³å‘½ä»¤ SADD key member [member\u0026hellip;]ï¼šå‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚ SREM key member [member\u0026hellip;]ï¼šç§»é™¤é›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚ SISMEMBER key memberï¼šåˆ¤æ–­æˆå‘˜æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œå­˜åœ¨è¿”å› 1ï¼Œä¸å­˜åœ¨è¿”å› 0ã€‚ SMEMBERS keyï¼šè¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚ SINTER key [key\u0026hellip;]ï¼šè¿”å›å¤šä¸ªé›†åˆçš„äº¤é›†ã€‚ SUNION key [key\u0026hellip;]ï¼šè¿”å›å¤šä¸ªé›†åˆçš„å¹¶é›†ã€‚ SDIFF key [key\u0026hellip;]ï¼šè¿”å›å¤šä¸ªé›†åˆçš„å·®é›†ï¼ˆç¬¬ä¸€ä¸ªé›†åˆå‡å»å…¶ä»–é›†åˆçš„å…ƒç´ ï¼‰ã€‚ ï¼ˆå››ï¼‰Hashï¼ˆæ•£åˆ—ï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šç”±é”®å€¼å¯¹ç»„æˆçš„é›†åˆï¼Œé€‚åˆå­˜å‚¨å¯¹è±¡ã€‚æ¯ä¸ªé”®å€¼å¯¹çš„é”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚å†…éƒ¨é‡‡ç”¨å“ˆå¸Œè¡¨å­˜å‚¨ï¼Œåœ¨æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤å•ä¸ªå­—æ®µæ—¶ï¼Œæ—¶é—´å¤æ‚åº¦å¹³å‡ä¸º O (1)ã€‚ åº”ç”¨åœºæ™¯ å­˜å‚¨å¯¹è±¡ï¼šå¦‚ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ç­‰å¯¹è±¡çš„å­˜å‚¨ã€‚ä»¥ç”¨æˆ· ID ä¸º keyï¼Œç”¨æˆ·çš„å„ä¸ªå±æ€§ï¼ˆå§“åã€å¹´é¾„ã€åœ°å€ç­‰ï¼‰ä¸º fieldï¼Œå¯¹åº”çš„å€¼ä¸º valueã€‚ä¸ String å­˜å‚¨å¯¹è±¡ç›¸æ¯”ï¼ŒHash å¯çµæ´»æ“ä½œå•ä¸ªå­—æ®µï¼Œæ— éœ€åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡ã€‚ è´­ç‰©è½¦ç³»ç»Ÿï¼šè´­ç‰©è½¦åœºæ™¯ä¸­ï¼Œä»¥ç”¨æˆ· ID ä¸º keyï¼Œå•†å“ ID ä¸º fieldï¼Œå•†å“æ•°é‡ä¸º valueã€‚æ–¹ä¾¿å¯¹è´­ç‰©è½¦ä¸­å•†å“è¿›è¡Œæ·»åŠ ã€ä¿®æ”¹æ•°é‡ã€åˆ é™¤ç­‰æ“ä½œã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ·»åŠ å•†å“æ—¶ï¼Œè‹¥å•†å“å·²å­˜åœ¨ï¼Œä½¿ç”¨ HINCRBY å‘½ä»¤å¢åŠ å•†å“æ•°é‡ï¼›åˆ é™¤å•†å“æ—¶ï¼Œä½¿ç”¨ HDEL å‘½ä»¤ã€‚ é…ç½®ç®¡ç†ï¼šå­˜å‚¨åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ï¼Œä¸ String å­˜å‚¨é…ç½®ç›¸æ¯”ï¼ŒHash å¯å¯¹å•ä¸ªé…ç½®é¡¹è¿›è¡Œä¿®æ”¹ï¼Œæ— éœ€é‡æ–°è®¾ç½®æ•´ä¸ªé…ç½®å­—ç¬¦ä¸²ã€‚å¦‚æ•°æ®åº“è¿æ¥é…ç½®ï¼Œå¯å°†ä¸»æœºã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ç­‰å­—æ®µåˆ†åˆ«å­˜å‚¨åœ¨ Hash ä¸­ã€‚ ç›¸å…³å‘½ä»¤ HSET key field valueï¼šä¸ºå“ˆå¸Œè¡¨ä¸­çš„å­—æ®µèµ‹å€¼ã€‚ HGET key fieldï¼šè·å–å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ã€‚ HDEL key field [field\u0026hellip;]ï¼šåˆ é™¤å“ˆå¸Œè¡¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚ HINCRBY key field incrementï¼šä¸ºå“ˆå¸Œè¡¨ä¸­çš„å­—æ®µå€¼å¢åŠ æŒ‡å®šçš„æ•´æ•°ã€‚ HGETALL keyï¼šè·å–å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰å­—æ®µå’Œå€¼ã€‚ ï¼ˆäº”ï¼‰Zsetï¼ˆæœ‰åºé›†åˆï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šæ¯ä¸ªæˆå‘˜éƒ½å…³è”ä¸€ä¸ªåˆ†æ•°çš„å­—ç¬¦ä¸²é›†åˆï¼Œé€šè¿‡åˆ†æ•°å¯¹æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§æ’åºï¼Œæˆå‘˜å”¯ä¸€ä½†åˆ†æ•°å¯é‡å¤ã€‚å†…éƒ¨é€šè¿‡è·³è·ƒè¡¨å’Œå“ˆå¸Œè¡¨ä¸¤ç§æ•°æ®ç»“æ„å®ç°ï¼Œåœ¨æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾å…ƒç´ ä»¥åŠèŒƒå›´æŸ¥è¯¢æ–¹é¢æ€§èƒ½è¾ƒå¥½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (log N)ï¼ŒN ä¸ºé›†åˆå…ƒç´ æ•°é‡ã€‚ åº”ç”¨åœºæ™¯ æ’è¡Œæ¦œç³»ç»Ÿï¼šå¸¸ç”¨äºå„ç§æ’è¡Œæ¦œåœºæ™¯ï¼Œå¦‚ç›´æ’­é—´é€ç¤¼ç‰©æ’è¡Œæ¦œã€æ¸¸æˆç©å®¶ç§¯åˆ†æ’è¡Œæ¦œã€å•†å“é”€é‡æ’è¡Œæ¦œç­‰ã€‚å°†ç”¨æˆ· ID æˆ–å•†å“ ID ä½œä¸ºæˆå‘˜ï¼Œå¯¹åº”çš„åˆ†æ•°ï¼ˆå¦‚ç¤¼ç‰©ä»·å€¼ã€ç©å®¶ç§¯åˆ†ã€å•†å“é”€é‡ï¼‰ä½œä¸ºæ’åºä¾æ®ã€‚é€šè¿‡ ZRANGEï¼ˆä»å°åˆ°å¤§ï¼‰æˆ– ZREVRANGEï¼ˆä»å¤§åˆ°å°ï¼‰å‘½ä»¤è·å–æ’è¡Œæ¦œæ•°æ®ã€‚ å¸¦æƒé‡çš„ä»»åŠ¡é˜Ÿåˆ—ï¼šåœ¨ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªä»»åŠ¡å¯å…³è”ä¸€ä¸ªæƒé‡ï¼ˆåˆ†æ•°ï¼‰ï¼Œæ ¹æ®æƒé‡å†³å®šä»»åŠ¡æ‰§è¡Œé¡ºåºã€‚é€šè¿‡ ZADD å‘½ä»¤æ·»åŠ ä»»åŠ¡åŠæƒé‡ï¼Œé€šè¿‡ ZPOPMIN æˆ– ZPOPMAX å‘½ä»¤è·å–å¹¶ç§»é™¤æƒé‡æœ€å°æˆ–æœ€å¤§çš„ä»»åŠ¡ã€‚ æ—¶é—´åºåˆ—æ•°æ®ï¼šå¦‚è‚¡ç¥¨ä»·æ ¼éšæ—¶é—´å˜åŒ–æ•°æ®ï¼Œæ—¶é—´ä½œä¸ºåˆ†æ•°ï¼Œè‚¡ç¥¨ä»·æ ¼ä½œä¸ºæˆå‘˜ã€‚å¯æ–¹ä¾¿åœ°æŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µå†…çš„è‚¡ç¥¨ä»·æ ¼æ•°æ®ï¼Œé€šè¿‡ ZRANGEBYSCORE å‘½ä»¤å®ç°ã€‚ ç›¸å…³å‘½ä»¤ ZADD key score member [score member\u0026hellip;]ï¼šå‘æœ‰åºé›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°ã€‚ ZRANGE key start stop [WITHSCORES]ï¼šè¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šèŒƒå›´å†…çš„æˆå‘˜ï¼ŒæŒ‰åˆ†æ•°ä»å°åˆ°å¤§æ’åºï¼ŒWITHSCORES é€‰é¡¹å¯åŒæ—¶è¿”å›æˆå‘˜çš„åˆ†æ•°ã€‚ ZREVRANGE key start stop [WITHSCORES]ï¼šè¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šèŒƒå›´å†…çš„æˆå‘˜ï¼ŒæŒ‰åˆ†æ•°ä»å¤§åˆ°å°æ’åºï¼ŒWITHSCORES é€‰é¡¹å¯åŒæ—¶è¿”å›æˆå‘˜çš„åˆ†æ•°ã€‚ ZREVRANK key memberï¼šè¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜çš„æ’åï¼ˆä»å¤§åˆ°å°æ’åºï¼‰ã€‚ ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]ï¼šè¿”å›æœ‰åºé›†åˆä¸­åˆ†æ•°åœ¨æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ï¼Œå¯é€šè¿‡ LIMIT é€‰é¡¹æŒ‡å®šè¿”å›ç»“æœçš„åç§»é‡å’Œæ•°é‡ã€‚ äºŒã€Redis ç‰¹æ®Šæ•°æ®ç»“æ„(å…«ç§) ï¼ˆä¸€ï¼‰HyperLogLogsï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šç”¨äºè¿‘ä¼¼ç»Ÿè®¡é›†åˆä¸­å”¯ä¸€å…ƒç´ çš„æ•°é‡ï¼Œé€šè¿‡æ¦‚ç‡ç®—æ³•å®ç°ï¼Œåœ¨å†…å­˜ä½¿ç”¨ä¸Šæä¸ºé«˜æ•ˆã€‚åªéœ€å°‘é‡å†…å­˜ï¼ˆ12KBï¼‰å³å¯ç»Ÿè®¡å¤§é‡æ•°æ®ï¼Œè¯¯å·®ç‡çº¦ä¸º 0.81%ã€‚å†…éƒ¨é€šè¿‡ç¨€ç–çŸ©é˜µå’Œç¨ å¯†çŸ©é˜µå­˜å‚¨æ•°æ®ã€‚ åº”ç”¨åœºæ™¯ ç½‘é¡µ UV ç»Ÿè®¡ï¼šç»Ÿè®¡ç½‘é¡µçš„ç‹¬ç«‹è®¿å®¢æ•°ã€‚æ¯æ¬¡ç”¨æˆ·è®¿é—®ç½‘é¡µæ—¶ï¼Œå°†ç”¨æˆ· ID é€šè¿‡ PFADD å‘½ä»¤æ·»åŠ åˆ°å¯¹åº”çš„ HyperLogLog ä¸­ï¼Œæœ€åä½¿ç”¨ PFCOUNT å‘½ä»¤è·å– UV æ•°é‡ã€‚ç›¸æ¯”ä¼ ç»Ÿå­˜å‚¨æ¯ä¸ªç”¨æˆ· ID å†ç»Ÿè®¡å”¯ä¸€å€¼çš„æ–¹å¼ï¼ŒHyperLogLog å¤§å¤§èŠ‚çœå†…å­˜ã€‚ å¹¿å‘Šæ›å…‰ç»Ÿè®¡ï¼šåœ¨å¹¿å‘ŠæŠ•æ”¾ç³»ç»Ÿä¸­ï¼Œç»Ÿè®¡å¹¿å‘Šçš„ç‹¬ç«‹æ›å…‰æ¬¡æ•°ã€‚å°†æ¯æ¬¡å¹¿å‘Šæ›å…‰çš„è®¾å¤‡ ID æˆ–ç”¨æˆ· ID è®°å½•åˆ° HyperLogLog ä¸­ï¼Œå¯é«˜æ•ˆè·å–ç‹¬ç«‹æ›å…‰æ•°ï¼Œä¸ºå¹¿å‘Šæ•ˆæœè¯„ä¼°æä¾›æ•°æ®æ”¯æŒã€‚ ç›¸å…³å‘½ä»¤ PFADD key element [element\u0026hellip;]ï¼šå‘ HyperLogLog ä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚ PFCOUNT key [key\u0026hellip;]ï¼šè¿”å›ä¸€ä¸ªæˆ–å¤šä¸ª HyperLogLog çš„è¿‘ä¼¼åŸºæ•°ã€‚ PFMERGE destkey sourcekey [sourcekey\u0026hellip;]ï¼šå°†å¤šä¸ª HyperLogLog åˆå¹¶ä¸ºä¸€ä¸ªã€‚ ï¼ˆäºŒï¼‰Bitmapï¼ˆä½å­˜å‚¨ï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šåŸºäºå­—ç¬¦ä¸²ç±»å‹å®ç°ï¼Œé€šè¿‡ä½æ“ä½œæ¥å­˜å‚¨å’Œå¤„ç†æ•°æ®ã€‚æ¯ä¸ªå­—ç¬¦ä¸²å¯å­˜å‚¨ 2^32 - 1 ä¸ªä½ï¼Œå³ 512MB å¤§å°çš„ä½æ•°æ®ã€‚é€šè¿‡ SETBIT å‘½ä»¤è®¾ç½®æŸä½çš„å€¼ï¼ˆ0 æˆ– 1ï¼‰ï¼ŒGETBIT å‘½ä»¤è·å–æŸä½çš„å€¼ã€‚ åº”ç”¨åœºæ™¯ ç”¨æˆ·æ´»è·ƒçŠ¶æ€ç»Ÿè®¡ï¼šä»¥æ—¥æœŸï¼ˆç²¾ç¡®åˆ°å¤©ï¼‰ä½œä¸º keyï¼Œç”¨æˆ· ID ä¸º offsetã€‚å½“ç”¨æˆ·åœ¨å½“å¤©æ´»è·ƒè¿‡æ—¶ï¼Œä½¿ç”¨ SETBIT å‘½ä»¤å°†å¯¹åº”ä½ç½®è®¾ç½®ä¸º 1ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ 2023 å¹´ 10 æœˆ 1 æ—¥æ´»è·ƒç”¨æˆ·ï¼ŒSETBIT 20231001 user_id 1ã€‚é€šè¿‡ BITCOUNT å‘½ä»¤å¯ç»Ÿè®¡å½“å¤©æ´»è·ƒç”¨æˆ·æ•°é‡ï¼Œé€šè¿‡ BITOP å‘½ä»¤å¯è¿›è¡Œä½è¿ç®—ï¼Œå¦‚ç»Ÿè®¡è¿ç»­å¤šæ—¥æ´»è·ƒç”¨æˆ·ã€‚ æƒé™ç®¡ç†ï¼šç”¨ Bitmap è¡¨ç¤ºç”¨æˆ·æƒé™ï¼Œæ¯ä¸ªæƒé™å¯¹åº”ä¸€ä½ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å…·æœ‰è¯»å–æƒé™ï¼Œå¯¹åº”ä½è®¾ä¸º 1ï¼›æ— å†™å…¥æƒé™ï¼Œå¯¹åº”ä½è®¾ä¸º 0ã€‚é€šè¿‡ä½è¿ç®—å¯å¿«é€Ÿåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·æœ‰æŸç»„æƒé™ï¼Œå¦‚åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åŒæ—¶å…·æœ‰è¯»å–å’Œæ‰§è¡Œæƒé™ã€‚ ç›¸å…³å‘½ä»¤ SETBIT key offset valueï¼šè®¾ç½®æˆ–æ¸…é™¤æŒ‡å®š key åç§»é‡ä¸Šçš„ä½å€¼ï¼ˆ0 æˆ– 1ï¼‰ã€‚ GETBIT key offsetï¼šè·å–æŒ‡å®š key åç§»é‡ä¸Šçš„ä½å€¼ã€‚ BITCOUNT key [start end]ï¼šç»Ÿè®¡æŒ‡å®š key ä¸­ä½å€¼ä¸º 1 çš„æ•°é‡ï¼Œstart å’Œ end å¯é€‰ï¼Œç”¨äºæŒ‡å®šå­—èŠ‚èŒƒå›´ã€‚ BITOP operation destkey key [key\u0026hellip;]ï¼šå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª key è¿›è¡Œä½è¿ç®—ï¼ˆANDã€ORã€XORã€NOTï¼‰ï¼Œç»“æœå­˜å‚¨åœ¨ destkey ä¸­ã€‚ ï¼ˆä¸‰ï¼‰Geospatialï¼ˆåœ°ç†ä½ç½®ï¼‰\nç»“æ„ç‰¹ç‚¹ï¼šç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¹¶æ”¯æŒåŸºäºåœ°ç†ä½ç½®çš„æŸ¥è¯¢ã€‚æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ Zset å®ç°ï¼Œå°†åœ°ç†ä½ç½®çš„ç»çº¬åº¦ä¿¡æ¯ç¼–ç åä½œä¸ºåˆ†æ•°å­˜å‚¨ï¼Œåœ°ç†ä½ç½®æ ‡è¯†ï¼ˆå¦‚åŸå¸‚åã€åº—é“ºåï¼‰ä½œä¸ºæˆå‘˜ã€‚æ”¯æŒæŸ¥è¯¢é™„è¿‘ä½ç½®ã€è®¡ç®—è·ç¦»ç­‰æ“ä½œã€‚ åº”ç”¨åœºæ™¯ é™„è¿‘ä½ç½®æŸ¥è¯¢ï¼šåœ¨åœ°å›¾åº”ç”¨ã€å¤–å–é…é€ã€å…±äº«å•è½¦ç­‰åœºæ™¯ä¸­ï¼Œç”¨äºæŸ¥æ‰¾ç”¨æˆ·é™„è¿‘çš„å•†å®¶ã€é…é€å‘˜ã€å…±äº«å•è½¦ç­‰ã€‚ä¾‹å¦‚ï¼Œå¤–å–åº”ç”¨ä¸­ï¼Œç”¨æˆ·å¯é€šè¿‡è¯¥åŠŸèƒ½æŸ¥æ‰¾é™„è¿‘å¯é…é€çš„é¤å…ï¼Œé¤å…ä½ç½®ä¿¡æ¯äº‹å…ˆå­˜å‚¨åœ¨ Redis çš„ Geospatial ç»“æ„ä¸­ï¼Œé€šè¿‡ GEORADIUS å‘½ä»¤æŸ¥è¯¢ã€‚ è·ç¦»è®¡ç®—ï¼šè®¡ç®—ä¸¤ä¸ªåœ°ç†ä½ç½®ä¹‹é—´çš„è·ç¦»ã€‚å¦‚åœ¨ç‰©æµé…é€ä¸­ï¼Œè®¡ç®—ä»“åº“ä¸é…é€åœ°å€çš„è·ç¦»ï¼Œä¸ºé…é€è·¯çº¿è§„åˆ’æä¾›æ•°æ®æ”¯æŒã€‚é€šè¿‡ GEODIST å‘½ä»¤å®ç°è·ç¦»è®¡ç®—ã€‚ ç›¸å…³å‘½ä»¤ GEOADD key longitude latitude member [longitude latitude member\u0026hellip;]ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªåœ°ç†ä½ç½®ä¿¡æ¯æ·»åŠ åˆ°æŒ‡å®š key ä¸­ã€‚ GEODIST key member1 member2 [m|km|ft|mi]ï¼šè®¡ç®—ä¸¤ä¸ªåœ°ç†ä½ç½®ä¹‹é—´çš„è·ç¦»ï¼Œå•ä½å¯æŒ‡å®šä¸ºç±³ï¼ˆmï¼‰ã€åƒç±³ï¼ˆkmï¼‰ã€è‹±å°ºï¼ˆftï¼‰ã€è‹±é‡Œï¼ˆmiï¼‰ã€‚ GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]ï¼šä»¥æŒ‡å®šç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œè¿”å›æŒ‡å®šåŠå¾„å†…çš„åœ°ç†ä½ç½®ï¼Œå¯é€‰æ‹©è¿”å›åœ°ç†ä½ç½®çš„åæ ‡ã€è·ç¦»ã€å“ˆå¸Œå€¼ï¼ŒCOUNT é€‰é¡¹å¯é™åˆ¶è¿”å›ç»“æœæ•°é‡ã€‚ GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]ï¼šä¸ GEORADIUS ç±»ä¼¼ï¼Œåªæ˜¯ä»¥å·²å­˜åœ¨çš„åœ°ç†ä½ç½®æˆå‘˜ä¸ºä¸­å¿ƒè¿›è¡ŒæŸ¥è¯¢ã€‚ 1. ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ å—¯ï¼Œæˆ‘æƒ³ä¸€ä¸‹ã€‚ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºå­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®å› æ­¤ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ° DB å»æŸ¥è¯¢ï¼Œå¯èƒ½å¯¼è‡´ DB æŒ‚æ‰ã€‚è¿™ç§æƒ…å†µå¤§æ¦‚ç‡æ˜¯é­åˆ°äº†æ”»å‡»ã€‚è§£å†³æ–¹æ¡ˆçš„è¯ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä¼šç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è§£å†³å®ƒã€‚\nè§£å†³æ–¹æ³•1ï¼šç¼“å­˜ç©ºå¯¹è±¡\nå½“æŸ¥è¯¢æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¸æ˜¯ç›´æ¥è¿”å›ç©ºï¼Œè€Œæ˜¯å°†ä¸€ä¸ªç©ºå¯¹è±¡ï¼ˆæ¯”å¦‚ä¸€ä¸ªç©ºçš„JSONå¯¹è±¡æˆ–è€…ä¸€ä¸ªæ ‡è®°å€¼ï¼‰å­˜å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„TTLï¼ˆå­˜æ´»æ—¶é—´ï¼‰ã€‚è¿™æ ·ï¼Œå½“ä¸‹æ¬¡å†æŸ¥è¯¢ç›¸åŒçš„æ•°æ®æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–åˆ°è¿™ä¸ªç©ºå¯¹è±¡ï¼Œè€Œæ— éœ€å†æ¬¡æŸ¥è¯¢æ•°æ®åº“ï¼Œä»è€Œé¿å…äº†å¯¹æ•°æ®åº“çš„æ— æ•ˆè®¿é—®ã€‚\n**ç¼ºç‚¹ï¼š**è™½ç„¶å®ç°ç®€å•ï¼Œä½†å®ƒä¼šå¸¦æ¥ä¸€äº›é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œå› ä¸ºå³ä½¿æ˜¯ç©ºå¯¹è±¡ï¼Œä¹Ÿéœ€è¦å ç”¨ä¸€å®šçš„ç¼“å­˜ç©ºé—´ã€‚æ­¤å¤–ï¼Œç”±äºè®¾ç½®äº†TTLï¼Œåœ¨ç¼“å­˜è¿‡æœŸä¹‹å‰ï¼Œå³ä½¿æ•°æ®åº“ä¸­å·²ç»æ·»åŠ äº†ç›¸åº”çš„æ•°æ®ï¼ŒæŸ¥è¯¢æ—¶ä»ç„¶ä¼šè¿”å›ç©ºå¯¹è±¡ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´çŸ­æœŸå†…çš„æ•°æ®ä¸ä¸€è‡´ã€‚\nè§£å†³æ–¹æ³•2ï¼šå¸ƒéš†è¿‡æ»¤å™¨\nå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚æˆ‘ä»¬å½“æ—¶ä½¿ç”¨çš„æ˜¯Redissonå®ç°çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚å®ƒçš„åº•å±‚åŸç†æ˜¯ï¼Œå…ˆåˆå§‹åŒ–ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯äºŒè¿›åˆ¶0æˆ–1ã€‚ä¸€å¼€å§‹éƒ½æ˜¯0ï¼Œå½“ä¸€ä¸ªkeyæ¥äº†ä¹‹åï¼Œç»è¿‡3æ¬¡hashè®¡ç®—ï¼Œæ¨¡æ•°ç»„é•¿åº¦æ‰¾åˆ°æ•°æ®çš„ä¸‹æ ‡ï¼Œç„¶åæŠŠæ•°ç»„ä¸­åŸæ¥çš„0æ”¹ä¸º1ã€‚è¿™æ ·ï¼Œä¸‰ä¸ªæ•°ç»„çš„ä½ç½®å°±èƒ½æ ‡æ˜ä¸€ä¸ªkeyçš„å­˜åœ¨ã€‚å½“éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨æ—¶ï¼Œé€šè¿‡ç›¸åŒçš„å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºè¯¥å…ƒç´ åœ¨ä½æ•°ç»„ä¸Šçš„ä½ç½®ï¼Œå¦‚æœè¿™äº›ä½ç½®ä¸Šçš„å€¼éƒ½ä¸º1ï¼Œåˆ™è®¤ä¸ºè¯¥å…ƒç´ å¯èƒ½å­˜åœ¨ï¼›å¦‚æœä»»ä½•ä¸€ä¸ªä½ç½®ä¸Šçš„å€¼ä¸º0ï¼Œåˆ™è¯¥å…ƒç´ ä¸€å®šä¸å­˜åœ¨ã€‚åœ¨ç¼“å­˜ç©¿é€çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“ä¸­å­˜åœ¨çš„æ•°æ®å¯¹åº”çš„keyå­˜å…¥å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå½“æŸ¥è¯¢ä¸€ä¸ªkeyæ—¶ï¼Œå…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¯¥keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…æŸ¥è¯¢æ•°æ®åº“ã€‚\nä¼˜ç‚¹ï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„å†…å­˜å ç”¨ç›¸å¯¹è¾ƒå°‘ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¸€ä¸ªä½æ•°ç»„æ¥å­˜å‚¨ä¿¡æ¯ï¼Œç›¸æ¯”ç›´æ¥ç¼“å­˜å¤§é‡çš„keyå€¼ï¼ŒèŠ‚çœäº†å¾ˆå¤šç©ºé—´ã€‚è€Œä¸”å®ƒæ²¡æœ‰å¤šä½™çš„keyï¼Œä¸ä¼šåƒç¼“å­˜ç©ºå¯¹è±¡é‚£æ ·å ç”¨é¢å¤–çš„ç¼“å­˜èµ„æºã€‚\nç¼ºç‚¹ï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç†è§£å’Œä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ä»¥åŠä½æ•°ç»„ç­‰æ•°æ®ç»“æ„ã€‚è€Œä¸”å®ƒå­˜åœ¨è¯¯åˆ¤çš„å¯èƒ½ï¼Œå³å½“å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªkeyå­˜åœ¨æ—¶ï¼Œå®é™…ä¸Šè¯¥keyå¯èƒ½å¹¶ä¸å­˜åœ¨ï¼Œè¿™å°±å¢åŠ äº†ç©¿é€çš„é£é™©ã€‚å¦å¤–ï¼Œå¸ƒéš†è¿‡æ»¤å™¨æ— æ³•åˆ é™¤æ•°æ®ï¼Œä¸€æ—¦ä¸€ä¸ªkeyè¢«æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå°±æ— æ³•å•ç‹¬å°†å…¶ç§»é™¤ï¼Œè¿™åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚\n2. ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œä¹Ÿè¢«ç§°ä¸ºçƒ­ç‚¹ Key é—®é¢˜ã€‚å®ƒæ˜¯æŒ‡åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªè¢«é¢‘ç¹è®¿é—®ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„ Key çªç„¶å¤±æ•ˆäº†ï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥ç©¿é€åˆ°æ•°æ®åº“ï¼Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ï¼Œä»è€Œå¼•å‘ç³»ç»Ÿæ€§èƒ½ä¸‹é™ç”šè‡³å´©æºƒçš„æƒ…å†µã€‚\nè§£å†³æ–¹æ³•1ï¼šåŸºäºäº’æ–¥é”çš„è§£å†³æ–¹æ¡ˆ\nå°±æ˜¯å½“çº¿ç¨‹æŸ¥è¯¢ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œå°è¯•å»è·å–äº’æ–¥é”ï¼Œç„¶ååœ¨é‡å»ºç¼“å­˜æ•°æ®ï¼Œåœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šå»å°è¯•è·å–äº’æ–¥é”ï¼Œå¦‚æœå¤±è´¥å°±ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œå¹¶ç»§ç»­ï¼Œä¸æ–­é‡è¯•ï¼Œç­‰åˆ°æ•°æ®é‡å»ºæˆåŠŸï¼Œå…¶ä»–çº¿ç¨‹å°±å¯ä»¥å‘½ä¸­æ•°æ®äº†ã€‚è¿™æ ·å°±ä¸ä¼šå¯¼è‡´ç¼“å­˜å‡»ç©¿ã€‚\nè¿™é‡Œæˆ‘ä»¬è·å–äº’æ–¥é”å¯ä»¥ä½¿ç”¨redisä¸­stringç±»å‹ä¸­çš„setnxæ–¹æ³• ï¼Œå› ä¸ºsetnxæ–¹æ³•æ˜¯åœ¨keyä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰å¯ä»¥åˆ›å»ºæˆåŠŸçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å»ºç¼“å­˜æ—¶ï¼Œä½¿ç”¨setnxæ¥å°†é”çš„æ•°æ®åŠ å…¥åˆ°redisä¸­ï¼Œå¹¶ä¸”é€šè¿‡åˆ¤æ–­è¿™ä¸ªé”çš„keyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±æ˜¯è·å–é”æˆåŠŸï¼Œå¤±è´¥å°±æ˜¯è·å–å¤±è´¥ï¼Œè¿™æ ·åˆšå¥½å¯ä»¥å®ç°äº’æ–¥é”çš„æ•ˆæœã€‚é‡Šæ”¾é”å°±æ›´ç®€å•äº†ï¼Œç›´æ¥åˆ é™¤æˆ‘ä»¬å­˜å…¥çš„é”çš„ Key æ¥é‡Šæ”¾é”ã€‚\nä¼˜ç‚¹ï¼š\nâ€‹\t**å†…å­˜å ç”¨å°ï¼š**ç”±äºä¸éœ€è¦é¢å¤–å­˜å‚¨è¿‡æœŸæ—¶é—´ç­‰ä¿¡æ¯ï¼Œå†…å­˜å ç”¨ç›¸å¯¹è¾ƒå°‘ã€‚\nâ€‹\t**ä¸€è‡´æ€§é«˜ï¼š**æ‰€æœ‰çº¿ç¨‹æœ€ç»ˆéƒ½èƒ½è·å–åˆ°æœ€æ–°çš„ç¼“å­˜æ•°æ®ï¼Œæ•°æ®ä¸€è‡´æ€§å¾—åˆ°äº†ä¿è¯ã€‚\nâ€‹\t**å®ç°ç®€å•ï¼š**é€šè¿‡ Redis çš„ SETNX æ–¹æ³•å’Œç®€å•çš„é€»è¾‘æ§åˆ¶ï¼Œå°±å¯ä»¥å®ç°äº’æ–¥é”ï¼Œå®ç°èµ·æ¥ç›¸å¯¹å®¹æ˜“ã€‚\nç¼ºç‚¹ï¼š\nâ€‹\t**æ€§èƒ½è¾ƒä½ï¼š**å¤šä¸ªçº¿ç¨‹åœ¨è·å–é”å¤±è´¥åä¼šä¸æ–­é‡è¯•ï¼Œå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚\nâ€‹\t**å®¹æ˜“å‡ºç°æ­»é”ï¼š**å¦‚æœåœ¨è·å–é”åï¼Œçº¿ç¨‹å‡ºç°å¼‚å¸¸æˆ–é•¿æ—¶é—´æœªé‡Šæ”¾é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹ä¸€ç›´ç­‰å¾…ï¼Œä»è€Œå‡ºç°æ­»é”çš„æƒ…å†µã€‚\nè§£å†³æ–¹æ³•2ï¼šåŸºäºé€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜\nåŸç†ï¼šç»™ Redis ç¼“å­˜å­—æ®µä¸­æ·»åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´å­—æ®µï¼Œè€Œä¸æ˜¯ç›´æ¥è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ã€‚å½“çº¿ç¨‹æŸ¥è¯¢ç¼“å­˜çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦å·²ç»è¿‡æœŸã€‚å¦‚æœè¿‡æœŸï¼Œå°±è·å–äº’æ–¥é”ï¼Œå¹¶å¼€å¯ä¸€ä¸ªå­çº¿ç¨‹è¿›è¡Œç¼“å­˜é‡å»ºä»»åŠ¡ï¼Œç›´åˆ°å­çº¿ç¨‹å®Œæˆä»»åŠ¡åï¼Œé‡Šæ”¾é”ã€‚åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œå…¶ä»–çº¿ç¨‹è·å–äº’æ–¥é”å¤±è´¥åï¼Œå¹¶ä¸æ˜¯ç»§ç»­ç­‰å¾…é‡è¯•ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›æ—§æ•°æ®ã€‚\nå®ç°æ–¹å¼ï¼šæ‰€è°“çš„é€»è¾‘è¿‡æœŸï¼Œç±»ä¼¼äºé€»è¾‘åˆ é™¤ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„è¿‡æœŸï¼Œè€Œæ˜¯æ–°å¢ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥æ ‡è®° Key çš„è¿‡æœŸæ—¶é—´ã€‚è¿™æ ·èƒ½å¤Ÿé¿å… Key è¿‡æœŸè€Œè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä»è€Œä½¿æ•°æ®æ°¸ä¸è¿‡æœŸï¼Œä»æ ¹æœ¬ä¸Šè§£å†³å› ä¸ºçƒ­ç‚¹ Key è¿‡æœŸå¯¼è‡´çš„ç¼“å­˜å‡»ç©¿ã€‚ä¸€èˆ¬åœ¨ææ´»åŠ¨æ—¶ï¼Œæ¯”å¦‚æŠ¢ä¼˜æƒ åˆ¸ã€ç§’æ€ç­‰åœºæ™¯ï¼Œè¯·æ±‚é‡æ¯”è¾ƒå¤§å°±å¯ä»¥ä½¿ç”¨é€»è¾‘è¿‡æœŸï¼Œç­‰æ´»åŠ¨ä¸€è¿‡å°±æ‰‹åŠ¨åˆ é™¤é€»è¾‘è¿‡æœŸçš„æ•°æ®ã€‚é€»è¾‘è¿‡æœŸä¸€å®šè¦å…ˆè¿›è¡Œæ•°æ®é¢„çƒ­ï¼Œå°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚é€»è¾‘è¿‡æœŸæ—¶é—´æ ¹æ®å…·ä½“ä¸šåŠ¡è€Œå®šï¼Œé€»è¾‘è¿‡æœŸè¿‡é•¿ï¼Œä¼šé€ æˆç¼“å­˜æ•°æ®çš„å †ç§¯ï¼Œæµªè´¹å†…å­˜ï¼›è¿‡çŸ­ä¼šé€ æˆé¢‘ç¹ç¼“å­˜é‡å»ºï¼Œé™ä½æ€§èƒ½ã€‚æ‰€ä»¥è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´æ—¶éœ€è¦å®é™…æµ‹è¯•å’Œè¯„ä¼°ä¸åŒå‚æ•°ä¸‹çš„æ€§èƒ½å’Œèµ„æºæ¶ˆè€—æƒ…å†µï¼Œå¯ä»¥é€šè¿‡è§‚å¯Ÿç³»ç»Ÿçš„è¡¨ç°ï¼Œåœ¨ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚\nä¼˜ç‚¹ï¼š\nâ€‹\tæ€§èƒ½é«˜ï¼šé€šè¿‡å¼€å¯å­çº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œä½¿åŸæ¥çš„åŒæ­¥é˜»å¡å˜æˆå¼‚æ­¥ï¼Œæé«˜äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åº”å¯¹é«˜å¹¶å‘åœºæ™¯ã€‚\nç¼ºç‚¹ï¼š\nâ€‹\tå†…å­˜å ç”¨è¾ƒå¤§ï¼šéœ€è¦é¢å¤–å­˜å‚¨è¿‡æœŸæ—¶é—´å­—æ®µï¼Œå¢åŠ äº†å†…å­˜çš„å ç”¨ã€‚\nâ€‹\tå®¹æ˜“å‡ºç°è„è¯»ï¼šåœ¨ç¼“å­˜é‡å»ºæœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½ä¼šè·å–åˆ°æ—§æ•°æ®ï¼Œä»è€Œå¯¼è‡´è„è¯»çš„æƒ…å†µã€‚\n3. ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œå¤§é‡ç¼“å­˜ Key åŒæ—¶å¤±æ•ˆï¼Œæˆ–è€…ç¼“å­˜æœåŠ¡ï¼ˆå¦‚ Redisï¼‰æ•´ä½“å®•æœºï¼Œå¯¼è‡´åŸæœ¬åº”è¯¥ä»ç¼“å­˜è·å–çš„æ•°æ®å…¨éƒ¨ç©¿é€åˆ°æ•°æ®åº“ï¼Œä»è€Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å‹åŠ›ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´æ•°æ®åº“å´©æºƒã€‚è¿™ç§æƒ…å†µé€šå¸¸ä¼šå¼•å‘æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ï¼Œç”šè‡³å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚\nå…·ä½“æ¥è¯´ï¼Œç¼“å­˜é›ªå´©å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š\nå¤§é‡ Key åŒæ—¶å¤±æ•ˆï¼šå¦‚æœç¼“å­˜ä¸­çš„ Key éƒ½è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆåœ¨æŸä¸€æ—¶åˆ»ï¼Œè¿™äº› Key ä¼šåŒæ—¶å¤±æ•ˆã€‚æ­¤æ—¶ï¼Œå¤§é‡è¯·æ±‚ä¼šåŒæ—¶æŸ¥è¯¢æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“è´Ÿè½½ç¬é—´å¢åŠ ã€‚ ç¼“å­˜æœåŠ¡å®•æœºï¼šå¦‚æœæ•´ä¸ªç¼“å­˜æœåŠ¡ï¼ˆå¦‚ Redis é›†ç¾¤ï¼‰å®•æœºï¼Œæ‰€æœ‰åŸæœ¬ä¾èµ–ç¼“å­˜çš„è¯·æ±‚éƒ½ä¼šç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼ŒåŒæ ·ä¼šç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›ã€‚ è§£å†³æ–¹æ¡ˆ1ï¼š ç»™ä¸åŒçš„ Key è®¾ç½®éšæœºçš„ TTL\nä¸ºäº†é¿å…å¤§é‡ Key åŒæ—¶å¤±æ•ˆï¼Œå¯ä»¥åœ¨è®¾ç½®ç¼“å­˜æ—¶ï¼Œä¸ºæ¯ä¸ª Key çš„ TTLï¼ˆè¿‡æœŸæ—¶é—´ï¼‰æ·»åŠ ä¸€ä¸ªéšæœºå€¼ã€‚ä¾‹å¦‚ï¼ŒåŸæœ¬çš„è¿‡æœŸæ—¶é—´æ˜¯ 10 åˆ†é’Ÿï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šéšæœºå¢åŠ  1-5 åˆ†é’Ÿã€‚è¿™æ ·ï¼Œæ¯ä¸ª Key çš„è¿‡æœŸæ—¶é—´å°±ä¼šåˆ†æ•£å¼€æ¥ï¼Œå¾ˆéš¾åŒæ—¶å¤±æ•ˆã€‚\nè§£å†³æ–¹æ¡ˆ2ï¼š åˆ©ç”¨ Redis é›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§\né€šè¿‡éƒ¨ç½² Redis é›†ç¾¤ï¼Œå°†ç¼“å­˜æ•°æ®åˆ†æ•£åˆ°å¤šä¸ª Redis å®ä¾‹ä¸­ã€‚å³ä½¿æŸä¸ª Redis å®ä¾‹å®•æœºï¼Œå…¶ä»–å®ä¾‹ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä»è€Œæé«˜ç¼“å­˜æœåŠ¡çš„æ•´ä½“å¯ç”¨æ€§ã€‚\nè§£å†³æ–¹æ¡ˆ3ï¼š æ·»åŠ é™çº§é™æµç­–ç•¥\nåœ¨ç¼“å­˜å±‚å’Œæ•°æ®åº“å±‚ä¹‹é—´æ·»åŠ é™çº§é™æµç­–ç•¥ï¼Œå½“è¯·æ±‚é‡è¿‡é«˜æ—¶ï¼Œé€šè¿‡å¿«é€Ÿå¤±è´¥æœºåˆ¶ç›´æ¥è¿”å›é”™è¯¯æˆ–é»˜è®¤å€¼ï¼Œé¿å…è¯·æ±‚ç©¿é€åˆ°æ•°æ®åº“ã€‚\nè§£å†³æ–¹æ¡ˆ4ï¼š æ·»åŠ å¤šçº§ç¼“å­˜\nåœ¨åº”ç”¨å±‚æ·»åŠ å¤šçº§ç¼“å­˜ï¼Œé™¤äº†æœ¬åœ°ç¼“å­˜ï¼ˆå¦‚ Ehcacheï¼‰å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰å¤–ï¼Œè¿˜å¯ä»¥åœ¨æ•°æ®åº“å±‚æ·»åŠ ç¼“å­˜ï¼ˆå¦‚æ•°æ®åº“çš„æŸ¥è¯¢ç¼“å­˜ï¼‰ã€‚è¿™æ ·ï¼Œå³ä½¿åˆ†å¸ƒå¼ç¼“å­˜å¤±æ•ˆï¼Œè¿˜å¯ä»¥é€šè¿‡æœ¬åœ°ç¼“å­˜æˆ–æ•°æ®åº“ç¼“å­˜æ¥ç¼“è§£å‹åŠ›ã€‚\nå®ç°æ–¹å¼ï¼š\nåœ¨åº”ç”¨å±‚ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆå¦‚ Ehcacheï¼‰ä½œä¸ºç¬¬ä¸€çº§ç¼“å­˜ã€‚ åœ¨åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ä½œä¸ºç¬¬äºŒçº§ç¼“å­˜ã€‚ åœ¨æ•°æ®åº“å±‚ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ä½œä¸ºç¬¬ä¸‰çº§ç¼“å­˜ã€‚ 4. redisä½œä¸ºç¼“å­˜ï¼Œmysqlçš„æ•°æ®å¦‚ä½•ä¸redisè¿›è¡ŒåŒæ­¥å‘¢ï¼Ÿï¼ˆåŒå†™ä¸€è‡´æ€§ï¼‰ æˆ‘ä»¬å½“æ—¶é‡‡ç”¨äº†è¯»å†™é”æ¥ä¿è¯å¼ºä¸€è‡´æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Redisson å®ç°çš„è¯»å†™é”ã€‚\nåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ å…±äº«é”ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¯»è¯»ä¸äº’æ–¥ï¼Œä½†è¯»å†™äº’æ–¥ã€‚è¿™æ„å‘³ç€å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–æ•°æ®ï¼Œä½†å¦‚æœæœ‰çº¿ç¨‹æ­£åœ¨å†™å…¥æ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½è¯»å–ï¼Œä»è€Œé¿å…äº†è„è¯»ã€‚è€Œåœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ æ’ä»–é”ï¼Œè¿™æ ·æ— è®ºæ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œï¼Œéƒ½ä¼šè¢«äº’æ–¥ï¼Œç¡®ä¿åœ¨å†™æ•°æ®çš„åŒæ—¶ï¼Œä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹è¯»å–æ•°æ®ï¼Œè¿›ä¸€æ­¥é¿å…äº†è„æ•°æ®ã€‚\nè¿™é‡Œé¢éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯»æ–¹æ³•å’Œå†™æ–¹æ³•ä¸Šéœ€è¦ä½¿ç”¨åŒä¸€æŠŠé”æ‰è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ä»»ä½•æ—¶åˆ»ï¼Œæ•°æ®çš„ä¸€è‡´æ€§éƒ½èƒ½å¾—åˆ°ä¿è¯ã€‚\n5. é‚£è¿™ä¸ªæ’ä»–é”æ˜¯å¦‚ä½•ä¿è¯è¯»å†™ã€è¯»è¯»äº’æ–¥çš„å‘¢ï¼Ÿ å…¶å®æ’ä»–é”åº•å±‚ä½¿ç”¨çš„æ˜¯ SETNXï¼Œå®ƒä¿è¯äº†åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œé”ä½çš„æ–¹æ³•ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†æ’ä»–é”åï¼Œå…¶ä»–çº¿ç¨‹æ— è®ºæ˜¯å°è¯•è¯»å–è¿˜æ˜¯å†™å…¥ï¼Œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚\n5. ä½ å¬è¯´è¿‡å»¶æ—¶åŒåˆ å—ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨å®ƒå‘¢ï¼Ÿ å»¶è¿ŸåŒåˆ ï¼Œå¦‚æœæ˜¯å†™æ“ä½œï¼Œæˆ‘ä»¬å…ˆæŠŠç¼“å­˜ä¸­çš„æ•°æ®åˆ é™¤ï¼Œç„¶åæ›´æ–°æ•°æ®åº“ï¼Œæœ€åå†å»¶æ—¶åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ã€‚å…¶ä¸­ï¼Œè¿™ä¸ªå»¶æ—¶å¤šä¹…ä¸å¤ªå¥½ç¡®å®šã€‚åœ¨å»¶æ—¶çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°è„æ•°æ®ï¼Œå¹¶ä¸èƒ½ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨å®ƒã€‚\n6. Redis æ•°æ®çš„æŒä¹…åŒ–æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ å€™é€‰äººï¼šåœ¨ Redis ä¸­æä¾›äº†ä¸¤ç§ä¸»è¦çš„æ•°æ®æŒä¹…åŒ–æ–¹å¼ï¼šRDBï¼ˆRedis Databaseï¼‰å’Œ AOFï¼ˆAppend Only Fileï¼‰ã€‚\n7. è¿™ä¸¤ç§æŒä¹…åŒ–æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ å€™é€‰äººï¼šRDB æ˜¯ä¸€ä¸ªå¿«ç…§æ–‡ä»¶ï¼Œå®ƒä¼šå®šæœŸå°† Redis å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ª RDB æ–‡ä»¶ä¸­ã€‚å½“ Redis å®ä¾‹å®•æœºåï¼Œå¯ä»¥ä» RDB æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ã€‚RDB æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ï¼Œä½“ç§¯ç›¸å¯¹è¾ƒå°ï¼Œæ¢å¤é€Ÿåº¦è¾ƒå¿«ï¼Œä½†å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä¹‹åçš„æ•°æ®ã€‚\nAOF æ˜¯è¿½åŠ æ–‡ä»¶ï¼Œå®ƒä¼šå°† Redis æ‰§è¡Œçš„æ¯ä¸ªå†™å‘½ä»¤è¿½åŠ åˆ° AOF æ–‡ä»¶ä¸­ã€‚å½“ Redis å®ä¾‹å®•æœºåï¼Œå¯ä»¥ä» AOF æ–‡ä»¶ä¸­é‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚AOF æ–‡ä»¶æ˜¯æ–‡æœ¬æ ¼å¼çš„ï¼Œä½“ç§¯ç›¸å¯¹è¾ƒå¤§ï¼Œæ¢å¤é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†æ•°æ®ä¸¢å¤±çš„é£é™©æ›´å°ã€‚\n8. è¿™ä¸¤ç§æ–¹å¼ï¼Œå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«å‘¢ï¼Ÿ å€™é€‰äººï¼šRDB æ¢å¤é€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½“ç§¯è¾ƒå°ï¼ŒåŠ è½½å’Œæ¢å¤æ•°æ®çš„é€Ÿåº¦é€šå¸¸æ¯” AOF å¿«ã€‚ç„¶è€Œï¼ŒRDB çš„ç¼ºç‚¹æ˜¯å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä¹‹åçš„æ•°æ®ã€‚AOF æ¢å¤é€Ÿåº¦è¾ƒæ…¢ï¼Œå› ä¸ºå®ƒéœ€è¦é‡æ–°æ‰§è¡Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰å‘½ä»¤æ¥æ¢å¤æ•°æ®ï¼Œä½†å®ƒçš„æ•°æ®å®Œæ•´æ€§æ›´é«˜ï¼Œä¸¢å¤±æ•°æ®çš„é£é™©æ›´å°ã€‚\nåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»“åˆä½¿ç”¨ RDB å’Œ AOF æ¥å®ç°æ•°æ®çš„æŒä¹…åŒ–ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¼šåœ¨é¡¹ç›®ä¸­è®¾ç½® RDB æ¯éš”ä¸€å®šæ—¶é—´ï¼ˆå¦‚æ¯å°æ—¶ï¼‰ç”Ÿæˆä¸€æ¬¡å¿«ç…§ï¼ŒåŒæ—¶å¼€å¯ AOF å¹¶è®¾ç½®ä¸ºæ¯ç§’æ‰¹é‡å†™å…¥ä¸€æ¬¡å‘½ä»¤ã€‚è¿™æ ·å¯ä»¥åœ¨ä¿è¯æ•°æ®æ¢å¤é€Ÿåº¦çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚\n9. ä½ ä»¬é¡¹ç›®ä¸­å…·ä½“æ˜¯å¦‚ä½•è®¾ç½®çš„å‘¢ï¼Ÿ å€™é€‰äººï¼šåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹é…ç½®ï¼š\nRDB é…ç½®ï¼š\næˆ‘ä»¬è®¾ç½®äº† RDB æ¯å°æ—¶ç”Ÿæˆä¸€æ¬¡å¿«ç…§ï¼Œè¿™æ ·å¯ä»¥åœ¨ Redis å®ä¾‹å®•æœºæ—¶ï¼Œä»æœ€è¿‘çš„å¿«ç…§æ–‡ä»¶ä¸­æ¢å¤å¤§éƒ¨åˆ†æ•°æ®ã€‚\né…ç½®ç¤ºä¾‹ï¼š\n1 save 3600 1 AOF é…ç½®ï¼š\næˆ‘ä»¬å¼€å¯äº† AOFï¼Œå¹¶è®¾ç½®äº†æ¯ç§’æ‰¹é‡å†™å…¥ä¸€æ¬¡å‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥åœ¨ Redis å®ä¾‹å®•æœºæ—¶ï¼Œä» AOF æ–‡ä»¶ä¸­æ¢å¤æœ€è¿‘çš„å†™æ“ä½œã€‚\né…ç½®ç¤ºä¾‹ï¼š\n1 2 appendonly yes appendfsync everysec é€šè¿‡è¿™ç§é…ç½®ï¼Œæˆ‘ä»¬æ—¢ä¿è¯äº†æ•°æ®æ¢å¤çš„é€Ÿåº¦ï¼Œåˆæœ€å¤§é™åº¦åœ°å‡å°‘äº†æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚åœ¨å®é™…è¿è¡Œä¸­ï¼Œè¿™ç§ç»„åˆæ–¹å¼è¡¨ç°å‡ºäº†è‰¯å¥½çš„æ€§èƒ½å’Œå¯é æ€§ã€‚\n10. Redisçš„æ•°æ®è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ å€™é€‰äººï¼šå—¯~ï¼Œåœ¨redisä¸­æä¾›äº†ä¸¤ç§æ•°æ®è¿‡æœŸåˆ é™¤ç­–ç•¥ã€‚ç¬¬ä¸€ç§æ˜¯æƒ°æ€§åˆ é™¤ã€‚åœ¨è®¾ç½®è¯¥keyè¿‡æœŸæ—¶é—´åï¼Œæˆ‘ä»¬ä¸å»ç®¡å®ƒã€‚å½“éœ€è¦è¯¥keyæ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸã€‚å¦‚æœè¿‡æœŸï¼Œæˆ‘ä»¬å°±åˆ æ‰å®ƒï¼›åä¹‹ï¼Œè¿”å›è¯¥keyã€‚ç¬¬äºŒç§æ˜¯å®šæœŸåˆ é™¤ã€‚å°±æ˜¯è¯´ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å°±å¯¹ä¸€äº›keyè¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤é‡Œé¢è¿‡æœŸçš„keyã€‚å®šæœŸæ¸…ç†çš„ä¸¤ç§æ¨¡å¼æ˜¯ï¼š1) SLOWæ¨¡å¼ï¼Œæ˜¯å®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œé¢‘ç‡é»˜è®¤ä¸º10hzï¼Œæ¯æ¬¡ä¸è¶…è¿‡25msï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶redis.confçš„hzé€‰é¡¹æ¥è°ƒæ•´è¿™ä¸ªæ¬¡æ•°ï¼›2) FASTæ¨¡å¼ï¼Œæ‰§è¡Œé¢‘ç‡ä¸å›ºå®šï¼Œæ¯æ¬¡äº‹ä»¶å¾ªç¯ä¼šå°è¯•æ‰§è¡Œï¼Œä½†ä¸¤æ¬¡é—´éš”ä¸ä½äº2msï¼Œæ¯æ¬¡è€—æ—¶ä¸è¶…è¿‡1msã€‚Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯ï¼šæƒ°æ€§åˆ é™¤ + å®šæœŸåˆ é™¤ä¸¤ç§ç­–ç•¥é…åˆä½¿ç”¨ã€‚\n11. Redisçš„æ•°æ®æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ å€™é€‰äººï¼šå—¯ï¼Œè¿™ä¸ªåœ¨redisä¸­æä¾›äº†å¾ˆå¤šç§ï¼Œé»˜è®¤æ˜¯noevictionï¼Œä¸åˆ é™¤ä»»ä½•æ•°æ®ï¼Œå†…éƒ¨ä¸è¶³æ—¶ç›´æ¥æŠ¥é”™ã€‚è¿™ä¸ªå¯ä»¥åœ¨redisçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚é‡Œé¢æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼šä¸€ä¸ªæ˜¯LRUï¼Œå¦å¤–ä¸€ä¸ªæ˜¯LFUã€‚LRUçš„æ„æ€å°±æ˜¯æœ€å°‘æœ€è¿‘ä½¿ç”¨ã€‚å®ƒä¼šç”¨å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ã€‚è¿™ä¸ªå€¼è¶Šå¤§ï¼Œåˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚LFUçš„æ„æ€æ˜¯æœ€å°‘é¢‘ç‡ä½¿ç”¨ã€‚å®ƒä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ã€‚å€¼è¶Šå°ï¼Œæ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è®¾ç½®çš„æ˜¯allkeys-lruï¼Œå®ƒä¼šæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®è¿›è¡Œæ·˜æ±°ï¼ŒæŠŠä¸€äº›ç»å¸¸è®¿é—®çš„keyç•™åœ¨redisä¸­ã€‚\n12. æ•°æ®åº“æœ‰1000ä¸‡æ•°æ®ï¼ŒRedisåªèƒ½ç¼“å­˜20wæ•°æ®ã€‚å¦‚ä½•ä¿è¯Redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ å€™é€‰äººï¼šå—¯ï¼Œæˆ‘æƒ³ä¸€ä¸‹()ã€‚å¯ä»¥ä½¿ç”¨allkeys-lruï¼ˆæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼‰æ·˜æ±°ç­–ç•¥ã€‚é‚£ç•™ä¸‹æ¥çš„éƒ½æ˜¯ç»å¸¸è®¿é—®çš„çƒ­ç‚¹æ•°æ®ã€‚\n13. Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å€™é€‰äººï¼šå—¯~ï¼Œè¿™ä¸ªè¦çœ‹redisçš„æ•°æ®æ·˜æ±°ç­–ç•¥æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ˜¯é»˜è®¤çš„é…ç½®ï¼Œrediså†…å­˜ç”¨å®Œä»¥ååˆ™ç›´æ¥æŠ¥é”™ã€‚æˆ‘ä»¬å½“æ—¶è®¾ç½®çš„æ˜¯allkeys-lruç­–ç•¥ï¼ŒæŠŠæœ€è¿‘æœ€å¸¸è®¿é—®çš„æ•°æ®ç•™åœ¨ç¼“å­˜ä¸­ã€‚\n14. Redisåˆ†å¸ƒå¼é”å¦‚ä½•å®ç° åœ¨Redisä¸­æä¾›äº†ä¸€ä¸ªå‘½ä»¤SETNXï¼ˆSET if not existsï¼‰ã€‚ç”±äºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½¿ç”¨è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸€ä¸ªkeyè®¾ç½®å€¼ã€‚åœ¨æ²¡æœ‰è¿‡æœŸæˆ–åˆ é™¤keyçš„æ—¶å€™ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ˜¯ä¸èƒ½è®¾ç½®è¿™ä¸ªkeyçš„ã€‚\n15. é‚£ä½ å¦‚ä½•æ§åˆ¶Rediså®ç°åˆ†å¸ƒå¼é”çš„æœ‰æ•ˆæ—¶é•¿å‘¢ï¼Ÿ SETNXæŒ‡ä»¤ä¸å¥½æ§åˆ¶æœ‰æ•ˆæ—¶é•¿ã€‚æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯Redissonæ¡†æ¶å®ç°çš„ã€‚åœ¨Redissonä¸­éœ€è¦æ‰‹åŠ¨åŠ é”ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶é”çš„å¤±æ•ˆæ—¶é—´å’Œç­‰å¾…æ—¶é—´ã€‚å½“é”ä½çš„ä¸€ä¸ªä¸šåŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆæ—¶ï¼ŒRedissonä¼šå¼•å…¥ä¸€ä¸ªçœ‹é—¨ç‹—æœºåˆ¶ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥å½“å‰ä¸šåŠ¡æ˜¯å¦è¿˜æŒæœ‰é”ã€‚å¦‚æœæŒæœ‰ï¼Œå°±å¢åŠ åŠ é”çš„æŒæœ‰æ—¶é—´ã€‚å½“ä¸šåŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œéœ€è¦ä½¿ç”¨é‡Šæ”¾é”ã€‚åœ¨é«˜å¹¶å‘ä¸‹ï¼Œä¸€ä¸ªä¸šåŠ¡æ‰§è¡Œå¾ˆå¿«æ—¶ï¼Œå®¢æˆ·1æŒæœ‰é”ï¼Œå®¢æˆ·2æ¥äº†ä»¥åå¹¶ä¸ä¼šé©¬ä¸Šè¢«æ‹’ç»ï¼Œè€Œæ˜¯è‡ªæ—‹ä¸æ–­å°è¯•è·å–é”ã€‚å¦‚æœå®¢æˆ·1é‡Šæ”¾ä¹‹åï¼Œå®¢æˆ·2å°±å¯ä»¥é©¬ä¸ŠæŒæœ‰é”ï¼Œæ€§èƒ½ä¹Ÿå¾—åˆ°äº†æå‡ã€‚\n16. Redissonå®ç°çš„åˆ†å¸ƒå¼é”æ˜¯å¯é‡å…¥çš„å—ï¼Ÿå®ƒæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ æ˜¯çš„ï¼ŒRedisson å®ç°çš„åˆ†å¸ƒå¼é”æ˜¯å¯é‡å…¥çš„ã€‚å¯é‡å…¥é”å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€æŠŠé”è€Œä¸ä¼šè¢«é˜»å¡ï¼Œè¿™å¯ä»¥æœ‰æ•ˆé¿å…æ­»é”é—®é¢˜ï¼ŒåŒæ—¶è®©ä»£ç é€»è¾‘æ›´æ¸…æ™°ã€‚\nRedisson å¦‚ä½•å®ç°å¯é‡å…¥é”\nRedisson æ˜¯åŸºäº Redis çš„å“ˆå¸Œç»“æ„æ¥å­˜å‚¨é”ä¿¡æ¯çš„ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œæˆ‘ä»¬æœ‰ä¸ªå« â€œmyLockâ€ çš„é”ï¼Œè¿™å°±æ˜¯é”çš„å”¯ä¸€æ ‡è¯†ï¼Œç›¸å½“äºå“ˆå¸Œç»“æ„é‡Œçš„ Keyã€‚è€Œæ¯ä¸ªå°è¯•è·å–é”çš„çº¿ç¨‹éƒ½æœ‰è‡ªå·±å”¯ä¸€çš„æ ‡è¯†ï¼Œåƒçº¿ç¨‹ ID æˆ–è€… UUIDï¼Œè¿™å°±æ˜¯å“ˆå¸Œç»“æ„é‡Œçš„ Fieldã€‚çº¿ç¨‹è·å–é”çš„æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯é‡å…¥æ¬¡æ•°ï¼Œå°±æ˜¯å“ˆå¸Œç»“æ„é‡Œçš„ Valueã€‚\nåŠ é”è¿‡ç¨‹\nå½“ä¸€ä¸ªçº¿ç¨‹æƒ³å»è·å–é”çš„æ—¶å€™ï¼ŒRedisson é¦–å…ˆä¼šæ£€æŸ¥è¿™ä¸ªé”å¯¹åº”çš„ Key å­˜ä¸å­˜åœ¨ã€‚è¦æ˜¯ä¸å­˜åœ¨ï¼Œé‚£å°±è¯´æ˜å½“å‰æ²¡æœ‰çº¿ç¨‹æŒæœ‰è¿™æŠŠé”ï¼ŒRedisson å°±ä¼šåˆ›å»ºè¿™ä¸ªé”ï¼ŒæŠŠ Field è®¾æˆå½“å‰çº¿ç¨‹çš„æ ‡è¯†ï¼ŒValue è®¾ä¸º 1ï¼ŒåŒæ—¶ç»™é”è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚è¦æ˜¯é”å·²ç»å­˜åœ¨ï¼ŒRedisson å°±ä¼šå»æ£€æŸ¥ Field æ˜¯ä¸æ˜¯å’Œå½“å‰çº¿ç¨‹çš„æ ‡è¯†ä¸€æ ·ã€‚å¦‚æœä¸€æ ·ï¼Œé‚£å°±æ„å‘³ç€å½“å‰çº¿ç¨‹å·²ç»æŒæœ‰è¿™æŠŠé”äº†ï¼ŒRedisson å°±æŠŠ Value åŠ  1ï¼Œå¹¶ä¸”åˆ·æ–°é”çš„è¿‡æœŸæ—¶é—´ã€‚è¦æ˜¯ä¸ä¸€æ ·ï¼Œé‚£å°±è¡¨ç¤ºé”è¢«å…¶ä»–çº¿ç¨‹å ç€ï¼Œå½“å‰çº¿ç¨‹å°±å¾—ç­‰ç€é”è¢«é‡Šæ”¾ã€‚\né‡Šæ”¾é”è¿‡ç¨‹\né‡Šæ”¾é”çš„æ—¶å€™ï¼ŒRedisson ä¼šå…ˆçœ‹çœ‹é”çš„ Field å’Œå½“å‰çº¿ç¨‹æ ‡è¯†æ˜¯ä¸æ˜¯ä¸€è‡´ã€‚å¦‚æœä¸€è‡´ï¼Œå°±æŠŠ Value å‡ 1ã€‚è¦æ˜¯å‡å®Œä¹‹å Value å˜æˆ 0 äº†ï¼Œé‚£å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»å®Œå…¨é‡Šæ”¾äº†è¿™æŠŠé”ï¼ŒRedisson å°±æŠŠé”å¯¹åº”çš„ Key åˆ é™¤ã€‚è¦æ˜¯ Value è¿˜å¤§äº 0ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹è¿˜æœ‰é‡å…¥çš„æƒ…å†µï¼Œè¿˜æŒæœ‰é”ï¼ŒRedisson å°±åˆ·æ–°ä¸€ä¸‹é”çš„è¿‡æœŸæ—¶é—´ã€‚\né˜²æ­¢æ­»é”\nRedisson åœ¨é˜²æ­¢æ­»é”æ–¹é¢ä¹Ÿæœ‰å¾ˆå®ç”¨çš„æœºåˆ¶ã€‚ä¸€æ–¹é¢ï¼ŒåŠ é”çš„æ—¶å€™ä¼šç»™é”è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±ç®—æŸä¸ªçº¿ç¨‹å‡ºé—®é¢˜äº†ï¼Œä¸€ç›´ä¸é‡Šæ”¾é”ï¼Œåˆ°æ—¶é—´äº†é”ä¹Ÿä¼šè‡ªåŠ¨è¢«åˆ é™¤ã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒçš„å¯é‡å…¥æœºåˆ¶ä¹Ÿèƒ½é¿å…å› ä¸ºçº¿ç¨‹åµŒå¥—è°ƒç”¨å¯¼è‡´çš„æ­»é”ã€‚\nå¯é‡å…¥é”\nRedisson çš„å¯é‡å…¥é”ä¼˜åŠ¿ä¹Ÿå¾ˆæ˜æ˜¾ã€‚ä»çº¿ç¨‹å®‰å…¨è§’åº¦çœ‹ï¼Œåªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½é‡Šæ”¾é”ï¼Œè¿™å°±ä¿è¯äº†ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚åœ¨æ€§èƒ½ä¸Šï¼Œå®ƒé€šè¿‡ Lua è„šæœ¬ç¡®ä¿åŠ é”å’Œé‡Šæ”¾é”çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œé¿å…äº†ç«æ€æ¡ä»¶ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚\n17. Redissonå®ç°çš„åˆ†å¸ƒå¼é”èƒ½è§£å†³ä¸»ä»ä¸€è‡´æ€§çš„é—®é¢˜å—ï¼Ÿ ä¸èƒ½å®Œå…¨è§£å†³ã€‚åœ¨Redisçš„ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹ï¼Œä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ä¹‹é—´å­˜åœ¨æ•°æ®åŒæ­¥çš„å»¶è¿Ÿã€‚å½“ä¸»èŠ‚ç‚¹å®•æœºæ—¶ï¼Œä»èŠ‚ç‚¹å¯èƒ½ä¼šè¢«æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä½†æ­¤æ—¶é”æ•°æ®å¯èƒ½å°šæœªå®Œå…¨åŒæ­¥ï¼Œå¯¼è‡´é”å¤±æ•ˆã€‚\nä¾‹å¦‚ï¼Œå½“çº¿ç¨‹1åœ¨ä¸»èŠ‚ç‚¹ä¸ŠåŠ é”æˆåŠŸåï¼Œä¸»èŠ‚ç‚¹æ•°æ®è¿˜æœªå®Œå…¨åŒæ­¥åˆ°ä»èŠ‚ç‚¹ã€‚å¦‚æœæ­¤æ—¶ä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹è¢«æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œçº¿ç¨‹2å¯èƒ½ä¼šåœ¨æ–°çš„ä¸»èŠ‚ç‚¹ä¸ŠåŠ é”æˆåŠŸï¼Œå¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰ä¸€æŠŠé”ã€‚\n18. å¦‚æœä¸šåŠ¡éè¦ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™ä¸ªè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ ä½¿ç”¨Redissonçš„multiLock Redissonæä¾›äº†multiLockæ–¹æ¡ˆæ¥è§£å†³ä¸»ä»ä¸€è‡´æ€§é—®é¢˜ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š\nåœ¨å¤šä¸ªç‹¬ç«‹çš„RedisèŠ‚ç‚¹ä¸Šåˆ†åˆ«åˆ›å»ºé”ã€‚ åªæœ‰å½“åœ¨æ‰€æœ‰æŒ‡å®šçš„RedisèŠ‚ç‚¹ä¸Šéƒ½æˆåŠŸè·å–é”æ—¶ï¼Œæ‰ç®—è·å–é”æˆåŠŸã€‚ è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å…ä¸»ä»åŒæ­¥ä¸ä¸€è‡´æ—¶é”å¤±æ•ˆçš„é—®é¢˜ã€‚ä½†ç¼ºç‚¹æ˜¯è¿ç»´æˆæœ¬é«˜ï¼Œå®ç°å¤æ‚ï¼Œä¸”è‡³å°‘éœ€è¦ä¸‰å°RedisæœåŠ¡å™¨ã€‚\nä½¿ç”¨å…¶ä»–åˆ†å¸ƒå¼é”å®ç° å¦‚æœä¸šåŠ¡å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜ï¼Œå»ºè®®ä½¿ç”¨å…¶ä»–åˆ†å¸ƒå¼é”å®ç°ï¼Œå¦‚åŸºäºZooKeeperçš„åˆ†å¸ƒå¼é”ã€‚ZooKeeperçš„åˆ†å¸ƒå¼é”å¯ä»¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œé€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼çš„åº”ç”¨åœºæ™¯ã€‚\n19. Redisé›†ç¾¤æœ‰å“ªäº›æ–¹æ¡ˆï¼ŒçŸ¥é“å—ï¼Ÿ åœ¨Redisä¸­æä¾›çš„é›†ç¾¤æ–¹æ¡ˆæ€»å…±æœ‰ä¸‰ç§ï¼šä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ã€Redisåˆ†ç‰‡é›†ç¾¤ã€‚\n20. é‚£ä½ æ¥ä»‹ç»ä¸€ä¸‹ä¸»ä»åŒæ­¥ã€‚ å•èŠ‚ç‚¹Redisçš„å¹¶å‘èƒ½åŠ›æœ‰ä¸Šé™ï¼Œå¯ä»¥é€šè¿‡æ­å»ºä¸»ä»é›†ç¾¤å®ç°è¯»å†™åˆ†ç¦»ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸»å¤šä»ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»æ•°æ®ã€‚ä¸»èŠ‚ç‚¹å†™å…¥æ•°æ®åï¼Œéœ€è¦æŠŠæ•°æ®åŒæ­¥åˆ°ä»èŠ‚ç‚¹ä¸­ã€‚\n21. èƒ½è¯´ä¸€ä¸‹ä¸»ä»åŒæ­¥æ•°æ®çš„æµç¨‹å—ï¼Ÿ å—¯~~ï¼Œå¥½ï¼ä¸»ä»åŒæ­¥åˆ†ä¸ºäº†ä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯å…¨é‡åŒæ­¥ï¼Œä¸€ä¸ªæ˜¯å¢é‡åŒæ­¥ã€‚\nå…¨é‡åŒæ­¥æ˜¯æŒ‡ä»èŠ‚ç‚¹ç¬¬ä¸€æ¬¡ä¸ä¸»èŠ‚ç‚¹å»ºç«‹è¿æ¥çš„æ—¶å€™ä½¿ç”¨å…¨é‡åŒæ­¥ï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š\nç¬¬ä¸€ï¼šä»èŠ‚ç‚¹è¯·æ±‚ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œå…¶ä¸­ä»èŠ‚ç‚¹ä¼šæºå¸¦è‡ªå·±çš„replication idå’Œoffsetåç§»é‡ã€‚\nç¬¬äºŒï¼šä¸»èŠ‚ç‚¹åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œä¸»è¦åˆ¤æ–­çš„ä¾æ®å°±æ˜¯ï¼Œä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹æ˜¯å¦æ˜¯åŒä¸€ä¸ªreplication idï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œé‚£ä¸»èŠ‚ç‚¹å°±ä¼šæŠŠè‡ªå·±çš„replication idå’Œoffsetå‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè®©ä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ä¿æŒä¸€è‡´ã€‚\nç¬¬ä¸‰ï¼šåœ¨åŒæ—¶ä¸»èŠ‚ç‚¹ä¼šæ‰§è¡ŒBGSAVEï¼Œç”ŸæˆRDBæ–‡ä»¶åï¼Œå‘é€ç»™ä»èŠ‚ç‚¹å»æ‰§è¡Œï¼Œä»èŠ‚ç‚¹å…ˆæŠŠè‡ªå·±çš„æ•°æ®æ¸…ç©ºï¼Œç„¶åæ‰§è¡Œä¸»èŠ‚ç‚¹å‘é€è¿‡æ¥çš„RDBæ–‡ä»¶ï¼Œè¿™æ ·å°±ä¿æŒäº†ä¸€è‡´ã€‚\nå½“ç„¶ï¼Œå¦‚æœåœ¨RDBç”Ÿæˆæ‰§è¡ŒæœŸé—´ï¼Œä¾ç„¶æœ‰è¯·æ±‚åˆ°äº†ä¸»èŠ‚ç‚¹ï¼Œè€Œä¸»èŠ‚ç‚¹ä¼šä»¥å‘½ä»¤çš„æ–¹å¼è®°å½•åˆ°ç¼“å†²åŒºï¼Œç¼“å†²åŒºæ˜¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæœ€åæŠŠè¿™ä¸ªæ—¥å¿—æ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹å®Œå…¨ä¸€è‡´äº†ï¼ŒåæœŸå†åŒæ­¥æ•°æ®çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä¾èµ–äºè¿™ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯å…¨é‡åŒæ­¥ã€‚\nå¢é‡åŒæ­¥æŒ‡çš„æ˜¯ï¼Œå½“ä»èŠ‚ç‚¹æœåŠ¡é‡å¯ä¹‹åï¼Œæ•°æ®å°±ä¸ä¸€è‡´äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œä»èŠ‚ç‚¹ä¼šè¯·æ±‚ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œä¸»èŠ‚ç‚¹è¿˜æ˜¯åˆ¤æ–­ä¸æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œä¸æ˜¯ç¬¬ä¸€æ¬¡å°±è·å–ä»èŠ‚ç‚¹çš„offsetå€¼ï¼Œç„¶åä¸»èŠ‚ç‚¹ä»å‘½ä»¤æ—¥å¿—ä¸­è·å–offsetå€¼ä¹‹åçš„æ•°æ®ï¼Œå‘é€ç»™ä»èŠ‚ç‚¹è¿›è¡Œæ•°æ®åŒæ­¥ã€‚\n22. æ€ä¹ˆä¿è¯Redisçš„é«˜å¹¶å‘é«˜å¯ç”¨ï¼Ÿ ä¸ºäº†ä¿è¯Redisçš„é«˜å¹¶å‘å’Œé«˜å¯ç”¨æ€§ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š\nä¸»ä»å¤åˆ¶ä¸å“¨å…µæ¨¡å¼\nä¸»ä»å¤åˆ¶ï¼šé€šè¿‡ä¸»ä»å¤åˆ¶ï¼Œå¯ä»¥å°†æ•°æ®ä»ä¸»èŠ‚ç‚¹åŒæ­¥åˆ°å¤šä¸ªä»èŠ‚ç‚¹ã€‚ä¸»èŠ‚ç‚¹è´Ÿè´£å†™æ“ä½œï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»æ“ä½œï¼Œè¿™æ ·å¯ä»¥åˆ†æ•£è¯»å–å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚ å“¨å…µæ¨¡å¼ï¼šå“¨å…µï¼ˆSentinelï¼‰æ˜¯Redisçš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç›‘æ§ä¸»ä»å¤åˆ¶çš„è¿è¡ŒçŠ¶æ€ã€‚å¦‚æœä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå“¨å…µä¼šè‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯æ›´æ–°è¿æ¥ä¿¡æ¯ã€‚å“¨å…µæ¨¡å¼é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°é«˜å¯ç”¨æ€§ï¼š ç›‘æ§ï¼šå“¨å…µä¼šæŒç»­ç›‘æ§ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„çŠ¶æ€ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå“¨å…µä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªä»èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚ é€šçŸ¥å®¢æˆ·ç«¯ï¼šå“¨å…µä¼šé€šè¿‡å‘å¸ƒ/è®¢é˜…æœºåˆ¶é€šçŸ¥å®¢æˆ·ç«¯æ–°çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯ã€‚ Redisé›†ç¾¤\nåˆ†ç‰‡ï¼šRedisé›†ç¾¤é€šè¿‡å°†æ•°æ®åˆ†ç‰‡åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥æœ‰æ•ˆåˆ†æ•£è´Ÿè½½ï¼Œæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œç¡®ä¿æœåŠ¡çš„å¯ç”¨æ€§ã€‚ 23. ä½ ä»¬ä½¿ç”¨Redisæ˜¯å•ç‚¹è¿˜æ˜¯é›†ç¾¤ï¼Œå“ªç§é›†ç¾¤ï¼Ÿ 24. Redisé›†ç¾¤è„‘è£‚è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ 25. Redisçš„åˆ†ç‰‡é›†ç¾¤æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 26. Redisåˆ†ç‰‡é›†ç¾¤ä¸­æ•°æ®æ˜¯æ€ä¹ˆå­˜å‚¨å’Œè¯»å–çš„ï¼Ÿ 27. Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜é‚£ä¹ˆå¿«ï¼Ÿ å®Œå…¨åŸºäºå†…å­˜çš„ï¼ŒCè¯­è¨€ç¼–å†™ã€‚ é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ã€‚ ä½¿ç”¨å¤šè·¯I/Oå¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡IOã€‚ 28. èƒ½è§£é‡Šä¸€ä¸‹I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ I/O å¤šè·¯å¤ç”¨æ¨¡å‹å‘¢ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹èƒ½åŒæ—¶ç›¯ç€å¥½å¤šç½‘ç»œè¿æ¥ï¼ˆSocketï¼‰ã€‚å°±åƒé¤å…é‡Œä¸€ä¸ªå‰å®³çš„æœåŠ¡å‘˜ï¼Œèƒ½åŒæ—¶ç…§é¡¾å¥½å¤šæ¡Œå®¢äººã€‚ä»¥å‰ä¼ ç»Ÿçš„æ–¹å¼æ˜¯æ¥ä¸€ä¸ªå®¢äººå°±å®‰æ’ä¸€ä¸ªæœåŠ¡å‘˜ä¸“é—¨ç›¯ç€ï¼Œå¤ªæµªè´¹äººåŠ›äº†ã€‚è€Œ I/O å¤šè·¯å¤ç”¨å°±æ˜¯è®©ä¸€ä¸ªæœåŠ¡å‘˜ï¼ˆçº¿ç¨‹ï¼‰çœ‹ç€æ‰€æœ‰æ¡Œå­ï¼ˆSocketï¼‰ï¼Œå“ªä¸ªæ¡Œå­ä¸Šçš„å®¢äººéœ€è¦ç‚¹èœï¼ˆå¯è¯»ï¼‰æˆ–è€…è¦ç»“è´¦ï¼ˆå¯å†™ï¼‰äº†ï¼Œè¿™ä¸ªæœåŠ¡å‘˜å°±è¿‡å»æœåŠ¡ã€‚\nRedis å°±æ˜¯ç”¨äº† I/O å¤šè·¯å¤ç”¨ç»“åˆäº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†å¥½å¤š Socket è¯·æ±‚ï¼Œåƒæœ‰ä¸“é—¨å¤„ç†è¿æ¥çš„ã€å¤„ç†å‘½ä»¤å›å¤çš„ã€å¤„ç†å‘½ä»¤è¯·æ±‚çš„ã€‚ä¸è¿‡åœ¨ Redis 6.0 ä¹‹åï¼Œä¸ºäº†è®©å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œåœ¨å‘½ä»¤å›å¤å’Œå‘½ä»¤è¯·æ±‚å¤„ç†çš„æŸäº›ç¯èŠ‚ç”¨äº†å¤šçº¿ç¨‹ï¼Œä½†æ ¸å¿ƒçš„å‘½ä»¤æ‰§è¡Œè¿˜æ˜¯å•çº¿ç¨‹ï¼Œä¿è¯å‘½ä»¤æ‰§è¡Œçš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§ã€‚\näº”ã€è®¾è®¡æ¨¡å¼ç¯‡ 1. å•ç‚¹ç™»å½•è¿™å—æ€ä¹ˆå®ç°çš„ï¼Ÿ å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ï¼šç”¨æˆ·åªéœ€ç™»å½•ä¸€æ¬¡ï¼Œå³å¯è®¿é—®æ‰€æœ‰ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚\nåŸºäº Cookie å’Œ Session çš„å®ç°\nç”¨æˆ·ç™»å½•ï¼šç”¨æˆ·è®¿é—®åº”ç”¨ç³»ç»Ÿï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼Œç™»å½•è¯·æ±‚è¢«å‘é€åˆ°è®¤è¯ä¸­å¿ƒã€‚ è®¤è¯ä¸ Session åˆ›å»ºï¼šè®¤è¯ä¸­å¿ƒéªŒè¯ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œè‹¥æˆåŠŸåˆ™åœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ª Sessionï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ Session ä¸­ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ Session IDã€‚ Cookie è®¾ç½®ï¼šè®¤è¯ä¸­å¿ƒå°† Session ID é€šè¿‡ Cookie å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¼šåœ¨åç»­è¯·æ±‚ä¸­è‡ªåŠ¨æºå¸¦è¯¥ Cookieã€‚ è®¿é—®å…¶ä»–åº”ç”¨ç³»ç»Ÿï¼šå½“ç”¨æˆ·è®¿é—®å…¶ä»–åº”ç”¨ç³»ç»Ÿæ—¶ï¼Œæµè§ˆå™¨ä¼šæºå¸¦åŒ…å« Session ID çš„ Cookieï¼Œåº”ç”¨ç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œä» Cookie ä¸­è·å– Session IDï¼Œå¹¶æ ¹æ® Session ID åˆ°æœåŠ¡å™¨ç«¯æŸ¥æ‰¾å¯¹åº”çš„ Sessionï¼Œä»¥æ­¤æ¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œè‹¥ Session å­˜åœ¨ä¸”æœ‰æ•ˆï¼Œåˆ™å…è®¸ç”¨æˆ·è®¿é—®ã€‚ åŸºäº Token çš„å®ç°\nç”¨æˆ·ç™»å½•ï¼šç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œç³»ç»ŸéªŒè¯èº«ä»½åç”Ÿæˆä¸€ä¸ªJWTä»¤ç‰Œï¼Œç„¶åå°†è¿™ä¸ªä»¤ç‰Œè¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¼šå°†å…¶ä¿å­˜åˆ°Cookieä¸­ã€‚ è®¿é—®å…¶ä»–æœåŠ¡ï¼šå½“ç”¨æˆ·è®¿é—®å…¶ä»–ç³»ç»Ÿæˆ–æœåŠ¡æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æºå¸¦è¿™ä¸ªJWTä»¤ç‰Œã€‚ç½‘å…³ä¼šæ‹¦æˆªè¯·æ±‚ï¼Œæ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆã€‚ ä»¤ç‰ŒéªŒè¯ï¼š å¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œç½‘å…³ä¼šå°†è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸è®¿é—®ã€‚ å¦‚æœä»¤ç‰Œæ— æ•ˆï¼ˆæ¯”å¦‚è¿‡æœŸæˆ–è¢«ç¯¡æ”¹ï¼‰ï¼Œç½‘å…³ä¼šè¿”å›401çŠ¶æ€ç ï¼Œå‰ç«¯æ¥æ”¶åˆ°åä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œæç¤ºç”¨æˆ·é‡æ–°ç™»å½•ã€‚ æœåŠ¡é—´é€šä¿¡ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå„æœåŠ¡ä¹‹é—´ä¹Ÿå¯èƒ½éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™æ—¶ï¼ŒæœåŠ¡ä¹‹é—´ä¼šé€šè¿‡ä¼ é€’JWTä»¤ç‰Œæ¥ç¡®è®¤å½¼æ­¤çš„èº«ä»½ï¼Œç¡®ä¿é€šä¿¡çš„å®‰å…¨æ€§ã€‚ 2. ä¸Šä¼ æ•°æ®çš„å®‰å…¨æ€§ä½ ä»¬æ€ä¹ˆæ§åˆ¶ï¼Ÿ åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­ï¼Œå¯¹äºæµè§ˆå™¨è®¿é—®åå°æ—¶ä¸Šä¼ æ•°æ®çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä¸»è¦æ˜¯é€šè¿‡åŠ å¯†æŠ€æœ¯æ¥æ§åˆ¶çš„ï¼Œå¸¸ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†è¿™ä¸¤ç§æ–¹å¼ã€‚\nå…ˆæ¥è¯´è¯´å¯¹ç§°åŠ å¯†å§ã€‚å®ƒçš„åŸç†æ˜¯åŠ å¯†å’Œè§£å¯†éƒ½ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ã€‚æ•°æ®å‘é€æ–¹ä¼šæŠŠè¦ä¼ è¾“çš„æ˜æ–‡å’Œè¿™ä¸ªåŠ å¯†å¯†é’¥ä¸€èµ·ï¼Œé€šè¿‡ç‰¹å®šçš„åŠ å¯†ç®—æ³•è¿›è¡Œå¤„ç†ï¼Œå°†å…¶è½¬åŒ–ä¸ºå¤æ‚çš„å¯†æ–‡ï¼Œç„¶åå†å‘é€å‡ºå»ã€‚æ¥æ”¶æ–¹æ”¶åˆ°å¯†æ–‡åï¼Œè¦æƒ³è§£è¯»å‡ºåŸæ–‡ï¼Œå°±éœ€è¦ä½¿ç”¨å’ŒåŠ å¯†æ—¶ç›¸åŒçš„å¯†é’¥ï¼Œä»¥åŠè¿™ä¸ªåŠ å¯†ç®—æ³•çš„é€†ç®—æ³•æ¥å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œè¿™æ ·æ‰èƒ½æ¢å¤æˆåŸæ¥å¯è¯»çš„æ˜æ–‡ã€‚å¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼Œå®ƒçš„ç®—æ³•æ˜¯å…¬å¼€çš„ï¼Œè®¡ç®—é‡æ¯”è¾ƒå°ï¼ŒåŠ å¯†çš„é€Ÿåº¦å¿«ï¼Œæ•ˆç‡ä¹Ÿé«˜ï¼Œèƒ½å¤Ÿå¿«é€Ÿå¤„ç†å¤§é‡æ•°æ®ã€‚ä¸è¿‡å®ƒä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå°±æ˜¯å®‰å…¨æ€§ç›¸å¯¹éå¯¹ç§°åŠ å¯†æ¥è¯´è¦ä½ä¸€äº›ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨å®ƒæ¥ä¿å­˜åƒç”¨æˆ·æ‰‹æœºå·ã€èº«ä»½è¯è¿™ç±»è™½ç„¶æ•æ„Ÿï¼Œä½†åç»­éœ€è¦è§£å¯†ä½¿ç”¨çš„ä¿¡æ¯ã€‚å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ AESã€DESã€3DES ç­‰ç­‰ã€‚\nå†å°±æ˜¯éå¯¹ç§°åŠ å¯†ã€‚è¿™ç§åŠ å¯†æ–¹å¼æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œä¸€ä¸ªæ˜¯å…¬å¼€å¯†é’¥ï¼Œå¦ä¸€ä¸ªæ˜¯ç§æœ‰å¯†é’¥ã€‚æˆ‘ä»¬ä¼šåŒæ—¶ç”Ÿæˆè¿™ä¸¤æŠŠå¯†é’¥ï¼Œç§é’¥ç”±æœåŠ¡å™¨ç«¯éšç§˜ä¿å­˜å¥½ï¼Œå…¬é’¥åˆ™å¯ä»¥ä¸‹å‘ç»™ä¿¡ä»»çš„å®¢æˆ·ç«¯ã€‚åœ¨åŠ å¯†å’Œè§£å¯†æ–¹é¢ï¼Œç§é’¥åŠ å¯†çš„å†…å®¹ï¼Œåªæœ‰æŒæœ‰å…¬é’¥çš„ä¸€æ–¹æ‰èƒ½è§£å¯†ï¼›åè¿‡æ¥ï¼Œå…¬é’¥åŠ å¯†çš„å†…å®¹ï¼Œå°±åªæœ‰æŒæœ‰ç§é’¥çš„ä¸€æ–¹å¯ä»¥è§£å¯†ã€‚è€Œä¸”ï¼Œè¿˜å¯ä»¥ç”¨ç§é’¥è¿›è¡Œç­¾åï¼Œé€šè¿‡å…¬é’¥æ¥éªŒè¯æ•°æ®æœ‰æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ã€‚éå¯¹ç§°åŠ å¯†çš„ä¼˜åŠ¿åœ¨äºå®ƒçš„å®‰å…¨æ€§æ›´å¥½ï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯åŠ å¯†å’Œè§£å¯†èŠ±è´¹çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œé€Ÿåº¦æ…¢ï¼Œæ‰€ä»¥åªé€‚åˆå¯¹å°‘é‡æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠå®ƒç”¨åœ¨ç­¾åå’Œè®¤è¯è¿™äº›åœºæ™¯é‡Œï¼Œæ¯”å¦‚è¯´ç§é’¥ç”±æœåŠ¡å™¨ä¿å­˜ç”¨æ¥åŠ å¯†æ•°æ®ï¼Œå…¬é’¥äº¤ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯ç”¨æ¥å¯¹ä»¤ç‰Œæˆ–è€…ç­¾åè¿›è¡Œè§£å¯†æˆ–è€…æ ¡éªŒã€‚åƒ RSAã€DSA è¿™äº›éƒ½æ˜¯å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®å…·ä½“çš„æƒ…å†µæ¥é€‰æ‹©åˆé€‚çš„åŠ å¯†æ–¹å¼ã€‚å¦‚æœä¼ è¾“çš„æ•°æ®é‡å¾ˆå¤§ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šå»ºè®®ä½¿ç”¨å¯¹ç§°åŠ å¯†ï¼Œä¸è¿‡è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šç”¨å®ƒæ¥ä¿å­˜ç‰¹åˆ«æ•æ„Ÿçš„ä¿¡æ¯ã€‚è€Œå¦‚æœä¼ è¾“çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼ŒåŒæ—¶å¯¹å®‰å…¨æ€§è¦æ±‚åˆå¾ˆé«˜ï¼Œé‚£æˆ‘ä»¬å°±ä¼šé‡‡ç”¨éå¯¹ç§°åŠ å¯†ï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°ä¿éšœä¸Šä¼ æ•°æ®åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚\n3. ä½ è´Ÿè´£é¡¹ç›®çš„æ—¶å€™é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Ÿ åœ¨æˆ‘ä»¬çš„åœ¨çº¿åˆ¤é¢˜ç³»ç»Ÿï¼ˆOJï¼‰é¡¹ç›®ä¸­ï¼Œä¸åŒç¼–ç¨‹è¯­è¨€çš„åˆ¤é¢˜é€»è¾‘å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä¾‹å¦‚ï¼ŒJavaè¯­è¨€çš„å†…å­˜å’Œæ—¶é—´é™åˆ¶é€šå¸¸éœ€è¦é€‚å½“å¢åŠ ï¼Œè€ŒC++è¯­è¨€å¯èƒ½éœ€è¦æ›´ä¸¥æ ¼çš„é™åˆ¶ã€‚æ­¤å¤–ï¼Œä»£ç æ²™ç®±çš„è°ƒç”¨ä¹Ÿéœ€è¦æ”¯æŒå¤šç§æ–¹å¼ï¼Œå¦‚æœ¬åœ°æ²™ç®±ã€è¿œç¨‹æ²™ç®±å’Œç¬¬ä¸‰æ–¹æ²™ç®±ã€‚å¦‚æœå°†æ‰€æœ‰è¿™äº›é€»è¾‘éƒ½å†™åœ¨ä¸€ä¸ªServiceç±»ä¸­ï¼Œé€šè¿‡å¤§é‡çš„if...elseè¯­å¥æ¥åŒºåˆ†ï¼Œä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ä¼šå˜å¾—å¾ˆå·®ï¼Œåœˆå¤æ‚åº¦ä¹Ÿä¼šå¾ˆé«˜ã€‚å› æ­¤ï¼Œæˆ‘é€‰æ‹©äº†ç­–ç•¥æ¨¡å¼ã€å·¥å‚æ¨¡å¼å’Œä»£ç†æ¨¡å¼æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚\n(1) é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨ç­–ç•¥æ¨¡å¼å°è£…ä¸åŒè¯­è¨€çš„åˆ¤é¢˜ç®—æ³•\nå®šä¹‰åˆ¤é¢˜ç­–ç•¥æ¥å£\nè¿™ä¸ªæ¥å£å°±åƒæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œè§„å®šäº†æ‰€æœ‰å…·ä½“åˆ¤é¢˜ç­–ç•¥ç±»éƒ½å¿…é¡»å®ç°çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ¥å£é‡Œï¼Œæœ‰ä¸€ä¸ª doJudge æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª JudgeContext ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æºå¸¦åˆ¤é¢˜æ‰€éœ€çš„å„ç§ä¿¡æ¯ã€‚\n1 2 3 public interface JudgeStrategy { void doJudge(JudgeContext context); } å®ç°å…·ä½“çš„ç­–ç•¥ç±»\nä»¥ Java å’Œ C++ è¯­è¨€ä¸ºä¾‹ã€‚å¯¹äº Java è¯­è¨€ï¼Œæˆ‘åˆ›å»ºäº† JavaLanguageJudgeStrategy ç±»ï¼Œå®ƒå®ç°äº† JudgeStrategy æ¥å£ï¼Œåœ¨ doJudge æ–¹æ³•é‡Œç¼–å†™äº† Java è¯­è¨€ç‰¹æœ‰çš„åˆ¤é¢˜é€»è¾‘ã€‚åŒæ ·åœ°ï¼Œå¯¹äº C++ è¯­è¨€ï¼Œæˆ‘åˆ›å»ºäº† CppLanguageJudgeStrategy ç±»ï¼Œä¹Ÿåœ¨å…¶ doJudge æ–¹æ³•ä¸­å®ç°äº† C++ è¯­è¨€çš„åˆ¤é¢˜é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 public class JavaLanguageJudgeStrategy implements JudgeStrategy { @Override public void doJudge(JudgeContext context) { // Javaè¯­è¨€çš„åˆ¤é¢˜é€»è¾‘ } } public class CppLanguageJudgeStrategy implements JudgeStrategy { @Override public void doJudge(JudgeContext context) { // C++è¯­è¨€çš„åˆ¤é¢˜é€»è¾‘ } } å®šä¹‰ä¸Šä¸‹æ–‡ç±»\nä¸ºäº†æ–¹ä¾¿ä¼ é€’åˆ¤é¢˜æ‰€éœ€çš„ä¿¡æ¯ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ç±» JudgeContextã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼ŒåŒ…å«äº†æäº¤çš„ä»£ç ã€è¾“å…¥ç”¨ä¾‹ä»¥åŠé¢„æœŸè¾“å‡ºç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šåœ¨åˆ¤é¢˜è¿‡ç¨‹ä¸­è¢«ä½¿ç”¨ã€‚\n1 2 3 4 5 6 public class JudgeContext { private String submissionCode; private String input; private String expectedOutput; // å…¶ä»–éœ€è¦çš„ä¿¡æ¯ } å®šä¹‰ç­–ç•¥ç®¡ç†ç±»\næœ€åï¼Œä¸ºäº†ç®¡ç†è¿™äº›ä¸åŒçš„åˆ¤é¢˜ç­–ç•¥ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªç­–ç•¥ç®¡ç†ç±» JudgeManagerã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ª Map æ¥å­˜å‚¨ä¸åŒè¯­è¨€å¯¹åº”çš„åˆ¤é¢˜ç­–ç•¥ï¼Œé”®æ˜¯è¯­è¨€çš„åç§°ï¼Œå€¼æ˜¯å¯¹åº”çš„ç­–ç•¥ç±»å®ä¾‹ã€‚åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘åˆå§‹åŒ–äº†è¿™ä¸ª Mapï¼Œå°† Java å’Œ C++ ç­‰è¯­è¨€å¯¹åº”çš„ç­–ç•¥ç±»å®ä¾‹æ·»åŠ è¿›å»ã€‚åŒæ—¶ï¼Œæä¾›äº†ä¸€ä¸ª executeStrategy æ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥çš„è¯­è¨€åç§°ä» Map ä¸­è·å–å¯¹åº”çš„ç­–ç•¥å®ä¾‹ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨å…¶ doJudge æ–¹æ³•è¿›è¡Œåˆ¤é¢˜ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class JudgeManager { private Map\u0026lt;String, JudgeStrategy\u0026gt; strategyMap; public JudgeManager() { strategyMap = new HashMap\u0026lt;\u0026gt;(); strategyMap.put(\u0026#34;Java\u0026#34;, new JavaLanguageJudgeStrategy()); strategyMap.put(\u0026#34;Cpp\u0026#34;, new CppLanguageJudgeStrategy()); // æ·»åŠ å…¶ä»–è¯­è¨€çš„ç­–ç•¥ } public void executeStrategy(String language, JudgeContext context) { JudgeStrategy strategy = strategyMap.get(language); if (strategy != null) { strategy.doJudge(context); } else { throw new IllegalArgumentException(\u0026#34;Unsupported language: \u0026#34; + language); } } } é€šè¿‡è¿™ç§ç­–ç•¥æ¨¡å¼çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ·»åŠ æ–°çš„ç¼–ç¨‹è¯­è¨€åˆ¤é¢˜ç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚å¦‚æœåç»­éœ€è¦å¢åŠ æ–°çš„è¯­è¨€åˆ¤é¢˜é€»è¾‘ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç­–ç•¥ç±»å¹¶å®ç° JudgeStrategy æ¥å£ï¼Œç„¶ååœ¨ JudgeManager çš„ Map ä¸­æ·»åŠ å¯¹åº”çš„æ˜ å°„å…³ç³»å³å¯ï¼Œä¸ä¼šå¯¹ç°æœ‰çš„ä»£ç é€ æˆå½±å“ã€‚\n(2) ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨å·¥å‚æ¨¡å¼ç®€åŒ–ä»£ç æ²™ç®±è°ƒç”¨å®ä¾‹çš„è·å–\nå®šä¹‰ä»£ç æ²™ç®±æ¥å£\né¦–å…ˆï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªä»£ç æ²™ç®±æ¥å£ CodeSandboxã€‚è¿™ä¸ªæ¥å£è§„å®šäº†ä»£ç æ²™ç®±å¿…é¡»å…·å¤‡çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå³ execute æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä»£ç å’Œè¾“å…¥ä½œä¸ºå‚æ•°ï¼Œè¿”å›æ‰§è¡Œç»“æœã€‚é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒç±»å‹çš„ä»£ç æ²™ç®±æä¾›ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼ã€‚\n1 2 3 public interface CodeSandbox { ExecutionResult execute(String code, String input); } å®ç°å…·ä½“çš„ä»£ç æ²™ç®±ç±»\næˆ‘å®ç°äº†å…·ä½“çš„ä»£ç æ²™ç®±ç±»ã€‚åˆ†åˆ«æœ‰ LocalCodeSandbox ç”¨äºæœ¬åœ°ä»£ç æ²™ç®±æ‰§è¡Œï¼ŒRemoteCodeSandbox ç”¨äºè¿œç¨‹ä»£ç æ²™ç®±æ‰§è¡Œï¼Œä»¥åŠ ThirdPartyCodeSandbox ç”¨äºè°ƒç”¨ç¬¬ä¸‰æ–¹ä»£ç æ²™ç®±æœåŠ¡ã€‚æ¯ä¸ªç±»éƒ½å®ç°äº† CodeSandbox æ¥å£ï¼Œå¹¶åœ¨ execute æ–¹æ³•ä¸­ç¼–å†™äº†å„è‡ªå¯¹åº”çš„æ‰§è¡Œé€»è¾‘ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class LocalCodeSandbox implements CodeSandbox { @Override public ExecutionResult execute(String code, String input) { // æœ¬åœ°æ²™ç®±æ‰§è¡Œé€»è¾‘ } } public class RemoteCodeSandbox implements CodeSandbox { @Override public ExecutionResult execute(String code, String input) { // è¿œç¨‹æ²™ç®±æ‰§è¡Œé€»è¾‘ } } public class ThirdPartyCodeSandbox implements CodeSandbox { @Override public ExecutionResult execute(String code, String input) { // ç¬¬ä¸‰æ–¹æ²™ç®±æ‰§è¡Œé€»è¾‘ } } å®šä¹‰å·¥å‚ç±»\næœ€åï¼Œä¸ºäº†æ–¹ä¾¿è·å–ä¸åŒç±»å‹çš„ä»£ç æ²™ç®±å®ä¾‹ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªå·¥å‚ç±»CodeSandboxFactoryã€‚åœ¨è¿™ä¸ªå·¥å‚ç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªé™æ€æ–¹æ³• getCodeSandboxï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªè¡¨ç¤ºæ²™ç®±ç±»å‹çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚æ ¹æ®ä¼ å…¥çš„ç±»å‹ï¼Œä½¿ç”¨ switch è¯­å¥è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè¿”å›ç›¸åº”çš„ä»£ç æ²™ç®±å®ä¾‹ã€‚å¦‚æœä¼ å…¥çš„ç±»å‹ä¸è¢«æ”¯æŒï¼Œä¼šæŠ›å‡ºä¸€ä¸ª IllegalArgumentException å¼‚å¸¸.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class CodeSandboxFactory { public static CodeSandbox getCodeSandbox(String type) { switch (type) { case \u0026#34;local\u0026#34;: return new LocalCodeSandbox(); case \u0026#34;remote\u0026#34;: return new RemoteCodeSandbox(); case \u0026#34;thirdParty\u0026#34;: return new ThirdPartyCodeSandbox(); default: throw new IllegalArgumentException(\u0026#34;Unsupported sandbox type: \u0026#34; + type); } } } é€šè¿‡è¿™ç§å·¥å‚æ¨¡å¼çš„å®ç°ï¼Œæˆ‘ä»¬åœ¨éœ€è¦è·å–ä»£ç æ²™ç®±å®ä¾‹æ—¶ï¼Œåªéœ€è¦è°ƒç”¨ CodeSandboxFactory çš„ getCodeSandbox æ–¹æ³•å¹¶ä¼ å…¥ç›¸åº”çš„ç±»å‹å³å¯ï¼Œæ— éœ€å…³å¿ƒå…·ä½“çš„å®ä¾‹åˆ›å»ºè¿‡ç¨‹ã€‚è€Œä¸”ï¼Œå¦‚æœåç»­éœ€è¦æ·»åŠ æ–°çš„ä»£ç æ²™ç®±ç±»å‹ï¼Œåªéœ€è¦åœ¨å·¥å‚ç±»çš„ switch è¯­å¥ä¸­æ·»åŠ ç›¸åº”çš„åˆ†æ”¯ï¼ŒåŒæ—¶å®ç°å¯¹åº”çš„ä»£ç æ²™ç®±ç±»ï¼Œä¸ä¼šå¯¹å…¶ä»–éƒ¨åˆ†çš„ä»£ç é€ æˆå½±å“ï¼Œå¤§å¤§æé«˜äº†ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n(3) ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–åˆ¤é¢˜æœºæ¨¡å—ä¸­ä»£ç æ²™ç®±è°ƒç”¨çš„çµæ´»æ€§ä¸å¯ç®¡ç†æ€§ï¼Œæˆ‘é‡‡å–äº†é…ç½®åŒ–ä»£ç æ²™ç®±ç±»å‹çš„æ–¹æ¡ˆã€‚\nå®ç°åŠ¨æ€åˆ‡æ¢ä»£ç æ²™ç®±çš„å®ç°ï¼Œå…¨ç¨‹æ— éœ€ä¿®æ”¹ä»£ç ï¼Œå¤§å¤§æé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ä¸ç¨³å®šæ€§ã€‚\nåœ¨ application.yml é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä»£ç æ²™ç®±ç±»å‹çš„é…ç½®é¡¹ã€‚\n1 2 sandbox: type: remote ä»£ç è¯»å–é…ç½®\nåœ¨ Java ä»£ç ä¸­ï¼Œåˆ©ç”¨ Spring æ¡†æ¶æä¾›çš„ @Value æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ sandbox.type å€¼ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n1 2 @Value(\u0026#34;${sandbox.type}\u0026#34;) private String sandboxType; ç„¶åï¼Œåœ¨è·å–ä»£ç æ²™ç®±å®ä¾‹çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨å‰é¢æåˆ°çš„å·¥å‚ç±»æ¥è·å–ç›¸åº”ç±»å‹çš„ä»£ç æ²™ç®±å®ä¾‹ï¼š\n1 2 3 public CodeSandbox getCodeSandbox() { return CodeSandboxFactory.getCodeSandbox(sandboxType); } è¿™é‡Œé€šè¿‡å°†è¯»å–åˆ°çš„ sandboxType ä½œä¸ºå‚æ•°ä¼ é€’ç»™ CodeSandboxFactory çš„ getCodeSandbox æ–¹æ³•ï¼Œå°±èƒ½è·å–åˆ°å¯¹åº”çš„ä»£ç æ²™ç®±å®ä¾‹ã€‚\n(4) æœ€å æˆ‘ä»¬ä½¿ç”¨ä»£ç†æ¨¡å¼å¢å¼ºä»£ç æ²™ç®±çš„èƒ½åŠ›\nåœ¨è°ƒç”¨ä»£ç æ²™ç®±å‰åè¿›è¡Œæ—¥å¿—è®°å½•ç­‰æ“ä½œæ—¶ï¼Œå¦‚æœç›´æ¥åœ¨ä»£ç æ²™ç®±è°ƒç”¨å®ç°ç±»ä¸­ç¼–å†™ï¼Œä¼šå¯¼è‡´ä»£ç è€¦åˆåº¦é«˜ï¼Œåç»­ä¿®æ”¹å’Œæ‰©å±•å›°éš¾ã€‚\nå®šä¹‰ä»£ç†ç±»\næˆ‘å®šä¹‰äº†ä¸€ä¸ªä»£ç†ç±» CodeSandboxProxyï¼Œå®ƒå®ç°äº† CodeSandbox æ¥å£ã€‚åœ¨è¿™ä¸ªä»£ç†ç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ targetï¼Œå®ƒæ˜¯è¢«ä»£ç†çš„ä»£ç æ²™ç®±å¯¹è±¡ã€‚é€šè¿‡æ„é€ å‡½æ•°å°†è¢«ä»£ç†çš„å¯¹è±¡ä¼ å…¥å¹¶èµ‹å€¼ç»™ targetã€‚ åœ¨ execute æ–¹æ³•ä¸­ï¼Œæˆ‘åœ¨è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„ execute æ–¹æ³•å‰åæ·»åŠ äº†æ—¥å¿—è®°å½•çš„æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨è°ƒç”¨ä¹‹å‰ï¼Œä¼šè°ƒç”¨ log æ–¹æ³•è®°å½• â€œExecuting code in sandbox\u0026hellip;â€ï¼Œè¡¨ç¤ºä»£ç æ²™ç®±å¼€å§‹æ‰§è¡Œä»£ç ï¼›åœ¨è°ƒç”¨ä¹‹åï¼Œå†æ¬¡è°ƒç”¨ log æ–¹æ³•è®°å½• â€œExecution completed.â€ï¼Œè¡¨ç¤ºä»£ç æ‰§è¡Œå®Œæˆã€‚æœ€åè¿”å›æ‰§è¡Œç»“æœã€‚log æ–¹æ³•ä¸­å°è£…äº†å…·ä½“çš„æ—¥å¿—è®°å½•é€»è¾‘ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class CodeSandboxProxy implements CodeSandbox { private CodeSandbox target; public CodeSandboxProxy(CodeSandbox target) { this.target = target; } @Override public ExecutionResult execute(String code, String input) { log(\u0026#34;Executing code in sandbox...\u0026#34;); ExecutionResult result = target.execute(code, input); log(\u0026#34;Execution completed.\u0026#34;); return result; } private void log(String message) { // æ—¥å¿—è®°å½•é€»è¾‘ } } ä½¿ç”¨ä»£ç†ç±»\nåœ¨è·å–ä»£ç æ²™ç®±å®ä¾‹çš„æ–¹æ³• getCodeSandbox ä¸­ï¼Œé¦–å…ˆé€šè¿‡ CodeSandboxFactory å·¥å‚ç±»æ ¹æ®é…ç½®çš„æ²™ç®±ç±»å‹è·å–åˆ°å…·ä½“çš„ä»£ç æ²™ç®±å®ä¾‹ targetï¼Œç„¶åå°†è¿™ä¸ªå®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ CodeSandboxProxy ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡å¹¶è¿”å›ã€‚è¿™æ ·ï¼Œåç»­è°ƒç”¨ä»£ç æ²™ç®±çš„ execute æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†å¯¹è±¡çš„ execute æ–¹æ³•ï¼Œä»è€Œå®ç°äº†åœ¨ä»£ç æ²™ç®±æ‰§è¡Œå‰åæ·»åŠ æ—¥å¿—è®°å½•ç­‰é¢å¤–åŠŸèƒ½ã€‚\n1 2 3 4 public CodeSandbox getCodeSandbox() { CodeSandbox target = CodeSandboxFactory.getCodeSandbox(sandboxType); return new CodeSandboxProxy(target); } é€šè¿‡ä»£ç†æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸æ”¹å˜ä»£ç æ²™ç®±å®ç°ç±»çš„å‰æä¸‹ï¼Œé›†ä¸­åœ°ä¸ºä»£ç æ²™ç®±æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚è¿™æ ·ï¼Œä»£ç æ²™ç®±çš„åŸæœ‰åŠŸèƒ½ä¸ä¼šå—åˆ°å½±å“ï¼ŒåŒæ—¶åˆèƒ½è½»æ¾åœ°æ‰©å±•å…¶èƒ½åŠ›ã€‚\nä»£ç†æ¨¡å¼å°†æ—¥å¿—è®°å½•é€»è¾‘ä¸ä»£ç æ²™ç®±çš„æ‰§è¡Œé€»è¾‘åˆ†ç¦»å¼€æ¥ã€‚ä»£ç æ²™ç®±çš„å®ç°ç±»åªéœ€è¦ä¸“æ³¨äºä»£ç æ‰§è¡Œçš„æ ¸å¿ƒé€»è¾‘ï¼Œè€Œæ—¥å¿—è®°å½•ç­‰é¢å¤–åŠŸèƒ½ç”±ä»£ç†ç±»è´Ÿè´£ã€‚è¿™ä½¿å¾—æ¯ä¸ªç±»çš„èŒè´£æ›´åŠ æ¸…æ™°æ˜ç¡®ï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¹Ÿè®©ä»£ç ç»“æ„æ›´åŠ åˆç†ã€‚\nå…­ã€JavaåŸºç¡€ 1. JVM vs JDK vs JRE JVMï¼ˆJava Virtual Machineï¼‰ æ˜¯è¿â¾ Java å­—èŠ‚ç çš„è™šæ‹Ÿæœºã€‚JVM æœ‰é’ˆå¯¹ä¸åŒç³»ç»Ÿçš„ç‰¹å®šå®ç°ï¼ˆWindowsï¼Œ Linuxï¼ŒmacOSï¼‰ï¼Œâ½¬çš„æ˜¯ä½¿â½¤ç›¸åŒçš„å­—èŠ‚ç ï¼Œå®ƒä»¬éƒ½ä¼šç»™å‡ºç›¸åŒçš„ç»“æœã€‚å­—èŠ‚ç å’Œä¸åŒç³»ç»Ÿçš„ JVM å®ç°æ˜¯ Java è¯­â¾”â€œâ¼€æ¬¡ç¼–è¯‘ï¼Œéšå¤„å¯ä»¥è¿â¾â€çš„å…³é”®æ‰€åœ¨ã€‚JVMæœ‰å¤šç§å®ç°ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„HotSpot VMï¼Œè¿˜æœ‰J9 VMã€Zing VMç­‰ã€‚è¿™äº›ä¸åŒçš„å®ç°æä¾›äº†ä¸åŒçš„æ€§èƒ½ä¼˜åŒ–å’Œç‰¹æ€§ã€‚\nJDKï¼ˆJava Development Kitï¼‰ æ˜¯Javaå¼€å‘å·¥å…·åŒ…ï¼Œå®ƒåŒ…å«äº†JREçš„æ‰€æœ‰å†…å®¹ï¼ŒåŒæ—¶è¿˜åŒ…æ‹¬ç¼–è¯‘å™¨ï¼ˆjavacï¼‰ã€è°ƒè¯•å™¨ï¼ˆjdbï¼‰ã€æ–‡æ¡£ç”Ÿæˆå™¨ï¼ˆjavadocï¼‰ç­‰å¼€å‘å·¥å…·ã€‚JDKæ˜¯Javaå¼€å‘è€…çš„å¿…å¤‡å·¥å…·ï¼Œç”¨äºç¼–å†™ã€ç¼–è¯‘å’Œè°ƒè¯•Javaç¨‹åºã€‚å¦‚æœä½ éœ€è¦è¿›è¡ŒJavaå¼€å‘ï¼Œé‚£ä¹ˆå®‰è£…JDKæ˜¯å¿…é¡»çš„ã€‚\nJREï¼ˆJava Runtime Environmentï¼‰ æ˜¯Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒåŒ…å«äº†è¿è¡Œå·²ç¼–è¯‘Javaç¨‹åºæ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬JVMã€Javaç±»åº“å’Œä¸€äº›åŸºç¡€å·¥å…·ã€‚JREä¸»è¦ç”¨äºè¿è¡ŒJavaç¨‹åºï¼Œè€Œä¸åŒ…å«å¼€å‘å·¥å…·ã€‚å¦‚æœä½ åªéœ€è¦è¿è¡ŒJavaç¨‹åºï¼Œè€Œä¸éœ€è¦è¿›è¡Œå¼€å‘ï¼Œé‚£ä¹ˆå®‰è£…JREå°±è¶³å¤Ÿäº†ã€‚\nåœ¨å®é™…å·¥ä½œä¸­ï¼Œè™½ç„¶JREå¯ä»¥è¿è¡ŒJavaç¨‹åºï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šå®‰è£…JDKï¼Œå› ä¸ºä¸€äº›å·¥å…·ï¼ˆå¦‚JSPå®¹å™¨ï¼‰åœ¨è¿è¡Œæ—¶éœ€è¦ç¼–è¯‘åŠŸèƒ½ï¼Œè¿™å°±éœ€è¦JDKçš„æ”¯æŒã€‚æ€»çš„æ¥è¯´ï¼ŒJVMæ˜¯è¿è¡ŒJavaç¨‹åºçš„æ ¸å¿ƒï¼ŒJDKæ˜¯å¼€å‘Javaç¨‹åºçš„å·¥å…·é›†ï¼Œè€ŒJREæ˜¯è¿è¡ŒJavaç¨‹åºçš„ç¯å¢ƒã€‚\n2. ä»€ä¹ˆæ˜¯å­—èŠ‚ç ?é‡‡ç”¨å­—èŠ‚ç çš„å¥½å¤„æ˜¯ä»€ä¹ˆ? åœ¨ Java ä¸­ï¼ŒJVM å¯ä»¥ç†è§£çš„ä»£ç å°±å«åšå­—èŠ‚ç ï¼ˆå³æ‰©å±•åä¸º .class çš„â½‚ä»¶ï¼‰ï¼Œå®ƒä¸â¾¯å‘ä»»ä½•ç‰¹å®š çš„å¤„ç†å™¨ï¼Œåªâ¾¯å‘è™šæ‹Ÿæœºã€‚Java è¯­â¾”é€šè¿‡å­—èŠ‚ç çš„â½…å¼ï¼Œåœ¨â¼€å®šç¨‹åº¦ä¸Šè§£å†³äº†ä¼ ç»Ÿè§£é‡Šå‹è¯­â¾”æ‰§â¾ æ•ˆç‡ä½çš„é—®é¢˜ï¼ŒåŒæ—¶â¼œä¿ç•™äº†è§£é‡Šå‹è¯­â¾”å¯ç§»æ¤çš„ç‰¹ç‚¹ã€‚æ‰€ä»¥ï¼Œ Java ç¨‹åºè¿â¾æ—¶ç›¸å¯¹æ¥è¯´è¿˜æ˜¯â¾¼æ•ˆ çš„ï¼ˆä¸è¿‡ï¼Œå’Œ C++ï¼ŒRustï¼ŒGo ç­‰è¯­â¾”è¿˜æ˜¯æœ‰â¼€å®šå·®è·çš„ï¼‰ï¼Œâ½½ä¸”ï¼Œç”±äºå­—èŠ‚ç å¹¶ä¸é’ˆå¯¹â¼€ç§ç‰¹å®šçš„ æœºå™¨ï¼Œå› æ­¤ï¼ŒJava ç¨‹åºâ½†é¡»é‡æ–°ç¼–è¯‘ä¾¿å¯åœ¨å¤šç§ä¸åŒæ“ä½œç³»ç»Ÿçš„è®¡ç®—æœºä¸Šè¿â¾ã€‚\n3. Java ç¨‹åºä»æºä»£ç åˆ°è¿â¾çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º æˆ‘ä»¬éœ€è¦æ ¼å¤–æ³¨æ„çš„æ˜¯ .class-\u0026gt;æœºå™¨ç  è¿™â¼€æ­¥ã€‚åœ¨è¿™â¼€æ­¥ JVM ç±»åŠ è½½å™¨â¾¸å…ˆåŠ è½½å­—èŠ‚ç â½‚ä»¶ï¼Œç„¶å é€šè¿‡è§£é‡Šå™¨é€â¾è§£é‡Šæ‰§â¾ï¼Œè¿™ç§â½…å¼çš„æ‰§â¾é€Ÿåº¦ä¼šç›¸å¯¹æ¯”è¾ƒæ…¢ã€‚â½½ä¸”ï¼Œæœ‰äº›â½…æ³•å’Œä»£ç å—æ˜¯ç»å¸¸éœ€è¦ è¢«è°ƒâ½¤çš„(ä¹Ÿå°±æ˜¯æ‰€è°“çš„çƒ­ç‚¹ä»£ç )ï¼Œæ‰€ä»¥åâ¾¯å¼•è¿›äº† JITï¼ˆjust-in-time compilationï¼‰ ç¼–è¯‘å™¨ï¼Œâ½½ JIT å±äºè¿â¾æ—¶ç¼–è¯‘ã€‚å½“ JIT ç¼–è¯‘å™¨å®Œæˆç¬¬â¼€æ¬¡ç¼–è¯‘åï¼Œå…¶ä¼šå°†å­—èŠ‚ç å¯¹åº”çš„æœºå™¨ç ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å¯ä»¥ ç›´æ¥ä½¿â½¤ã€‚â½½æˆ‘ä»¬çŸ¥é“ï¼Œæœºå™¨ç çš„è¿â¾æ•ˆç‡è‚¯å®šæ˜¯â¾¼äº Java è§£é‡Šå™¨çš„ã€‚è¿™ä¹Ÿè§£é‡Šäº†æˆ‘ä»¬ä¸ºä»€ä¹ˆç»å¸¸ ä¼šè¯´ Java æ˜¯ç¼–è¯‘ä¸è§£é‡Šå…±å­˜çš„è¯­â¾” ã€‚\n3. æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡çš„åŒºåˆ«ï¼Ÿ è¯­æ³•å½¢å¼ ï¼šä»è¯­æ³•å½¢å¼ä¸Šçœ‹ï¼Œæˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œâ½½å±€éƒ¨å˜é‡æ˜¯åœ¨ä»£ç å—æˆ–â½…æ³•ä¸­å®šä¹‰çš„å˜é‡æˆ–æ˜¯â½…æ³•çš„å‚æ•°ï¼›æˆå‘˜å˜é‡å¯ä»¥è¢« public , private , static ç­‰ä¿®é¥°ç¬¦æ‰€ä¿®é¥°ï¼Œâ½½å±€éƒ¨å˜é‡ä¸èƒ½è¢«è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦åŠ static æ‰€ä¿®é¥°ï¼›ä½†æ˜¯ï¼Œæˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½èƒ½è¢« final æ‰€ä¿®é¥°ã€‚ å­˜å‚¨â½…å¼ ï¼šä»å˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨â½…å¼æ¥çœ‹,å¦‚æœæˆå‘˜å˜é‡æ˜¯ä½¿â½¤ static ä¿®é¥°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œå¦‚æœæ²¡æœ‰ä½¿â½¤ static ä¿®é¥°ï¼Œè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºå®ä¾‹çš„ã€‚â½½å¯¹è±¡å­˜åœ¨äºå †å†…å­˜ï¼Œå±€éƒ¨å˜é‡åˆ™å­˜åœ¨äºæ ˆå†…å­˜ã€‚ â½£å­˜æ—¶é—´ ï¼šä»å˜é‡åœ¨å†…å­˜ä¸­çš„â½£å­˜æ—¶é—´ä¸Šçœ‹ï¼Œæˆå‘˜å˜é‡æ˜¯å¯¹è±¡çš„â¼€éƒ¨åˆ†ï¼Œå®ƒéšç€å¯¹è±¡çš„åˆ›å»ºâ½½ å­˜åœ¨ï¼Œâ½½å±€éƒ¨å˜é‡éšç€â½…æ³•çš„è°ƒâ½¤â½½â¾ƒåŠ¨â½£æˆï¼Œéšç€â½…æ³•çš„è°ƒâ½¤ç»“æŸâ½½æ¶ˆäº¡ã€‚ é»˜è®¤å€¼ ï¼šä»å˜é‡æ˜¯å¦æœ‰é»˜è®¤å€¼æ¥çœ‹ï¼Œæˆå‘˜å˜é‡å¦‚æœæ²¡æœ‰è¢«èµ‹åˆå§‹å€¼ï¼Œåˆ™ä¼šâ¾ƒåŠ¨ä»¥ç±»å‹çš„é»˜è®¤å€¼â½½èµ‹å€¼ï¼ˆâ¼€ç§æƒ…å†µä¾‹å¤–:è¢« final ä¿®é¥°çš„æˆå‘˜å˜é‡ä¹Ÿå¿…é¡»æ˜¾å¼åœ°èµ‹å€¼ï¼‰ï¼Œâ½½å±€éƒ¨å˜é‡åˆ™ä¸ä¼šâ¾ƒåŠ¨ èµ‹å€¼ã€‚ 5. é™æ€å˜é‡æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å…±äº«æ•°æ®ï¼š é™æ€å˜é‡å±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯ç±»çš„æŸä¸ªå…·ä½“å®ä¾‹ã€‚å› æ­¤ï¼Œæ— è®ºä¸€ä¸ªç±»åˆ›å»ºäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰è¿™äº›å¯¹è±¡éƒ½å…±äº«åŒä¸€ä»½é™æ€å˜é‡ã€‚è¿™ä½¿å¾—é™æ€å˜é‡éå¸¸é€‚åˆç”¨äºå­˜å‚¨ç±»çº§åˆ«çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯¹æ‰€æœ‰å®ä¾‹éƒ½æ˜¯ç›¸åŒçš„ã€‚ èŠ‚çœå†…å­˜ï¼š ç”±äºé™æ€å˜é‡æ˜¯ç±»çº§åˆ«çš„ï¼Œå®ƒåœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½å‰¯æœ¬ï¼Œæ— è®ºåˆ›å»ºå¤šå°‘ä¸ªç±»çš„å®ä¾‹ï¼Œéƒ½ä¸ä¼šé‡å¤å ç”¨å†…å­˜ã€‚è¿™åœ¨å¤„ç†å¤§é‡å¯¹è±¡æ—¶å¯ä»¥æ˜¾è‘—èŠ‚çœå†…å­˜èµ„æºã€‚ å¸¸é‡å®šä¹‰ï¼š é™æ€å˜é‡é€šå¸¸ä¼šè¢«finalå…³é”®å­—ä¿®é¥°ï¼Œæˆä¸ºå¸¸é‡ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¿™äº›å˜é‡çš„å€¼åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä»è€Œæé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 6. é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æœ‰ä½•ä¸åŒï¼Ÿ è°ƒç”¨æ–¹å¼ï¼š é™æ€æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡ç±»å.æ–¹æ³•åç›´æ¥è°ƒç”¨ï¼Œæ— éœ€åˆ›å»ºç±»çš„å®ä¾‹ã€‚è™½ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡è°ƒç”¨ï¼Œä½†è¿™ç§æ–¹å¼å®¹æ˜“é€ æˆæ··æ·†ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨ç±»å.æ–¹æ³•åæ¥è°ƒç”¨é™æ€æ–¹æ³•ã€‚ å®ä¾‹æ–¹æ³•ï¼šå¿…é¡»é€šè¿‡ç±»çš„å®ä¾‹è°ƒç”¨ï¼Œå³å¯¹è±¡.æ–¹æ³•åã€‚å®ä¾‹æ–¹æ³•ä¾èµ–äºå…·ä½“çš„å¯¹è±¡å®ä¾‹ã€‚ è®¿é—®ç±»æˆå‘˜çš„é™åˆ¶ï¼š é™æ€æ–¹æ³•ï¼šåªèƒ½è®¿é—®ç±»çš„é™æ€æˆå‘˜ï¼ˆé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ï¼‰ï¼Œä¸èƒ½è®¿é—®å®ä¾‹æˆå‘˜ï¼ˆå®ä¾‹å˜é‡å’Œå®ä¾‹æ–¹æ³•ï¼‰ã€‚è¿™æ˜¯å› ä¸ºé™æ€æ–¹æ³•å±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯æŸä¸ªå…·ä½“å®ä¾‹ã€‚ å®ä¾‹æ–¹æ³•ï¼šå¯ä»¥è®¿é—®ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬é™æ€æˆå‘˜å’Œå®ä¾‹æˆå‘˜ã€‚å®ä¾‹æ–¹æ³•ä¾èµ–äºå…·ä½“çš„å¯¹è±¡å®ä¾‹ï¼Œå› æ­¤å¯ä»¥è®¿é—®è¯¥å®ä¾‹çš„æ‰€æœ‰æˆå‘˜ã€‚ ä¸å¯¹è±¡çš„å…³ç³»ï¼š é™æ€æ–¹æ³•ï¼šå±äºç±»æœ¬èº«ï¼Œä¸å…·ä½“çš„å¯¹è±¡å®ä¾‹æ— å…³ã€‚æ— è®ºåˆ›å»ºå¤šå°‘ä¸ªå¯¹è±¡ï¼Œé™æ€æ–¹æ³•éƒ½åªæœ‰ä¸€ä»½ã€‚ å®ä¾‹æ–¹æ³•ï¼šå±äºå…·ä½“çš„å¯¹è±¡å®ä¾‹ï¼Œæ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½æœ‰è‡ªå·±çš„å®ä¾‹æ–¹æ³•ã€‚ 7. é‡è½½å’Œé‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ é‡è½½ï¼ˆOverloadingï¼‰\né‡è½½æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå…è®¸å®šä¹‰å¤šä¸ªåŒåæ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å¿…é¡»ä¸åŒ\né‡è½½å‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œç¼–è¯‘å™¨é€šè¿‡å‚æ•°åˆ—è¡¨æ¥åŒºåˆ†ä¸åŒçš„æ–¹æ³•ã€‚\né‡è½½å°±æ˜¯åŒâ¼€ä¸ªç±»ä¸­å¤šä¸ªåŒåæ–¹æ³•æ ¹æ®ä¸åŒçš„ä¼ å‚æ¥æ‰§è¡Œä¸åŒçš„é€»è¾‘å¤„ç†ã€‚\né‡å†™\né‡å†™å‘ç”Ÿåœ¨è¿è¡ŒæœŸï¼Œæ˜¯â¼¦ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•çš„å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™ã€‚\næ–¹æ³•åã€å‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒï¼Œå­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰ï¼ŒæŠ›å‡ºçš„ å¼‚å¸¸èŒƒå›´å°äºç­‰äºçˆ¶ç±»ï¼Œè®¿é—®ä¿®é¥°ç¬¦èŒƒå›´å¤§äºç­‰äºçˆ¶ç±»ã€‚å¦‚æœæ–¹æ³•çš„è¿”å› ç±»å‹æ˜¯ void å’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™è¿”å›å€¼é‡å†™æ—¶ä¸å¯ä¿®æ”¹ã€‚ä½†æ˜¯å¦‚æœæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‡å†™ æ—¶æ˜¯å¯ä»¥è¿”å›è¯¥å¼•â½¤ç±»å‹çš„å­ç±»çš„ã€‚ å¦‚æœçˆ¶ç±»æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦ä¸º private/final/static åˆ™å­ç±»å°±ä¸èƒ½é‡å†™è¯¥æ–¹æ³•ï¼Œä½†æ˜¯è¢« static ä¿®é¥°çš„æ–¹æ³•èƒ½å¤Ÿè¢«å†æ¬¡å£°æ˜ã€‚ æ„é€ æ–¹æ³•æ— æ³•è¢«é‡å†™ **å£è¯€ï¼š**æ–¹æ³•çš„é‡å†™è¦éµå¾ªâ€œä¸¤åŒä¸¤å°ä¸€å¤§â€\nâ€œä¸¤åŒâ€å³æ–¹æ³•åç›¸åŒã€å½¢å‚åˆ—è¡¨ç›¸åŒï¼›\nâ€œä¸¤å°â€æŒ‡çš„æ˜¯å­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰ï¼Œå­ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»åº”æ¯”çˆ¶ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»æ›´å°æˆ–ç›¸ç­‰ï¼›\nâ€œä¸€å¤§â€æŒ‡çš„æ˜¯å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™åº”æ¯”çˆ¶ç±»æ–¹æ³•çš„è®¿é—®æƒé™æ›´å¤§æˆ–ç›¸ç­‰ã€‚\n8. Java ä¸­çš„å‡ ç§åŸºæœ¬æ•°æ®ç±»å‹äº†è§£ä¹ˆï¼Ÿ Java ä¸­æœ‰ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š\n4 ç§æ•´æ•°å‹ï¼š byte ã€ short ã€ int ã€ long\n2 ç§æµ®ç‚¹å‹ï¼š float ï¼ˆ4ï¼‰ã€ doubleï¼ˆ8ï¼‰\n1 ç§å­—ç¬¦ç±»å‹ï¼šcharï¼ˆ2ï¼‰\n1 ç§å¸ƒå°”å‹ï¼š boolean\nbyteã€shortã€intã€longèƒ½è¡¨ç¤ºçš„æœ€å¤§æ­£æ•°éƒ½å‡ 1 äº†ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºæ³•ä¸­ï¼Œæœ€é«˜ä½æ˜¯ç”¨æ¥è¡¨ç¤ºç¬¦å·çš„ï¼ˆ0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°ï¼‰ï¼Œå…¶ä½™ä½è¡¨ç¤ºæ•°å€¼éƒ¨åˆ†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦è¡¨ç¤ºæœ€å¤§çš„æ­£æ•°ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé™¤äº†æœ€é«˜ä½ä¹‹å¤–çš„æ‰€æœ‰ä½éƒ½è®¾ä¸º 1ã€‚å¦‚æœæˆ‘ä»¬å†åŠ  1ï¼Œå°±ä¼šå¯¼è‡´æº¢å‡ºï¼Œå˜æˆä¸€ä¸ªè´Ÿæ•°ã€‚\n9. åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹çš„åŒºåˆ«ï¼Ÿ æˆå‘˜å˜é‡åŒ…è£…ç±»å‹ä¸èµ‹å€¼å°±æ˜¯ null ï¼Œè€ŒåŸºæœ¬ç±»å‹æœ‰é»˜è®¤å€¼ä¸”ä¸æ˜¯ null ã€‚ åŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥ã€‚ åŸºæœ¬æ•°æ®ç±»å‹çš„å±€éƒ¨å˜é‡å­˜æ”¾åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼ˆæœªè¢« static ä¿®é¥°ï¼‰å­˜æ”¾åœ¨ Java è™šæ‹Ÿæœºçš„å †ä¸­ã€‚åŒ…è£…ç±»å‹å±äºå¯¹è±¡ç±»å‹ï¼Œæˆ‘ä»¬çŸ¥é“å‡ ä¹æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½å­˜åœ¨äºå †ä¸­ã€‚ ç›¸æ¯”äºå¯¹è±¡ç±»å‹ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å ç”¨çš„ç©ºé—´éå¸¸å°ã€‚ âš  æ³¨æ„ï¼šåŸºæœ¬æ•°æ®ç±»å‹å­˜æ”¾åœ¨æ ˆä¸­æ˜¯ä¸€ä¸ªå¸¸è§çš„è¯¯åŒºï¼åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡å¦‚æœæ²¡æœ‰è¢« static ä¿®é¥°çš„è¯ï¼ˆä¸å»ºè®®è¿™ä¹ˆä½¿ç”¨ï¼Œåº”è¯¥è¦ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼‰ï¼Œå°±å­˜æ”¾åœ¨å †ä¸­ã€‚\n10. è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±äº†è§£å—ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ è£…ç®±ï¼šå°†åŸºæœ¬ç±»å‹ç”¨å®ƒä»¬å¯¹åº”çš„å¼•ç”¨ç±»å‹åŒ…è£…èµ·æ¥ï¼›\næ‹†ç®±ï¼šå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼›\nè£…ç®±å…¶å®å°±æ˜¯è°ƒç”¨äº† åŒ…è£…ç±»çš„ valueOf() æ–¹æ³•ï¼Œæ‹†ç®±å…¶å®å°±æ˜¯è°ƒç”¨äº† xxxValue() â½…æ³•ã€‚\nInteger i = 10 ç­‰ä»·äº Integer i = Integer.valueOf(10) int n = i ç­‰ä»·äº int n = i.intValue() ; 11. é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾ 1. å°è£… å°è£…æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼ˆå³å±æ€§ï¼‰éšè—åœ¨å¯¹è±¡å†…éƒ¨ï¼Œä¸å…è®¸å¤–éƒ¨ç›´æ¥è®¿é—®è¿™äº›å†…éƒ¨ä¿¡æ¯ã€‚ä½†å¯ä»¥é€šè¿‡ä¸€äº›å…¬å¼€çš„æ–¹æ³•æ¥æ“ä½œè¿™äº›å±æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ— æ³•çœ‹åˆ°æŒ‚åœ¨å¢™ä¸Šçš„ç©ºè°ƒå†…éƒ¨çš„é›¶ä»¶ï¼Œä½†å¯ä»¥é€šè¿‡é¥æ§å™¨æ¥æ§åˆ¶ç©ºè°ƒã€‚å¦‚æœæŸäº›å±æ€§ä¸æƒ³è¢«å¤–ç•Œè®¿é—®ï¼Œå¯ä»¥é€‰æ‹©ä¸æä¾›ç›¸åº”çš„æ–¹æ³•ã€‚ä½†å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰ä»»ä½•å¯è®¿é—®çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±å¤±å»äº†æ„ä¹‰ã€‚\n2. ç»§æ‰¿ ä¸åŒç±»å‹çš„å¯¹è±¡é€šå¸¸æœ‰ä¸€äº›å…±åŒç‚¹ã€‚ä¾‹å¦‚ï¼Œå°æ˜ã€å°çº¢å’Œå°æéƒ½æ˜¯å­¦ç”Ÿï¼Œå…±äº«å­¦ç”Ÿçš„ä¸€äº›ç‰¹æ€§ï¼ˆå¦‚ç­çº§ã€å­¦å·ç­‰ï¼‰ã€‚åŒæ—¶ï¼Œæ¯ä¸ªå¯¹è±¡ä¹Ÿæœ‰å…¶ç‹¬ç‰¹çš„ç‰¹æ€§ã€‚ç»§æ‰¿æ˜¯ä¸€ç§ä½¿ç”¨å·²å­˜åœ¨çš„ç±»å®šä¹‰ä½œä¸ºåŸºç¡€æ¥åˆ›å»ºæ–°ç±»çš„æŠ€æœ¯ã€‚æ–°ç±»å¯ä»¥å¢åŠ æ–°çš„æ•°æ®å’ŒåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½é€‰æ‹©æ€§åœ°ç»§æ‰¿çˆ¶ç±»ã€‚ç»§æ‰¿å¯ä»¥å¿«é€Ÿåˆ›å»ºæ–°ç±»ï¼Œæé«˜ä»£ç å¤ç”¨æ€§ï¼Œå¢å¼ºç¨‹åºçš„å¯ç»´æŠ¤æ€§ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´ã€‚\nå…³äºç»§æ‰¿çš„ä¸‰ä¸ªè¦ç‚¹ï¼š\nå­ç±»æ‹¥æœ‰çˆ¶ç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œä½†æ— æ³•è®¿é—®çˆ¶ç±»ä¸­çš„ç§æœ‰å±æ€§å’Œæ–¹æ³•ã€‚ å­ç±»å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ï¼Œå³å¯ä»¥å¯¹çˆ¶ç±»è¿›è¡Œæ‰©å±•ã€‚ å­ç±»å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼å®ç°çˆ¶ç±»çš„æ–¹æ³•ã€‚ 3. å¤šæ€ å¤šæ€è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¯ä»¥å…·æœ‰å¤šç§çŠ¶æ€ï¼Œå…·ä½“è¡¨ç°ä¸ºçˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘å­ç±»çš„å®ä¾‹ã€‚å¤šæ€çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š\nå¯¹è±¡ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¹‹é—´å¿…é¡»å­˜åœ¨ç»§æ‰¿ï¼ˆç±»ï¼‰æˆ–å®ç°ï¼ˆæ¥å£ï¼‰çš„å…³ç³»ã€‚ å¼•ç”¨ç±»å‹å˜é‡è°ƒç”¨çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šã€‚ å¤šæ€ä¸èƒ½è°ƒç”¨â€œåªåœ¨å­ç±»ä¸­å­˜åœ¨è€Œåœ¨çˆ¶ç±»ä¸­ä¸å­˜åœ¨â€çš„æ–¹æ³•ã€‚ å¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯å­ç±»è¦†ç›–çš„æ–¹æ³•ï¼›å¦‚æœæ²¡æœ‰è¦†ç›–ï¼Œåˆ™è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚ 12. æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆå…±åŒç‚¹å’ŒåŒºåˆ«ï¼Ÿ å…±åŒç‚¹\néƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚ éƒ½å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚ éƒ½å¯ä»¥æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼ˆJava 8 å¯ä»¥ç”¨defaultå…³é”®å­—åœ¨æ¥å£ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•ï¼‰ã€‚ åŒºåˆ«\næ¥å£ï¼š ä¸»è¦ç”¨äºå¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œçº¦æŸï¼Œå®ç°æ¥å£çš„ç±»å…·æœ‰å¯¹åº”çš„è¡Œä¸ºã€‚ ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚ æ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯public static finalç±»å‹çš„ï¼Œä¸èƒ½è¢«ä¿®æ”¹ä¸”å¿…é¡»æœ‰åˆå§‹å€¼ã€‚ æŠ½è±¡ç±»ï¼š ä¸»è¦ç”¨äºä»£ç å¤ç”¨ï¼Œå¼ºè°ƒçš„æ˜¯æ‰€å±å…³ç³»ã€‚ ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ æŠ½è±¡ç±»çš„æˆå‘˜å˜é‡é»˜è®¤æ˜¯defaultï¼Œå¯ä»¥åœ¨å­ç±»ä¸­è¢«é‡æ–°å®šä¹‰æˆ–èµ‹å€¼ã€‚ 13. æ·±æ‹·è´ã€æµ…æ‹·è´å’Œå¼•ç”¨æ‹·è´çš„åŒºåˆ« å¼•ç”¨æ‹·è´æ˜¯æŒ‡ä¸¤ä¸ªä¸åŒçš„å¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚è¿™ç§æ–¹å¼ä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œåªæ˜¯å°†ä¸€ä¸ªå¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå¼•ç”¨ã€‚\næµ…æ‹·è´ä¼šåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä½†ä¸ä¼šå¤åˆ¶å¯¹è±¡å†…éƒ¨çš„å¼•ç”¨ç±»å‹å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæµ…æ‹·è´çš„å¯¹è±¡å’ŒåŸå¯¹è±¡å…±äº«å†…éƒ¨çš„å¼•ç”¨ç±»å‹å±æ€§ã€‚\næ·±æ‹·è´ä¼šå®Œå…¨å¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å¯¹è±¡å†…éƒ¨çš„æ‰€æœ‰å¼•ç”¨ç±»å‹å±æ€§ã€‚æ·±æ‹·è´çš„å¯¹è±¡å’ŒåŸå¯¹è±¡å®Œå…¨ç‹¬ç«‹ï¼Œä¸å…±äº«ä»»ä½•å¼•ç”¨ç±»å‹å±æ€§ã€‚\n14. == å’Œ equals() çš„åŒºåˆ« == çš„ä½œç”¨ï¼š åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚ å¼•ç”¨æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå³æ¯”è¾ƒå†…å­˜åœ°å€ã€‚ æ³¨æ„ï¼šJavaä¸­åªæœ‰å€¼ä¼ é€’ï¼Œæ— è®ºæ˜¯æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹è¿˜æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œ== æ¯”è¾ƒçš„éƒ½æ˜¯å€¼ã€‚å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå€¼æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ equals() çš„ä½œç”¨ï¼š åŸºæœ¬æ•°æ®ç±»å‹ï¼šequals() æ–¹æ³•ä¸èƒ½ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œåªèƒ½ç”¨äºå¯¹è±¡ã€‚ å¼•ç”¨æ•°æ®ç±»å‹ï¼šequals() æ–¹æ³•ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚equals() æ–¹æ³•å­˜åœ¨äº Object ç±»ä¸­ï¼Œæ‰€æœ‰ç±»éƒ½ç»§æ‰¿è‡ª Object ç±»ï¼Œå› æ­¤æ‰€æœ‰ç±»éƒ½æœ‰ equals() æ–¹æ³•ã€‚ é»˜è®¤è¡Œä¸ºï¼šObject ç±»ä¸­çš„ equals() æ–¹æ³•é»˜è®¤æ¯”è¾ƒå¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œç­‰åŒäº ==ã€‚ é‡å†™è¡Œä¸ºï¼šé€šå¸¸æˆ‘ä»¬ä¼šé‡å†™ equals() æ–¹æ³•æ¥æ¯”è¾ƒå¯¹è±¡çš„å±æ€§æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„å±æ€§ç›¸ç­‰ï¼Œåˆ™è¿”å› trueï¼Œè¡¨ç¤ºè¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ã€‚ 15. hashCode() æœ‰ä»€ä¹ˆç”¨ï¼Ÿ hashCode() çš„ä½œç”¨æ˜¯è·å–å“ˆå¸Œç ï¼ˆä¸€ä¸ªæ•´æ•°ï¼‰ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ã€‚è¿™ä¸ªå“ˆå¸Œç çš„ä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚hashCode() å®šä¹‰åœ¨ JDK çš„ Object ç±»ä¸­ï¼Œè¿™å°±æ„å‘³ç€ Java ä¸­çš„ä»»ä½•ç±»éƒ½åŒ…å«æœ‰ hashCode() æ–¹æ³•ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼šObject çš„ hashCode() æ–¹æ³•æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”¨ C è¯­è¨€æˆ– C++ å®ç°çš„ï¼Œè¯¥æ–¹æ³•é€šå¸¸ç”¨æ¥å°†å¯¹è±¡çš„å†…å­˜åœ°å€è½¬æ¢ä¸ºæ•´æ•°ä¹‹åè¿”å›ã€‚\næ•£åˆ—è¡¨å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ï¼ˆkey-valueï¼‰ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šèƒ½æ ¹æ®â€œé”®â€å¿«é€Ÿæ£€ç´¢å‡ºå¯¹åº”çš„â€œå€¼â€ã€‚è¿™å…¶ä¸­å°±åˆ©ç”¨åˆ°äº†æ•£åˆ—ç ï¼ï¼ˆå¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€è¦çš„å¯¹è±¡ï¼‰\nä¸ºä»€ä¹ˆè¦æœ‰ hashCode()ï¼Ÿ\næˆ‘ä»¬ä»¥â€œHashSet å¦‚ä½•æ£€æŸ¥é‡å¤â€ä¸ºä¾‹æ¥è¯´æ˜ä¸ºä»€ä¹ˆè¦æœ‰ hashCode()ã€‚å½“ä½ æŠŠå¯¹è±¡åŠ å…¥ HashSet æ—¶ï¼ŒHashSet ä¼šå…ˆè®¡ç®—å¯¹è±¡çš„ hashCode å€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–å·²ç»åŠ å…¥çš„å¯¹è±¡çš„ hashCode å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„ hashCodeï¼ŒHashSet ä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒ hashCode å€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨ equals() æ–¹æ³•æ¥æ£€æŸ¥ hashCode ç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSet å°±ä¸ä¼šè®©å…¶åŠ å…¥æ“ä½œæˆåŠŸã€‚å¦‚æœä¸åŒçš„è¯ï¼Œå°±ä¼šé‡æ–°æ•£åˆ—åˆ°å…¶ä»–ä½ç½®ã€‚è¿™æ ·æˆ‘ä»¬å¤§å¤§å‡å°‘äº† equals çš„æ¬¡æ•°ï¼Œç›¸åº”å°±å¤§å¤§æé«˜äº†æ‰§è¡Œé€Ÿåº¦ã€‚\nhashCode() å’Œ equals() éƒ½æ˜¯ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„ã€‚é‚£ä¸ºä»€ä¹ˆ JDK è¿˜è¦åŒæ—¶æä¾›è¿™ä¸¤ä¸ªæ–¹æ³•å‘¢ï¼Ÿ\nè¿™æ˜¯å› ä¸ºåœ¨ä¸€äº›å®¹å™¨ï¼ˆæ¯”å¦‚ HashMapã€HashSetï¼‰ä¸­ï¼Œæœ‰äº† hashCode() ä¹‹åï¼Œåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨å¯¹åº”å®¹å™¨ä¸­çš„æ•ˆç‡ä¼šæ›´é«˜ï¼ˆå‚è€ƒæ·»åŠ å…ƒç´ è¿› HashSet çš„è¿‡ç¨‹ï¼‰ï¼æˆ‘ä»¬åœ¨å‰é¢ä¹Ÿæåˆ°äº†æ·»åŠ å…ƒç´ è¿› HashSet çš„è¿‡ç¨‹ï¼Œå¦‚æœ HashSet åœ¨å¯¹æ¯”çš„æ—¶å€™ï¼ŒåŒæ ·çš„ hashCode æœ‰å¤šä¸ªå¯¹è±¡ï¼Œå®ƒä¼šç»§ç»­ä½¿ç”¨ equals() æ¥åˆ¤æ–­æ˜¯å¦çœŸçš„ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ hashCode å¸®åŠ©æˆ‘ä»¬å¤§å¤§ç¼©å°äº†æŸ¥æ‰¾æˆæœ¬ã€‚\né‚£ä¸ºä»€ä¹ˆä¸åªæä¾› hashCode() æ–¹æ³•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸¤ä¸ªå¯¹è±¡çš„ hashCode å€¼ç›¸ç­‰å¹¶ä¸ä»£è¡¨ä¸¤ä¸ªå¯¹è±¡å°±ç›¸ç­‰ã€‚é‚£ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashCode å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šç›¸ç­‰å‘¢ï¼Ÿ\nå› ä¸º hashCode() æ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ä¹Ÿè®¸åˆšå¥½ä¼šè®©å¤šä¸ªå¯¹è±¡ä¼ å›ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚è¶Šç³Ÿç³•çš„å“ˆå¸Œç®—æ³•è¶Šå®¹æ˜“ç¢°æ’ï¼Œä½†è¿™ä¹Ÿä¸æ•°æ®å€¼åŸŸåˆ†å¸ƒçš„ç‰¹æ€§æœ‰å…³ï¼ˆæ‰€è°“å“ˆå¸Œç¢°æ’ä¹Ÿå°±æ˜¯æŒ‡çš„æ˜¯ä¸åŒçš„å¯¹è±¡å¾—åˆ°ç›¸åŒçš„ hashCodeï¼‰ã€‚\nä¸ºä»€ä¹ˆé‡å†™ equals() æ—¶å¿…é¡»é‡å†™ hashCode() æ–¹æ³•ï¼Ÿ\nå› ä¸ºä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡çš„ hashCode å€¼å¿…é¡»æ˜¯ç›¸ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ equals() æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£è¿™ä¸¤ä¸ªå¯¹è±¡çš„ hashCode å€¼ä¹Ÿè¦ç›¸ç­‰ã€‚å¦‚æœé‡å†™ equals() æ—¶æ²¡æœ‰é‡å†™ hashCode() æ–¹æ³•çš„è¯å°±å¯èƒ½ä¼šå¯¼è‡´ equals() æ–¹æ³•åˆ¤æ–­æ˜¯ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼ŒhashCode å€¼å´ä¸ç›¸ç­‰ã€‚\n16. Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«ï¼Ÿ çº¿ç¨‹å®‰å…¨æ€§\nString ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡ï¼Œçº¿ç¨‹å®‰å…¨ã€‚ AbstractStringBuilder æ˜¯ StringBuilder ä¸ StringBuffer çš„å…¬å…±çˆ¶ç±»ï¼Œå®šä¹‰äº†ä¸€äº›å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ expandCapacityã€appendã€insertã€indexOf ç­‰å…¬å…±æ–¹æ³•ã€‚ StringBuffer å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ StringBuilder å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ æ€§èƒ½\næ¯æ¬¡å¯¹ String ç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ã€‚ StringBuffer æ¯æ¬¡éƒ½ä¼šå¯¹ StringBuffer å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„å¯¹è±¡å¹¶æ”¹å˜å¯¹è±¡å¼•ç”¨ã€‚ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨ StringBuilder ç›¸æ¯”ä½¿ç”¨ StringBuffer ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§èƒ½æå‡ï¼Œä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©ã€‚ String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„ï¼Ÿ\nä¿å­˜å­—ç¬¦ä¸²çš„æ•°ç»„è¢« final ä¿®é¥°ä¸”ä¸ºç§æœ‰çš„ï¼Œå¹¶ä¸” String ç±»æ²¡æœ‰æä¾›/æš´éœ²ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚ String ç±»è¢« final ä¿®é¥°å¯¼è‡´å…¶ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿›è€Œé¿å…äº†å­ç±»ç ´å String ä¸å¯å˜ã€‚ å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ+â€ è¿˜æ˜¯ StringBuilder?\nå­—ç¬¦ä¸²å¯¹è±¡é€šè¿‡â€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ StringBuilder è°ƒç”¨ append() æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ toString() å¾—åˆ°ä¸€ä¸ª String å¯¹è±¡ ã€‚ ä¸è¿‡ï¼Œåœ¨å¾ªç¯å†…ä½¿ç”¨â€œ+â€è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥çš„è¯ï¼Œå­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºé™·ï¼šç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºå•ä¸ª StringBuilder ä»¥å¤ç”¨ï¼Œä¼šå¯¼è‡´åˆ›å»ºè¿‡å¤šçš„ StringBuilder å¯¹è±¡ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ StringBuilder å¯¹è±¡è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥çš„è¯ï¼Œå°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜äº†ã€‚ String#equals() å’Œ Object#equals() æœ‰ä½•åŒºåˆ«ï¼Ÿ\nString ä¸­çš„ equals æ–¹æ³•æ˜¯è¢«é‡å†™è¿‡çš„ï¼Œæ¯”è¾ƒçš„æ˜¯ String å­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚ Object çš„ equals æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½œç”¨äº†è§£å—ï¼Ÿ\nå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚ intern æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ\nString.intern() æ˜¯ä¸€ä¸ª nativeï¼ˆæœ¬åœ°ï¼‰æ–¹æ³•ï¼Œå…¶ä½œç”¨æ˜¯å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¯ä»¥ç®€å•åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå°±ç›´æ¥è¿”å›è¯¥å¼•ç”¨ã€‚ å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£å°±åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨å¹¶è¿”å›ã€‚ 17. Exception å’Œ Error çš„åŒºåˆ« åœ¨ Java é‡Œï¼Œæ‰€æœ‰å¼‚å¸¸éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆï¼Œå³java.langåŒ…ä¸­çš„Throwableç±»ã€‚Throwableç±»æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±»ï¼š\nExceptionï¼šæ˜¯ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œèƒ½å¤Ÿé€šè¿‡catchè¯­å¥æ¥æ•è·ã€‚å®ƒåˆå¯ç»†åˆ†ä¸ºChecked Exceptionï¼ˆå—æ£€æŸ¥å¼‚å¸¸ï¼Œå¿…é¡»å¤„ç†ï¼‰å’ŒUnchecked Exceptionï¼ˆä¸å—æ£€æŸ¥å¼‚å¸¸ï¼Œå¯ä»¥ä¸å¤„ç†ï¼‰ã€‚ Errorï¼šå±äºç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œä¸å»ºè®®é€šè¿‡catchæ•è·ã€‚ä¾‹å¦‚Javaè™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆVirtual MachineErrorï¼‰ã€è™šæ‹Ÿæœºå†…å­˜ä¸å¤Ÿé”™è¯¯ï¼ˆOutOfMemoryErrorï¼‰ã€ç±»å®šä¹‰é”™è¯¯ï¼ˆNoClassDefFoundErrorï¼‰ç­‰ã€‚å½“è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰é€šå¸¸ä¼šé€‰æ‹©ç»ˆæ­¢çº¿ç¨‹ã€‚ 18. Checked Exception å’Œ Unchecked Exception çš„åŒºåˆ« Checked Exceptionï¼ˆå—æ£€æŸ¥å¼‚å¸¸ï¼‰ï¼šåœ¨ Java ä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå—æ£€æŸ¥å¼‚å¸¸æ²¡æœ‰è¢«catchæˆ–è€…throwså…³é”®å­—å¤„ç†ï¼Œä»£ç å°±æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚é™¤äº†RuntimeExceptionåŠå…¶å­ç±»ä»¥å¤–ï¼Œå…¶ä»–çš„Exceptionç±»åŠå…¶å­ç±»éƒ½å±äºå—æ£€æŸ¥å¼‚å¸¸ã€‚å¸¸è§çš„å—æ£€æŸ¥å¼‚å¸¸æœ‰ï¼šä¸IOç›¸å…³çš„å¼‚å¸¸ã€ClassNotFoundExceptionã€SQLExceptionç­‰ã€‚\nUnchecked Exceptionï¼ˆä¸å—æ£€æŸ¥å¼‚å¸¸ï¼‰ï¼šåœ¨ Java ä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå³ä½¿ä¸å¤„ç†ä¸å—æ£€æŸ¥å¼‚å¸¸ï¼Œä»£ç ä¹Ÿèƒ½æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚\nRuntimeExceptionåŠå…¶å­ç±»éƒ½è¢«ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œå¸¸è§çš„æœ‰ï¼š\nNullPointerExceptionï¼ˆç©ºæŒ‡é’ˆé”™è¯¯ï¼‰ IllegalArgumentExceptionï¼ˆå‚æ•°é”™è¯¯ï¼Œæ¯”å¦‚æ–¹æ³•å…¥å‚ç±»å‹é”™è¯¯ï¼‰ NumberFormatExceptionï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯ï¼Œæ˜¯IllegalArgumentExceptionçš„å­ç±»ï¼‰ ArrayIndexOutOfBoundsExceptionï¼ˆæ•°ç»„è¶Šç•Œé”™è¯¯ï¼‰ ClassCastExceptionï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰ ArithmeticExceptionï¼ˆç®—æœ¯é”™è¯¯ï¼‰ SecurityExceptionï¼ˆå®‰å…¨é”™è¯¯ï¼Œæ¯”å¦‚æƒé™ä¸å¤Ÿï¼‰ UnsupportedOperationExceptionï¼ˆä¸æ”¯æŒçš„æ“ä½œé”™è¯¯ï¼Œæ¯”å¦‚é‡å¤åˆ›å»ºåŒä¸€ç”¨æˆ· 19. Throwable ç±»å¸¸ç”¨æ–¹æ³• String getMessage()ï¼šè¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„ç®€è¦æè¿°ã€‚ String toString()ï¼šè¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯ã€‚ String getLocalizedMessage()ï¼šè¿”å›å¼‚å¸¸å¯¹è±¡çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€‚Throwableçš„å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”Ÿæˆæœ¬åœ°åŒ–ä¿¡æ¯ã€‚è‹¥å­ç±»æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸getMessage()è¿”å›çš„ç»“æœç›¸åŒã€‚ void printStackTrace()ï¼šåœ¨æ§åˆ¶å°ä¸Šæ‰“å°Throwableå¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯ã€‚ 20. try-catch-finally çš„ä½¿ç”¨ try å—ï¼šç”¨äºæ•è·å¼‚å¸¸ã€‚å…¶åå¯ä»¥æ¥é›¶ä¸ªæˆ–å¤šä¸ªcatchå—ï¼Œå¦‚æœæ²¡æœ‰catchå—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ªfinallyå—ã€‚ catch å—ï¼šç”¨äºå¤„ç†tryæ•è·åˆ°çš„å¼‚å¸¸ã€‚ finally å—ï¼šæ— è®ºæ˜¯å¦æ•è·æˆ–å¤„ç†å¼‚å¸¸ï¼Œfinallyå—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨tryå—æˆ–catchå—ä¸­é‡åˆ°returnè¯­å¥æ—¶ï¼Œfinallyè¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚ æ³¨æ„ï¼šä¸è¦åœ¨finallyè¯­å¥å—ä¸­ä½¿ç”¨returnï¼å½“tryè¯­å¥å’Œfinallyè¯­å¥ä¸­éƒ½æœ‰returnè¯­å¥æ—¶ï¼Œtryè¯­å¥å—ä¸­çš„returnè¯­å¥ä¼šè¢«å¿½ç•¥ã€‚è¿™æ˜¯å› ä¸ºtryè¯­å¥ä¸­çš„returnè¿”å›å€¼ä¼šå…ˆè¢«æš‚å­˜åœ¨ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸­ï¼Œå½“æ‰§è¡Œåˆ°finallyè¯­å¥ä¸­çš„returnä¹‹åï¼Œè¿™ä¸ªæœ¬åœ°å˜é‡çš„å€¼å°±å˜ä¸ºäº†finallyè¯­å¥ä¸­çš„returnè¿”å›å€¼ã€‚\n21. finally ä¸­çš„ä»£ç ä¸€å®šä¼šæ‰§è¡Œå—ï¼Ÿ ä¸ä¸€å®šã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œfinallyä¸­çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ¯”å¦‚ï¼š\nfinallyä¹‹å‰è™šæ‹Ÿæœºè¢«ç»ˆæ­¢è¿è¡Œï¼Œä¾‹å¦‚ä½¿ç”¨System.exit(1)ç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„ Java è™šæ‹Ÿæœºã€‚ ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ã€‚ å…³é—­ CPUã€‚ 22. å¼‚å¸¸ä½¿ç”¨æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ ä¸è¦æŠŠå¼‚å¸¸å®šä¹‰ä¸ºé™æ€å˜é‡ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´å¼‚å¸¸æ ˆä¿¡æ¯é”™ä¹±ã€‚æ¯æ¬¡æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ‰‹åŠ¨ new ä¸€ä¸ªå¼‚å¸¸å¯¹è±¡æŠ›å‡ºã€‚ æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ä¸€å®šè¦æœ‰æ„ä¹‰ã€‚ å»ºè®®æŠ›å‡ºæ›´åŠ å…·ä½“çš„å¼‚å¸¸ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯çš„æ—¶å€™åº”è¯¥æŠ›å‡º NumberFormatException è€Œä¸æ˜¯å…¶çˆ¶ç±» IllegalArgumentExceptionã€‚ ä½¿ç”¨æ—¥å¿—æ‰“å°å¼‚å¸¸ä¹‹åå°±ä¸è¦å†æŠ›å‡ºå¼‚å¸¸äº†ï¼ˆä¸¤è€…ä¸è¦åŒæ—¶å­˜åœ¨äºä¸€æ®µä»£ç é€»è¾‘ä¸­ï¼‰ã€‚ 23. åå°„ å®šä¹‰ï¼šåå°„èµ‹äºˆäº† Java ç¨‹åºåœ¨è¿è¡Œæ—¶åˆ†æç±»ä»¥åŠæ‰§è¡Œç±»ä¸­æ–¹æ³•çš„èƒ½åŠ›ã€‚å€ŸåŠ©åå°„ï¼Œèƒ½å¤Ÿè·å–ä»»æ„ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥è°ƒç”¨è¿™äº›æ–¹æ³•å’Œå±æ€§ã€‚è‹¥æ·±å…¥ç ”ç©¶æ¡†æ¶åº•å±‚åŸç†æˆ–è‡ªè¡Œç¼–å†™æ¡†æ¶ï¼Œå¯¹åå°„æ¦‚å¿µä¼šè¾ƒä¸ºç†Ÿæ‚‰ï¼Œå› å…¶è¢«ç§°ä¸ºæ¡†æ¶çš„çµé­‚ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šä½¿ä»£ç æ›´çµæ´»ï¼Œä¸ºå„ç§æ¡†æ¶å®ç°å¼€ç®±å³ç”¨çš„åŠŸèƒ½æä¾›ä¾¿åˆ©ã€‚ ç¼ºç‚¹ï¼šå¢åŠ å®‰å…¨é—®é¢˜ï¼Œä¾‹å¦‚å¯æ— è§†æ³›å‹å‚æ•°åœ¨ç¼–è¯‘æ—¶çš„å®‰å…¨æ£€æŸ¥ï¼›æ€§èƒ½ç›¸å¯¹ç¨å·®ï¼Œä½†å¯¹æ¡†æ¶å®é™…å½±å“ä¸å¤§ã€‚ åº”ç”¨åœºæ™¯ åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œç›´æ¥ä½¿ç”¨åå°„æœºåˆ¶çš„åœºæ™¯è¾ƒå°‘ã€‚ç„¶è€Œï¼Œä¼—å¤šæ¡†æ¶å¦‚ Spring/Spring Bootã€MyBatis ç­‰å¤§é‡è¿ç”¨äº†åå°„æœºåˆ¶ã€‚ åŠ¨æ€ä»£ç†åœ¨è¿™äº›æ¡†æ¶ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œè€ŒåŠ¨æ€ä»£ç†çš„å®ç°ä¾èµ–åå°„ã€‚ä¾‹å¦‚ JDK å®ç°åŠ¨æ€ä»£ç†çš„ç¤ºä¾‹ä»£ç ï¼Œé€šè¿‡åå°„ç±»Methodè°ƒç”¨æŒ‡å®šæ–¹æ³•ã€‚ æ³¨è§£çš„å®ç°ä¹Ÿç”¨åˆ°åå°„ã€‚ä»¥ Spring ä¸ºä¾‹ï¼Œä½¿ç”¨@Componentæ³¨è§£å£°æ˜ä¸€ä¸ªç±»ä¸º Spring Beanï¼Œé€šè¿‡@Valueæ³¨è§£è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å€¼ï¼Œå…¶åŸç†æ˜¯åŸºäºåå°„åˆ†æç±»ï¼Œè·å–ç±»ã€å±æ€§ã€æ–¹æ³•åŠæ–¹æ³•å‚æ•°ä¸Šçš„æ³¨è§£ï¼Œè¿›è€Œè¿›è¡Œåç»­å¤„ç†ã€‚ 24. åºåˆ—åŒ–ä¸ååºåˆ—åŒ– å¦‚æœæˆ‘ä»¬éœ€è¦æŒä¹…åŒ– Java å¯¹è±¡æ¯”å¦‚å°† Java å¯¹è±¡ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨ç½‘ç»œä¼ è¾“ Java å¯¹è±¡ï¼Œè¿™äº›åœºæ™¯éƒ½éœ€è¦ç”¨åˆ°åºåˆ—åŒ–ã€‚\nå®šä¹‰ åºåˆ—åŒ–ï¼šå°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµçš„è¿‡ç¨‹ã€‚å½“éœ€è¦æŒä¹…åŒ– Java å¯¹è±¡ï¼Œå¦‚ä¿å­˜åœ¨æ–‡ä»¶ä¸­æˆ–åœ¨ç½‘ç»œä¼ è¾“ Java å¯¹è±¡æ—¶ï¼Œä¼šç”¨åˆ°åºåˆ—åŒ–ã€‚ ååºåˆ—åŒ–ï¼šå°†åºåˆ—åŒ–è¿‡ç¨‹ä¸­ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµè½¬æ¢å›æ•°æ®ç»“æ„æˆ–å¯¹è±¡çš„è¿‡ç¨‹ã€‚ ä¸æƒ³åºåˆ—åŒ–æŸäº›å­—æ®µçš„å¤„ç†æ–¹å¼ï¼šå¯¹äºä¸æƒ³è¿›è¡Œåºåˆ—åŒ–çš„å˜é‡ï¼Œä½¿ç”¨transientå…³é”®å­—ä¿®é¥°ã€‚transientå…³é”®å­—ä½œç”¨ä¸ºé˜»æ­¢å®ä¾‹ä¸­è¢«å…¶ä¿®é¥°çš„å˜é‡åºåˆ—åŒ–ï¼›å¯¹è±¡ååºåˆ—åŒ–æ—¶ï¼Œè¢«transientä¿®é¥°çš„å˜é‡å€¼ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤ã€‚éœ€æ³¨æ„ï¼štransientåªèƒ½ä¿®é¥°å˜é‡ï¼Œä¸èƒ½ä¿®é¥°ç±»å’Œæ–¹æ³•ï¼›è¢«å…¶ä¿®é¥°çš„å˜é‡ï¼Œååºåˆ—åŒ–åå€¼å°†è¢«ç½®ä¸ºç±»å‹é»˜è®¤å€¼ï¼ˆå¦‚intç±»å‹ä¸º 0ï¼‰ï¼›staticå˜é‡ä¸å±äºä»»ä½•å¯¹è±¡ï¼Œæ— è®ºæ˜¯å¦æœ‰transientä¿®é¥°ï¼Œå‡ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚ 26. Java IO æµäº†è§£å—ï¼Ÿ Java IOæµæ¦‚è¿°ï¼šJava IOæµæ˜¯Javaä¸­ç”¨äºå¤„ç†è¾“å…¥è¾“å‡ºçš„æ ¸å¿ƒæœºåˆ¶ï¼Œæ•°æ®è¾“å…¥åˆ°è®¡ç®—æœºå†…å­˜çš„è¿‡ç¨‹ç§°ä¸ºè¾“å…¥ï¼Œä»å†…å­˜è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚æ–‡ä»¶ã€æ•°æ®åº“ã€è¿œç¨‹ä¸»æœºç­‰ï¼‰çš„è¿‡ç¨‹ç§°ä¸ºè¾“å‡ºã€‚ç”±äºæ•°æ®ä¼ è¾“è¿‡ç¨‹ç±»ä¼¼äºæ°´æµï¼Œå› æ­¤å½¢è±¡åœ°ç§°ä¸ºIOæµã€‚Java IOæµåˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµï¼Œæ ¹æ®æ•°æ®å¤„ç†æ–¹å¼åˆåˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚ æŠ½è±¡åŸºç±»ï¼šJava IOæµçš„40å¤šä¸ªç±»éƒ½æ˜¯ä»4ä¸ªæŠ½è±¡ç±»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥çš„ï¼Œåˆ†åˆ«æ˜¯InputStreamå’ŒReaderï¼ˆè¾“å…¥æµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å…¥æµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å…¥æµï¼‰ï¼Œä»¥åŠOutputStreamå’ŒWriterï¼ˆè¾“å‡ºæµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å‡ºæµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å‡ºæµï¼‰ã€‚ Bufferedç±»çš„ä½œç”¨ï¼šä¸ºäº†æé«˜IOæ“ä½œçš„æ•ˆç‡ï¼ŒJavaæä¾›äº†BufferedInputStreamã€BufferedOutputStreamã€BufferedReaderå’ŒBufferedWriterè¿™å‡ ä¸ªç±»ã€‚å®ƒä»¬åˆ†åˆ«ç»§æ‰¿è‡ªå¯¹åº”çš„è¾“å…¥è¾“å‡ºæµç±»ï¼Œå¹¶åœ¨å†…éƒ¨ä½¿ç”¨ç¼“å†²åŒºæ¥å‡å°‘ç‰©ç†è¯»å†™æ¬¡æ•°ã€‚ å¯¹äºè¾“å…¥æµï¼šBufferedInputStreamå’ŒBufferedReaderä¼šåœ¨ç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ï¼Œå°†æ•°æ®å—ä¸€æ¬¡æ€§è¯»å…¥ç¼“å†²åŒºï¼Œä¹‹åçš„è¯»å–æ“ä½œå…ˆä»ç¼“å†²åŒºä¸­è·å–æ•°æ®ï¼Œåªæœ‰å½“ç¼“å†²åŒºä¸­çš„æ•°æ®è¢«è¯»å®Œåï¼Œæ‰ä¼šå†æ¬¡ä»åº•å±‚æ•°æ®æºè¯»å–æ•°æ®å¡«å……ç¼“å†²åŒºã€‚è¿™ç§æ–¹å¼å‡å°‘äº†å¯¹åº•å±‚æ•°æ®æºçš„é¢‘ç¹è®¿é—®ï¼Œæé«˜äº†è¯»å–æ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œå½“è¯»å–å¤§æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨BufferedReaderå¯ä»¥æ˜¾è‘—æå‡è¯»å–é€Ÿåº¦ã€‚ å¯¹äºè¾“å‡ºæµï¼šBufferedOutputStreamå’ŒBufferedWriterä¼šå…ˆå°†è¦å†™å…¥çš„æ•°æ®æš‚å­˜åˆ°ç¼“å†²åŒºä¸­ï¼Œå½“ç¼“å†²åŒºæ»¡æˆ–è€…è°ƒç”¨flush()æ–¹æ³•æ—¶ï¼Œæ‰å°†ç¼“å†²åŒºä¸­çš„æ•°æ®ä¸€æ¬¡æ€§å†™å…¥ç›®æ ‡å­˜å‚¨ã€‚è¿™æ ·å¯ä»¥å‡å°‘å¯¹ç›®æ ‡å­˜å‚¨çš„å†™å…¥æ¬¡æ•°ï¼Œæé«˜å†™å…¥æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿèƒ½é¿å…é¢‘ç¹å†™å…¥å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚æ¯”å¦‚åœ¨å†™å…¥å¤§é‡æ–‡æœ¬æ•°æ®åˆ°æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨BufferedWriterå¯ä»¥æ›´é«˜æ•ˆåœ°å®Œæˆå†™å…¥æ“ä½œã€‚ 27. ä¸ºä»€ä¹ˆJavaçš„I/Oæµè¦åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµï¼Ÿ ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š\nå­—ç¬¦æµæ¶‰åŠç¼–ç è½¬æ¢ï¼š å­—ç¬¦æµæ˜¯ç”±Javaè™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹æ¶‰åŠåˆ°å­—ç¬¦ç¼–ç ï¼ˆå¦‚UTF-8ã€ISO-8859-1ç­‰ï¼‰ï¼Œè€Œä¸åŒçš„ç¼–ç æ–¹å¼ä¼šå¯¼è‡´ç›¸åŒçš„å­—èŠ‚åºåˆ—è¢«è§£é‡Šä¸ºä¸åŒçš„å­—ç¬¦ã€‚å› æ­¤ï¼Œå­—ç¬¦æµçš„å¤„ç†ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦è€ƒè™‘ç¼–ç é—®é¢˜ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—æ—¶ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªå­—èŠ‚åºåˆ—åœ¨UTF-8ç¼–ç ä¸‹å¯èƒ½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè€Œåœ¨ISO-8859-1ç¼–ç ä¸‹å¯èƒ½è¡¨ç¤ºå¦ä¸€ä¸ªå­—ç¬¦ã€‚å­—ç¬¦æµé€šè¿‡æŒ‡å®šç¼–ç æ–¹å¼ï¼Œç¡®ä¿å­—ç¬¦çš„æ­£ç¡®è¯»å–å’Œå†™å…¥ã€‚ å­—èŠ‚æµå’Œå­—ç¬¦æµçš„é€‚ç”¨åœºæ™¯ä¸åŒï¼š å­—èŠ‚æµï¼šé€‚ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚æ–‡ä»¶çš„è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚å­—èŠ‚æµç›´æ¥æ“ä½œå­—èŠ‚ï¼Œä¸æ¶‰åŠç¼–ç è½¬æ¢ï¼Œå› æ­¤æ•ˆç‡è¾ƒé«˜ï¼Œé€‚åˆå¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ç­‰ï¼‰ã€‚ å­—ç¬¦æµï¼šé€‚ç”¨äºå¤„ç†æ–‡æœ¬æ•°æ®ã€‚å­—ç¬¦æµåœ¨å¤„ç†æ–‡æœ¬æ—¶ä¼šè‡ªåŠ¨å¤„ç†ç¼–ç é—®é¢˜ï¼Œç¡®ä¿æ–‡æœ¬å†…å®¹çš„æ­£ç¡®æ€§ï¼Œé€‚åˆå¤„ç†æ–‡æœ¬æ–‡ä»¶ï¼ˆå¦‚.txtã€.javaç­‰ï¼‰ã€‚ 28. æ³›å‹ æŒ‡å®šå‚æ•°ï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹æ³›å‹å‚æ•°è¿›è¡Œæ£€æµ‹ï¼Œå¹¶ä¸”é€šè¿‡æ³›å‹å‚æ•°å¯ä»¥æŒ‡å®šä¼ å…¥çš„å¯¹è±¡ç±»å‹ã€‚\næ¯”å¦‚ ArrayList\u0026lt;Person\u0026gt; persons = new ArrayList\u0026lt;Person\u0026gt;() è¿™è¡Œä»£ç å°±æŒ‡æ˜äº†è¯¥ ArrayList å¯¹è±¡åªèƒ½ä¼ å…¥ Person å¯¹è±¡ï¼Œå¦‚æœä¼ å…¥å…¶ä»–ç±»å‹çš„å¯¹è±¡å°±ä¼šæŠ¥é”™ã€‚\n29. ä¸ºä»€ä¹ˆé‡å†™ equals () å°±ä¸€å®šè¦é‡å†™ hashCode () æ–¹æ³• åœ¨ Java ä¸­ï¼Œè‹¥ä»…é‡å†™ equals() æ–¹æ³•è€Œä¸é‡å†™ hashCode() æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´ a.equals(b) è¡¨è¾¾å¼ä¸º trueï¼Œä½† a å’Œ b çš„ hashCode å€¼å´ä¸åŒã€‚è¿™åœ¨ä½¿ç”¨æ•£åˆ—é›†åˆï¼ˆå¦‚ HashMapã€HashSet ç­‰ï¼‰å­˜å‚¨å¯¹è±¡æ—¶ä¼šå¼•å‘é—®é¢˜ã€‚å› ä¸ºæ•£åˆ—é›†åˆåˆ©ç”¨ hashCode è®¡ç®—é”®çš„å­˜å‚¨ä½ç½®ï¼Œè‹¥å­˜å‚¨ä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡å´æœ‰ä¸åŒçš„ hashCodeï¼Œå®ƒä»¬ä¼šè¢«å­˜äºå“ˆå¸Œè¡¨çš„ä¸åŒä½ç½®ã€‚å½“ä¾æ®å¯¹è±¡è·å–æ•°æ®æ—¶ï¼Œå°±ä¼šå‡ºç°çŸ›ç›¾ï¼Œå³ç›¸åŒå¯¹è±¡å­˜äºå“ˆå¸Œè¡¨çš„ä¸åŒä½ç½®ï¼Œè¿›è€Œå¼•å‘ä¸å¯é¢„æœŸçš„é”™è¯¯ã€‚æ‰€ä»¥ï¼Œä¸ºä¿è¯å¯¹è±¡åœ¨æ•£åˆ—é›†åˆä¸­çš„æ­£ç¡®å­˜å‚¨å’ŒæŸ¥æ‰¾ï¼Œé‡å†™ equals() æ–¹æ³•æ—¶å¿…é¡»é‡å†™ hashCode() æ–¹æ³•ã€‚\n30. Integer å’Œ int çš„åŒºåˆ«ä»¥åŠ Java è®¾è®¡å°è£…ç±»çš„åŸå›  åŒºåˆ«\nåˆå§‹å€¼ä¸åŒï¼šInteger ä½œä¸ºå¼•ç”¨ç±»å‹ï¼Œåˆå§‹å€¼ä¸º nullï¼›int ä½œä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆå§‹å€¼ä¸º 0ã€‚ å­˜å‚¨ä½ç½®ä¸åŒï¼šInteger å¯¹è±¡å­˜å‚¨åœ¨å †å†…å­˜ï¼Œint ç±»å‹çš„å˜é‡ç›´æ¥å­˜å‚¨åœ¨æ ˆç©ºé—´ã€‚ ç±»å‹åŠä½¿ç”¨çµæ´»æ€§ä¸åŒï¼šInteger æ˜¯å¯¹è±¡ç±»å‹ï¼Œå°è£…äº†ä¼—å¤šæ–¹æ³•å’Œå±æ€§ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ çµæ´»ï¼›int æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒåŠŸèƒ½ç›¸å¯¹å•ä¸€ã€‚ è®¾è®¡å°è£…ç±»çš„åŸå› \nJava æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œå…¶æ“ä½œå¤§å¤šåŸºäºå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œé›†åˆç±»ï¼ˆå¦‚ Listã€Set ç­‰ï¼‰åªèƒ½å­˜å‚¨ Object ç±»å‹çš„å…ƒç´ ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹æ— æ³•ç›´æ¥å­˜å‚¨åœ¨é›†åˆä¸­ï¼Œå¿…é¡»ä½¿ç”¨å¯¹åº”çš„å°è£…ç±»ã€‚å› æ­¤ï¼ŒJava è®¾è®¡å°è£…ç±»çš„ä¸»è¦ç›®çš„æ˜¯è®©åŸºæœ¬æ•°æ®ç±»å‹ä¹Ÿèƒ½å‚ä¸é¢å‘å¯¹è±¡çš„æ“ä½œï¼Œå¢å¼ºä»£ç çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚\n31. å¦‚ä½•ç†è§£Javaå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ ç±»åŠ è½½æ£€æŸ¥ï¼šå½“ç¨‹åºå°è¯•å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒJVM é¦–å…ˆä¼šæ£€æŸ¥è¯¥å¯¹è±¡æ‰€å±çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¦‚æœè¯¥ç±»å°šæœªè¢«åŠ è½½ï¼ŒJVM ä¼šå¯åŠ¨ç±»åŠ è½½æœºåˆ¶ï¼Œé€šè¿‡ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æŸ¥æ‰¾å¹¶åŠ è½½å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼ˆ.class æ–‡ä»¶ï¼‰ã€‚åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—çš„éªŒè¯ã€å‡†å¤‡å’Œè§£ææ“ä½œï¼Œä¸ºç±»çš„ä½¿ç”¨åšå¥½å‡†å¤‡ã€‚ä¾‹å¦‚ï¼ŒéªŒè¯å­—èŠ‚ç æ–‡ä»¶çš„æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼ç­‰ã€‚ å†…å­˜åˆ†é…ï¼šä¸€æ—¦ç±»è¢«æˆåŠŸåŠ è½½ï¼ŒJVM å°±ä¼šä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ã€‚å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåå°±å·²ç»ç¡®å®šï¼ŒJVM ä¼šåœ¨å †å†…å­˜ä¸­ä¸ºå…¶åˆ†é…ä¸€å—åˆé€‚çš„å†…å­˜åŒºåŸŸã€‚å†…å­˜åˆ†é…çš„æ–¹å¼é€šå¸¸æœ‰ä¸¤ç§ï¼šæŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨ã€‚æŒ‡é’ˆç¢°æ’æ˜¯æŒ‡ JVM ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å †å†…å­˜ä¸­å¯ç”¨å†…å­˜çš„æŒ‡é’ˆï¼Œå½“éœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œå°±å°†æŒ‡é’ˆç§»åŠ¨ç›¸åº”çš„è·ç¦»æ¥ä¸ºæ–°å¯¹è±¡åˆ†é…ç©ºé—´ï¼›ç©ºé—²åˆ—è¡¨åˆ™æ˜¯ JVM ç»´æŠ¤ä¸€ä¸ªè®°å½•å †å†…å­˜ä¸­å¯ç”¨å†…å­˜å—çš„åˆ—è¡¨ï¼Œæ¯æ¬¡åˆ†é…å†…å­˜æ—¶ï¼Œä»åˆ—è¡¨ä¸­é€‰æ‹©åˆé€‚çš„å†…å­˜å—åˆ†é…ç»™å¯¹è±¡ã€‚ åˆå§‹åŒ–é›¶å€¼ï¼šåœ¨ä¸ºå¯¹è±¡åˆ†é…å®Œå†…å­˜åï¼ŒJVM ä¼šå°†åˆ†é…çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼‰æˆ– nullï¼ˆå¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ï¼‰ã€‚è¿™ä¸€æ­¥ç¡®ä¿äº†å¯¹è±¡çš„å®ä¾‹å˜é‡åœ¨è¢«ç¨‹åºå‘˜æ˜¾å¼èµ‹å€¼ä¹‹å‰æœ‰ä¸€ä¸ªé»˜è®¤çš„åˆå§‹çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œint ç±»å‹çš„å®ä¾‹å˜é‡ä¼šè¢«åˆå§‹åŒ–ä¸º 0ï¼ŒObject ç±»å‹çš„å®ä¾‹å˜é‡ä¼šè¢«åˆå§‹åŒ–ä¸º nullã€‚ è®¾ç½®å¯¹è±¡å¤´ï¼šå¯¹è±¡å¤´æ˜¯å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒåŒ…å«äº†å¯¹è±¡çš„ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚å¯¹è±¡çš„å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€å¯¹è±¡çš„åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰ã€‚JVM ä¼šåœ¨è¿™ä¸€æ­¥è®¾ç½®å¯¹è±¡å¤´ä¸­çš„è¿™äº›ä¿¡æ¯ï¼Œä»¥ä¾¿åç»­å¯¹å¯¹è±¡çš„ç®¡ç†å’Œæ“ä½œã€‚ æ‰§è¡Œæ„é€ æ–¹æ³•ï¼šå®Œæˆä¸Šè¿°æ­¥éª¤åï¼ŒJVM ä¼šè°ƒç”¨å¯¹è±¡çš„æ„é€ æ–¹æ³•ï¼ˆconstructorï¼‰ï¼Œæ‰§è¡Œç¨‹åºå‘˜åœ¨æ„é€ æ–¹æ³•ä¸­ç¼–å†™çš„ä»£ç é€»è¾‘ï¼Œå¯¹å¯¹è±¡è¿›è¡Œè¿›ä¸€æ­¥çš„åˆå§‹åŒ–ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œç¨‹åºå‘˜å¯ä»¥ä¸ºå¯¹è±¡çš„å®ä¾‹å˜é‡èµ‹äºˆç‰¹å®šçš„å€¼ï¼Œè¿›è¡Œä¸€äº›å¿…è¦çš„èµ„æºåˆå§‹åŒ–æˆ–å…¶ä»–æ“ä½œï¼Œä½¿å¯¹è±¡å¤„äºå¯ç”¨çš„çŠ¶æ€ã€‚ ä¸ƒã€JVMåŸºç¡€ 1. JVM æ˜¯ä»€ä¹ˆï¼Ÿ å®šä¹‰ï¼šJVM å³ Java Virtual Machineï¼Œæ˜¯ Java ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ˜¯è¿è¡Œ Java äºŒè¿›åˆ¶å­—èŠ‚ç çš„ç¯å¢ƒã€‚ å¥½å¤„ï¼šå®ç°äº† â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ çš„ç‰¹æ€§ï¼Œå› ä¸º JVM å±è”½äº†åº•å±‚æ“ä½œç³»ç»Ÿçš„å·®å¼‚ï¼Œä½¿å¾— Java ç¨‹åºåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šéƒ½èƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼›å…·å¤‡è‡ªåŠ¨å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå‡è½»äº†å¼€å‘è€…å¯¹å†…å­˜ç®¡ç†çš„è´Ÿæ‹…ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ï¼Œå¹¶ä¸”é™ä½äº†å› å†…å­˜ç®¡ç†ä¸å½“å¯¼è‡´çš„é”™è¯¯é£é™©ã€‚ 2. JVM ç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ ç»„æˆéƒ¨åˆ† ClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰ï¼šè´Ÿè´£åŠ è½½ Java ç±»æ–‡ä»¶ï¼Œå°† Java ä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç ï¼Œä½¿ JVM èƒ½å¤Ÿè¯†åˆ«å’Œå¤„ç†ã€‚ Runtime Data Areaï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼Œå†…å­˜åˆ†åŒºï¼‰ï¼šæ˜¯ JVM è¿è¡Œæ—¶ç®¡ç†å†…å­˜çš„åŒºåŸŸï¼ŒåŒ…æ‹¬å †ã€æ–¹æ³•åŒºã€æ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨ç­‰ã€‚ Execution Engineï¼ˆæ‰§è¡Œå¼•æ“ï¼‰ï¼šæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼Œå°†å­—èŠ‚ç ç¿»è¯‘ä¸ºåº•å±‚ç³»ç»Ÿèƒ½å¤Ÿç†è§£å’Œæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæœ€ç»ˆäº¤ç”± CPU æ‰§è¡Œã€‚ Native Method Libraryï¼ˆæœ¬åœ°åº“æ¥å£ï¼‰ï¼šå½“ Java ç¨‹åºéœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€ï¼ˆå¦‚ Cã€C++ï¼‰ç¼–å†™çš„æœ¬åœ°ä»£ç æ—¶ï¼Œé€šè¿‡è¯¥æ¥å£å®ç°è°ƒç”¨ï¼Œä»¥å®Œæˆä¸€äº› Java è¯­è¨€æœ¬èº«æ— æ³•ç›´æ¥å®ç°çš„åŠŸèƒ½ã€‚ è¿è¡Œæµç¨‹ ç±»åŠ è½½å™¨æŠŠ Java ä»£ç ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­ã€‚ è¿è¡Œæ—¶æ•°æ®åŒºå°†å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­è¿›è¡Œå­˜å‚¨å’Œç®¡ç†ã€‚ç”±äºå­—èŠ‚ç æ˜¯ JVM çš„æŒ‡ä»¤é›†è§„èŒƒï¼Œä¸èƒ½ç›´æ¥è¢«åº•å±‚ç³»ç»Ÿæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚ æ‰§è¡Œå¼•æ“å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šè°ƒç”¨æœ¬åœ°åº“æ¥å£æ¥å®ç°ä¸€äº›åŠŸèƒ½ï¼Œæœ€ç»ˆç”± CPU æ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œå®Œæˆç¨‹åºçš„è¿è¡Œã€‚ 3. ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ï¼Ÿ å®šä¹‰ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸï¼Œå†…éƒ¨ä¿å­˜ç€å­—èŠ‚ç çš„è¡Œå·ï¼Œç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚ ä½œç”¨ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒJVM é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…æ‰§è¡Œæ—¶é—´æ¥å®ç°å¤šçº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ç”¨å®Œè¢«æŒ‚èµ·ï¼Œå¤„ç†å™¨åˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œåï¼Œå†æ¬¡åˆ‡æ¢å›è¯¥çº¿ç¨‹æ—¶ï¼Œå°±å¯ä»¥ä»ç¨‹åºè®¡æ•°å™¨ä¸­è·å–ä¸Šæ¬¡æ‰§è¡Œçš„è¡Œå·ï¼Œä»è€Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä¿è¯äº†çº¿ç¨‹æ‰§è¡Œçš„è¿ç»­æ€§å’Œæ­£ç¡®æ€§ã€‚ ç‰¹ç‚¹ï¼šå®ƒæ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰è§„å®šä¼šå‡ºç° OutOfMemoryErrorï¼ˆOOMï¼‰çš„åŒºåŸŸï¼Œå¹¶ä¸”è¯¥åŒºåŸŸä¹Ÿä¸ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆGCï¼‰ã€‚ æŸ¥çœ‹å·¥å…·ï¼šä½¿ç”¨ javap -verbose xx.class å‘½ä»¤å¯ä»¥æ‰“å°å †æ ˆå¤§å°ã€å±€éƒ¨å˜é‡çš„æ•°é‡å’Œæ–¹æ³•çš„å‚æ•°ç­‰ä¿¡æ¯ï¼Œè¿™å¯¹äºäº†è§£ç¨‹åºçš„å­—èŠ‚ç ç»“æ„å’Œåˆ†æé—®é¢˜æœ‰ä¸€å®šå¸®åŠ©ã€‚ 4. Java å †æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ æ¦‚è¿°ï¼šJava å †æ˜¯çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œä¸»è¦ç”¨äºä¿å­˜å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ç­‰æ•°æ®ã€‚å½“å †ä¸­æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´åˆ†é…ç»™æ–°çš„å¯¹è±¡å®ä¾‹ï¼Œä¸”æ— æ³•å†è¿›è¡Œæ‰©å±•æ—¶ï¼Œå°±ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ åˆ†åŒº å¹´è½»ä»£ï¼šè¢«åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ Eden åŒºå’Œä¸¤ä¸ªå¤§å°ç›¸åŒçš„ Survivor åŒºï¼ˆä¸€èˆ¬ç§°ä¸º From Survivor å’Œ To Survivorï¼‰ã€‚åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡é€šå¸¸ä¼šé¦–å…ˆåˆ†é…åˆ° Eden åŒºï¼Œç»è¿‡å‡ æ¬¡åƒåœ¾æ”¶é›†åï¼Œä»ç„¶å­˜æ´»åœ¨ Survivor åŒºçš„å¯¹è±¡ä¼šæ ¹æ® JVM çš„ç­–ç•¥è¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚ è€å¹´ä»£ï¼šä¸»è¦ä¿å­˜ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸€äº›é•¿æ—¶é—´å­˜åœ¨çš„å¯¹è±¡å®ä¾‹ï¼Œè¿™äº›å¯¹è±¡åœ¨å¹´è½»ä»£ç»è¿‡å¤šæ¬¡åƒåœ¾å›æ”¶åä¾ç„¶å­˜æ´»ï¼Œå°±ä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚ å…ƒç©ºé—´ï¼ˆJava 8 åŠä»¥åï¼‰ï¼šåœ¨ Java 8 ä¸­ï¼Œä¸ºäº†é¿å…æ–¹æ³•åŒºï¼ˆä¹‹å‰çš„æ°¸ä¹…ä»£ï¼‰å‡ºç° OOM é—®é¢˜ï¼Œå°†å…¶ç§»åŠ¨åˆ°äº†æœ¬åœ°å†…å­˜ï¼Œé‡æ–°å¼€è¾Ÿäº†ä¸€å—ç©ºé—´ç§°ä¸ºå…ƒç©ºé—´ã€‚å…ƒç©ºé—´ä¸»è¦ä¿å­˜**ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡ã€ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚**å®ƒçš„å¤§å°é»˜è®¤ä»…å—æœ¬åœ°å†…å­˜çš„é™åˆ¶ï¼Œç›¸æ¯”ä¹‹å‰çš„æ°¸ä¹…ä»£ï¼Œæ›´åŠ çµæ´»ï¼Œå‡å°‘äº†å› æ°¸ä¹…ä»£å†…å­˜ä¸è¶³å¯¼è‡´çš„ OOM æƒ…å†µã€‚ 5. ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆï¼Ÿ å®šä¹‰ï¼šæ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´ç§°ä¸ºè™šæ‹Ÿæœºæ ˆï¼Œå®ƒéµå¾ªå…ˆè¿›åå‡ºï¼ˆFILOï¼‰çš„åŸåˆ™ã€‚æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆframeï¼‰ç»„æˆï¼Œæ¯ä¸ªæ ˆå¸§å¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜ã€‚ æ ˆå¸§ç›¸å…³ï¼šæ¯ä¸ªçº¿ç¨‹åœ¨ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œè¿™ä¸ªæ´»åŠ¨æ ˆå¸§å¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•ã€‚å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§å¹¶å‹å…¥æ ˆä¸­ï¼›å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œæ ˆå¸§ä¼šä»æ ˆä¸­å¼¹å‡ºï¼Œé‡Šæ”¾ç›¸åº”çš„å†…å­˜ã€‚ ä¸åƒåœ¾å›æ”¶çš„å…³ç³»ï¼šåƒåœ¾å›æ”¶ä¸»è¦é’ˆå¯¹å †å†…å­˜ï¼Œå½“æ ˆå¸§å¼¹æ ˆåï¼Œå…¶æ‰€å ç”¨çš„å†…å­˜ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œå› æ­¤æ ˆå†…å­˜çš„ç®¡ç†ç›¸å¯¹ç®€å•ï¼Œä¸€èˆ¬ä¸éœ€è¦åƒåœ¾å›æ”¶æœºåˆ¶æ¥å¤„ç†ã€‚ æ ˆå†…å­˜å¤§å°å½±å“ï¼šæ ˆå†…å­˜å¹¶éè¶Šå¤§è¶Šå¥½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ˆå†…å­˜é€šå¸¸ä¸º 1024kã€‚å¦‚æœæ ˆå†…å­˜è®¾ç½®è¿‡å¤§ï¼Œä¼šå¯¼è‡´çº¿ç¨‹æ•°å˜å°‘ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœºå™¨æ€»å†…å­˜ä¸º 512mï¼ŒæŒ‰ç…§é»˜è®¤æ ˆå†…å­˜ 1024k è®¡ç®—ï¼Œèƒ½æ´»åŠ¨çš„çº¿ç¨‹æ•°ä¸º 512 ä¸ªï¼›å¦‚æœå°†æ ˆå†…å­˜æ”¹ä¸º 2048kï¼Œé‚£ä¹ˆèƒ½æ´»åŠ¨çš„çº¿ç¨‹æ•°å°±ä¼šå‡åŠã€‚ å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨æ€§ å¦‚æœæ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå³è¯¥å˜é‡åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä¸åŒçº¿ç¨‹ä¸ä¼šåŒæ—¶è®¿é—®åˆ°è¿™ä¸ªå±€éƒ¨å˜é‡ã€‚ å¦‚æœå±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å¼•ç”¨é€ƒç¦»äº†æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œä¾‹å¦‚ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼è¢«å…¶ä»–çº¿ç¨‹è·å–åˆ°ï¼Œæ­¤æ—¶å°±éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è®¿é—®å’Œä¿®æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–å…¶ä»–é”™è¯¯ã€‚ æ ˆå†…å­˜æº¢å‡ºæƒ…å†µ æ ˆå¸§è¿‡å¤šä¼šå¯¼è‡´æ ˆå†…å­˜æº¢å‡ºï¼Œå…¸å‹çš„æƒ…å†µæ˜¯é€’å½’è°ƒç”¨ã€‚å¦‚æœé€’å½’è°ƒç”¨æ²¡æœ‰æ­£ç¡®è®¾ç½®ç»ˆæ­¢æ¡ä»¶ï¼Œä¼šä¸æ–­åˆ›å»ºæ–°çš„æ ˆå¸§ï¼Œæœ€ç»ˆå¯¼è‡´æ ˆå†…å­˜è€—å°½ï¼ŒæŠ›å‡º java.lang.StackOverFlowError å¼‚å¸¸ã€‚ æ ˆå¸§è¿‡å¤§ä¹Ÿå¯èƒ½å¯¼è‡´æ ˆå†…å­˜æº¢å‡ºï¼Œå› ä¸ºæ¯ä¸ªæ ˆå¸§å ç”¨çš„ç©ºé—´è¿‡å¤§ï¼Œä¼šä½¿å¾—æ ˆèƒ½å¤Ÿå®¹çº³çš„æ ˆå¸§æ•°é‡å‡å°‘ï¼Œä»è€Œæ›´å®¹æ˜“å‡ºç°å†…å­˜ä¸è¶³çš„æƒ…å†µã€‚ æ ˆå¸§çš„å‹å…¥ä¸å¼¹å‡ºï¼šæ–¹æ³•è°ƒç”¨çš„æ•°æ®é€šè¿‡æ ˆä¼ é€’ã€‚æ¯æ¬¡æ–¹æ³•è°ƒç”¨ï¼Œä¼šå¯¹åº”ä¸€ä¸ªæ ˆå¸§è¢«å‹å…¥æ ˆä¸­ï¼›æ–¹æ³•è°ƒç”¨ç»“æŸï¼Œå¯¹åº”çš„æ ˆå¸§è¢«å¼¹å‡ºã€‚\næ ˆå¸§çš„ç»„æˆ\nå±€éƒ¨å˜é‡è¡¨ï¼šå­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å¤šç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ booleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ä»¥åŠå¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå¯èƒ½æ˜¯æŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ç›¸å…³ä½ç½®ï¼‰ã€‚ æ“ä½œæ•°æ ˆï¼šä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸­é—´è®¡ç®—ç»“æœï¼Œè®¡ç®—æ—¶çš„ä¸´æ—¶å˜é‡ä¹Ÿå­˜æ”¾äºæ­¤ã€‚ åŠ¨æ€é“¾æ¥ï¼šä¸»è¦ç”¨äºå½“ä¸€ä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•çš„åœºæ™¯ã€‚Class æ–‡ä»¶å¸¸é‡æ± å­˜æœ‰å¤§é‡ç¬¦å·å¼•ç”¨ï¼ˆå¦‚æ–¹æ³•å¼•ç”¨çš„ç¬¦å·å¼•ç”¨ï¼‰ï¼ŒåŠ¨æ€é“¾æ¥è´Ÿè´£å°†å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºå†…å­˜åœ°å€ä¸­çš„ç›´æ¥å¼•ç”¨ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿç§°ä¸ºåŠ¨æ€è¿æ¥ã€‚ æ–¹æ³•è¿”å›åœ°å€ï¼šæ–¹æ³•æ‰§è¡Œç»“æŸæ—¶ï¼Œç”¨äºç¡®å®šè¿”å›çš„ä½ç½®ã€‚ 6. JVM è¿è¡Œæ—¶æ•°æ®åŒºæœ‰å“ªäº›ç»„æˆéƒ¨åˆ†ï¼Œå„è‡ªçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å †ï¼šä¸»è¦ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œæ˜¯åƒåœ¾å›æ”¶å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚å¯¹è±¡çš„åˆ›å»ºã€å­˜å‚¨å’Œé”€æ¯ç­‰æ“ä½œéƒ½ä¸å †å†…å­˜å¯†åˆ‡ç›¸å…³ã€‚ æ–¹æ³•åŒºï¼šå¯ä»¥çœ‹ä½œæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ä»¥åŠå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œæ–¹æ³•åŒºçš„å®ç°æ˜¯æ°¸ä¹…ä»£ï¼›Java 8 åŠä»¥åï¼Œæ–¹æ³•åŒºç”±å…ƒç©ºé—´å®ç°ï¼Œå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œé¿å…äº†æ°¸ä¹…ä»£å¸¸è§çš„ OOM é—®é¢˜ã€‚ æ ˆï¼šè§£å†³ç¨‹åºè¿è¡Œæ—¶çš„æ–¹æ³•è°ƒç”¨å’Œå±€éƒ¨å˜é‡å­˜å‚¨é—®é¢˜ã€‚æ ˆä¸­å­˜å‚¨çš„æ˜¯æ ˆå¸§ï¼Œæ¯ä¸ªæ ˆå¸§åŒ…å«å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼šä¸æ ˆçš„åŠŸèƒ½ç±»ä¼¼ï¼Œä¸»è¦ç”¨äºæ‰§è¡Œæœ¬åœ°æ–¹æ³•ï¼Œå³ Java è°ƒç”¨é Java ä»£ç ï¼ˆå¦‚ Cã€C++ ä»£ç ï¼‰çš„æ¥å£ã€‚å½“ Java ç¨‹åºéœ€è¦è°ƒç”¨æœ¬åœ°æ–¹æ³•æ—¶ï¼Œä¼šåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­åˆ›å»ºç›¸åº”çš„æ ˆå¸§æ¥æ‰§è¡Œè¿™äº›æ–¹æ³•ã€‚ ç¨‹åºè®¡æ•°å™¨ï¼šå¦‚å‰é¢æ‰€è¿°ï¼Œå®ƒæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¿å­˜å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼Œç”¨äºçº¿ç¨‹åˆ‡æ¢åæ¢å¤æ‰§è¡Œä½ç½®ã€‚ 7. è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ æ¦‚è¿° æ–¹æ³•åŒºæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå…³é—­è™šæ‹Ÿæœºæ—¶é‡Šæ”¾ã€‚ ä¸»è¦å­˜å‚¨ç±»çš„ä¿¡æ¯ï¼ˆå¦‚ç±»çš„ç»“æ„ã€å­—æ®µã€æ–¹æ³•ç­‰ï¼‰ã€è¿è¡Œæ—¶å¸¸é‡æ± ç­‰æ•°æ®ã€‚å¦‚æœæ–¹æ³•åŒºåŸŸä¸­çš„å†…å­˜æ— æ³•æ»¡è¶³åˆ†é…è¯·æ±‚ï¼Œå°±ä¼šæŠ›å‡º OutOfMemoryError: Metaspace å¼‚å¸¸ï¼ˆåœ¨ Java 8 åŠä»¥åä½¿ç”¨å…ƒç©ºé—´å®ç°æ–¹æ³•åŒºï¼‰ã€‚ å¸¸é‡æ± ï¼šå¯ä»¥çœ‹ä½œæ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ä¿¡æ¯ã€‚é€šè¿‡ javap -v xx.class å‘½ä»¤å¯ä»¥æŸ¥çœ‹å­—èŠ‚ç ç»“æ„ï¼ŒåŒ…æ‹¬ç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± å’Œæ–¹æ³•å®šä¹‰ç­‰ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªåŒ…å« main æ–¹æ³•çš„ Application ç±»ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤åï¼Œå¯ä»¥çœ‹åˆ°å¸¸é‡æ± ä¸­å­˜å‚¨äº†ç±»åã€æ–¹æ³•åã€å­—æ®µå¼•ç”¨ã€å­—ç¬¦ä¸²å¸¸é‡ç­‰ä¿¡æ¯ï¼Œmain æ–¹æ³•åœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦åˆ°å¸¸é‡æ± ä¸­æŸ¥æ‰¾å…·ä½“çš„ç±»å’Œæ–¹æ³•åœ°å€è¿›è¡Œè°ƒç”¨ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± ï¼šå¸¸é‡æ± æ˜¯å­˜åœ¨äº .class æ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥ç±»è¢«åŠ è½½åˆ° JVM ä¸­æ—¶ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯ä¼šè¢«æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¹¶å°†å…¶ä¸­çš„ç¬¦å·åœ°å€è½¬æ¢ä¸ºçœŸå®åœ°å€ï¼Œä»¥ä¾¿ JVM èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ã€‚ 8. ä»€ä¹ˆæ˜¯ç›´æ¥å†…å­˜ï¼Œå®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ï¼Ÿ å®šä¹‰ï¼šç›´æ¥å†…å­˜ä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†ï¼Œå®ƒæ˜¯è™šæ‹Ÿæœºä½¿ç”¨çš„ç³»ç»Ÿå†…å­˜ã€‚ ç‰¹ç‚¹ï¼šå¸¸è§äº NIOï¼ˆNew IOï¼‰æ“ä½œä¸­ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒºã€‚ç›´æ¥å†…å­˜çš„åˆ†é…å’Œå›æ”¶æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ã€‚ä½†æ˜¯ï¼Œå®ƒçš„è¯»å†™æ€§èƒ½å¾ˆé«˜ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä¸éœ€è¦åœ¨å †å†…å­˜å’Œç³»ç»Ÿå†…å­˜ä¹‹é—´è¿›è¡Œæ•°æ®æ‹·è´ï¼ŒJVM å¯ä»¥ç›´æ¥æ“ä½œç›´æ¥å†…å­˜ã€‚ åº”ç”¨åœºæ™¯ï¼šä»¥å°†æœ¬åœ°ç”µè„‘ä¸­ä¸€ä¸ªè¾ƒå¤§çš„æ–‡ä»¶ï¼ˆå¦‚è¶…è¿‡ 100m çš„è§†é¢‘æ–‡ä»¶ï¼‰ä»ä¸€ä¸ªç£ç›˜æŒªåˆ°å¦ä¸€ä¸ªç£ç›˜ä¸ºä¾‹ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„ IO æ“ä½œå’Œ NIO æ“ä½œè¿›è¡Œå¯¹æ¯”ã€‚é€šè¿‡ä»£ç æµ‹è¯•å¯ä»¥å‘ç°ï¼Œä½¿ç”¨ä¼ ç»Ÿ IO æ“ä½œçš„æ—¶é—´è¦æ¯” NIO æ“ä½œçš„æ—¶é—´é•¿å¾ˆå¤šï¼Œè¿™æ˜¯å› ä¸º NIO æ“ä½œåˆ©ç”¨äº†ç›´æ¥å†…å­˜çš„ç‰¹æ€§ï¼Œå‡å°‘äº†æ•°æ®æ‹·è´çš„å¼€é”€ï¼Œä»è€Œæé«˜äº†æ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚åœ¨ä¼ ç»Ÿé˜»å¡ IO ä¸­ï¼Œæ•°æ®éœ€è¦å…ˆä»ç£ç›˜è¯»å–åˆ°æ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºï¼Œå†ä»æ“ä½œç³»ç»Ÿç¼“å†²åŒºæ‹·è´åˆ° JVM çš„å †å†…å­˜ï¼Œç„¶åå†è¿›è¡Œåç»­å¤„ç†ï¼›è€Œåœ¨ NIO ä¸­ï¼Œæ•°æ®å¯ä»¥ç›´æ¥è¯»å–åˆ°ç›´æ¥å†…å­˜ä¸­ï¼ŒJVM å¯ä»¥ç›´æ¥å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå¤§å¤§æé«˜äº†è¯»å†™æ€§èƒ½ã€‚ 9. å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å­˜å‚¨å†…å®¹ä¸åŒï¼šæ ˆå†…å­˜ä¸€èˆ¬ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ–¹æ³•çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ï¼›è€Œå †å†…å­˜ä¸»è¦ç”¨äºå­˜å‚¨ Java å¯¹è±¡å’Œæ•°ç»„ç­‰æ•°æ®ã€‚ å†…å­˜ç®¡ç†æ–¹å¼ä¸åŒï¼šå †å†…å­˜ä¼šè¿›è¡Œ GC åƒåœ¾å›æ”¶ï¼Œå½“å¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šè‡ªåŠ¨å›æ”¶å…¶å ç”¨çš„å†…å­˜ï¼›è€Œæ ˆå†…å­˜çš„ç®¡ç†ç›¸å¯¹ç®€å•ï¼Œå½“æ ˆå¸§å¼¹æ ˆæ—¶ï¼Œå…¶æ‰€å ç”¨çš„å†…å­˜ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸éœ€è¦åƒåœ¾å›æ”¶æœºåˆ¶ã€‚ çº¿ç¨‹ç›¸å…³æ€§ä¸åŒï¼šæ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆï¼Œçº¿ç¨‹ä¹‹é—´çš„æ ˆå†…å­˜ç›¸äº’éš”ç¦»ï¼›è€Œå †å†…å­˜æ˜¯çº¿ç¨‹å…±æœ‰çš„ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®å’Œæ“ä½œå †ä¸­çš„å¯¹è±¡ã€‚ å¼‚å¸¸ç±»å‹ä¸åŒï¼šå¦‚æœæ ˆå†…å­˜ä¸è¶³ï¼Œä¼šæŠ›å‡º java.lang.StackOverFlowError å¼‚å¸¸ï¼Œé€šå¸¸æ˜¯ç”±äºé€’å½’è°ƒç”¨è¿‡æ·±æˆ–æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆç©ºé—´è€—å°½ï¼›å¦‚æœå †å†…å­˜ä¸è¶³ï¼Œä¼šæŠ›å‡º java.lang.OutOfMemoryError å¼‚å¸¸ï¼Œä¾‹å¦‚åˆ›å»ºè¿‡å¤šçš„å¯¹è±¡å¯¼è‡´å †å†…å­˜è¢«è€—å°½ã€‚å˜»å˜» 10. ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›? ç±»åŠ è½½å™¨\nJVMåªä¼šè¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°JVMä¸­ï¼Œä»è€Œè®©Javaç¨‹åºèƒ½å¤Ÿå¯åŠ¨èµ·æ¥ã€‚ç°æœ‰çš„ç±»åŠ è½½å™¨åŸºæœ¬ä¸Šéƒ½æ˜¯java.lang.ClassLoaderçš„å­ç±»ï¼Œè¯¥ç±»çš„ä¸»è¦èŒè´£å°±æ˜¯ç”¨äºå°†æŒ‡å®šçš„ç±»æ‰¾åˆ°æˆ–ç”Ÿæˆå¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼ŒåŒæ—¶ç±»åŠ è½½å™¨è¿˜ä¼šè´Ÿè´£åŠ è½½ç¨‹åºæ‰€éœ€è¦çš„èµ„æºã€‚\nç±»åŠ è½½å™¨ç§ç±»\nç±»åŠ è½½å™¨æ ¹æ®å„è‡ªåŠ è½½èŒƒå›´çš„ä¸åŒï¼Œåˆ’åˆ†ä¸ºå››ç§ç±»åŠ è½½å™¨ï¼š\nå¯åŠ¨ç±»åŠ è½½å™¨(BootStrap ClassLoader)ï¼š è¯¥ç±»å¹¶ä¸ç»§æ‰¿ClassLoaderç±»ï¼Œå…¶æ˜¯ç”±C++ç¼–å†™å®ç°ã€‚ç”¨äºåŠ è½½JAVA_HOME/jre/libç›®å½•ä¸‹çš„ç±»åº“ã€‚ æ‰©å±•ç±»åŠ è½½å™¨(ExtClassLoader)ï¼š è¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦åŠ è½½JAVA_HOME/jre/lib/extç›®å½•ä¸­çš„ç±»åº“ã€‚ åº”ç”¨ç±»åŠ è½½å™¨(AppClassLoader)ï¼š è¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦ç”¨äºåŠ è½½classPathä¸‹çš„ç±»ï¼Œä¹Ÿå°±æ˜¯åŠ è½½å¼€å‘è€…è‡ªå·±ç¼–å†™çš„Javaç±»ã€‚ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼š å¼€å‘è€…è‡ªå®šä¹‰ç±»ç»§æ‰¿ClassLoaderï¼Œå®ç°è‡ªå®šä¹‰ç±»åŠ è½½è§„åˆ™ã€‚ ç±»åŠ è½½å™¨çš„ä½“ç³»å¹¶ä¸æ˜¯â€œç»§æ‰¿â€ä½“ç³»ï¼Œè€Œæ˜¯å§”æ´¾ä½“ç³»ï¼Œç±»åŠ è½½å™¨é¦–å…ˆä¼šåˆ°è‡ªå·±çš„parentä¸­æŸ¥æ‰¾ç±»æˆ–è€…èµ„æºï¼Œå¦‚æœæ‰¾ä¸åˆ°æ‰ä¼šåˆ°è‡ªå·±æœ¬åœ°æŸ¥æ‰¾ã€‚ç±»åŠ è½½å™¨çš„å§”æ‰˜è¡Œä¸ºåŠ¨æœºæ˜¯ä¸ºäº†é¿å…ç›¸åŒçš„ç±»è¢«åŠ è½½å¤šæ¬¡ã€‚\n11. ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨åœ¨æ¥åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•å»åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚ä»»åŠ¡å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡é€’å½’ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±è¿”å›æˆåŠŸï¼›åªæœ‰çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡æ—¶ï¼Œæ‰ç”±ä¸‹ä¸€çº§å»åŠ è½½ã€‚\n12. JVMä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶ ï¼ˆ1ï¼‰é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…æŸä¸€ä¸ªç±»è¢«é‡å¤åŠ è½½ï¼Œå½“çˆ¶ç±»å·²ç»åŠ è½½ååˆ™æ— éœ€é‡å¤åŠ è½½ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚\nï¼ˆ2ï¼‰ä¸ºäº†å®‰å…¨ï¼Œä¿è¯ç±»åº“APIä¸ä¼šè¢«ä¿®æ”¹\n13. è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ ç±»ä»åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­å¼€å§‹ï¼Œç›´åˆ°å¸è½½ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬äº†ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œå¸è½½è¿™7ä¸ªé˜¶æ®µã€‚å…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æè¿™ä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆlinkingï¼‰ã€‚\nåŠ è½½: æŸ¥æ‰¾å’Œå¯¼å…¥classæ–‡ä»¶ éªŒè¯: ä¿è¯åŠ è½½ç±»çš„å‡†ç¡®æ€§ å‡†å¤‡: ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼ è§£æ: æŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ åˆå§‹åŒ–: å¯¹ç±»çš„é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ ä½¿ç”¨: JVM å¼€å§‹ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç  å¸è½½: å½“ç”¨æˆ·ç¨‹åºä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒIVMä¾¿å¼€å§‹é”€æ¯åˆ›å»ºçš„Classå¯¹è±¡ã€‚\nä¸€ã€åŠ è½½\næ ¸å¿ƒä»»åŠ¡ï¼šé€šè¿‡ç±»çš„å…¨é™å®šåï¼ˆç±»çš„å…¨åï¼‰ï¼Œè·å–è¯¥ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°ä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œæˆ–å…¶ä»–å­˜å‚¨ä½ç½®è¯»å–ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classæ–‡ä»¶ï¼‰ã€‚æ¥ç€ï¼Œå°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµè§£æä¸ºæ–¹æ³•åŒºå†…ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œå³æ„å»ºèµ·ç¬¦åˆ Java ç±»æ¨¡å‹çš„æ•°æ®è¡¨ç¤ºã€‚æœ€åï¼Œåˆ›å»ºjava.lang.Classç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹ä½œä¸ºåç»­å¯¹è¯¥ç±»å„ç§æ•°æ®ï¼ˆå¦‚å­—æ®µã€æ–¹æ³•ç­‰ï¼‰è¿›è¡Œè®¿é—®çš„å…¥å£ã€‚ ç¤ºä¾‹è¯´æ˜ï¼šå‡è®¾å­˜åœ¨ä¸€ä¸ªUserç±»ï¼Œç±»åŠ è½½å™¨ä¼šæ ¹æ®Userç±»çš„å…¨é™å®šåæ‰¾åˆ°å¯¹åº”çš„.classæ–‡ä»¶ï¼Œè¯»å–å…¶å­—èŠ‚ç æ•°æ®ï¼Œå°†å…¶è½¬æ¢ä¸º JVM å†…éƒ¨èƒ½å¤Ÿç†è§£çš„ç±»æ¨¡å‹ç»“æ„ï¼Œå¹¶åˆ›å»ºClass\u0026lt;User\u0026gt;å®ä¾‹ï¼Œåç»­å¯ä»¥é€šè¿‡è¿™ä¸ªå®ä¾‹è·å–Userç±»çš„ç›¸å…³ä¿¡æ¯ã€‚ äºŒã€è¿æ¥\néªŒè¯ ç›®çš„ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»ç¬¦åˆ JVM è§„èŒƒï¼Œæ˜¯å®‰å…¨å¯é çš„ï¼Œé˜²æ­¢æ¶æ„æˆ–é”™è¯¯çš„å­—èŠ‚ç å¯¹ JVM è¿è¡Œé€ æˆå±å®³ã€‚ å…·ä½“å†…å®¹ æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šæ£€æŸ¥å­—èŠ‚ç æ–‡ä»¶æ˜¯å¦ç¬¦åˆClassæ–‡ä»¶çš„è§„èŒƒï¼Œä¾‹å¦‚æ–‡ä»¶çš„é­”æ•°ã€ç‰ˆæœ¬å·ã€å¸¸é‡æ± æ ¼å¼ç­‰æ˜¯å¦æ­£ç¡®ã€‚ å…ƒæ•°æ®éªŒè¯ï¼šéªŒè¯ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚ç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤Objectå¤–åº”éƒ½æœ‰çˆ¶ç±»ï¼‰ã€æ˜¯å¦ç»§æ‰¿äº†è¢«finalä¿®é¥°çš„ç±»ï¼ˆä¸å…è®¸ç»§æ‰¿ï¼‰ã€ç±»ä¸­çš„å­—æ®µå’Œæ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»å­˜åœ¨çŸ›ç›¾ï¼ˆå¦‚è¦†ç›–finalæ–¹æ³•æˆ–å­—æ®µï¼‰ç­‰ã€‚ å­—èŠ‚ç éªŒè¯ï¼šå¯¹å­—èŠ‚ç è¿›è¡Œæ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®ä¿ç¨‹åºè¯­ä¹‰åˆæ³•ã€é€»è¾‘æ­£ç¡®ï¼Œä¾‹å¦‚æ£€æŸ¥è·³è½¬æŒ‡ä»¤æ˜¯å¦æŒ‡å‘åˆæ³•çš„ä½ç½®ã€æ“ä½œæ•°æ ˆçš„æ“ä½œæ˜¯å¦æ­£ç¡®ç­‰ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ï¼šéªŒè¯ç¬¦å·å¼•ç”¨çš„æœ‰æ•ˆæ€§ï¼Œå¦‚ç±»ã€å­—æ®µã€æ–¹æ³•ç­‰çš„ç¬¦å·å¼•ç”¨æ˜¯å¦èƒ½æ­£ç¡®è§£æåˆ°ç›®æ ‡ã€‚ å‡†å¤‡ å†…å­˜åˆ†é…ï¼šä¸ºç±»å˜é‡ï¼ˆè¢«staticä¿®é¥°çš„å˜é‡ï¼‰åˆ†é…å†…å­˜ç©ºé—´ã€‚æ­¤æ—¶ï¼Œç±»å˜é‡ä¼šè¢«èµ‹äºˆé»˜è®¤åˆå§‹å€¼ï¼Œä¾‹å¦‚intç±»å‹å˜é‡åˆå§‹åŒ–ä¸º0ï¼Œbooleanç±»å‹å˜é‡åˆå§‹åŒ–ä¸ºfalseç­‰ã€‚ ç‰¹æ®Šæƒ…å†µï¼šå¯¹äºstaticä¸”ä¸ºfinalçš„åŸºæœ¬ç±»å‹å˜é‡ï¼Œä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ï¼Œå…¶å€¼åœ¨ç¼–è¯‘æœŸå°±å·²ç¡®å®šï¼Œä¼šåœ¨å‡†å¤‡é˜¶æ®µç›´æ¥èµ‹å€¼ã€‚è€Œå¯¹äºstaticä¸”ä¸ºfinalçš„å¼•ç”¨ç±»å‹å˜é‡ï¼Œèµ‹å€¼æ“ä½œåˆ™åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆã€‚ è§£æ ä»»åŠ¡ï¼šå°†ç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚ç¬¦å·å¼•ç”¨æ˜¯ä¸€ç»„ç”¨äºæè¿°æ‰€å¼•ç”¨ç›®æ ‡çš„ç¬¦å·ï¼Œä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼›è€Œç›´æ¥å¼•ç”¨æ˜¯å¯ä»¥ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–èƒ½é—´æ¥å®šä½ç›®æ ‡çš„å¥æŸ„ï¼Œä¸è™šæ‹Ÿæœºå†…å­˜å¸ƒå±€ç›´æ¥ç›¸å…³ã€‚ ç¤ºä¾‹ï¼šå½“ä¸€ä¸ªæ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•æ—¶ï¼Œæ–¹æ³•ååœ¨ç¼–è¯‘æœŸæ˜¯ç¬¦å·å¼•ç”¨ï¼Œåœ¨è§£æé˜¶æ®µä¼šå°†å…¶è½¬æ¢ä¸ºæŒ‡å‘å®é™…æ–¹æ³•å†…å­˜åœ°å€çš„ç›´æ¥å¼•ç”¨ï¼Œä½¿å¾— JVM èƒ½å¤Ÿç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚ ä¸‰ã€åˆå§‹åŒ–\n**é™æ€æˆå‘˜åˆå§‹åŒ–ï¼š**å¯¹ç±»çš„é™æ€å˜é‡å’Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œã€‚ çˆ¶ç±»ä¼˜å…ˆï¼šå¦‚æœåˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå…¶çˆ¶ç±»å°šæœªåˆå§‹åŒ–ï¼Œåˆ™ä¼˜å…ˆåˆå§‹åŒ–å…¶çˆ¶ç±»ã€‚è¿™ä¿è¯äº†ç±»ç»§æ‰¿ä½“ç³»ä¸­ï¼Œçˆ¶ç±»çš„é™æ€èµ„æºå…ˆè¢«åˆå§‹åŒ–ï¼Œå­ç±»å¯ä»¥åŸºäºçˆ¶ç±»å·²åˆå§‹åŒ–çš„çŠ¶æ€è¿›è¡Œè‡ªèº«çš„åˆå§‹åŒ–ã€‚ é¡ºåºæ‰§è¡Œï¼šå½“ç±»ä¸­åŒæ—¶åŒ…å«å¤šä¸ªé™æ€å˜é‡å’Œé™æ€ä»£ç å—æ—¶ï¼ŒæŒ‰ç…§è‡ªä¸Šè€Œä¸‹çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå…ˆå®šä¹‰çš„é™æ€å˜é‡ä¼šå…ˆäºåé¢çš„é™æ€ä»£ç å—ä»¥åŠåç»­å®šä¹‰çš„é™æ€å˜é‡è¢«åˆå§‹åŒ–ã€‚ è§¦å‘æ—¶æœºï¼šåˆå§‹åŒ–é˜¶æ®µé€šå¸¸åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹è§¦å‘ï¼šåˆ›å»ºç±»çš„å®ä¾‹ï¼ˆä½¿ç”¨newå…³é”®å­—ï¼‰ã€è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€è®¿é—®ç±»çš„é™æ€å­—æ®µï¼ˆé™¤finalå¸¸é‡å¤–ï¼Œå› ä¸ºå…¶åœ¨å‡†å¤‡é˜¶æ®µå·²èµ‹å€¼ï¼‰ã€åå°„è°ƒç”¨ç±»ç­‰ã€‚ å››ã€ä½¿ç”¨\næ‰§è¡Œå…¥å£æ–¹æ³•ï¼šJVM ä»ç¨‹åºçš„å…¥å£æ–¹æ³•ï¼ˆå¦‚mainæ–¹æ³•ï¼‰å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç ã€‚è¿™æ˜¯ç¨‹åºè¿è¡Œçš„èµ·ç‚¹ï¼Œåç»­çš„ä»£ç æ‰§è¡Œå’Œé€»è¾‘å¤„ç†éƒ½åŸºäºæ­¤å±•å¼€ã€‚ è°ƒç”¨é™æ€æˆå‘˜ï¼šåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è°ƒç”¨ç±»çš„é™æ€æˆå‘˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ã€‚é™æ€æˆå‘˜æ˜¯ç±»çº§åˆ«çš„èµ„æºï¼Œå¯è¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«è®¿é—®ï¼Œå¸¸ç”¨äºå®ç°ä¸ç±»ç›¸å…³çš„é€šç”¨åŠŸèƒ½æˆ–å­˜å‚¨ç±»çº§åˆ«çš„æ•°æ®ã€‚ åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼šä½¿ç”¨newå…³é”®å­—ä¸ºç±»åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šåœ¨å †å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼Œåˆå§‹åŒ–å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°å®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–ã€‚åˆ›å»ºçš„å¯¹è±¡å®ä¾‹å¯ä»¥è®¿é—®ç±»çš„éé™æ€æˆå‘˜ï¼Œæ‰§è¡Œå¯¹è±¡ç‰¹å®šçš„è¡Œä¸ºå’Œæ“ä½œã€‚ äº”ã€å¸è½½\nå½“ç”¨æˆ·ç¨‹åºä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒJVM ä¼šå¼€å§‹é”€æ¯ä¹‹å‰åˆ›å»ºçš„Classå¯¹è±¡ã€‚è¿™åŒ…æ‹¬é‡Šæ”¾ä¸ç±»ç›¸å…³çš„æ‰€æœ‰å†…å­˜èµ„æºï¼Œå¦‚ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆå­˜å‚¨åœ¨æ–¹æ³•åŒºï¼‰ã€é™æ€å˜é‡æ‰€å ç”¨çš„å†…å­˜ç­‰ã€‚éšç€æ‰€æœ‰ç›¸å…³Classå¯¹è±¡è¢«é”€æ¯ï¼Œè´Ÿè´£è¿è¡Œç¨‹åºçš„ JVM ä¹Ÿä¼šé€€å‡ºå†…å­˜ï¼Œæ•´ä¸ªç±»åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚\né€šè¿‡å¯¹ç±»åŠ è½½å„ä¸ªé˜¶æ®µçš„è¯¦ç»†äº†è§£ï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£ Java ç¨‹åºåœ¨è¿è¡Œæ—¶çš„è¡Œä¸ºå’Œæœºåˆ¶ï¼Œå¯¹äºæ’æŸ¥é—®é¢˜ã€ä¼˜åŒ–æ€§èƒ½ç­‰æ–¹é¢å…·æœ‰é‡è¦æ„ä¹‰ã€‚\n14. ç®€è¿°Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿï¼ˆGCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦GCï¼‰ ä¸ºäº†è®©ç¨‹åºå‘˜æ›´ä¸“æ³¨äºä»£ç çš„å®ç°ï¼Œè€Œä¸ç”¨è¿‡å¤šçš„è€ƒè™‘å†…å­˜é‡Šæ”¾çš„é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œåœ¨Javaè¯­è¨€ä¸­ï¼Œæœ‰äº†è‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„GC(Garbage Collection)ã€‚\næœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œç¨‹åºå‘˜åªéœ€è¦å…³å¿ƒå†…å­˜çš„ç”³è¯·å³å¯ï¼Œå†…å­˜çš„é‡Šæ”¾ç”±ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å®Œæˆã€‚\nåœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¸åŒçš„å¯¹è±¡å¼•ç”¨ç±»å‹ï¼ŒGCä¼šé‡‡ç”¨ä¸åŒçš„å›æ”¶æ—¶æœº\næ¢å¥è¯è¯´ï¼Œè‡ªåŠ¨çš„åƒåœ¾å›æ”¶çš„ç®—æ³•å°±ä¼šå˜å¾—éå¸¸é‡è¦äº†ï¼Œå¦‚æœå› ä¸ºç®—æ³•çš„ä¸åˆç†ï¼Œå¯¼è‡´å†…å­˜èµ„æºä¸€ç›´æ²¡æœ‰é‡Šæ”¾ï¼ŒåŒæ ·ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºçš„ã€‚\n15. å¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶ ç®€å•ä¸€å¥å°±æ˜¯ï¼šå¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼•ç”¨æŒ‡å‘å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç°åœ¨å°±æ˜¯åƒåœ¾ï¼Œå¦‚æœå®šä½äº†åƒåœ¾ï¼Œåˆ™æœ‰å¯èƒ½ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚\nå¦‚æœè¦å®šä½ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥ç¡®å®šï¼Œç¬¬ä¸€ä¸ªæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Œç¬¬äºŒä¸ªæ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚\n16. å®šä½åƒåœ¾çš„æ–¹æ³• 1. å¼•ç”¨è®¡æ•°æ³•\nåŸç†ï¼šå¯¹è±¡æ¯è¢«å¼•ç”¨ä¸€æ¬¡ï¼Œå…¶å¼•ç”¨è®¡æ•°å°±é€’å¢ä¸€æ¬¡ï¼›å½“å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œè¯¥å¯¹è±¡å¯è¢«å›æ”¶ã€‚ä¾‹å¦‚String demo = new String(\u0026quot;123\u0026quot;);ï¼Œæ­¤æ—¶demoå¯¹è±¡å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå½“demo = null;æ—¶ï¼Œdemoå¯¹è±¡å¼•ç”¨è®¡æ•°é™ä¸º 0ï¼Œå¯è¢«å›æ”¶ã€‚ ç¼ºç‚¹ï¼šå¯¹è±¡é—´å­˜åœ¨å¾ªç¯å¼•ç”¨æ—¶ä¼šå¤±æ•ˆã€‚ä¾‹å¦‚ä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå³ä½¿å®ƒä»¬ä¸å†è¢«å¤–éƒ¨å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°ä¹Ÿä¸ä¼šä¸º 0ï¼Œå¯¼è‡´æ— æ³•å›æ”¶ï¼Œå¼•å‘å†…å­˜æ³„æ¼ã€‚åŒæ—¶ï¼Œæ¯æ¬¡å¯¹è±¡å¼•ç”¨çŠ¶æ€æ”¹å˜éƒ½è¦æ›´æ–°è®¡æ•°å™¨ï¼Œæœ‰æ—¶é—´å¼€é”€ä¸”æµªè´¹ CPU èµ„æºï¼Œå³ä¾¿å†…å­˜å……è¶³ä¹ŸæŒç»­ç»Ÿè®¡ã€‚ 2. å¯è¾¾æ€§åˆ†æç®—æ³•\nåŸç†ï¼šä»¥ GC Roots ä¸ºæ ¹èŠ‚ç‚¹ï¼Œé€šè¿‡å¼•ç”¨å…³ç³»å‘ä¸‹éå†æ‰€æœ‰å¯¹è±¡ã€‚è‹¥å¯¹è±¡ä¸æ ¹èŠ‚ç‚¹æ— ç›´æ¥æˆ–é—´æ¥å¼•ç”¨ï¼Œåˆ™å¯è¢«åˆ¤å®šä¸ºåƒåœ¾å›æ”¶å¯¹è±¡ã€‚GC Roots åŒ…æ‹¬è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ä»¥åŠæœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡ã€‚ å¯¹è±¡å›æ”¶ç‰¹æ®Šæƒ…å†µï¼šå¯¹è±¡è¢«æ ‡è®°ä¸ºå¯å›æ”¶åï¼Œè‹¥å…¶finalizeæ–¹æ³•æœªæ‰§è¡Œï¼ŒGC æ—¶ä¼šå…ˆæ‰§è¡Œè¯¥æ–¹æ³•ã€‚åœ¨finalizeæ–¹æ³•ä¸­ï¼Œè‹¥è®¾ç½®å¯¹è±¡ä¸ GC ROOTS äº§ç”Ÿå…³è”ï¼Œåˆ™ GC å†æ¬¡åˆ¤æ–­æ—¶è¯¥å¯¹è±¡å¯è¾¾ï¼Œä¸ä¼šè¢«å›æ”¶ï¼›è‹¥ä»ä¸å¯è¾¾ï¼Œåˆ™è¿›è¡Œå›æ”¶ã€‚ä¸”finalizeæ–¹æ³•å¯¹æ¯ä¸ªå¯¹è±¡ä»…æ‰§è¡Œä¸€æ¬¡ã€‚ 17. åƒåœ¾å›æ”¶ç®—æ³• ï¼ˆä¸€ï¼‰æ ‡è®°æ¸…é™¤ç®—æ³•\næµç¨‹ï¼šåˆ†æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µã€‚å…ˆæ ¹æ®å¯è¾¾æ€§åˆ†æç®—æ³•æ ‡è®°æ‰€æœ‰å¯å›æ”¶å¯¹è±¡ï¼Œç„¶åå¯¹æ ‡è®°å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚ ä¼˜ç¼ºç‚¹ï¼šèƒ½è§£å†³å¼•ç”¨è®¡æ•°æ³•çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä½†æ•ˆç‡ä½ï¼Œæ ‡è®°å’Œæ¸…é™¤éƒ½éœ€éå†æ‰€æœ‰å¯¹è±¡ï¼Œä¸” GC æ—¶éœ€åœæ­¢åº”ç”¨ç¨‹åºï¼Œå½±å“äº¤äº’æ€§ã€‚æ¸…ç†å‡ºçš„å†…å­˜ç¢ç‰‡åŒ–ä¸¥é‡ï¼Œå› ä¸ºè¢«å›æ”¶å¯¹è±¡åˆ†æ•£åœ¨å†…å­˜å„å¤„ï¼Œå¯¼è‡´å†…å­˜ä¸è¿è´¯ã€‚ ï¼ˆäºŒï¼‰å¤åˆ¶ç®—æ³•\næµç¨‹ï¼šå°†å†…å­˜ç©ºé—´ä¸€åˆ†ä¸ºäºŒï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ã€‚åƒåœ¾å›æ”¶æ—¶ï¼Œå°†æ­£åœ¨ä½¿ç”¨å—ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åæ¸…ç©ºå½“å‰ä½¿ç”¨å—ï¼Œä¸¤å—å†…å­˜è§’è‰²äº¤æ¢ï¼Œé‡å¤æ­¤è¿‡ç¨‹ã€‚ é€‚ç”¨åœºæ™¯åŠä¼˜ç¼ºç‚¹ï¼šå½“å†…å­˜ä¸­åƒåœ¾å¯¹è±¡è¾ƒå¤šï¼Œéœ€å¤åˆ¶çš„å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ•ˆç‡é«˜ï¼Œä¸”æ¸…ç†åå†…å­˜æ— ç¢ç‰‡ã€‚ä½†åŒä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨ä¸€åŠå†…å­˜ï¼Œå†…å­˜ä½¿ç”¨ç‡ä½ã€‚ ï¼ˆä¸‰ï¼‰æ ‡è®°æ•´ç†ç®—æ³•\næµç¨‹ï¼šåœ¨æ ‡è®°æ¸…é™¤ç®—æ³•åŸºç¡€ä¸Šæ”¹è¿›ã€‚åŒæ ·å…ˆæ ‡è®°å¯å›æ”¶å¯¹è±¡ï¼Œæ¸…ç†é˜¶æ®µå°†å­˜æ´»å¯¹è±¡å‘å†…å­˜ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†è¾¹ç•Œä»¥å¤–çš„åƒåœ¾ã€‚ ä¼˜ç¼ºç‚¹ï¼šè§£å†³äº†æ ‡è®°æ¸…é™¤ç®—æ³•çš„å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ï¼Œä½†å¤šäº†å¯¹è±¡ç§»åŠ¨æ­¥éª¤ï¼Œæ•ˆç‡ä¼šå—ä¸€å®šå½±å“ã€‚ä¸å¤åˆ¶ç®—æ³•ç›¸æ¯”ï¼Œå¤åˆ¶ç®—æ³•æ ‡è®°å®Œå°±å¤åˆ¶å¯¹è±¡ï¼Œè€Œæ ‡è®°æ•´ç†ç®—æ³•éœ€ç­‰æ‰€æœ‰å­˜æ´»å¯¹è±¡æ ‡è®°å®Œæ¯•åå†æ•´ç†ã€‚ ï¼ˆå››ï¼‰åˆ†ä»£æ”¶é›†ç®—æ³•\nå †å†…å­˜åˆ’åˆ†ï¼šJava 8 æ—¶ï¼Œå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ¯”ä¾‹ä¸º 1:2ã€‚æ–°ç”Ÿä»£åˆç»†åˆ†ä¸º Eden åŒºã€S0 åŒºå’Œ S1 åŒºï¼Œæ¯”ä¾‹ä¸º 8:1:1ã€‚Java 7 æ—¶è¿˜å­˜åœ¨æ°¸ä¹…ä»£ã€‚ ä¸åŒ GC ç±»å‹ Minor GCï¼ˆYoung GCï¼‰ï¼šå‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´çŸ­ï¼ˆSTW, Stop-The-Worldï¼‰ã€‚æ–°åˆ›å»ºå¯¹è±¡å…ˆåˆ†é…åˆ° Eden åŒºï¼ŒEden åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œæ ‡è®° Eden åŒºå’Œ from åŒºï¼ˆåˆå§‹æ—¶æ— ï¼‰çš„å­˜æ´»å¯¹è±¡ï¼Œç”¨å¤åˆ¶ç®—æ³•å°†å…¶å¤åˆ¶åˆ° to åŒºï¼ŒEden åŒºå’Œ from åŒºå†…å­˜é‡Šæ”¾ã€‚ç»è¿‡å¤šæ¬¡å›æ”¶ï¼Œå¹¸å­˜åŒºå¯¹è±¡è‹¥ç†¬è¿‡ä¸€å®šæ¬¡æ•°ï¼ˆæœ€å¤š 15 æ¬¡ï¼‰æˆ–å› å¹¸å­˜åŒºå†…å­˜ä¸è¶³ã€å¤§å¯¹è±¡ç­‰åŸå› ï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚ Major GCï¼šå‘ç”Ÿåœ¨è€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€‚ Full GCï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£å®Œæ•´åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´é•¿ï¼Œåº”å°½é‡é¿å…ã€‚ Mixed GCï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ¨åˆ†åŒºåŸŸçš„åƒåœ¾å›æ”¶ï¼Œæ˜¯ G1 æ”¶é›†å™¨ç‰¹æœ‰çš„ã€‚ 18. åƒåœ¾å›æ”¶å™¨ ï¼ˆä¸€ï¼‰ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨\nç‰¹ç‚¹ï¼šä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé€‚ç”¨äºå †å†…å­˜è¾ƒå°çš„ä¸ªäººç”µè„‘ã€‚ åº”ç”¨åŒºåŸŸåŠç®—æ³•ï¼šSerial ç”¨äºæ–°ç”Ÿä»£ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼›Serial Old ç”¨äºè€å¹´ä»£ï¼Œé‡‡ç”¨æ ‡è®° - æ•´ç†ç®—æ³•ã€‚åƒåœ¾å›æ”¶æ—¶ï¼ŒJava åº”ç”¨æ‰€æœ‰çº¿ç¨‹éƒ½è¦æš‚åœï¼ˆSTWï¼‰ç­‰å¾…å›æ”¶å®Œæˆã€‚ ï¼ˆäºŒï¼‰å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨\nç‰¹ç‚¹ï¼šå¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼ŒJDK8 é»˜è®¤ä½¿ç”¨ã€‚ åº”ç”¨åŒºåŸŸåŠç®—æ³•ï¼šParallel New ä½œç”¨äºæ–°ç”Ÿä»£ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼›Parallel Old ä½œç”¨äºè€å¹´ä»£ï¼Œé‡‡ç”¨æ ‡è®° - æ•´ç†ç®—æ³•ã€‚åŒæ ·åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ‰€æœ‰åº”ç”¨çº¿ç¨‹éœ€æš‚åœï¼ˆSTWï¼‰ã€‚ ï¼ˆä¸‰ï¼‰CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨\nç‰¹ç‚¹ï¼šé’ˆå¯¹è€å¹´ä»£ï¼Œé‡‡ç”¨æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼Œä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œåƒåœ¾å›æ”¶æ—¶åº”ç”¨ä»èƒ½æ­£å¸¸è¿è¡Œï¼Œåœé¡¿æ—¶é—´çŸ­ï¼Œç”¨æˆ·ä½“éªŒå¥½ã€‚ ï¼ˆå››ï¼‰G1 åƒåœ¾æ”¶é›†å™¨\næ¦‚è¿°ï¼šåº”ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼ŒJDK9 ä¹‹åé»˜è®¤ä½¿ç”¨ã€‚å°†å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå¯å……å½“ edenã€survivorã€oldã€humongousï¼ˆä¸“ä¸ºå¤§å¯¹è±¡å‡†å¤‡ï¼‰ã€‚é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå…¼é¡¾å“åº”æ—¶é—´ä¸ååé‡ã€‚åˆ†ä¸ºæ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†ä¸‰ä¸ªé˜¶æ®µï¼Œè‹¥å¹¶å‘å¤±è´¥ï¼ˆå›æ”¶é€Ÿåº¦èµ¶ä¸ä¸Šåˆ›å»ºæ–°å¯¹è±¡é€Ÿåº¦ï¼‰ï¼Œä¼šè§¦å‘ Full GCã€‚ å·¥ä½œé˜¶æ®µ å¹´è½»ä»£åƒåœ¾å›æ”¶ï¼ˆYoung Collectionï¼‰ï¼šåˆå§‹æ—¶æ‰€æœ‰åŒºåŸŸç©ºé—²ï¼Œåˆ›å»ºå¯¹è±¡å­˜äºä¼Šç”¸å›­åŒºã€‚ä¼Šç”¸å›­éœ€å›æ”¶æ—¶ï¼Œé€‰ä¸€ä¸ªç©ºé—²åŒºåŸŸåšå¹¸å­˜åŒºï¼Œç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼Œéœ€æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚åç»­ä¼Šç”¸å›­å†…å­˜å†ä¸è¶³æ—¶ï¼Œå°†ä¼Šç”¸å›­åŠä¹‹å‰å¹¸å­˜åŒºå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°å¹¸å­˜åŒºï¼Œè¾ƒè€å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£ã€‚ å¹´è½»ä»£åƒåœ¾å›æ”¶ + å¹¶å‘æ ‡è®°ï¼ˆYoung Collection + Concurrent Markï¼‰ï¼šè€å¹´ä»£å ç”¨å†…å­˜è¶…é˜ˆå€¼ï¼ˆé»˜è®¤ 45%ï¼‰åè§¦å‘å¹¶å‘æ ‡è®°ï¼Œæ­¤æ—¶æ— éœ€æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚å¹¶å‘æ ‡è®°åæœ‰é‡æ–°æ ‡è®°é˜¶æ®µè§£å†³æ¼æ ‡é—®é¢˜ï¼Œéœ€æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚å®Œæˆåç¡®å®šè€å¹´ä»£å­˜æ´»å¯¹è±¡ï¼Œè¿›å…¥æ··åˆæ”¶é›†é˜¶æ®µï¼Œæ ¹æ®æš‚åœæ—¶é—´ç›®æ ‡ä¼˜å…ˆå›æ”¶å­˜æ´»å¯¹è±¡å°‘çš„åŒºåŸŸã€‚ æ··åˆæ”¶é›†ï¼ˆMixed Collectionï¼‰ï¼šå®Œæˆå¯¹è±¡å¤åˆ¶ï¼Œé‡Šæ”¾å†…å­˜ï¼Œè¿›å…¥ä¸‹ä¸€è½®å›æ”¶å¾ªç¯ã€‚ 19ã€å¯¹è±¡å¼•ç”¨ç±»å‹ ï¼ˆä¸€ï¼‰å¼ºå¼•ç”¨\nåªæœ‰æ‰€æœ‰ GC Roots å¯¹è±¡éƒ½ä¸é€šè¿‡å¼ºå¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡æ‰èƒ½è¢«åƒåœ¾å›æ”¶ã€‚ä¾‹å¦‚User user = new User();ï¼Œåªè¦userå¼•ç”¨å­˜åœ¨ï¼ŒUserå¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶ã€‚\nï¼ˆäºŒï¼‰è½¯å¼•ç”¨\nä»…æœ‰è½¯å¼•ç”¨å¼•ç”¨å¯¹è±¡æ—¶ï¼Œåƒåœ¾å›æ”¶åè‹¥å†…å­˜ä»ä¸è¶³ï¼Œä¼šå†æ¬¡è§¦å‘å¯¹è¯¥å¯¹è±¡çš„å›æ”¶ã€‚å¦‚User user = new User(); SoftReference softReference = new SoftReference(user);ï¼Œåœ¨å†…å­˜ç´§å¼ æ—¶ï¼Œè½¯å¼•ç”¨å¯¹è±¡å¯èƒ½è¢«å›æ”¶ã€‚\nï¼ˆä¸‰ï¼‰å¼±å¼•ç”¨\nä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨å¯¹è±¡æ—¶ï¼Œåƒåœ¾å›æ”¶æ—¶æ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚ä¾‹å¦‚User user = new User(); WeakReference weakReference = new WeakReference(user);ã€‚ThreadLocal ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå…¶å†…éƒ¨Entryç±»çš„keyä¸ºå¼±å¼•ç”¨ï¼Œvalueä¸ºå¼ºå¼•ç”¨ã€‚å½“keyè¢«å›æ”¶è€Œvalueæœªæ¸…ç†æ—¶å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› æ­¤ä½¿ç”¨ ThreadLocal åå»ºè®®è°ƒç”¨æ¸…ç†æ–¹æ³•ã€‚\nï¼ˆå››ï¼‰è™šå¼•ç”¨\nå¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œè¢«å¼•ç”¨å¯¹è±¡å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šå…¥é˜Ÿï¼Œç”± Reference Handler çº¿ç¨‹è°ƒç”¨ç›¸å…³æ–¹æ³•é‡Šæ”¾ç›´æ¥å†…å­˜ã€‚\nJVM è°ƒä¼˜å®è·µ 1. JVM è°ƒä¼˜å‚æ•°è®¾ç½®ä½ç½® Tomcatï¼šè¦åœ¨ Tomcat é‡Œè®¾ç½® JVM è°ƒä¼˜å‚æ•°ï¼Œå¾—å»ä¿®æ”¹TOMCAT_HOME/bin/catalina.shæ–‡ä»¶ã€‚æ¯”å¦‚ï¼Œä½ æƒ³è®¾ç½®å †çš„åˆå§‹å¤§å°ä¸º 512MBï¼Œæœ€å¤§å¤§å°ä¸º 1024MBï¼Œå°±åœ¨æ–‡ä»¶é‡ŒåŠ ä¸ŠJAVA_OPTS=\u0026quot;-Xms512m -Xmx1024m\u0026quot; ã€‚è¿™æ ·ï¼ŒTomcat å¯åŠ¨æ—¶å°±ä¼šæŒ‰ç…§ä½ è®¾ç½®çš„å‚æ•°æ¥åˆ†é…å †å†…å­˜ã€‚ Spring Boot é¡¹ç›®ï¼šåœ¨ Linux ç³»ç»Ÿä¸‹å¯åŠ¨ Spring Boot é¡¹ç›®æ—¶ï¼Œèƒ½ç›´æ¥åœ¨å¯åŠ¨å‘½ä»¤é‡ŒåŠ å‚æ•°ã€‚åƒ nohup java -Xms512m -Xmx1024m -jar xxxx.jar --spring.profiles.active=prod \u0026amp; ï¼Œnohup èƒ½è®©å‘½ä»¤åœ¨åå°ä¸€ç›´è¿è¡Œï¼Œå…³äº†ç»ˆç«¯ä¹Ÿä¸å—å½±å“ï¼Œ\u0026amp; ä¹Ÿæ˜¯è®©å‘½ä»¤åœ¨åå°æ‰§è¡Œã€‚è¿™é‡ŒåŒæ ·è®¾ç½®äº†å †çš„åˆå§‹å’Œæœ€å¤§å¤§å°ï¼Œè¿˜æŒ‡å®šäº†é¡¹ç›®è¿è¡Œç¯å¢ƒæ˜¯prod ã€‚ 2. å¸¸ç”¨ JVM è°ƒä¼˜å‚æ•° å †å¤§å°è®¾ç½® -Xms ï¼šç”¨æ¥è®¾ç½®å †çš„åˆå§‹åŒ–å¤§å°ã€‚æ¯”å¦‚è¯´ -Xms512m ï¼Œæ„æ€å°±æ˜¯å †åˆšå¼€å§‹å°±åˆ†é… 512MB å†…å­˜ã€‚é€šå¸¸ä¸ºäº†ä¸è®©åƒåœ¾æ”¶é›†å™¨åœ¨åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°ä¹‹é—´æ¥å›è°ƒæ•´å †å¤§å°ï¼Œæµªè´¹æ—¶é—´ï¼Œä¼šæŠŠ -Xms å’Œ -Xmx è®¾ç½®æˆä¸€æ ·çš„å€¼ã€‚ -Xmx ï¼šè¿™ä¸ªæ˜¯è®¾ç½®å †èƒ½è¾¾åˆ°çš„æœ€å¤§å¤§å°ã€‚ä¾‹å¦‚ -Xmx1024m ï¼Œå°±æ˜¯è¯´å †æœ€å¤šå¯ä»¥ä½¿ç”¨ 1024MB å†…å­˜ã€‚ æ–°ç”Ÿä»£å†…å­˜åˆ†é…æ¯”ä¾‹è®¾ç½® -XX:SurvivorRatio ï¼šå®ƒå†³å®šå¹´è½»ä»£é‡Œ Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºçš„å¤§å°æ¯”ä¾‹ã€‚é»˜è®¤æ˜¯ 8:1:1 ã€‚è¦æ˜¯è®¾ç½® -XXSurvivorRatio=3 ï¼Œé‚£å°±è¡¨ç¤ºå¹´è½»ä»£é‡Œ survivor åŒºå’Œ eden åŒºçš„æ¯”ä¾‹æ˜¯ 2:3 ã€‚Java å®˜æ–¹ä¸€èˆ¬ä¼šå¢å¤§ Eden åŒºæ¥å‡å°‘ YGCï¼ˆæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼‰çš„æ¬¡æ•°ï¼Œä½† Eden åŒºå¤ªå¤§ï¼Œæ»¡äº†ä¹‹åé‡Šæ”¾å†…å­˜ä¼šå˜æ…¢ï¼Œç¨‹åºæš‚åœï¼ˆSTWï¼‰çš„æ—¶é—´å°±é•¿ï¼Œæ‰€ä»¥è¦æ ¹æ®å®é™…ç¨‹åºæƒ…å†µæ¥è°ƒæ•´è¿™ä¸ªæ¯”ä¾‹ã€‚ -XX:newSize ï¼šè®¾ç½®å¹´è½»ä»£çš„åˆå§‹å¤§å°ã€‚ -XX:MaxNewSize ï¼šè®¾ç½®å¹´è½»ä»£èƒ½è¾¾åˆ°çš„æœ€å¤§å¤§å°ã€‚ä¸€èˆ¬æŠŠè¿™ä¸¤ä¸ªå€¼è®¾æˆä¸€æ ·ï¼Œé»˜è®¤å¹´è½»ä»£å’Œè€å¹´ä»£çš„ç©ºé—´æ¯”ä¾‹æ˜¯ 1:2 ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥è°ƒæ•´å®ƒä»¬çš„å¤§å°ã€‚ çº¿ç¨‹å †æ ˆè®¾ç½® -Xss ï¼šæ¯ä¸ªçº¿ç¨‹é»˜è®¤æœ‰ 1M çš„å †æ ˆç©ºé—´ï¼Œç”¨æ¥æ”¾æ ˆå¸§ã€è°ƒç”¨å‚æ•°ã€å±€éƒ¨å˜é‡è¿™äº›ä¸œè¥¿ã€‚ä½†ä¸€èˆ¬ 256K å°±å¤Ÿäº†ã€‚å¦‚æœå‡å°‘æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ï¼Œç†è®ºä¸Šèƒ½äº§ç”Ÿæ›´å¤šçº¿ç¨‹ï¼Œä¸è¿‡è¿™ä¹Ÿå—æ“ä½œç³»ç»Ÿé™åˆ¶ã€‚æ¯”å¦‚ -Xss128k ï¼Œå°±æ˜¯æŠŠæ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°è®¾æˆ 128KB ã€‚ å¯¹è±¡æ™‹å‡è€å¹´ä»£ç›¸å…³è®¾ç½® -Xmn ï¼šè®¾ç½®å¹´è½»ä»£çš„å¤§å°ã€‚åˆç†è®¾ç½® eden åŒºã€survivor åŒºä»¥åŠå®ƒä»¬çš„ä½¿ç”¨ç‡ï¼Œèƒ½è®©å¹´è½»å¯¹è±¡ç•™åœ¨å¹´è½»ä»£ï¼Œé¿å… Full GCï¼ˆå…¨é‡åƒåœ¾å›æ”¶ï¼‰ã€‚ -XX:PetenureSizeThreshold ï¼šæŒ‡å®šå¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¤§å°é—¨æ§›ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚æ¯”å¦‚ -XX:PetenureSizeThreshold=1000000 ï¼Œå°±æ˜¯è¯´å¯¹è±¡å¤§å°è¶…è¿‡ 1MBï¼Œå°±ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…å†…å­˜ï¼Œé˜²æ­¢åœ¨å¹´è½»ä»£é¢‘ç¹ç§»åŠ¨å¤§å¯¹è±¡ï¼Œå¯¼è‡´ Full GCã€‚ -XX:MaxTenuringThreshold ï¼šè®¾ç½®å¯¹è±¡åœ¨ Survivor åŒºå­˜æ´»çš„æœ€å¤§å¹´é¾„ã€‚å¹´è½»å¯¹è±¡åœ¨ Eden åŒºç»è¿‡ç¬¬ä¸€æ¬¡ GC åè¿˜æ´»ç€ï¼Œå°±ä¼šè¢«ç§»åˆ° Survivor åŒºï¼Œä¹‹åæ¯ GC ä¸€æ¬¡å¹´é¾„åŠ  1 ï¼Œå½“å¹´é¾„è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šè¢«ç§»åˆ°è€å¹´åŒºã€‚è¦æ˜¯æƒ³è®©å¯¹è±¡ç•™åœ¨å¹´è½»ä»£ï¼Œå°±è®¾ä¸ªå¤§ä¸€ç‚¹çš„é˜ˆå€¼ã€‚ åƒåœ¾å›æ”¶å™¨é€‰æ‹©è®¾ç½® -XX:+UseParallelGC ï¼šè®©å¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶æ”¶é›†å™¨ï¼Œè¿™ä¸ªæ”¶é›†å™¨æ³¨é‡ååé‡ï¼Œèƒ½å‡å°‘åƒåœ¾å›æ”¶çš„æ—¶é—´ã€‚ -XX:+UseParallelOldGC ï¼šè®¾ç½®è€å¹´ä»£ä¹Ÿç”¨å¹¶è¡Œåƒåœ¾å›æ”¶æ”¶é›†å™¨ã€‚ -XX:+UseConcMarkSweepGC ï¼šè®©è€å¹´ä»£ç”¨ CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨ï¼Œè¿™ä¸ªæ”¶é›†å™¨èƒ½é™ä½åƒåœ¾å›æ”¶æ—¶ç¨‹åºæš‚åœçš„æ—¶é—´ã€‚ å†…å­˜åˆ†é¡µè®¾ç½® -XX:+LargePageSizeInBytes ï¼šè®¾ç½®å†…å­˜é¡µçš„å¤§å°ã€‚ç”¨å¤§çš„å†…å­˜åˆ†é¡µå¯ä»¥è®© CPU å†…å­˜å¯»å€èƒ½åŠ›å˜å¼ºï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ 3. JVM è°ƒä¼˜å·¥å…· å‘½ä»¤è¡Œå·¥å…· jpsï¼ˆJava Process Statusï¼‰ ï¼šå®ƒèƒ½è¾“å‡º JVM é‡Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯ï¼Œé€šè¿‡å®ƒå¯ä»¥çœ‹åˆ°å½“å‰è¿è¡Œçš„ Java è¿›ç¨‹ä»¥åŠç›¸å…³ä¿¡æ¯ã€‚ jstack ï¼šç”¨æ¥æŸ¥çœ‹ Java è¿›ç¨‹é‡Œçº¿ç¨‹çš„å †æ ˆä¿¡æ¯ã€‚ä½¿ç”¨æ–¹æ³•æ˜¯ jstack [option] \u0026lt;pid\u0026gt; ï¼Œ\u0026lt;pid\u0026gt; å°±æ˜¯è¿›ç¨‹ ID ã€‚é€šè¿‡åˆ†æçº¿ç¨‹å †æ ˆï¼Œèƒ½æ‰¾åˆ°çº¿ç¨‹æ­»é”ã€é•¿æ—¶é—´é˜»å¡è¿™äº›é—®é¢˜ã€‚ jmapå¯ä»¥ç”Ÿæˆå †è½¬å­˜å¿«ç…§ã€‚å¸¸è§å‘½ä»¤æœ‰ï¼š jmap -heap pid ï¼šèƒ½æ˜¾ç¤º Java å †çš„ä¿¡æ¯ï¼Œåƒå„ä»£çš„å¤§å°ã€æ¯”ä¾‹ï¼Œè¿˜æœ‰ä½¿ç”¨æƒ…å†µã€‚ jmap -dump:format=b,file=heap.hprof pid ï¼šæŠŠ Java å †å†…å­˜ä»¥ hprof äºŒè¿›åˆ¶æ ¼å¼è½¬å‚¨ï¼Œå¹¶ä¸”ä¿å­˜æˆä½ æŒ‡å®šçš„æ–‡ä»¶ heap.hprof ã€‚ jstatæ˜¯ JVM çš„ç»Ÿè®¡ç›‘æµ‹å·¥å…·ï¼Œèƒ½æ˜¾ç¤ºåƒåœ¾å›æ”¶ä¿¡æ¯ã€ç±»åŠ è½½ä¿¡æ¯ã€æ–°ç”Ÿä»£ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚å¸¸è§å‚æ•°æœ‰ï¼š jstat -gcutil pid ï¼šæ€»ç»“åƒåœ¾å›æ”¶çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å„ä»£çš„ä½¿ç”¨ç‡ã€GC æ¬¡æ•°ã€GC èŠ±çš„æ—¶é—´ç­‰ã€‚ jstat -gc pid ï¼šè¯¦ç»†è¾“å‡ºåƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯”å¦‚å¯¹è±¡åœ¨å„ä»£ä¹‹é—´æ€ä¹ˆç§»åŠ¨ã€æ€ä¹ˆå›æ”¶çš„ã€‚ jhat ï¼šå¯ä»¥åˆ†æ jmap ç”Ÿæˆçš„å †è½¬å­˜å¿«ç…§ï¼Œä½†ä¸€èˆ¬ä¸æ¨èç”¨å®ƒï¼Œç°åœ¨å¸¸ç”¨ Eclipse Memory Analyzer è¿™ç±»å·¥å…·æ›¿ä»£ã€‚ å¯è§†åŒ–å·¥å…· jconsole ï¼šè¿™æ˜¯åŸºäº JMXï¼ˆJava Management Extensionsï¼‰çš„å›¾å½¢åŒ–æ€§èƒ½ç›‘æ§å·¥å…·ï¼Œå¯ä»¥ç›‘æ§ JVM çš„å†…å­˜ã€çº¿ç¨‹ã€ç±»ç­‰ã€‚åœ¨ Java å®‰è£…ç›®å½•çš„binç›®å½•ä¸‹ï¼Œç›´æ¥å¯åŠ¨ jconsole.exe ï¼ˆWindows ç³»ç»Ÿï¼‰æˆ–è€… jconsole ï¼ˆLinux ç³»ç»Ÿï¼‰ï¼Œè¿ä¸Šç›®æ ‡ Java è¿›ç¨‹ï¼Œå°±èƒ½å¾ˆç›´è§‚åœ°çœ‹åˆ°å„ç§è¿è¡ŒæŒ‡æ ‡ã€‚ VisualVM ï¼šæ˜¯æ•…éšœå¤„ç†å·¥å…·ï¼Œèƒ½ç›‘æ§çº¿ç¨‹ã€å†…å­˜æƒ…å†µï¼ŒæŸ¥çœ‹æ–¹æ³•è€—è´¹ CPU çš„æ—¶é—´ï¼Œå†…å­˜é‡Œçš„å¯¹è±¡ï¼Œå·²ç»è¢« GC çš„å¯¹è±¡ï¼Œè¿˜èƒ½åå‘æŸ¥çœ‹å¯¹è±¡åˆ†é…çš„å †æ ˆã€‚åœ¨ Java å®‰è£…ç›®å½•çš„binç›®å½•ä¸‹å¯åŠ¨ jvisualvm.exe ï¼ˆWindows ç³»ç»Ÿï¼‰ï¼Œå®ƒèƒ½åŠ è½½ç¦»çº¿çš„å †è½¬å­˜å¿«ç…§ï¼ˆ.hprofæ–‡ä»¶ï¼‰è¿›è¡Œåˆ†æï¼Œæ–¹ä¾¿æ‰¾å‡ºå†…å­˜æ³„æ¼è¿™ç±»é—®é¢˜ã€‚ 4. Java å†…å­˜æ³„éœ²æ’æŸ¥æ€è·¯ ç”Ÿæˆå†…å­˜å¿«ç…§å¯ä»¥ç”¨jmapå‘½ä»¤æŒ‡å®šç”Ÿæˆå†…å­˜å¿«ç…§ dump æ–‡ä»¶ã€‚ä½†è¦æ˜¯ç¨‹åºå› ä¸ºå†…å­˜æº¢å‡ºå·²ç»ä¸­æ–­äº†ï¼Œ\njmapå°±æ²¡æ³•ç”¨äº†ã€‚\nè¿™æ—¶å€™å¯ä»¥è®¾ç½® VM å‚æ•°è®©ç¨‹åºè‡ªåŠ¨ç”Ÿæˆ dump æ–‡ä»¶ï¼Œè®¾ç½®æ–¹æ³•æ˜¯ï¼š\n-XX:+HeapDumpOnOutOfMemoryError ï¼šæ‰“å¼€å†…å­˜æº¢å‡ºæ—¶è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨å¿«ç…§çš„åŠŸèƒ½ã€‚ -XX:HeapDumpPath=/home/app/dumps/ ï¼šæŒ‡å®šç”Ÿæˆæ–‡ä»¶ä¿å­˜çš„ç›®å½•æ˜¯ /home/app/dumps/ ã€‚ åˆ†æ dump æ–‡ä»¶ï¼šç”¨å·¥å…·æ¥åˆ†æ dump æ–‡ä»¶ï¼Œæ¯”å¦‚ JDK è‡ªå¸¦çš„ VisualVM ï¼ˆä¹Ÿå¯ä»¥ç”¨ Eclipse Memory Analyzer ç­‰ï¼‰ã€‚ VisualVM èƒ½åŠ è½½ç¦»çº¿çš„ dump æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ Linux ç³»ç»Ÿé‡Œç¨‹åºç”Ÿæˆçš„ dump æ–‡ä»¶ï¼Œå¾—å…ˆä¸‹è½½åˆ°æœ¬åœ°ï¼ˆæ¯”å¦‚ Windows ç¯å¢ƒï¼‰ï¼Œå†ç”¨ VisualVM æ‰“å¼€åˆ†æã€‚\nå®šä½é—®é¢˜ä»£ç ï¼šé€šè¿‡æŸ¥çœ‹å †ä¿¡æ¯ï¼Œåƒå¯¹è±¡æ•°é‡ã€å¤§å°ã€å¼•ç”¨å…³ç³»è¿™äº›ï¼Œå¤§æ¦‚å°±èƒ½æ‰¾åˆ°å†…å­˜æº¢å‡ºæ˜¯å“ªæ®µä»£ç å¯¼è‡´çš„ã€‚\nä¿®å¤é—®é¢˜ï¼šæ‰¾åˆ°å¯¹åº”çš„ä»£ç ï¼Œçœ‹çœ‹ä¸Šä¸‹æ–‡ï¼Œåˆ†æå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¼•ç”¨å…³ç³»ï¼Œç„¶åä¿®æ”¹å¯¼è‡´å†…å­˜æ³„æ¼çš„ä»£ç é€»è¾‘ï¼Œæ¯”å¦‚é‡Šæ”¾æ‰æ²¡ç”¨çš„å¼•ç”¨ï¼Œä¼˜åŒ–å¯¹è±¡åˆ›å»ºå’Œé”€æ¯çš„æ–¹å¼ç­‰ã€‚\n5. æœåŠ¡å™¨ CPU æŒç»­é£™é«˜æ’æŸ¥æ–¹æ¡ˆä¸æ€è·¯ ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ CPU å ç”¨æƒ…å†µï¼šåœ¨ç»ˆç«¯è¾“å…¥ top å‘½ä»¤ï¼Œå°±èƒ½å®æ—¶çœ‹åˆ°ç³»ç»Ÿé‡Œå„ä¸ªè¿›ç¨‹çš„ CPU å ç”¨ç‡ç­‰ä¿¡æ¯ï¼Œè¿™æ ·å°±èƒ½æ‰¾å‡ºå“ªä¸ªè¿›ç¨‹å ç”¨ CPU æ¯”è¾ƒé«˜ã€‚ ç¡®å®šé«˜ CPU å ç”¨è¿›ç¨‹ IDï¼šä» top å‘½ä»¤çš„ç»“æœé‡Œï¼Œè®°ä¸‹å ç”¨ CPU é«˜çš„é‚£ä¸ªè¿›ç¨‹çš„ ID ã€‚ æŸ¥çœ‹è¿›ç¨‹å†…çº¿ç¨‹ä¿¡æ¯ï¼šç”¨ ps å‘½ä»¤æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹é‡Œçš„çº¿ç¨‹ä¿¡æ¯ï¼Œæ‰¾å‡º CPU å ç”¨é«˜çš„çº¿ç¨‹ã€‚æ¯”å¦‚ ps H -eo pid,tid,%CPU | grep \u0026lt;è¿›ç¨‹ID\u0026gt; ï¼Œpid æ˜¯è¿›ç¨‹ ID ï¼Œtid æ˜¯çº¿ç¨‹ ID ï¼Œ%CPU æ˜¯ CPU ä½¿ç”¨ç‡ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½ç­›é€‰å‡ºæŒ‡å®šè¿›ç¨‹é‡Œæ¯ä¸ªçº¿ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µã€‚ è½¬æ¢çº¿ç¨‹ ID ä¸ºåå…­è¿›åˆ¶ï¼šé€šå¸¸æ—¥å¿—é‡Œæ˜¾ç¤ºçš„çº¿ç¨‹ ID æ˜¯åå…­è¿›åˆ¶çš„ï¼Œæ‰€ä»¥è¦æŠŠå‰é¢å¾—åˆ°çš„åè¿›åˆ¶çº¿ç¨‹ ID è½¬æ¢æˆåå…­è¿›åˆ¶ã€‚åœ¨ Linux é‡Œç”¨ printf \u0026quot;%x\\n\u0026quot; \u0026lt;çº¿ç¨‹ID\u0026gt; è¿™ä¸ªå‘½ä»¤å°±èƒ½è½¬æ¢ã€‚ å®šä½é—®é¢˜ä»£ç è¡Œå·ï¼šç”¨ jstack å‘½ä»¤æ‰“å°è¿›ç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œæ ¹æ®è½¬æ¢åçš„åå…­è¿›åˆ¶çº¿ç¨‹ ID æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›è€Œæ‰¾åˆ°é—®é¢˜ä»£ç åœ¨æºç é‡Œçš„è¡Œå·ã€‚æ‰§è¡Œ jstack \u0026lt;è¿›ç¨‹ID\u0026gt; å‘½ä»¤ï¼Œåˆ†æè¾“å‡ºçš„å †æ ˆä¿¡æ¯ï¼Œæ‰¾åˆ°çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•è°ƒç”¨æ ˆï¼Œå°±èƒ½ç¡®å®šæ˜¯å“ªæ®µä»£ç å¯¼è‡´ CPU é£™é«˜ï¼Œç„¶åå†åˆ†æä»£ç é€»è¾‘ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰æ­»å¾ªç¯ã€å¤æ‚è®¡ç®—æ²¡ä¼˜åŒ–è¿™äº›é—®é¢˜ï¼Œæ‰¾åˆ°åŸå› åè¿›è¡Œä¿®å¤ã€‚ é¢è¯•ç°åœº ä¸€ã€JVMç»„æˆ é¢è¯•å®˜ï¼šJVMç”±é‚£äº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œå¥½çš„~~\nåœ¨JVMä¸­å…±æœ‰å››å¤§éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰ã€Runtime Data Areaï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼Œå†…å­˜åˆ†åŒºï¼‰ã€Execution Engineï¼ˆæ‰§è¡Œå¼•æ“ï¼‰ã€Native Method Libraryï¼ˆæœ¬åœ°åº“æ¥å£ï¼‰\nå®ƒä»¬çš„è¿è¡Œæµç¨‹æ˜¯ï¼š\nç¬¬ä¸€ï¼Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æŠŠJavaä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç \nç¬¬äºŒï¼Œè¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åªæ˜¯JVMçš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚ç³»ç»Ÿå»æ‰§è¡Œï¼Œè€Œæ˜¯æœ‰æ‰§è¡Œå¼•æ“è¿è¡Œ\nç¬¬ä¸‰ï¼Œæ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œå†äº¤ç”±CPUæ‰§è¡Œå»æ‰§è¡Œï¼Œæ­¤æ—¶éœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€çš„æœ¬åœ°åº“æ¥å£ï¼ˆNative Method Libraryï¼‰æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚\né¢è¯•å®˜ï¼šå¥½çš„ï¼Œä½ èƒ½è¯¦ç»†è¯´ä¸€ä¸‹ JVM è¿è¡Œæ—¶æ•°æ®åŒºå—ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œå¥½~\nè¿è¡Œæ—¶æ•°æ®åŒºåŒ…å«äº†å †ã€æ–¹æ³•åŒºã€æ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨è¿™å‡ éƒ¨åˆ†ï¼Œæ¯ä¸ªåŠŸèƒ½ä½œç”¨ä¸ä¸€æ ·ã€‚\nå †è§£å†³çš„æ˜¯å¯¹è±¡å®ä¾‹å­˜å‚¨çš„é—®é¢˜ï¼Œåƒåœ¾å›æ”¶å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚ æ–¹æ³•åŒºå¯ä»¥è®¤ä¸ºæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ä¿¡æ¯ï¼Œå¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚ æ ˆè§£å†³çš„æ˜¯ç¨‹åºè¿è¡Œçš„é—®é¢˜ï¼Œæ ˆé‡Œé¢å­˜çš„æ˜¯æ ˆå¸§ï¼Œæ ˆå¸§é‡Œé¢å­˜çš„æ˜¯å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚ æœ¬åœ°æ–¹æ³•æ ˆä¸æ ˆåŠŸèƒ½ç›¸åŒï¼Œæœ¬åœ°æ–¹æ³•æ ˆæ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¸€ä¸ªJavaè°ƒç”¨éJavaä»£ç çš„æ¥å£ã€‚ ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰ç¨‹åºè®¡æ•°å™¨ä¸­å­˜æ”¾çš„æ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œæ•°ã€‚JVMå·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ é¢è¯•å®˜ï¼šå¥½çš„ï¼Œä½ å†è¯¦ç»†ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œæ˜¯è¿™æ ·~~\njavaè™šæ‹Ÿæœºå¯¹äºå¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶ä¸”åˆ†é…çº¿ç¨‹æ‰§è¡Œæ—¶é—´ã€‚åœ¨ä»»ä½•çš„ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œä¸€ä¸ªå¤„ç†å™¨åªä¼šå¤„ç†æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœå½“å‰è¢«æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹å®ƒæ‰€åˆ†é…çš„æ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ã€æŒ‚èµ·ã€‘ã€‚å¤„ç†å™¨ä¼šåˆ‡æ¢åˆ°å¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹ä¸Šæ¥è¿›è¡Œæ‰§è¡Œã€‚å¹¶ä¸”è¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ï¼Œæ¥ç€å¤„ç†å™¨å°±ä¼šåˆæ¥æ‰§è¡Œè¢«æŒ‚èµ·çš„è¿™ä¸ªçº¿ç¨‹ã€‚è¿™æ—¶å€™ç¨‹åºè®¡æ•°å™¨å°±èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼Œç¨‹åºè®¡æ•°å™¨åœ¨æ¥å›åˆ‡æ¢çš„çº¿ç¨‹ä¸­è®°å½•ä»–ä¸Šä¸€æ¬¡æ‰§è¡Œçš„è¡Œå·ï¼Œç„¶åæ¥ç€ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚\né¢è¯•å®˜ï¼šä½ èƒ½ç»™æˆ‘è¯¦ç»†çš„ä»‹ç»Javaå †å—?\nå€™é€‰äºº:\nå¥½çš„~\nJavaä¸­çš„å †æœ¯è¯­çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚ä¸»è¦ç”¨æ¥ä¿å­˜å¯¹è±¡å®ä¾‹ï¼Œæ•°ç»„ç­‰ï¼Œå½“å †ä¸­æ²¡æœ‰å†…å­˜ç©ºé—´å¯åˆ†é…ç»™å®ä¾‹ï¼Œä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚\nâ€‹ åœ¨JAVA8ä¸­å †å†…ä¼šå­˜åœ¨å¹´è½»ä»£ã€è€å¹´ä»£\nâ€‹ 1ï¼‰YoungåŒºè¢«åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼ŒEdenåŒºå’Œä¸¤ä¸ªå¤§å°ä¸¥æ ¼ç›¸åŒçš„SurvivoråŒºï¼Œå…¶ä¸­ï¼ŒSurvivoråŒºé—´ä¸­ï¼ŒæŸä¸€æ—¶åˆ»åªæœ‰å…¶ä¸­ä¸€ä¸ªæ˜¯è¢«ä½¿ç”¨çš„ï¼Œå¦å¤–ä¸€ä¸ªç•™åšåƒåœ¾æ”¶é›†æ—¶å¤åˆ¶å¯¹è±¡ç”¨ã€‚åœ¨EdenåŒºå˜æ»¡çš„æ—¶å€™ï¼Œ GCå°±ä¼šå°†å­˜æ´»çš„å¯¹è±¡ç§»åˆ°ç©ºé—²çš„SurvivoråŒºé—´ä¸­ï¼Œæ ¹æ®JVMçš„ç­–ç•¥ï¼Œåœ¨ç»è¿‡å‡ æ¬¡åƒåœ¾æ”¶é›†åï¼Œä»»ç„¶å­˜æ´»äºSurvivorçš„å¯¹è±¡å°†è¢«ç§»åŠ¨åˆ°TenuredåŒºé—´ã€‚\nâ€‹ 2ï¼‰TenuredåŒºä¸»è¦ä¿å­˜ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ä¸€äº›è€çš„å¯¹è±¡ï¼Œå½“ä¸€äº›å¯¹è±¡åœ¨Youngå¤åˆ¶è½¬ç§»ä¸€å®šçš„æ¬¡æ•°ä»¥åï¼Œå¯¹è±¡å°±ä¼šè¢«è½¬ç§»åˆ°TenuredåŒºã€‚\né¢è¯•å®˜ï¼šèƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ\nå€™é€‰äºº:\næ–¹æ³•åŒºï¼ˆMethod Areaï¼‰æ˜¯ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å†…å­˜ç»“æ„ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œå®ƒä¸»è¦ç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰ï¼‰ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚æ–¹æ³•åŒºæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå¹¶ä¸”åœ¨è™šæ‹Ÿæœºçš„ç”Ÿå‘½å‘¨æœŸå†…ä¸€ç›´å­˜åœ¨ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ JDK 1.8 ä¹‹å‰ï¼Œæ–¹æ³•åŒºè¢«ç§°ä¸ºæ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰ï¼Œå®ƒä¸å †å†…å­˜çš„å…¶ä»–åŒºåŸŸï¼ˆå¦‚æ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼‰ç±»ä¼¼ï¼Œæ˜¯ JVM çš„ä¸€éƒ¨åˆ†ã€‚ä» JDK 1.8 å¼€å§‹ï¼Œæ°¸ä¹…ä»£è¢«ç§»é™¤ï¼Œæ–¹æ³•åŒºè¢«é‡æ–°è®¾è®¡ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼Œå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰ï¼Œè€Œä¸æ˜¯å †å†…å­˜ã€‚\né¢è¯•å®˜ï¼šä½ å¬è¿‡ç›´æ¥å†…å­˜å—ï¼Ÿ\nå€™é€‰äºº:\nç›´æ¥å†…å­˜ä¹Ÿè¢«ç§°ä¸ºå †å¤–å†…å­˜ï¼Œå®ƒæ˜¯ä¸€ç§ä½äº Java è™šæ‹Ÿæœºå †å¤–çš„å†…å­˜ï¼Œé€šå¸¸é€šè¿‡ Java Native Interfaceï¼ˆJNIï¼‰æˆ–è€…java.nio.ByteBuffer.allocateDirect() æ–¹æ³•è¿›è¡Œåˆ†é…ã€‚è¿™ç§å†…å­˜ç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ï¼Œå› æ­¤å®ƒä¸å— JVM å †å¤§å°çš„é™åˆ¶ï¼Œä¹Ÿä¸ä¼šå—åˆ°åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æœºåˆ¶çš„ç®¡ç†ã€‚ç”±äºç›´æ¥å†…å­˜æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œæ‰€ä»¥æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å…¶ä¸­çš„æ•°æ®ã€‚æ­¤å¤–ï¼Œç›´æ¥å†…å­˜ç‰¹åˆ«é€‚åˆç”¨äºé«˜æ€§èƒ½çš„ I/O æ“ä½œï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå‡å°‘æ•°æ®åœ¨ JVM å †å’Œæœ¬åœ°å†…å­˜ä¹‹é—´çš„æ‹·è´ï¼Œä»è€Œæé«˜ I/O æ“ä½œçš„æ•ˆç‡ã€‚ä¸è¿‡ï¼Œç”±äºç›´æ¥å†…å­˜ä¸å— GC ç®¡ç†ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\né¢è¯•å®˜ï¼šJava 8 ä¸­å°†æ–¹æ³•åŒºä»æ°¸ä¹…ä»£è¿ç§»åˆ°å…ƒç©ºé—´çš„æ”¹åŠ¨å¸¦æ¥äº†å“ªäº›å¥½å¤„å’Œæ½œåœ¨å½±å“ï¼Ÿ\nå€™é€‰äºº\nåœ¨ Java 8 ä¹‹å‰ï¼Œæ–¹æ³•åŒºæ˜¯é€šè¿‡ HotSpot è™šæ‹Ÿæœºçš„æ°¸ä¹…ä»£æ¥å®ç°çš„ï¼Œå®ƒå­˜å‚¨äº†ç±»çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ä»¥åŠå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰ã€‚ç”±äºæ°¸ä¹…ä»£æ˜¯ JVM å †çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå—åˆ°åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„ç®¡ç†ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª -XX:MaxPermSize çš„ä¸Šé™ã€‚è¿™å¯¼è‡´åœ¨å¤§é‡åŠ¨æ€ç”Ÿæˆç±»æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç° OutOfMemoryErrorã€‚è™½ç„¶å¯ä»¥é€šè¿‡å¢å¤§ -XX:MaxPermSize æ¥ç¼“è§£ï¼Œä½†å¾ˆéš¾ç¡®å®šä¸€ä¸ªåˆé€‚çš„å¤§å°ï¼Œå› ä¸ºå®ƒå—åˆ°ç±»çš„æ•°é‡å’Œå¸¸é‡æ•°é‡çš„å½±å“å¾ˆå¤§ã€‚\nä» Java 8 å¼€å§‹ï¼Œæ–¹æ³•åŒºçš„å®ç°è¢«è¿ç§»åˆ°äº†æœ¬åœ°å†…å­˜ä¸­çš„å…ƒç©ºé—´ã€‚å…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜è€Œä¸æ˜¯ JVM å †å†…å­˜ï¼Œå› æ­¤å®ƒä¸å— -XX:MaxPermSize çš„é™åˆ¶ï¼Œä¹Ÿä¸å— JVM åƒåœ¾å›æ”¶æœºåˆ¶çš„ç›´æ¥ç®¡ç†ã€‚è¿™ç§æ”¹åŠ¨å¸¦æ¥äº†ä»¥ä¸‹å¥½å¤„å’Œæ½œåœ¨å½±å“ï¼š\nå¥½å¤„\nå‡å°‘ OutOfMemoryErrorï¼šç”±äºå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œä¸å†å— JVM å †å¤§å°çš„é™åˆ¶ï¼Œå› æ­¤å‡å°‘äº†å› æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³è€Œå¯¼è‡´çš„ OutOfMemoryErrorã€‚ æ›´çµæ´»çš„å†…å­˜ç®¡ç†ï¼šå…ƒç©ºé—´çš„å¤§å°å¯ä»¥é€šè¿‡ -XX:MaxMetaspaceSize å‚æ•°è¿›è¡Œè®¾ç½®ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´ä¼šè‡ªåŠ¨æ‰©å±•ï¼Œé¿å…äº†æ‰‹åŠ¨è°ƒæ•´å†…å­˜å¤§å°çš„éº»çƒ¦ã€‚ æ€§èƒ½æå‡ï¼šç”±äºå…ƒç©ºé—´ä¸å†å— GC çš„é¢‘ç¹ç®¡ç†ï¼Œå‡å°‘äº† GC çš„è´Ÿæ‹…ï¼Œä»è€Œæå‡äº†æ•´ä½“æ€§èƒ½ã€‚ æ½œåœ¨å½±å“\nå†…å­˜ä½¿ç”¨å¢åŠ ï¼šå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é‡å¢åŠ ï¼Œå°¤å…¶æ˜¯åœ¨ç±»åŠ è½½é¢‘ç¹çš„åº”ç”¨ä¸­ã€‚ ç›‘æ§å’Œç®¡ç†å¤æ‚æ€§ï¼šç”±äºå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç›‘æ§å’Œç®¡ç†å…ƒç©ºé—´çš„å†…å­˜ä½¿ç”¨æƒ…å†µå¯èƒ½æ¯”ç›‘æ§æ°¸ä¹…ä»£æ›´åŠ å¤æ‚ã€‚ å…¼å®¹æ€§é—®é¢˜ï¼šå¯¹äºä¸€äº›ä¾èµ–äºæ°¸ä¹…ä»£ç‰¹æ€§çš„æ—§ä»£ç æˆ–å·¥å…·ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œè°ƒæ•´ä»¥é€‚åº”æ–°çš„å…ƒç©ºé—´æœºåˆ¶ã€‚ é¢è¯•å®˜ï¼šä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ\nå€™é€‰äºº:\nè™šæ‹Ÿæœºæ ˆæ˜¯æè¿°çš„æ˜¯æ–¹æ³•æ‰§è¡Œæ—¶çš„å†…å­˜æ¨¡å‹,æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒï¼Œæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºæ ˆæ¡¢ã€‚ä¿å­˜æ‰§è¡Œæ–¹æ³•æ—¶çš„å±€éƒ¨å˜é‡ã€åŠ¨æ€è¿æ¥ä¿¡æ¯ã€æ–¹æ³•è¿”å›åœ°å€ä¿¡æ¯ç­‰ç­‰ã€‚æ–¹æ³•å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šè¿›æ ˆï¼Œæ–¹æ³•æ‰§è¡Œå®Œä¼šå‡ºæ ˆã€ç›¸å½“äºæ¸…ç©ºäº†æ•°æ®ã€‘ï¼Œæ‰€ä»¥è¿™å—åŒºåŸŸä¸éœ€è¦è¿›è¡Œ GCã€‚\né¢è¯•å®˜ï¼šèƒ½è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆå—ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œå¥½çš„ï¼Œæœ‰è¿™å‡ ä¸ªåŒºåˆ«\nç¬¬ä¸€ï¼Œæ ˆå†…å­˜ä¸€èˆ¬ä¼šç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ï¼Œä½†å †å†…å­˜æ˜¯ç”¨æ¥å­˜å‚¨Javaå¯¹è±¡å’Œæ•°ç»„çš„çš„ã€‚å †ä¼šGCåƒåœ¾å›æ”¶ï¼Œè€Œæ ˆä¸ä¼šã€‚\nç¬¬äºŒã€æ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè€Œå †å†…å­˜æ˜¯çº¿ç¨‹å…±æœ‰çš„ã€‚\nç¬¬ä¸‰ã€ä¸¤è€…å¼‚å¸¸é”™è¯¯ä¸åŒï¼Œä½†å¦‚æœæ ˆå†…å­˜æˆ–è€…å †å†…å­˜ä¸è¶³éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\næ ˆç©ºé—´ä¸è¶³ï¼šjava.lang.StackOverFlowErrorã€‚\nå †ç©ºé—´ä¸è¶³ï¼šjava.lang.OutOfMemoryErrorã€‚\näºŒã€ç±»åŠ è½½å™¨ é¢è¯•å®˜ï¼šä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›?\nå€™é€‰äºº:\nå—¯ï¼Œæ˜¯è¿™æ ·çš„\nJVMåªä¼šè¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°JVMä¸­ï¼Œä»è€Œè®©Javaç¨‹åºèƒ½å¤Ÿå¯åŠ¨èµ·æ¥ã€‚\nå¸¸è§çš„ç±»åŠ è½½å™¨æœ‰4ä¸ª\nç¬¬ä¸€ä¸ªæ˜¯å¯åŠ¨ç±»åŠ è½½å™¨(BootStrap ClassLoader)ï¼šå…¶æ˜¯ç”±C++ç¼–å†™å®ç°ã€‚ç”¨äºåŠ è½½JAVA_HOME/jre/libç›®å½•ä¸‹çš„ç±»åº“ã€‚\nç¬¬äºŒä¸ªæ˜¯æ‰©å±•ç±»åŠ è½½å™¨(ExtClassLoader)ï¼šè¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦åŠ è½½JAVA_HOME/jre/lib/extç›®å½•ä¸­çš„ç±»åº“ã€‚\nç¬¬ä¸‰ä¸ªæ˜¯åº”ç”¨ç±»åŠ è½½å™¨(AppClassLoader)ï¼šè¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦ç”¨äºåŠ è½½classPathä¸‹çš„ç±»ï¼Œä¹Ÿå°±æ˜¯åŠ è½½å¼€å‘è€…è‡ªå·±ç¼–å†™çš„Javaç±»ã€‚\nç¬¬å››ä¸ªæ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼šå¼€å‘è€…è‡ªå®šä¹‰ç±»ç»§æ‰¿ClassLoaderï¼Œå®ç°è‡ªå®šä¹‰ç±»åŠ è½½è§„åˆ™ã€‚\né¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯æŒºå¤šçš„ã€‚\nç±»ä»åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­å¼€å§‹ï¼Œç›´åˆ°å¸è½½ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬äº†ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œå¸è½½è¿™7ä¸ªé˜¶æ®µã€‚å…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æè¿™ä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆlinkingï¼‰\n1.åŠ è½½ï¼šæŸ¥æ‰¾å’Œå¯¼å…¥classæ–‡ä»¶\n2.éªŒè¯ï¼šä¿è¯åŠ è½½ç±»çš„å‡†ç¡®æ€§\n3.å‡†å¤‡ï¼šä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼\n4.è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨\n5.åˆå§‹åŒ–ï¼šå¯¹ç±»çš„é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ\n6.ä½¿ç”¨ï¼šJVM å¼€å§‹ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç \n7.å¸è½½ï¼šå½“ç”¨æˆ·ç¨‹åºä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒJVM ä¾¿å¼€å§‹é”€æ¯åˆ›å»ºçš„ Class å¯¹è±¡ï¼Œæœ€åè´Ÿè´£è¿è¡Œçš„ JVM ä¹Ÿé€€å‡ºå†…å­˜\né¢è¯•å®˜ï¼šä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œå®ƒæ˜¯æ˜¯è¿™æ ·çš„ã€‚\nå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ è¾“åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨è¿”å›è‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢è¿”å›ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½\né¢è¯•å®˜ï¼šJVMä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶\nå€™é€‰äºº:\nä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚\nç¬¬ä¸€ã€é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…æŸä¸€ä¸ªç±»è¢«é‡å¤åŠ è½½ï¼Œå½“çˆ¶ç±»å·²ç»åŠ è½½ååˆ™æ— éœ€é‡å¤åŠ è½½ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚\nç¬¬äºŒã€ä¸ºäº†å®‰å…¨ï¼Œä¿è¯ç±»åº“APIä¸ä¼šè¢«ä¿®æ”¹\nä¸‰ã€åƒåœ¾å›æ”¶ é¢è¯•å®˜ï¼šç®€è¿°Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿï¼ˆGCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦GCï¼‰\nå€™é€‰äºº:\nå—¯ï¼Œæ˜¯è¿™æ ·~~\nä¸ºäº†è®©ç¨‹åºå‘˜æ›´ä¸“æ³¨äºä»£ç çš„å®ç°ï¼Œè€Œä¸ç”¨è¿‡å¤šçš„è€ƒè™‘å†…å­˜é‡Šæ”¾çš„é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œåœ¨Javaè¯­è¨€ä¸­ï¼Œæœ‰äº†è‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„GC(Garbage Collection)ã€‚\næœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œç¨‹åºå‘˜åªéœ€è¦å…³å¿ƒå†…å­˜çš„ç”³è¯·å³å¯ï¼Œå†…å­˜çš„é‡Šæ”¾ç”±ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å®Œæˆã€‚\nåœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¸åŒçš„å¯¹è±¡å¼•ç”¨ç±»å‹ï¼ŒGCä¼šé‡‡ç”¨ä¸åŒçš„å›æ”¶æ—¶æœº\né¢è¯•å®˜ï¼šå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ\nå€™é€‰äºº:\nå—¯å—¯~\nå¼ºå¼•ç”¨æœ€ä¸ºæ™®é€šçš„å¼•ç”¨æ–¹å¼ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äºæœ‰ç”¨ä¸”å¿…é¡»çš„çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œåˆ™GCå¹¶ä¸ä¼šå›æ”¶å®ƒã€‚å³ä¾¿å †ä¸­å†…å­˜ä¸è¶³äº†ï¼Œå®å¯å‡ºç°OOMï¼Œä¹Ÿä¸ä¼šå¯¹å…¶è¿›è¡Œå›æ”¶\nè½¯å¼•ç”¨è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äºæœ‰ç”¨ä¸”éå¿…é¡»çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å¤„äºè½¯å¼•ç”¨ï¼Œåœ¨å†…å­˜ç©ºé—´è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼ŒGCæœºåˆ¶å¹¶ä¸ä¼šå›æ”¶å®ƒï¼Œè€Œåœ¨å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œåˆ™ä¼šåœ¨OOMå¼‚å¸¸å‡ºç°ä¹‹é—´å¯¹å…¶è¿›è¡Œå›æ”¶ã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºGCçº¿ç¨‹ä¼˜å…ˆçº§è¾ƒä½ï¼Œè½¯å¼•ç”¨å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ã€‚\nå¼±å¼•ç”¨è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äºå¯èƒ½æœ‰ç”¨ä¸”éå¿…é¡»çš„çŠ¶æ€ã€‚åœ¨GCçº¿ç¨‹æ‰«æå†…å­˜åŒºåŸŸæ—¶ï¼Œä¸€æ—¦å‘ç°å¼±å¼•ç”¨ï¼Œå°±ä¼šå›æ”¶åˆ°å¼±å¼•ç”¨ç›¸å…³è”çš„å¯¹è±¡ã€‚å¯¹äºå¼±å¼•ç”¨çš„å›æ”¶ï¼Œæ— å…³å†…å­˜åŒºåŸŸæ˜¯å¦è¶³å¤Ÿï¼Œä¸€æ—¦å‘ç°åˆ™ä¼šè¢«å›æ”¶ã€‚åŒæ ·çš„ï¼Œå› ä¸ºGCçº¿ç¨‹ä¼˜å…ˆçº§è¾ƒä½ï¼Œæ‰€ä»¥å¼±å¼•ç”¨ä¹Ÿå¹¶ä¸æ˜¯ä¼šè¢«ç«‹åˆ»å›æ”¶ã€‚\nè™šå¼•ç”¨è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äºæ— ç”¨çš„çŠ¶æ€ã€‚åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚è™šå¼•ç”¨çš„ä½¿ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—Reference Queueè”åˆä½¿ç”¨\né¢è¯•å®˜ï¼šå¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶\nå€™é€‰äºº:\næ€è€ƒä¸€ä¼š~~\nå¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼•ç”¨æŒ‡å‘å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç°åœ¨å°±æ˜¯åƒåœ¾ï¼Œå¦‚æœå®šä½äº†åƒåœ¾ï¼Œåˆ™æœ‰å¯èƒ½ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚\nå¦‚æœè¦å®šä½ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥ç¡®å®šï¼Œç¬¬ä¸€ä¸ªæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Œç¬¬äºŒä¸ªæ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•\né€šå¸¸éƒ½ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥ç¡®å®šæ˜¯ä¸æ˜¯åƒåœ¾\né¢è¯•å®˜ï¼š JVM åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ\nå€™é€‰äºº:\næˆ‘è®°å¾—ä¸€å…±æœ‰å››ç§ï¼Œåˆ†åˆ«æ˜¯æ ‡è®°æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ç®—æ³•ã€æ ‡è®°æ•´ç†ç®—æ³•ã€åˆ†ä»£å›æ”¶\né¢è¯•å®˜ï¼š ä½ èƒ½è¯¦ç»†èŠä¸€ä¸‹åˆ†ä»£å›æ”¶å—ï¼Ÿ\nå€™é€‰äºº:\nå…³äºåˆ†ä»£å›æ”¶æ˜¯è¿™æ ·çš„\nåœ¨java8æ—¶ï¼Œå †è¢«åˆ†ä¸ºäº†ä¸¤ä»½ï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå®ƒä»¬é»˜è®¤ç©ºé—´å ç”¨æ¯”ä¾‹æ˜¯1:2\nå¯¹äºæ–°ç”Ÿä»£ï¼Œå†…éƒ¨åˆè¢«åˆ†ä¸ºäº†ä¸‰ä¸ªåŒºåŸŸã€‚EdenåŒºï¼ŒS0åŒºï¼ŒS1åŒºé»˜è®¤ç©ºé—´å ç”¨æ¯”ä¾‹æ˜¯8:1:1\nå…·ä½“çš„å·¥ä½œæœºåˆ¶æ˜¯æœ‰äº›æƒ…å†µï¼š\n1ï¼‰å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¼šè¢«åˆ†é…åœ¨æ–°ç”Ÿä»£çš„EdenåŒºã€‚å½“EdenåŒºè¦æ»¡äº†æ—¶å€™ï¼Œè§¦å‘YoungGCã€‚\n2ï¼‰å½“è¿›è¡ŒYoungGCåï¼Œæ­¤æ—¶åœ¨EdenåŒºå­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°S0åŒºï¼Œå¹¶ä¸”å½“å‰å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1ï¼Œæ¸…ç©ºEdenåŒºã€‚\n3ï¼‰å½“å†ä¸€æ¬¡è§¦å‘YoungGCçš„æ—¶å€™ï¼Œä¼šæŠŠEdenåŒºä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å’ŒS0ä¸­çš„å¯¹è±¡ï¼Œç§»åŠ¨åˆ°S1åŒºä¸­ï¼Œè¿™äº›å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1ï¼Œæ¸…ç©ºEdenåŒºå’ŒS0åŒºã€‚\n4ï¼‰å½“å†ä¸€æ¬¡è§¦å‘YoungGCçš„æ—¶å€™ï¼Œä¼šæŠŠEdenåŒºä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å’ŒS1ä¸­çš„å¯¹è±¡ï¼Œç§»åŠ¨åˆ°S0åŒºä¸­ï¼Œè¿™äº›å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1ï¼Œæ¸…ç©ºEdenåŒºå’ŒS1åŒºã€‚\n5ï¼‰å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°äº†æŸä¸€ä¸ªé™å®šçš„å€¼ï¼ˆé»˜è®¤15å² ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¿›å…¥åˆ°è€å¹´ä»£ä¸­ã€‚\nå½“ç„¶ä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœè¿›å…¥EdenåŒºçš„æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œåœ¨è§¦å‘YoungGCçš„æ—¶å€™ï¼Œä¼šç›´æ¥å­˜æ”¾åˆ°è€å¹´ä»£\nå½“è€å¹´ä»£æ»¡äº†ä¹‹åï¼Œè§¦å‘FullGCã€‚FullGCåŒæ—¶å›æ”¶æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå½“å‰åªä¼šå­˜åœ¨ä¸€ä¸ªFullGCçš„çº¿ç¨‹è¿›è¡Œæ‰§è¡Œï¼Œå…¶ä»–çš„çº¿ç¨‹å…¨éƒ¨ä¼šè¢«æŒ‚èµ·ã€‚ æˆ‘ä»¬åœ¨ç¨‹åºä¸­è¦å°½é‡é¿å…FullGCçš„å‡ºç°ã€‚\né¢è¯•å®˜ï¼šè®²ä¸€ä¸‹æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼æ˜¯è¿™æ ·çš„ï¼Œç®€å•è¯´å°±æ˜¯\næ–°ç”Ÿä»£ä¸»è¦ç”¨æ¥å­˜æ”¾æ–°ç”Ÿçš„å¯¹è±¡ã€‚\nè€å¹´ä»£ä¸»è¦å­˜æ”¾åº”ç”¨ä¸­ç”Ÿå‘½å‘¨æœŸé•¿çš„å†…å­˜å¯¹è±¡ã€‚\næ°¸ä¹…ä»£æŒ‡çš„æ˜¯æ°¸ä¹…ä¿å­˜åŒºåŸŸã€‚ä¸»è¦å­˜æ”¾Classå’ŒMetaï¼ˆå…ƒæ•°æ®ï¼‰çš„ä¿¡æ¯ã€‚åœ¨Java8ä¸­ï¼Œæ°¸ä¹…ä»£å·²ç»è¢«ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªç§°ä¹‹ä¸ºâ€œå…ƒæ•°æ®åŒºâ€ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåŸŸã€‚å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜çš„é™åˆ¶ã€‚\né¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ\nå€™é€‰äºº:\nåœ¨jvmä¸­ï¼Œå®ç°äº†å¤šç§åƒåœ¾æ”¶é›†å™¨ï¼ŒåŒ…æ‹¬ï¼šä¸²è¡Œåƒåœ¾æ”¶é›†å™¨ã€å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨ï¼ˆJDK8é»˜è®¤ï¼‰ã€CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨ã€G1åƒåœ¾æ”¶é›†å™¨ï¼ˆJDK9é»˜è®¤ï¼‰\né¢è¯•å®˜ï¼šMinor GCã€Major GCã€Full GCæ˜¯ä»€ä¹ˆ\nå€™é€‰äºº:\nå—¯ï¼Œå…¶å®å®ƒä»¬æŒ‡çš„æ˜¯ä¸åŒä»£ä¹‹é—´çš„åƒåœ¾å›æ”¶\nMinor GC å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´çŸ­\nMajor GC è€å¹´ä»£åŒºåŸŸçš„åƒåœ¾å›æ”¶ï¼Œè€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘Minor GCã€‚Minor GCä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™ä¼šè§¦å‘Major GCï¼ŒMajor GCé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæš‚åœæ—¶é—´é•¿\nFull GC æ–°ç”Ÿä»£ + è€å¹´ä»£å®Œæ•´åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´é•¿ï¼Œåº”å°½åŠ›é¿å…\nå››ã€JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰ é¢è¯•å®˜ï¼šJVM è°ƒä¼˜çš„å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼ï¼Ÿ\nå€™é€‰äºº:\næˆ‘ä»¬å½“æ—¶çš„é¡¹ç›®æ˜¯springbooté¡¹ç›®ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œjava -jarä¸­åŠ å…¥å‚æ•°å°±è¡Œäº†\né¢è¯•å®˜ï¼šç”¨çš„ JVM è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œè¿™äº›å‚æ•°æ˜¯æ¯”è¾ƒå¤šçš„\næˆ‘è®°å¾—å½“æ—¶æˆ‘ä»¬è®¾ç½®è¿‡å †çš„å¤§å°ï¼Œåƒ-Xmså’Œ-Xmx\nè¿˜æœ‰å°±æ˜¯å¯ä»¥è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºçš„å¤§å°æ¯”ä¾‹\nè¿˜æœ‰å°±æ˜¯å¯ä»¥è®¾ç½®ä½¿ç”¨å“ªç§åƒåœ¾å›æ”¶å™¨ç­‰ç­‰ã€‚å…·ä½“çš„æŒ‡ä»¤è¿˜çœŸè®°ä¸å¤ªæ¸…æ¥šã€‚\né¢è¯•å®˜ï¼šå—¯ï¼Œå¥½çš„ï¼Œä½ ä»¬å¹³æ—¶è°ƒè¯• JVMéƒ½ç”¨äº†å“ªäº›å·¥å…·å‘¢ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨jdkè‡ªå¸¦çš„ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚\njps è¾“å‡ºJVMä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯\njstackæŸ¥çœ‹javaè¿›ç¨‹å†…çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ã€‚\njmap ç”¨äºç”Ÿæˆå †è½¬å­˜å¿«ç…§\njstatç”¨äºJVMç»Ÿè®¡ç›‘æµ‹å·¥å…·\nè¿˜æœ‰ä¸€äº›å¯è§†åŒ–å·¥å…·ï¼Œåƒjconsoleå’ŒVisualVMç­‰\né¢è¯•å®˜ï¼šå‡å¦‚é¡¹ç›®ä¸­äº§ç”Ÿäº†javaå†…å­˜æ³„éœ²ï¼Œä½ è¯´ä¸€ä¸‹ä½ çš„æ’æŸ¥æ€è·¯ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œè¿™ä¸ªæˆ‘åœ¨ä¹‹å‰é¡¹ç›®æ’æŸ¥è¿‡\nç¬¬ä¸€å‘¢å¯ä»¥é€šè¿‡jmapæŒ‡å®šæ‰“å°ä»–çš„å†…å­˜å¿«ç…§ dumpæ–‡ä»¶ï¼Œä¸è¿‡æœ‰çš„æƒ…å†µæ‰“å°ä¸äº†ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®vmå‚æ•°è®©ç¨‹åºè‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶\nç¬¬äºŒï¼Œå¯ä»¥é€šè¿‡å·¥å…·å»åˆ†æ dumpæ–‡ä»¶ï¼Œjdkè‡ªå¸¦çš„VisualVMå°±å¯ä»¥åˆ†æ\nç¬¬ä¸‰ï¼Œé€šè¿‡æŸ¥çœ‹å †ä¿¡æ¯çš„æƒ…å†µï¼Œå¯ä»¥å¤§æ¦‚å®šä½å†…å­˜æº¢å‡ºæ˜¯å“ªè¡Œä»£ç å‡ºäº†é—®é¢˜\nç¬¬å››ï¼Œæ‰¾åˆ°å¯¹åº”çš„ä»£ç ï¼Œé€šè¿‡é˜…è¯»ä¸Šä¸‹æ–‡çš„æƒ…å†µï¼Œè¿›è¡Œä¿®å¤å³å¯\né¢è¯•å®˜ï¼šå¥½çš„ï¼Œé‚£ç°åœ¨å†æ¥è¯´ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯è¯´æœåŠ¡å™¨CPUæŒç»­é£™é«˜ï¼Œä½ çš„æ’æŸ¥æ–¹æ¡ˆä¸æ€è·¯ï¼Ÿ\nå€™é€‰äºº:\nå—¯ï¼Œæˆ‘æ€è€ƒä¸€ä¸‹~~\nå¯ä»¥è¿™ä¹ˆåš~~\nç¬¬ä¸€å¯ä»¥ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹å ç”¨cpuçš„æƒ…å†µ\nç¬¬äºŒé€šè¿‡topå‘½ä»¤æŸ¥çœ‹åï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å“ªä¸€ä¸ªè¿›ç¨‹å ç”¨cpuè¾ƒé«˜ï¼Œè®°å½•è¿™ä¸ªè¿›ç¨‹id\nç¬¬ä¸‰å¯ä»¥ç”¨ ps å‘½ä»¤æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹é‡Œçš„çº¿ç¨‹ä¿¡æ¯ï¼Œæ‰¾å‡º CPU å ç”¨é«˜çš„çº¿ç¨‹ã€‚\né€šå¸¸æ—¥å¿—é‡Œæ˜¾ç¤ºçš„çº¿ç¨‹ ID æ˜¯åå…­è¿›åˆ¶çš„ï¼Œæ‰€ä»¥è¦æŠŠå‰é¢å¾—åˆ°çš„åè¿›åˆ¶çº¿ç¨‹ ID è½¬æ¢æˆåå…­è¿›åˆ¶ã€‚\nç¬¬å››ç”¨ jstack å‘½ä»¤æ‰“å°è¿›ç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œæ ¹æ®è½¬æ¢åçš„åå…­è¿›åˆ¶çº¿ç¨‹ ID æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œå°±å¯ä»¥è¿›ä¸€æ­¥å®šä½é—®é¢˜ä»£ç çš„è¡Œå·ã€‚\n","date":"2025-04-22T00:00:00Z","image":"https://nova-bryan.github.io/p/java%E9%9D%A2%E8%AF%95/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/java%E9%9D%A2%E8%AF%95/","title":"Javaé¢è¯•"},{"content":"è¯·æ±‚å“åº”-æ¦‚è¿° åœ¨ä¸Šä¸€æ¬¡çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¼€å‘äº†springbootwebçš„å…¥é—¨ç¨‹åºã€‚ åŸºäºSpringBootçš„æ–¹å¼å¼€å‘ä¸€ä¸ªwebåº”ç”¨ï¼Œæµè§ˆå™¨å‘èµ·è¯·æ±‚ /hello å ï¼Œç»™æµè§ˆå™¨è¿”å›å­—ç¬¦ä¸² â€œHello World ~â€ã€‚\nå…¶å®å‘¢ï¼Œæ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚äº†æˆ‘ä»¬çš„åç«¯webæœåŠ¡å™¨(ä¹Ÿå°±æ˜¯å†…ç½®çš„Tomcat)ã€‚è€Œæˆ‘ä»¬åœ¨å¼€å‘webç¨‹åºæ—¶å‘¢ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ§åˆ¶å™¨ç±»Controllerï¼Œè¯·æ±‚ä¼šè¢«éƒ¨ç½²åœ¨Tomcatä¸­çš„Controlleræ¥æ”¶ï¼Œç„¶åControllerå†ç»™æµè§ˆå™¨ä¸€ä¸ªå“åº”ï¼Œå“åº”ä¸€ä¸ªå­—ç¬¦ä¸² â€œHello Worldâ€ã€‚ è€Œåœ¨è¯·æ±‚å“åº”çš„è¿‡ç¨‹ä¸­æ˜¯éµå¾ªHTTPåè®®çš„ã€‚\nä½†æ˜¯å‘¢ï¼Œè¿™é‡Œè¦å‘Šè¯‰å¤§å®¶çš„æ—¶ï¼Œå…¶å®åœ¨Tomcatè¿™ç±»WebæœåŠ¡å™¨ä¸­ï¼Œæ˜¯ä¸è¯†åˆ«æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„Controllerçš„ã€‚ä½†æ˜¯æˆ‘ä»¬å‰é¢è®²åˆ°è¿‡Tomcatæ˜¯ä¸€ä¸ªServletå®¹å™¨ï¼Œæ˜¯æ”¯æŒSerlvetè§„èŒƒçš„ï¼Œæ‰€ä»¥å‘¢ï¼Œåœ¨tomcatä¸­æ˜¯å¯ä»¥è¯†åˆ« Servletç¨‹åºçš„ã€‚ é‚£æˆ‘ä»¬æ‰€ç¼–å†™çš„XxxController æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Œåˆä¸Servletä¹‹é—´æœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Ÿ\nå…¶å®å‘¢ï¼Œåœ¨SpringBootè¿›è¡Œwebç¨‹åºå¼€å‘æ—¶ï¼Œå®ƒå†…ç½®äº†ä¸€ä¸ªæ ¸å¿ƒçš„Servletç¨‹åº DispatcherServletï¼Œç§°ä¹‹ä¸º æ ¸å¿ƒæ§åˆ¶å™¨ã€‚ DispatcherServlet è´Ÿè´£æ¥æ”¶é¡µé¢å‘é€çš„è¯·æ±‚ï¼Œç„¶åæ ¹æ®æ‰§è¡Œçš„è§„åˆ™ï¼Œå°†è¯·æ±‚å†è½¬å‘ç»™åé¢çš„è¯·æ±‚å¤„ç†å™¨Controllerï¼Œè¯·æ±‚å¤„ç†å™¨å¤„ç†å®Œè¯·æ±‚ä¹‹åï¼Œæœ€ç»ˆå†ç”±DispatcherServletç»™æµè§ˆå™¨å“åº”æ•°æ®ã€‚\né‚£å°†æ¥æµè§ˆå™¨å‘é€è¯·æ±‚ï¼Œä¼šæºå¸¦è¯·æ±‚æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šè¯·æ±‚è¡Œã€è¯·æ±‚å¤´ï¼›è¯·æ±‚åˆ°è¾¾tomcatä¹‹åï¼Œtomcatä¼šè´Ÿè´£è§£æè¿™äº›è¯·æ±‚æ•°æ®ï¼Œç„¶åå‘¢å°†è§£æåçš„è¯·æ±‚æ•°æ®ä¼šä¼ é€’ç»™Servletç¨‹åºçš„HttpServletRequestå¯¹è±¡ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€ HttpServletRequest å¯¹è±¡å°±å¯ä»¥è·å–åˆ°è¯·æ±‚æ•°æ®ã€‚ è€ŒTomcatï¼Œè¿˜ç»™Servletç¨‹åºä¼ é€’äº†ä¸€ä¸ªå‚æ•° HttpServletResponseï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™æµè§ˆå™¨è®¾ç½®å“åº”æ•°æ® ã€‚\né‚£ä¸Šè¿°æ‰€æè¿°çš„è¿™ç§æµè§ˆå™¨/æœåŠ¡å™¨çš„æ¶æ„æ¨¡å¼å‘¢ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šBSæ¶æ„ã€‚\nâ€¢ BSæ¶æ„ï¼šBrowser/Serverï¼Œæµè§ˆå™¨/æœåŠ¡å™¨æ¶æ„æ¨¡å¼ã€‚å®¢æˆ·ç«¯åªéœ€è¦æµè§ˆå™¨ï¼Œåº”ç”¨ç¨‹åºçš„é€»è¾‘å’Œæ•°æ®éƒ½å­˜å‚¨åœ¨æœåŠ¡ç«¯ã€‚\né‚£ä»Šå¤©å‘¢ï¼Œæˆ‘ä»¬çš„è¯¾ç¨‹å†…å®¹ä¸»è¦å°±å›´ç»•ç€ï¼šè¯·æ±‚ã€å“åº”è¿›è¡Œã€‚ ä»Šå¤©è¯¾ç¨‹å†…å®¹ï¼Œä¸»è¦åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š\nè¯·æ±‚ å“åº” åˆ†å±‚è§£è€¦ è¯·æ±‚å“åº”-è¯·æ±‚-postmanå·¥å…· Postmanæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘é¡µè°ƒè¯•ä¸å‘é€ç½‘é¡µHTTPè¯·æ±‚çš„Chromeæ’ä»¶ã€‚\nPostmanåŸæ˜¯Chromeæµè§ˆå™¨çš„æ’ä»¶ï¼Œå¯ä»¥æ¨¡æ‹Ÿæµè§ˆå™¨å‘åç«¯æœåŠ¡å™¨å‘èµ·ä»»ä½•å½¢å¼(å¦‚:getã€post)çš„HTTPè¯·æ±‚\nä½¿ç”¨Postmanè¿˜å¯ä»¥åœ¨å‘èµ·è¯·æ±‚æ—¶ï¼Œæºå¸¦ä¸€äº›è¯·æ±‚å‚æ•°ã€è¯·æ±‚å¤´ç­‰ä¿¡æ¯\nä½œç”¨ï¼šå¸¸ç”¨äºè¿›è¡Œæ¥å£æµ‹è¯•\nç‰¹å¾\nç®€å• å®ç”¨ ç¾è§‚ å¤§æ–¹ å®‰è£…\nåŒå‡»èµ„æ–™ä¸­æä¾›çš„Postman-win64-8.3.1-Setup.exeå³å¯è‡ªåŠ¨å®‰è£…ã€‚\nå®‰è£…å®Œæˆä¹‹åï¼Œè¿›å…¥é¡µé¢ä¸­ä¼šæç¤ºæœ‰æ–°ç‰ˆæœ¬å¯ä»¥å‡çº§ï¼ˆæ— éœ€å‡çº§ï¼‰\nç•Œé¢ä»‹ç»:\nå¦‚æœæˆ‘ä»¬éœ€è¦å°†æµ‹è¯•çš„è¯·æ±‚ä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªpostmançš„è´¦å·ï¼Œç„¶åç™»å½•ä¹‹åæ‰å¯ä»¥ã€‚\nç™»å½•å®Œæˆä¹‹åï¼Œå¯ä»¥åˆ›å»ºå·¥ä½œç©ºé—´ï¼š\nåˆ›å»ºè¯·æ±‚ï¼š\nç‚¹å‡»\u0026quot;Save\u0026quot;ï¼Œä¿å­˜å½“å‰è¯·æ±‚\nè¯·æ±‚å“åº”-è¯·æ±‚-ç®€å•å‚æ•°\u0026amp;å®ä½“å‚æ•° ç®€å•å‚æ•°\nç®€å•å‚æ•°ï¼šåœ¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œå‘æœåŠ¡å™¨ä¼ é€’çš„æ˜¯ä¸€äº›æ™®é€šçš„è¯·æ±‚æ•°æ®ã€‚\né‚£ä¹ˆåœ¨åç«¯ç¨‹åºä¸­ï¼Œå¦‚ä½•æ¥æ”¶ä¼ é€’è¿‡æ¥çš„æ™®é€šå‚æ•°æ•°æ®å‘¢ï¼Ÿ\næˆ‘ä»¬åœ¨è¿™é‡Œè®²è§£ä¸¤ç§æ–¹å¼ï¼š\nåŸå§‹æ–¹å¼ SpringBootæ–¹å¼ åŸå§‹æ–¹å¼\nåœ¨åŸå§‹çš„Webç¨‹åºå½“ä¸­ï¼Œéœ€è¦é€šè¿‡Servletä¸­æä¾›çš„APIï¼šHttpServletRequestï¼ˆè¯·æ±‚å¯¹è±¡ï¼‰ï¼Œè·å–è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ã€‚æ¯”å¦‚è·å–è¯·æ±‚å‚æ•°ï¼š\nTomcatæ¥æ”¶åˆ°httpè¯·æ±‚æ—¶ï¼šæŠŠè¯·æ±‚çš„ç›¸å…³ä¿¡æ¯å°è£…åˆ°HttpServletRequestå¯¹è±¡ä¸­\nåœ¨Controllerä¸­ï¼Œæˆ‘ä»¬è¦æƒ³è·å–Requestå¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥åœ¨æ–¹æ³•çš„å½¢å‚ä¸­å£°æ˜ HttpServletRequest å¯¹è±¡ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡æ¥è·å–è¯·æ±‚ä¿¡æ¯ï¼š\n1 2 //æ ¹æ®æŒ‡å®šçš„å‚æ•°åè·å–è¯·æ±‚å‚æ•°çš„æ•°æ®å€¼ String request.getParameter(\u0026#34;å‚æ•°å\u0026#34;) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @RestController public class RequestController { //åŸå§‹æ–¹å¼ @RequestMapping(\u0026#34;/simpleParam\u0026#34;) public String simpleParam(HttpServletRequest request){ // http://localhost:8080/simpleParam?name=Tom\u0026amp;age=10 // è¯·æ±‚å‚æ•°ï¼š name=Tom\u0026amp;age=10 ï¼ˆæœ‰2ä¸ªè¯·æ±‚å‚æ•°ï¼‰ // ç¬¬1ä¸ªè¯·æ±‚å‚æ•°ï¼š name=Tom å‚æ•°å:nameï¼Œå‚æ•°å€¼:Tom // ç¬¬2ä¸ªè¯·æ±‚å‚æ•°ï¼š age=10 å‚æ•°å:age , å‚æ•°å€¼:10 String name = request.getParameter(\u0026#34;name\u0026#34;);//nameå°±æ˜¯è¯·æ±‚å‚æ•°å String ageStr = request.getParameter(\u0026#34;age\u0026#34;);//ageå°±æ˜¯è¯·æ±‚å‚æ•°å int age = Integer.parseInt(ageStr);//éœ€è¦æ‰‹åŠ¨è¿›è¡Œç±»å‹è½¬æ¢ System.out.println(name+\u0026#34; : \u0026#34;+age); return \u0026#34;OK\u0026#34;; } } ä»¥ä¸Šè¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä»…åšäº†è§£ã€‚ï¼ˆåœ¨ä»¥åçš„å¼€å‘ä¸­ä¸ä¼šä½¿ç”¨åˆ°ï¼‰\nSpringBootæ–¹å¼\nåœ¨Springbootçš„ç¯å¢ƒä¸­ï¼Œå¯¹åŸå§‹çš„APIè¿›è¡Œäº†å°è£…ï¼Œæ¥æ”¶å‚æ•°çš„å½¢å¼æ›´åŠ ç®€å•ã€‚ å¦‚æœæ˜¯ç®€å•å‚æ•°ï¼Œå‚æ•°åä¸å½¢å‚å˜é‡åç›¸åŒï¼Œå®šä¹‰åŒåçš„å½¢å‚å³å¯æ¥æ”¶å‚æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 @RestController public class RequestController { // http://localhost:8080/simpleParam?name=Tom\u0026amp;age=10 // ç¬¬1ä¸ªè¯·æ±‚å‚æ•°ï¼š name=Tom å‚æ•°å:nameï¼Œå‚æ•°å€¼:Tom // ç¬¬2ä¸ªè¯·æ±‚å‚æ•°ï¼š age=10 å‚æ•°å:age , å‚æ•°å€¼:10 //springbootæ–¹å¼ @RequestMapping(\u0026#34;/simpleParam\u0026#34;) public String simpleParam(String name , Integer age ){//å½¢å‚åå’Œè¯·æ±‚å‚æ•°åä¿æŒä¸€è‡´ System.out.println(name+\u0026#34; : \u0026#34;+age); return \u0026#34;OK\u0026#34;; } } postmanæµ‹è¯•( GET è¯·æ±‚)ï¼š\npostmanæµ‹è¯•( POSTè¯·æ±‚ )ï¼š\nç»“è®ºï¼šä¸è®ºæ˜¯GETè¯·æ±‚è¿˜æ˜¯POSTè¯·æ±‚ï¼Œå¯¹äºç®€å•å‚æ•°æ¥è®²ï¼Œåªè¦ä¿è¯==è¯·æ±‚å‚æ•°åå’ŒControlleræ–¹æ³•ä¸­çš„å½¢å‚åä¿æŒä¸€è‡´==ï¼Œå°±å¯ä»¥è·å–åˆ°è¯·æ±‚å‚æ•°ä¸­çš„æ•°æ®å€¼ã€‚\nå‚æ•°åä¸ä¸€è‡´\nå¦‚æœæ–¹æ³•å½¢å‚åç§°ä¸è¯·æ±‚å‚æ•°åç§°ä¸ä¸€è‡´ï¼Œcontrolleræ–¹æ³•ä¸­çš„å½¢å‚è¿˜èƒ½æ¥æ”¶åˆ°è¯·æ±‚å‚æ•°å€¼å—ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 @RestController public class RequestController { // http://localhost:8080/simpleParam?name=Tom\u0026amp;age=20 // è¯·æ±‚å‚æ•°åï¼šname //springbootæ–¹å¼ @RequestMapping(\u0026#34;/simpleParam\u0026#34;) public String simpleParam(String username , Integer age ){//è¯·æ±‚å‚æ•°åå’Œå½¢å‚åä¸ç›¸åŒ System.out.println(username+\u0026#34; : \u0026#34;+age); return \u0026#34;OK\u0026#34;; } } ç­”æ¡ˆï¼šè¿è¡Œæ²¡æœ‰æŠ¥é”™ã€‚ controlleræ–¹æ³•ä¸­çš„usernameå€¼ä¸ºï¼šnullï¼Œageå€¼ä¸º20\nç»“è®ºï¼šå¯¹äºç®€å•å‚æ•°æ¥è®²ï¼Œè¯·æ±‚å‚æ•°åå’Œcontrolleræ–¹æ³•ä¸­çš„å½¢å‚åä¸ä¸€è‡´æ—¶ï¼Œæ— æ³•æ¥æ”¶åˆ°è¯·æ±‚æ•°æ® é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¼€å‘ä¸­ï¼Œé‡åˆ°äº†è¿™ç§è¯·æ±‚å‚æ•°åå’Œcontrolleræ–¹æ³•ä¸­çš„å½¢å‚åä¸ç›¸åŒï¼Œæ€ä¹ˆåŠï¼Ÿ\nè§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ä½¿ç”¨Springæä¾›çš„@RequestParamæ³¨è§£å®Œæˆæ˜ å°„\nåœ¨æ–¹æ³•å½¢å‚å‰é¢åŠ ä¸Š @RequestParam ç„¶åé€šè¿‡valueå±æ€§æ‰§è¡Œè¯·æ±‚å‚æ•°åï¼Œä»è€Œå®Œæˆæ˜ å°„ã€‚ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 @RestController public class RequestController { // http://localhost:8080/simpleParam?name=Tom\u0026amp;age=20 // è¯·æ±‚å‚æ•°åï¼šname //springbootæ–¹å¼ @RequestMapping(\u0026#34;/simpleParam\u0026#34;) public String simpleParam(@RequestParam(\u0026#34;name\u0026#34;) String username , Integer age ){ System.out.println(username+\u0026#34; : \u0026#34;+age); return \u0026#34;OK\u0026#34;; } } æ³¨æ„äº‹é¡¹ï¼š\n@RequestParamä¸­çš„requiredå±æ€§é»˜è®¤ä¸ºtrueï¼ˆé»˜è®¤å€¼ä¹Ÿæ˜¯trueï¼‰ï¼Œä»£è¡¨è¯¥è¯·æ±‚å‚æ•°å¿…é¡»ä¼ é€’ï¼Œå¦‚æœä¸ä¼ é€’å°†æŠ¥é”™\nå¦‚æœè¯¥å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥å°†requiredå±æ€§è®¾ç½®ä¸ºfalse\n1 2 3 4 5 @RequestMapping(\u0026#34;/simpleParam\u0026#34;) public String simpleParam(@RequestParam(name = \u0026#34;name\u0026#34;, required = false) String username, Integer age){ System.out.println(username+ \u0026#34;:\u0026#34; + age); return \u0026#34;OK\u0026#34;; } å°ç»“\n\\1. åŸå§‹æ–¹å¼è·å–è¯·æ±‚å‚æ•°\nControlleræ–¹æ³•å½¢å‚ä¸­å£°æ˜HttpServletRequestå¯¹è±¡ è°ƒç”¨å¯¹è±¡çš„getParameter(å‚æ•°å) \\2. SpringBootä¸­æ¥å—ç®€å•å‚æ•°\nè¯·æ±‚å‚æ•°åä¸æ–¹æ³•å½¢å‚å˜é‡åç›¸åŒ ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ \\3. @RequestParamæ³¨è§£\næ–¹æ³•å½¢å‚åç§°ä¸è¯·æ±‚å‚æ•°åç§°ä¸åŒ¹é…ï¼Œé€šè¿‡è¯¥æ³¨è§£å®Œæˆæ˜ å°„ è¯¥æ³¨è§£çš„requiredå±æ€§é»˜è®¤æ˜¯trueï¼Œä»£è¡¨è¯·æ±‚å‚æ•°å¿…é¡»ä¼ é€’ å®ä½“å‚æ•°\nåœ¨ä½¿ç”¨ç®€å•å‚æ•°åšä¸ºæ•°æ®ä¼ é€’æ–¹å¼æ—¶ï¼Œå‰ç«¯ä¼ é€’äº†å¤šå°‘ä¸ªè¯·æ±‚å‚æ•°ï¼Œåç«¯controlleræ–¹æ³•ä¸­çš„å½¢å‚å°±è¦ä¹¦å†™å¤šå°‘ä¸ªã€‚å¦‚æœè¯·æ±‚å‚æ•°æ¯”è¾ƒå¤šï¼Œé€šè¿‡ä¸Šè¿°çš„æ–¹å¼ä¸€ä¸ªå‚æ•°ä¸€ä¸ªå‚æ•°çš„æ¥æ”¶ï¼Œä¼šæ¯”è¾ƒç¹çã€‚\næ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†è¯·æ±‚å‚æ•°å°è£…åˆ°ä¸€ä¸ªå®ä½“ç±»å¯¹è±¡ä¸­ã€‚ è¦æƒ³å®Œæˆæ•°æ®å°è£…ï¼Œéœ€è¦éµå®ˆå¦‚ä¸‹è§„åˆ™ï¼šè¯·æ±‚å‚æ•°åä¸å®ä½“ç±»çš„å±æ€§åç›¸åŒ\nç®€å•å®ä½“å¯¹è±¡\nå®šä¹‰POJOå®ä½“ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public class User { private String name; private Integer age; public String getName() { return name; } public void setName(String name) { this.name = name; } public Integer getAge() { return age; } public void setAge(Integer age) { this.age = age; } @Override public String toString() { return \u0026#34;User{\u0026#34; + \u0026#34;name=\u0026#39;\u0026#34; + name + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, age=\u0026#34; + age + \u0026#39;}\u0026#39;; } } Controlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //å®ä½“å‚æ•°ï¼šç®€å•å®ä½“å¯¹è±¡ @RequestMapping(\u0026#34;/simplePojo\u0026#34;) public String simplePojo(User user){ System.out.println(user); return \u0026#34;OK\u0026#34;; } } Postmanæµ‹è¯•ï¼š\nå‚æ•°åå’Œå®ä½“ç±»å±æ€§åä¸€è‡´æ—¶ å‚æ•°åå’Œå®ä½“ç±»å±æ€§åä¸ä¸€è‡´æ—¶ å¤æ‚å®ä½“å¯¹è±¡\nå¤æ‚å®ä½“å¯¹è±¡æŒ‡çš„æ˜¯ï¼Œåœ¨å®ä½“ç±»ä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ï¼Œä¹Ÿæ˜¯å®ä½“å¯¹è±¡ç±»å‹çš„ã€‚å¦‚ä¸‹ï¼š\nUserç±»ä¸­æœ‰ä¸€ä¸ªAddressç±»å‹çš„å±æ€§ï¼ˆAddressæ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼‰ å¤æ‚å®ä½“å¯¹è±¡çš„å°è£…ï¼Œéœ€è¦éµå®ˆå¦‚ä¸‹è§„åˆ™ï¼š\nè¯·æ±‚å‚æ•°åä¸å½¢å‚å¯¹è±¡å±æ€§åç›¸åŒï¼ŒæŒ‰ç…§å¯¹è±¡å±‚æ¬¡ç»“æ„å…³ç³»å³å¯æ¥æ”¶åµŒå¥—å®ä½“ç±»å±æ€§å‚æ•°ã€‚ å®šä¹‰POJOå®ä½“ç±»ï¼š\nAddresså®ä½“ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public class Address { private String province; private String city; public String getProvince() { return province; } public void setProvince(String province) { this.province = province; } public String getCity() { return city; } public void setCity(String city) { this.city = city; } @Override public String toString() { return \u0026#34;Address{\u0026#34; + \u0026#34;province=\u0026#39;\u0026#34; + province + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, city=\u0026#39;\u0026#34; + city + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#39;}\u0026#39;; } } Userå®ä½“ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 public class User { private String name; private Integer age; private Address address; //åœ°å€å¯¹è±¡ public String getName() { return name; } public void setName(String name) { this.name = name; } public Integer getAge() { return age; } public void setAge(Integer age) { this.age = age; } public Address getAddress() { return address; } public void setAddress(Address address) { this.address = address; } @Override public String toString() { return \u0026#34;User{\u0026#34; + \u0026#34;name=\u0026#39;\u0026#34; + name + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, age=\u0026#34; + age + \u0026#34;, address=\u0026#34; + address + \u0026#39;}\u0026#39;; } } Controlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //å®ä½“å‚æ•°ï¼šå¤æ‚å®ä½“å¯¹è±¡ @RequestMapping(\u0026#34;/complexPojo\u0026#34;) public String complexPojo(User user){ System.out.println(user); return \u0026#34;OK\u0026#34;; } } Postmanæµ‹è¯•ï¼š\nè¯·æ±‚å“åº”-è¯·æ±‚-æ•°ç»„é›†åˆå‚æ•° æ•°ç»„\næ•°ç»„å‚æ•°ï¼šè¯·æ±‚å‚æ•°åä¸å½¢å‚æ•°ç»„åç§°ç›¸åŒä¸”è¯·æ±‚å‚æ•°ä¸ºå¤šä¸ªï¼Œå®šä¹‰æ•°ç»„ç±»å‹å½¢å‚å³å¯æ¥æ”¶å‚æ•°\nControlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //æ•°ç»„é›†åˆå‚æ•° @RequestMapping(\u0026#34;/arrayParam\u0026#34;) public String arrayParam(String[] hobby){ System.out.println(Arrays.toString(hobby)); return \u0026#34;OK\u0026#34;; } } Postmanæµ‹è¯•ï¼š\nåœ¨å‰ç«¯è¯·æ±‚æ—¶ï¼Œæœ‰ä¸¤ç§ä¼ é€’å½¢å¼ï¼š\næ–¹å¼ä¸€ï¼š xxxxxxxxxx?hobby=game\u0026amp;hobby=java\næ–¹å¼äºŒï¼šxxxxxxxxxxxxx?hobby=game,java\né›†åˆ\né›†åˆå‚æ•°ï¼šè¯·æ±‚å‚æ•°åä¸å½¢å‚é›†åˆå¯¹è±¡åç›¸åŒä¸”è¯·æ±‚å‚æ•°ä¸ºå¤šä¸ªï¼Œ@RequestParam ç»‘å®šå‚æ•°å…³ç³»\né»˜è®¤æƒ…å†µä¸‹ï¼Œè¯·æ±‚ä¸­å‚æ•°åç›¸åŒçš„å¤šä¸ªå€¼ï¼Œæ˜¯å°è£…åˆ°æ•°ç»„ã€‚å¦‚æœè¦å°è£…åˆ°é›†åˆï¼Œè¦ä½¿ç”¨@RequestParamç»‘å®šå‚æ•°å…³ç³»\nControlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //æ•°ç»„é›†åˆå‚æ•° @RequestMapping(\u0026#34;/listParam\u0026#34;) public String listParam(@RequestParam List\u0026lt;String\u0026gt; hobby){ System.out.println(hobby); return \u0026#34;OK\u0026#34;; } } Postmanæµ‹è¯•ï¼š\næ–¹å¼ä¸€ï¼š xxxxxxxxxx?hobby=game\u0026amp;hobby=java\næ–¹å¼äºŒï¼šxxxxxxxxxxxxx?hobby=game,java\nè¯·æ±‚å“åº”-è¯·æ±‚-æ—¥æœŸå‚æ•°\u0026amp;jsonå‚æ•° æ—¥æœŸå‚æ•°\nä¸Šè¿°æ¼”ç¤ºçš„éƒ½æ˜¯ä¸€äº›æ™®é€šçš„å‚æ•°ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ä¸­ï¼Œå¯èƒ½ä¼šæ¶‰åŠåˆ°æ—¥æœŸç±»å‹æ•°æ®çš„å°è£…ã€‚æ¯”å¦‚ï¼Œå¦‚ä¸‹éœ€æ±‚ï¼š\nå› ä¸ºæ—¥æœŸçš„æ ¼å¼å¤šç§å¤šæ ·ï¼ˆå¦‚ï¼š2022-12-12 10:05:45 ã€2022/12/12 10:05:45ï¼‰ï¼Œé‚£ä¹ˆå¯¹äºæ—¥æœŸç±»å‹çš„å‚æ•°åœ¨è¿›è¡Œå°è£…çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡@DateTimeFormatæ³¨è§£ï¼Œä»¥åŠå…¶patternå±æ€§æ¥è®¾ç½®æ—¥æœŸçš„æ ¼å¼ã€‚\n@DateTimeFormatæ³¨è§£çš„patternå±æ€§ä¸­æŒ‡å®šäº†å“ªç§æ—¥æœŸæ ¼å¼ï¼Œå‰ç«¯çš„æ—¥æœŸå‚æ•°å°±å¿…é¡»æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼ä¼ é€’ã€‚ åç«¯controlleræ–¹æ³•ä¸­ï¼Œéœ€è¦ä½¿ç”¨Dateç±»å‹æˆ–LocalDateTimeç±»å‹ï¼Œæ¥å°è£…ä¼ é€’çš„å‚æ•°ã€‚ Controlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //æ—¥æœŸæ—¶é—´å‚æ•° @RequestMapping(\u0026#34;/dateParam\u0026#34;) public String dateParam(@DateTimeFormat(pattern = \u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;) LocalDateTime updateTime){ System.out.println(updateTime); return \u0026#34;OK\u0026#34;; } } Postmanæµ‹è¯•ï¼š\nJSONå‚æ•°\næˆ‘ä»¬å­¦ä¹ JSONæ ¼å¼å‚æ•°ï¼Œä¸»è¦ä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ç€æ‰‹ï¼š\nPostmanåœ¨å‘é€è¯·æ±‚æ—¶ï¼Œå¦‚ä½•ä¼ é€’jsonæ ¼å¼çš„è¯·æ±‚å‚æ•° åœ¨æœåŠ¡ç«¯çš„controlleræ–¹æ³•ä¸­ï¼Œå¦‚ä½•æ¥æ”¶jsonæ ¼å¼çš„è¯·æ±‚å‚æ•° Postmanå‘é€JSONæ ¼å¼æ•°æ®ï¼š\næœåŠ¡ç«¯Controlleræ–¹æ³•æ¥æ”¶JSONæ ¼å¼æ•°æ®ï¼š\nä¼ é€’jsonæ ¼å¼çš„å‚æ•°ï¼Œåœ¨Controllerä¸­ä¼šä½¿ç”¨å®ä½“ç±»è¿›è¡Œå°è£…ã€‚ å°è£…è§„åˆ™ï¼šJSONæ•°æ®é”®åä¸å½¢å‚å¯¹è±¡å±æ€§åç›¸åŒï¼Œå®šä¹‰POJOç±»å‹å½¢å‚å³å¯æ¥æ”¶å‚æ•°ã€‚éœ€è¦ä½¿ç”¨ @RequestBodyæ ‡è¯†ã€‚ @RequestBodyæ³¨è§£ï¼šå°†JSONæ•°æ®æ˜ å°„åˆ°å½¢å‚çš„å®ä½“ç±»å¯¹è±¡ä¸­ï¼ˆJSONä¸­çš„keyå’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¿æŒä¸€è‡´ï¼‰ å®ä½“ç±»ï¼šAddress\n1 2 3 4 5 6 public class Address { private String province; private String city; //çœç•¥GET , SET æ–¹æ³• } å®ä½“ç±»ï¼šUser\n1 2 3 4 5 6 7 public class User { private String name; private Integer age; private Address address; //çœç•¥GET , SET æ–¹æ³• } Controlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //JSONå‚æ•° @RequestMapping(\u0026#34;/jsonParam\u0026#34;) public String jsonParam(@RequestBody User user){ System.out.println(user); return \u0026#34;OK\u0026#34;; } } Postmanæµ‹è¯•ï¼š\nè¯·æ±‚å“åº”-è¯·æ±‚-è·¯å¾„å‚æ•° åœ¨ç°åœ¨çš„å¼€å‘ä¸­ï¼Œç»å¸¸è¿˜ä¼šç›´æ¥åœ¨è¯·æ±‚çš„URLä¸­ä¼ é€’å‚æ•°ã€‚ä¾‹å¦‚ï¼š\n1 2 http://localhost:8080/user/1 http://localhost:880/user/1/0 ä¸Šè¿°çš„è¿™ç§ä¼ é€’è¯·æ±‚å‚æ•°çš„å½¢å¼å‘¢ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šè·¯å¾„å‚æ•°ã€‚\nå­¦ä¹ è·¯å¾„å‚æ•°å‘¢ï¼Œä¸»è¦æŒæ¡åœ¨åç«¯çš„controlleræ–¹æ³•ä¸­ï¼Œå¦‚ä½•æ¥æ”¶è·¯å¾„å‚æ•°ã€‚\nè·¯å¾„å‚æ•°ï¼š\nå‰ç«¯ï¼šé€šè¿‡è¯·æ±‚URLç›´æ¥ä¼ é€’å‚æ•°ï¼Œ åç«¯ï¼šä½¿ç”¨{\u0026hellip;}æ¥æ ‡è¯†è¯¥è·¯å¾„å‚æ•°ï¼Œéœ€è¦ä½¿ç”¨@PathVariableè·å–è·¯å¾„å‚æ•° Controlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //è·¯å¾„å‚æ•° @RequestMapping(\u0026#34;/path/{id}\u0026#34;) public String pathParam(@PathVariable Integer id){ System.out.println(id); return \u0026#34;OK\u0026#34;; } } Postmanæµ‹è¯•ï¼š\nä¼ é€’å¤šä¸ªè·¯å¾„å‚æ•°ï¼š\nPostmanï¼š\nControlleræ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 @RestController public class RequestController { //è·¯å¾„å‚æ•° @RequestMapping(\u0026#34;/path/{id}/{name}\u0026#34;) public String pathParam2(@PathVariable Integer id, @PathVariable String name){ System.out.println(id+ \u0026#34; : \u0026#34; +name); return \u0026#34;OK\u0026#34;; } } æ€»ç»“\nè¯·æ±‚å“åº”-å“åº”-@ResponseBody\u0026amp;ç»Ÿä¸€å“åº”ç»“æœ å“åº”\nå‰é¢æˆ‘ä»¬å­¦ä¹ è¿‡HTTLåè®®çš„äº¤äº’æ–¹å¼ï¼šè¯·æ±‚å“åº”æ¨¡å¼ï¼ˆæœ‰è¯·æ±‚å°±æœ‰å“åº”ï¼‰\né‚£ä¹ˆControllerç¨‹åºå‘¢ï¼Œé™¤äº†æ¥æ”¶è¯·æ±‚å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡Œå“åº”ã€‚\n@ResponseBody\nåœ¨æˆ‘ä»¬å‰é¢æ‰€ç¼–å†™çš„controlleræ–¹æ³•ä¸­ï¼Œéƒ½å·²ç»è®¾ç½®äº†å“åº”æ•°æ®ã€‚\ncontrolleræ–¹æ³•ä¸­çš„returnçš„ç»“æœï¼Œæ€ä¹ˆå°±å¯ä»¥å“åº”ç»™æµè§ˆå™¨å‘¢ï¼Ÿ\nç­”æ¡ˆï¼šä½¿ç”¨@ResponseBodyæ³¨è§£\n@ResponseBodyæ³¨è§£ï¼š\nç±»å‹ï¼šæ–¹æ³•æ³¨è§£ã€ç±»æ³¨è§£ ä½ç½®ï¼šä¹¦å†™åœ¨Controlleræ–¹æ³•ä¸Šæˆ–ç±»ä¸Š ä½œç”¨ï¼šå°†æ–¹æ³•è¿”å›å€¼ç›´æ¥å“åº”ç»™æµè§ˆå™¨ å¦‚æœè¿”å›å€¼ç±»å‹æ˜¯å®ä½“å¯¹è±¡/é›†åˆï¼Œå°†ä¼šè½¬æ¢ä¸ºJSONæ ¼å¼ååœ¨å“åº”ç»™æµè§ˆå™¨ ä½†æ˜¯åœ¨æˆ‘ä»¬æ‰€ä¹¦å†™çš„Controllerä¸­ï¼Œåªåœ¨ç±»ä¸Šæ·»åŠ äº†@RestControlleræ³¨è§£ã€æ–¹æ³•æ·»åŠ äº†@RequestMappingæ³¨è§£ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨@ResponseBodyæ³¨è§£ï¼Œæ€ä¹ˆç»™æµè§ˆå™¨å“åº”å‘¢ï¼Ÿ\n1 2 3 4 5 6 7 8 @RestController public class HelloController { @RequestMapping(\u0026#34;/hello\u0026#34;) public String hello(){ System.out.println(\u0026#34;Hello World ~\u0026#34;); return \u0026#34;Hello World ~\u0026#34;; } } åŸå› ï¼šåœ¨ç±»ä¸Šæ·»åŠ çš„@RestControlleræ³¨è§£ï¼Œæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ã€‚\n@RestController = @Controller + @ResponseBody @RestControlleræºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 @Target({ElementType.TYPE}) //å…ƒæ³¨è§£ï¼ˆä¿®é¥°æ³¨è§£çš„æ³¨è§£ï¼‰ @Retention(RetentionPolicy.RUNTIME) //å…ƒæ³¨è§£ @Documented //å…ƒæ³¨è§£ @Controller @ResponseBody public @interface RestController { @AliasFor( annotation = Controller.class ) String value() default \u0026#34;\u0026#34;; } ç»“è®ºï¼šåœ¨ç±»ä¸Šæ·»åŠ @RestControllerå°±ç›¸å½“äºæ·»åŠ äº†@ResponseBodyæ³¨è§£ã€‚\nç±»ä¸Šæœ‰@RestControlleræ³¨è§£æˆ–@ResponseBodyæ³¨è§£æ—¶ï¼šè¡¨ç¤ºå½“å‰ç±»ä¸‹æ‰€æœ‰çš„æ–¹æ³•è¿”å›å€¼åšä¸ºå“åº”æ•°æ® æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªPOJOå¯¹è±¡æˆ–é›†åˆæ—¶ï¼Œä¼šå…ˆè½¬æ¢ä¸ºJSONæ ¼å¼ï¼Œåœ¨å“åº”ç»™æµè§ˆå™¨ ä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹å“åº”æ•°æ®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 @RestController public class ResponseController { //å“åº”å­—ç¬¦ä¸² @RequestMapping(\u0026#34;/hello\u0026#34;) public String hello(){ System.out.println(\u0026#34;Hello World ~\u0026#34;); return \u0026#34;Hello World ~\u0026#34;; } //å“åº”å®ä½“å¯¹è±¡ @RequestMapping(\u0026#34;/getAddr\u0026#34;) public Address getAddr(){ Address addr = new Address();//åˆ›å»ºå®ä½“ç±»å¯¹è±¡ addr.setProvince(\u0026#34;å¹¿ä¸œ\u0026#34;); addr.setCity(\u0026#34;æ·±åœ³\u0026#34;); return addr; } //å“åº”é›†åˆæ•°æ® @RequestMapping(\u0026#34;/listAddr\u0026#34;) public List\u0026lt;Address\u0026gt; listAddr(){ List\u0026lt;Address\u0026gt; list = new ArrayList\u0026lt;\u0026gt;();//é›†åˆå¯¹è±¡ Address addr = new Address(); addr.setProvince(\u0026#34;å¹¿ä¸œ\u0026#34;); addr.setCity(\u0026#34;æ·±åœ³\u0026#34;); Address addr2 = new Address(); addr2.setProvince(\u0026#34;é™•è¥¿\u0026#34;); addr2.setCity(\u0026#34;è¥¿å®‰\u0026#34;); list.add(addr); list.add(addr2); return list; } } åœ¨æœåŠ¡ç«¯å“åº”äº†ä¸€ä¸ªå¯¹è±¡æˆ–è€…é›†åˆï¼Œé‚£ç§å‰ç«¯è·å–åˆ°çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨postmanå‘é€è¯·æ±‚æ¥æµ‹è¯•ä¸‹ã€‚æµ‹è¯•æ•ˆæœå¦‚ä¸‹ï¼š\nç»Ÿä¸€å“åº”ç»“æœ\nå¤§å®¶æœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å‰é¢æ‰€ç¼–å†™çš„è¿™äº›Controlleræ–¹æ³•ä¸­ï¼Œè¿”å›å€¼å„ç§å„æ ·ï¼Œæ²¡æœ‰ä»»ä½•çš„è§„èŒƒã€‚\nå¦‚æœæˆ‘ä»¬å¼€å‘ä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œé¡¹ç›®ä¸­controlleræ–¹æ³•å°†æˆåƒä¸Šä¸‡ï¼Œä½¿ç”¨ä¸Šè¿°æ–¹å¼å°†é€ æˆæ•´ä¸ªé¡¹ç›®éš¾ä»¥ç»´æŠ¤ã€‚é‚£åœ¨çœŸå®çš„é¡¹ç›®å¼€å‘ä¸­æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ\nåœ¨çœŸå®çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæ— è®ºæ˜¯å“ªç§æ–¹æ³•ï¼Œæˆ‘ä»¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„è¿”å›ç»“æœã€‚æ–¹æ¡ˆå¦‚ä¸‹ï¼š\nå‰ç«¯ï¼šåªéœ€è¦æŒ‰ç…§ç»Ÿä¸€æ ¼å¼çš„è¿”å›ç»“æœè¿›è¡Œè§£æ(ä»…ä¸€ç§è§£ææ–¹æ¡ˆ)ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ•°æ®ã€‚\nç»Ÿä¸€çš„è¿”å›ç»“æœä½¿ç”¨ç±»æ¥æè¿°ï¼Œåœ¨è¿™ä¸ªç»“æœä¸­åŒ…å«ï¼š\nå“åº”çŠ¶æ€ç ï¼šå½“å‰è¯·æ±‚æ˜¯æˆåŠŸï¼Œè¿˜æ˜¯å¤±è´¥ çŠ¶æ€ç ä¿¡æ¯ï¼šç»™é¡µé¢çš„æç¤ºä¿¡æ¯ è¿”å›çš„æ•°æ®ï¼šç»™å‰ç«¯å“åº”çš„æ•°æ®ï¼ˆå­—ç¬¦ä¸²ã€å¯¹è±¡ã€é›†åˆï¼‰ å®šä¹‰åœ¨ä¸€ä¸ªå®ä½“ç±»Resultæ¥åŒ…å«ä»¥ä¸Šä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 public class Result { private Integer code;//å“åº”ç ï¼Œ1 ä»£è¡¨æˆåŠŸ; 0 ä»£è¡¨å¤±è´¥ private String msg; //å“åº”ç  æè¿°å­—ç¬¦ä¸² private Object data; //è¿”å›çš„æ•°æ® public Result() { } public Result(Integer code, String msg, Object data) { this.code = code; this.msg = msg; this.data = data; } public Integer getCode() { return code; } public void setCode(Integer code) { this.code = code; } public String getMsg() { return msg; } public void setMsg(String msg) { this.msg = msg; } public Object getData() { return data; } public void setData(Object data) { this.data = data; } //å¢åˆ æ”¹ æˆåŠŸå“åº”(ä¸éœ€è¦ç»™å‰ç«¯è¿”å›æ•°æ®) public static Result success(){ return new Result(1,\u0026#34;success\u0026#34;,null); } //æŸ¥è¯¢ æˆåŠŸå“åº”(æŠŠæŸ¥è¯¢ç»“æœåšä¸ºè¿”å›æ•°æ®å“åº”ç»™å‰ç«¯) public static Result success(Object data){ return new Result(1,\u0026#34;success\u0026#34;,data); } //å¤±è´¥å“åº” public static Result error(String msg){ return new Result(0,msg,null); } } æ”¹é€ Controllerï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @RestController public class ResponseController { //å“åº”ç»Ÿä¸€æ ¼å¼çš„ç»“æœ @RequestMapping(\u0026#34;/hello\u0026#34;) public Result hello(){ System.out.println(\u0026#34;Hello World ~\u0026#34;); //return new Result(1,\u0026#34;success\u0026#34;,\u0026#34;Hello World ~\u0026#34;); return Result.success(\u0026#34;Hello World ~\u0026#34;); } //å“åº”ç»Ÿä¸€æ ¼å¼çš„ç»“æœ @RequestMapping(\u0026#34;/getAddr\u0026#34;) public Result getAddr(){ Address addr = new Address(); addr.setProvince(\u0026#34;å¹¿ä¸œ\u0026#34;); addr.setCity(\u0026#34;æ·±åœ³\u0026#34;); return Result.success(addr); } //å“åº”ç»Ÿä¸€æ ¼å¼çš„ç»“æœ @RequestMapping(\u0026#34;/listAddr\u0026#34;) public Result listAddr(){ List\u0026lt;Address\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); Address addr = new Address(); addr.setProvince(\u0026#34;å¹¿ä¸œ\u0026#34;); addr.setCity(\u0026#34;æ·±åœ³\u0026#34;); Address addr2 = new Address(); addr2.setProvince(\u0026#34;é™•è¥¿\u0026#34;); addr2.setCity(\u0026#34;è¥¿å®‰\u0026#34;); list.add(addr); list.add(addr2); return Result.success(list); } } ä½¿ç”¨Postmanæµ‹è¯•ï¼š\nè¯·æ±‚å“åº”-å“åº”-æ¡ˆä¾‹ æ¡ˆä¾‹ è·å–å‘˜å·¥æ•°æ®ï¼Œè¿”å›ç»Ÿä¸€å“åº”ç»“æœï¼Œåœ¨é¡µé¢æ¸²æŸ“å±•ç¤º\nåŠ è½½å¹¶è§£æemp.xmlæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå®Œæˆæ•°æ®å¤„ç†ï¼Œå¹¶åœ¨é¡µé¢å±•ç¤ºã€‚ è·å–å‘˜å·¥æ•°æ®ï¼Œè¿”å›ç»Ÿä¸€å“åº”ç»“æœï¼Œåœ¨é¡µé¢æ¸²æŸ“å±•ç¤º æ­¥éª¤ è·å–å‘˜å·¥æ•°æ®ï¼Œè¿”å›ç»Ÿä¸€å“åº”ç»“æœï¼Œåœ¨é¡µé¢æ¸²æŸ“å±•ç¤º\nåœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥dom4jçš„ä¾èµ–ï¼Œç”¨äºè§£æXMLæ–‡ä»¶ å¼•å…¥èµ„æ–™ä¸­æä¾›çš„è§£æXMLçš„å·¥å…·ç±»XMLParserUtilsã€å¯¹åº”çš„å®ä½“ç±»Empã€XMLæ–‡ä»¶ emp.xml å¼•å…¥èµ„æ–™ä¸­æä¾›çš„é™æ€é¡µé¢æ–‡ä»¶ï¼Œæ”¾åœ¨resourcesä¸‹çš„staticç›®å½•ä¸‹ ç¼–å†™Controllerç¨‹åºï¼Œå¤„ç†è¯·æ±‚ï¼Œå“åº”æ•°æ® å®ç°æ­¥éª¤\n\\1. åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥dom4jçš„ä¾èµ–ï¼Œç”¨äºè§£æXMLæ–‡ä»¶\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.dom4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dom4j\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.1.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \\2. å¼•å…¥èµ„æ–™ä¸­æä¾›çš„ï¼šè§£æXMLçš„å·¥å…·ç±»XMLParserUtilsã€å®ä½“ç±»Empã€XMLæ–‡ä»¶emp.xml\n\\3. å¼•å…¥èµ„æ–™ä¸­æä¾›çš„é™æ€é¡µé¢æ–‡ä»¶ï¼Œæ”¾åœ¨resourcesä¸‹çš„staticç›®å½•ä¸‹\n\\4. åˆ›å»ºEmpControllerç±»ï¼Œç¼–å†™Controllerç¨‹åºï¼Œå¤„ç†è¯·æ±‚ï¼Œå“åº”æ•°æ®\nä»£ç å®ç°\nContrillerä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @RestController public class EmpController { @RequestMapping(\u0026#34;/listEmp\u0026#34;) public Result list(){ //1. åŠ è½½å¹¶è§£æemp.xml String file = this.getClass().getClassLoader().getResource(\u0026#34;emp.xml\u0026#34;).getFile(); //System.out.println(file); List\u0026lt;Emp\u0026gt; empList = XmlParserUtils.parse(file, Emp.class); //2. å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç† - gender, job empList.stream().forEach(emp -\u0026gt; { //å¤„ç† gender 1: ç”·, 2: å¥³ String gender = emp.getGender(); if(\u0026#34;1\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;ç”·\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;å¥³\u0026#34;); } //å¤„ç†job - 1: è®²å¸ˆ, 2: ç­ä¸»ä»» , 3: å°±ä¸šæŒ‡å¯¼ String job = emp.getJob(); if(\u0026#34;1\u0026#34;.equals(job)){ emp.setJob(\u0026#34;è®²å¸ˆ\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(job)){ emp.setJob(\u0026#34;ç­ä¸»ä»»\u0026#34;); }else if(\u0026#34;3\u0026#34;.equals(job)){ emp.setJob(\u0026#34;å°±ä¸šæŒ‡å¯¼\u0026#34;); } }); //3. å“åº”æ•°æ® return Result.success(empList); } } ç»Ÿä¸€è¿”å›ç»“æœå®ä½“ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 public class Result { private Integer code ;//1 æˆåŠŸ , 0 å¤±è´¥ private String msg; //æç¤ºä¿¡æ¯ private Object data; //æ•°æ® date public Result() { } public Result(Integer code, String msg, Object data) { this.code = code; this.msg = msg; this.data = data; } public Integer getCode() { return code; } public void setCode(Integer code) { this.code = code; } public String getMsg() { return msg; } public void setMsg(String msg) { this.msg = msg; } public Object getData() { return data; } public void setData(Object data) { this.data = data; } public static Result success(Object data){ return new Result(1, \u0026#34;success\u0026#34;, data); } public static Result success(){ return new Result(1, \u0026#34;success\u0026#34;, null); } public static Result error(String msg){ return new Result(0, msg, null); } } æµ‹è¯•\nä»£ç ç¼–å†™å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œå¼•å¯¼ç±»ï¼Œå¯åŠ¨æœåŠ¡è¿›è¡Œæµ‹è¯•äº†ã€‚\nä½¿ç”¨Postmanæµ‹è¯•ï¼š\næ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š http://localhost:8080/emp.html\né—®é¢˜åˆ†æ\nä¸Šè¿°æ¡ˆä¾‹çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬è™½ç„¶å·²ç»å®ç°ï¼Œä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ¡ˆä¾‹ä¸­ï¼šè§£æXMLæ•°æ®ï¼Œè·å–æ•°æ®çš„ä»£ç ï¼Œå¤„ç†æ•°æ®çš„é€»è¾‘çš„ä»£ç ï¼Œç»™é¡µé¢å“åº”çš„ä»£ç å…¨éƒ¨éƒ½å †ç§¯åœ¨ä¸€èµ·äº†ï¼Œå…¨éƒ¨éƒ½å†™åœ¨controlleræ–¹æ³•ä¸­äº†ã€‚\nå½“å‰ç¨‹åºçš„è¿™ä¸ªä¸šåŠ¡é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘å†ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°Controlleræ–¹æ³•çš„ä»£ç é‡å°±å¾ˆå¤§äº†ã€‚\nå½“æˆ‘ä»¬è¦ä¿®æ”¹æ“ä½œæ•°æ®éƒ¨åˆ†çš„ä»£ç ï¼Œéœ€è¦æ”¹åŠ¨Controller å½“æˆ‘ä»¬è¦å®Œå–„é€»è¾‘å¤„ç†éƒ¨åˆ†çš„ä»£ç ï¼Œéœ€è¦æ”¹åŠ¨Controller å½“æˆ‘ä»¬éœ€è¦ä¿®æ”¹æ•°æ®å“åº”çš„ä»£ç ï¼Œè¿˜æ˜¯éœ€è¦æ”¹åŠ¨Controller è¿™æ ·å‘¢ï¼Œå°±ä¼šé€ æˆæˆ‘ä»¬æ•´ä¸ªå·¥ç¨‹ä»£ç çš„å¤ç”¨æ€§æ¯”è¾ƒå·®ï¼Œè€Œä¸”ä»£ç éš¾ä»¥ç»´æŠ¤ã€‚ é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå…¶å®åœ¨ç°åœ¨çš„å¼€å‘ä¸­ï¼Œæœ‰éå¸¸æˆç†Ÿçš„è§£å†³æ€è·¯ï¼Œé‚£å°±æ˜¯åˆ†å±‚å¼€å‘ã€‚\nåˆ†å±‚è§£è€¦-ä¸‰å±‚æ¶æ„ ä¸‰å±‚æ¶æ„\nåœ¨æˆ‘ä»¬è¿›è¡Œç¨‹åºè®¾è®¡ä»¥åŠç¨‹åºå¼€å‘æ—¶ï¼Œå°½å¯èƒ½è®©æ¯ä¸€ä¸ªæ¥å£ã€ç±»ã€æ–¹æ³•çš„èŒè´£æ›´å•ä¸€äº›ï¼ˆå•ä¸€èŒè´£åŸåˆ™ï¼‰ã€‚\nå•ä¸€èŒè´£åŸåˆ™ï¼šä¸€ä¸ªç±»æˆ–ä¸€ä¸ªæ–¹æ³•ï¼Œå°±åªåšä¸€ä»¶äº‹æƒ…ï¼Œåªç®¡ä¸€å—åŠŸèƒ½ã€‚\nè¿™æ ·å°±å¯ä»¥è®©ç±»ã€æ¥å£ã€æ–¹æ³•çš„å¤æ‚åº¦æ›´ä½ï¼Œå¯è¯»æ€§æ›´å¼ºï¼Œæ‰©å±•æ€§æ›´å¥½ï¼Œä¹Ÿæ›´åˆ©ç”¨åæœŸçš„ç»´æŠ¤ã€‚\næˆ‘ä»¬ä¹‹å‰å¼€å‘çš„ç¨‹åºå‘¢ï¼Œå¹¶ä¸æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸‹ä¹‹å‰çš„ç¨‹åºï¼š\né‚£å…¶å®æˆ‘ä»¬ä¸Šè¿°æ¡ˆä¾‹çš„å¤„ç†é€»è¾‘å‘¢ï¼Œä»ç»„æˆä¸Šçœ‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š\næ•°æ®è®¿é—®ï¼šè´Ÿè´£ä¸šåŠ¡æ•°æ®çš„ç»´æŠ¤æ“ä½œï¼ŒåŒ…æ‹¬å¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ“ä½œã€‚ é€»è¾‘å¤„ç†ï¼šè´Ÿè´£ä¸šåŠ¡é€»è¾‘å¤„ç†çš„ä»£ç ã€‚ è¯·æ±‚å¤„ç†ã€å“åº”æ•°æ®ï¼šè´Ÿè´£ï¼Œæ¥æ”¶é¡µé¢çš„è¯·æ±‚ï¼Œç»™é¡µé¢å“åº”æ•°æ®ã€‚ æŒ‰ç…§ä¸Šè¿°çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®å¼€å‘ä¸­å‘¢ï¼Œå¯ä»¥å°†ä»£ç åˆ†ä¸ºä¸‰å±‚ï¼š\nControllerï¼šæ§åˆ¶å±‚ã€‚æ¥æ”¶å‰ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¹¶å“åº”æ•°æ®ã€‚ Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚ã€‚å¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚ Daoï¼šæ•°æ®è®¿é—®å±‚(Data Access Object)ï¼Œä¹Ÿç§°ä¸ºæŒä¹…å±‚ã€‚è´Ÿè´£æ•°æ®è®¿é—®æ“ä½œï¼ŒåŒ…æ‹¬æ•°æ®çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ã€‚ åŸºäºä¸‰å±‚æ¶æ„çš„ç¨‹åºæ‰§è¡Œæµç¨‹ï¼š\nå‰ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œç”±Controllerå±‚æ¥æ”¶ï¼ˆControllerå“åº”æ•°æ®ç»™å‰ç«¯ï¼‰ Controllerå±‚è°ƒç”¨Serviceå±‚æ¥è¿›è¡Œé€»è¾‘å¤„ç†ï¼ˆServiceå±‚å¤„ç†å®Œåï¼ŒæŠŠå¤„ç†ç»“æœè¿”å›ç»™Controllerå±‚ï¼‰ Serivceå±‚è°ƒç”¨Daoå±‚ï¼ˆé€»è¾‘å¤„ç†è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„ä¸€äº›æ•°æ®è¦ä»Daoå±‚è·å–ï¼‰ Daoå±‚æ“ä½œæ–‡ä»¶ä¸­çš„æ•°æ®ï¼ˆDaoæ‹¿åˆ°çš„æ•°æ®ä¼šè¿”å›ç»™Serviceå±‚ï¼‰ æ€è€ƒï¼šæŒ‰ç…§ä¸‰å±‚æ¶æ„çš„æ€æƒ³ï¼Œå¦‚ä½•è¦å¯¹ä¸šåŠ¡é€»è¾‘(Serviceå±‚)è¿›è¡Œå˜æ›´ï¼Œä¼šå½±å“åˆ°Controllerå±‚å’ŒDaoå±‚å—ï¼Ÿ\nç­”æ¡ˆï¼šä¸ä¼šå½±å“ã€‚ ï¼ˆç¨‹åºçš„æ‰©å±•æ€§ã€ç»´æŠ¤æ€§å˜å¾—æ›´å¥½äº†ï¼‰\nä»£ç æ‹†åˆ†\næˆ‘ä»¬ä½¿ç”¨ä¸‰å±‚æ¶æ„æ€æƒ³ï¼Œæ¥æ”¹é€ ä¸‹ä¹‹å‰çš„ç¨‹åºï¼š\næ§åˆ¶å±‚åŒ…åï¼šxxxx.controller ä¸šåŠ¡é€»è¾‘å±‚åŒ…åï¼šxxxx.service æ•°æ®è®¿é—®å±‚åŒ…åï¼šxxxx.dao **æ§åˆ¶å±‚ï¼š**æ¥æ”¶å‰ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¹¶å“åº”æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @RestController public class EmpController { //ä¸šåŠ¡å±‚å¯¹è±¡ private EmpService empService = new EmpServiceA(); @RequestMapping(\u0026#34;/listEmp\u0026#34;) public Result list(){ //1. è°ƒç”¨serviceå±‚, è·å–æ•°æ® List\u0026lt;Emp\u0026gt; empList = empService.listEmp(); //3. å“åº”æ•°æ® return Result.success(empList); } } **ä¸šåŠ¡é€»è¾‘å±‚ï¼š**å¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘\nä¸šåŠ¡æ¥å£ 1 2 3 4 5 //ä¸šåŠ¡é€»è¾‘æ¥å£ï¼ˆåˆ¶å®šä¸šåŠ¡æ ‡å‡†ï¼‰ public interface EmpService { //è·å–å‘˜å·¥åˆ—è¡¨ public List\u0026lt;Emp\u0026gt; listEmp(); } ä¸šåŠ¡å®ç°ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 //ä¸šåŠ¡é€»è¾‘å®ç°ç±»ï¼ˆæŒ‰ç…§ä¸šåŠ¡æ ‡å‡†å®ç°ï¼‰ public class EmpServiceA implements EmpService { //daoå±‚å¯¹è±¡ private EmpDao empDao = new EmpDaoA(); @Override public List\u0026lt;Emp\u0026gt; listEmp() { //1. è°ƒç”¨dao, è·å–æ•°æ® List\u0026lt;Emp\u0026gt; empList = empDao.listEmp(); //2. å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç† - gender, job empList.stream().forEach(emp -\u0026gt; { //å¤„ç† gender 1: ç”·, 2: å¥³ String gender = emp.getGender(); if(\u0026#34;1\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;ç”·\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;å¥³\u0026#34;); } //å¤„ç†job - 1: è®²å¸ˆ, 2: ç­ä¸»ä»» , 3: å°±ä¸šæŒ‡å¯¼ String job = emp.getJob(); if(\u0026#34;1\u0026#34;.equals(job)){ emp.setJob(\u0026#34;è®²å¸ˆ\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(job)){ emp.setJob(\u0026#34;ç­ä¸»ä»»\u0026#34;); }else if(\u0026#34;3\u0026#34;.equals(job)){ emp.setJob(\u0026#34;å°±ä¸šæŒ‡å¯¼\u0026#34;); } }); return empList; } } **æ•°æ®è®¿é—®å±‚ï¼š**è´Ÿè´£æ•°æ®çš„è®¿é—®æ“ä½œï¼ŒåŒ…å«æ•°æ®çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥\næ•°æ®è®¿é—®æ¥å£ 1 2 3 4 5 //æ•°æ®è®¿é—®å±‚æ¥å£ï¼ˆåˆ¶å®šæ ‡å‡†ï¼‰ public interface EmpDao { //è·å–å‘˜å·¥åˆ—è¡¨æ•°æ® public List\u0026lt;Emp\u0026gt; listEmp(); } æ•°æ®è®¿é—®å®ç°ç±» 1 2 3 4 5 6 7 8 9 10 11 //æ•°æ®è®¿é—®å®ç°ç±» public class EmpDaoA implements EmpDao { @Override public List\u0026lt;Emp\u0026gt; listEmp() { //1. åŠ è½½å¹¶è§£æemp.xml String file = this.getClass().getClassLoader().getResource(\u0026#34;emp.xml\u0026#34;).getFile(); System.out.println(file); List\u0026lt;Emp\u0026gt; empList = XmlParserUtils.parse(file, Emp.class); return empList; } } ä¸‰å±‚æ¶æ„çš„å¥½å¤„ï¼š\nå¤ç”¨æ€§å¼º ä¾¿äºç»´æŠ¤ åˆ©ç”¨æ‰©å±• åˆ†å±‚è§£è€¦=åˆ†å±‚è§£è€¦ï¼ˆIOC-DIå¼•å…¥ï¼‰ åˆ†å±‚è§£è€¦\nå†…èšï¼šè½¯ä»¶ä¸­å„ä¸ªåŠŸèƒ½æ¨¡å—å†…éƒ¨çš„åŠŸèƒ½è”ç³»ã€‚ è€¦åˆï¼šè¡¡é‡è½¯ä»¶ä¸­å„ä¸ªå±‚/æ¨¡å—ä¹‹é—´çš„ä¾èµ–ã€å…³è”çš„ç¨‹åº¦ã€‚ è½¯ä»¶è®¾è®¡åŸåˆ™ï¼šé«˜å†…èšä½è€¦åˆã€‚\né«˜å†…èšæŒ‡çš„æ˜¯ï¼šä¸€ä¸ªæ¨¡å—ä¸­å„ä¸ªå…ƒç´ ä¹‹é—´çš„è”ç³»çš„ç´§å¯†ç¨‹åº¦ï¼Œå¦‚æœå„ä¸ªå…ƒç´ (è¯­å¥ã€ç¨‹åºæ®µ)ä¹‹é—´çš„è”ç³»ç¨‹åº¦è¶Šé«˜ï¼Œåˆ™å†…èšæ€§è¶Šé«˜ï¼Œå³ \u0026ldquo;é«˜å†…èš\u0026rdquo;ã€‚\nä½è€¦åˆæŒ‡çš„æ˜¯ï¼šè½¯ä»¶ä¸­å„ä¸ªå±‚ã€æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³è”ç¨‹åºè¶Šä½è¶Šå¥½ã€‚\nç¨‹åºä¸­é«˜å†…èšçš„ä½“ç°ï¼š\nEmpServiceAç±»ä¸­åªç¼–å†™äº†å’Œå‘˜å·¥ç›¸å…³çš„é€»è¾‘å¤„ç†ä»£ç  ç¨‹åºä¸­è€¦åˆä»£ç çš„ä½“ç°ï¼š\næŠŠä¸šåŠ¡ç±»å˜ä¸ºEmpServiceBæ—¶ï¼Œéœ€è¦ä¿®æ”¹controllerå±‚ä¸­çš„ä»£ç  é«˜å†…èšã€ä½è€¦åˆçš„ç›®çš„æ˜¯ä½¿ç¨‹åºæ¨¡å—çš„å¯é‡ç”¨æ€§ã€ç§»æ¤æ€§å¤§å¤§å¢å¼ºã€‚\nè§£è€¦æ€è·¯\nä¹‹å‰æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œéœ€è¦ä»€ä¹ˆå¯¹è±¡ï¼Œå°±ç›´æ¥newä¸€ä¸ªå°±å¯ä»¥äº†ã€‚ è¿™ç§åšæ³•å‘¢ï¼Œå±‚ä¸å±‚ä¹‹é—´ä»£ç å°±è€¦åˆäº†ï¼Œå½“serviceå±‚çš„å®ç°å˜äº†ä¹‹åï¼Œ æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹controllerå±‚çš„ä»£ç ã€‚\né‚£åº”è¯¥æ€ä¹ˆè§£è€¦å‘¢ï¼Ÿ\né¦–å…ˆä¸èƒ½åœ¨EmpControllerä¸­ä½¿ç”¨newå¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š æ­¤æ—¶ï¼Œå°±å­˜åœ¨å¦ä¸€ä¸ªé—®é¢˜äº†ï¼Œä¸èƒ½newï¼Œå°±æ„å‘³ç€æ²¡æœ‰ä¸šåŠ¡å±‚å¯¹è±¡ï¼ˆç¨‹åºè¿è¡Œå°±æŠ¥é”™ï¼‰ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ æˆ‘ä»¬çš„è§£å†³æ€è·¯æ˜¯ï¼š æä¾›ä¸€ä¸ªå®¹å™¨ï¼Œå®¹å™¨ä¸­å­˜å‚¨ä¸€äº›å¯¹è±¡(ä¾‹ï¼šEmpServiceå¯¹è±¡) controllerç¨‹åºä»å®¹å™¨ä¸­è·å–EmpServiceç±»å‹çš„å¯¹è±¡ æˆ‘ä»¬æƒ³è¦å®ç°ä¸Šè¿°è§£è€¦æ“ä½œï¼Œå°±æ¶‰åŠåˆ°Springä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š\næ§åˆ¶åè½¬ï¼š Inversion Of Controlï¼Œç®€ç§°IOCã€‚å¯¹è±¡çš„åˆ›å»ºæ§åˆ¶æƒç”±ç¨‹åºè‡ªèº«è½¬ç§»åˆ°å¤–éƒ¨ï¼ˆå®¹å™¨ï¼‰ï¼Œè¿™ç§æ€æƒ³ç§°ä¸ºæ§åˆ¶åè½¬ã€‚\nå¯¹è±¡çš„åˆ›å»ºæƒç”±ç¨‹åºå‘˜ä¸»åŠ¨åˆ›å»ºè½¬ç§»åˆ°å®¹å™¨(ç”±å®¹å™¨åˆ›å»ºã€ç®¡ç†å¯¹è±¡)ã€‚è¿™ä¸ªå®¹å™¨ç§°ä¸ºï¼šIOCå®¹å™¨æˆ–Springå®¹å™¨\nä¾èµ–æ³¨å…¥ï¼š Dependency Injectionï¼Œç®€ç§°DIã€‚å®¹å™¨ä¸ºåº”ç”¨ç¨‹åºæä¾›è¿è¡Œæ—¶ï¼Œæ‰€ä¾èµ–çš„èµ„æºï¼Œç§°ä¹‹ä¸ºä¾èµ–æ³¨å…¥ã€‚\nç¨‹åºè¿è¡Œæ—¶éœ€è¦æŸä¸ªèµ„æºï¼Œæ­¤æ—¶å®¹å™¨å°±ä¸ºå…¶æä¾›è¿™ä¸ªèµ„æºã€‚\nä¾‹ï¼šEmpControllerç¨‹åºè¿è¡Œæ—¶éœ€è¦EmpServiceå¯¹è±¡ï¼ŒSpringå®¹å™¨å°±ä¸ºå…¶æä¾›å¹¶æ³¨å…¥EmpServiceå¯¹è±¡\nIOCå®¹å™¨ä¸­åˆ›å»ºã€ç®¡ç†çš„å¯¹è±¡ï¼Œç§°ä¹‹ä¸ºï¼šbeanå¯¹è±¡\nåˆ†å±‚è§£è€¦-IOC\u0026amp;DI-å…¥é—¨ IOC\u0026amp;DIå…¥é—¨\nä»»åŠ¡ï¼šå®ŒæˆControllerå±‚ã€Serviceå±‚ã€Daoå±‚çš„ä»£ç è§£è€¦\næ€è·¯ï¼š\nåˆ é™¤Controllerå±‚ã€Serviceå±‚ä¸­newå¯¹è±¡çš„ä»£ç \nServiceå±‚åŠDaoå±‚çš„å®ç°ç±»ï¼Œäº¤ç»™IOCå®¹å™¨ç®¡ç†\nä¸ºControlleråŠServiceæ³¨å…¥è¿è¡Œæ—¶ä¾èµ–çš„å¯¹è±¡\nControllerç¨‹åºä¸­æ³¨å…¥ä¾èµ–çš„Serviceå±‚å¯¹è±¡ Serviceç¨‹åºä¸­æ³¨å…¥ä¾èµ–çš„Daoå±‚å¯¹è±¡ ç¬¬1æ­¥ï¼šåˆ é™¤Controllerå±‚ã€Serviceå±‚ä¸­newå¯¹è±¡çš„ä»£ç \nç¬¬2æ­¥ï¼šServiceå±‚åŠDaoå±‚çš„å®ç°ç±»ï¼Œäº¤ç»™IOCå®¹å™¨ç®¡ç†\nä½¿ç”¨Springæä¾›çš„æ³¨è§£ï¼š@Component ï¼Œå°±å¯ä»¥å®ç°ç±»äº¤ç»™IOCå®¹å™¨ç®¡ç† ç¬¬3æ­¥ï¼šä¸ºControlleråŠServiceæ³¨å…¥è¿è¡Œæ—¶ä¾èµ–çš„å¯¹è±¡\nä½¿ç”¨Springæä¾›çš„æ³¨è§£ï¼š@Autowired ï¼Œå°±å¯ä»¥å®ç°ç¨‹åºè¿è¡Œæ—¶IOCå®¹å™¨è‡ªåŠ¨æ³¨å…¥éœ€è¦çš„ä¾èµ–å¯¹è±¡ å®Œæ•´çš„ä¸‰å±‚ä»£ç ï¼š\nControllerå±‚ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @RestController public class EmpController { @Autowired //è¿è¡Œæ—¶,ä»IOCå®¹å™¨ä¸­è·å–è¯¥ç±»å‹å¯¹è±¡,èµ‹å€¼ç»™è¯¥å˜é‡ private EmpService empService ; @RequestMapping(\u0026#34;/listEmp\u0026#34;) public Result list(){ //1. è°ƒç”¨service, è·å–æ•°æ® List\u0026lt;Emp\u0026gt; empList = empService.listEmp(); //3. å“åº”æ•°æ® return Result.success(empList); } } Serviceå±‚ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 @Component //å°†å½“å‰å¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†,æˆä¸ºIOCå®¹å™¨çš„bean public class EmpServiceA implements EmpService { @Autowired //è¿è¡Œæ—¶,ä»IOCå®¹å™¨ä¸­è·å–è¯¥ç±»å‹å¯¹è±¡,èµ‹å€¼ç»™è¯¥å˜é‡ private EmpDao empDao ; @Override public List\u0026lt;Emp\u0026gt; listEmp() { //1. è°ƒç”¨dao, è·å–æ•°æ® List\u0026lt;Emp\u0026gt; empList = empDao.listEmp(); //2. å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç† - gender, job empList.stream().forEach(emp -\u0026gt; { //å¤„ç† gender 1: ç”·, 2: å¥³ String gender = emp.getGender(); if(\u0026#34;1\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;ç”·\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;å¥³\u0026#34;); } //å¤„ç†job - 1: è®²å¸ˆ, 2: ç­ä¸»ä»» , 3: å°±ä¸šæŒ‡å¯¼ String job = emp.getJob(); if(\u0026#34;1\u0026#34;.equals(job)){ emp.setJob(\u0026#34;è®²å¸ˆ\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(job)){ emp.setJob(\u0026#34;ç­ä¸»ä»»\u0026#34;); }else if(\u0026#34;3\u0026#34;.equals(job)){ emp.setJob(\u0026#34;å°±ä¸šæŒ‡å¯¼\u0026#34;); } }); return empList; } } Daoå±‚ï¼š 1 2 3 4 5 6 7 8 9 10 11 @Component //å°†å½“å‰å¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†,æˆä¸ºIOCå®¹å™¨çš„bean public class EmpDaoA implements EmpDao { @Override public List\u0026lt;Emp\u0026gt; listEmp() { //1. åŠ è½½å¹¶è§£æemp.xml String file = this.getClass().getClassLoader().getResource(\u0026#34;emp.xml\u0026#34;).getFile(); System.out.println(file); List\u0026lt;Emp\u0026gt; empList = XmlParserUtils.parse(file, Emp.class); return empList; } } è¿è¡Œæµ‹è¯•ï¼š\nå¯åŠ¨SpringBootå¼•å¯¼ç±»ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ï¼šhttp://localhost:8080/emp.html åˆ†å±‚è§£è€¦-IOC\u0026amp;DI-IOCè¯¦è§£ beançš„å£°æ˜\nå‰é¢æˆ‘ä»¬æåˆ°IOCæ§åˆ¶åè½¬ï¼Œå°±æ˜¯å°†å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™Springçš„IOCå®¹å™¨ï¼Œç”±IOCå®¹å™¨åˆ›å»ºåŠç®¡ç†å¯¹è±¡ã€‚IOCå®¹å™¨åˆ›å»ºçš„å¯¹è±¡ç§°ä¸ºbeanå¯¹è±¡ã€‚\nåœ¨ä¹‹å‰çš„å…¥é—¨æ¡ˆä¾‹ä¸­ï¼Œè¦æŠŠæŸä¸ªå¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼Œéœ€è¦åœ¨ç±»ä¸Šæ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼š@Component\nè€ŒSpringæ¡†æ¶ä¸ºäº†æ›´å¥½çš„æ ‡è¯†webåº”ç”¨ç¨‹åºå¼€å‘å½“ä¸­ï¼Œbeanå¯¹è±¡åˆ°åº•å½’å±äºå“ªä¸€å±‚ï¼Œåˆæä¾›äº†@Componentçš„è¡ç”Ÿæ³¨è§£ï¼š\n@Controller ï¼ˆæ ‡æ³¨åœ¨æ§åˆ¶å±‚ç±»ä¸Šï¼‰ @Service ï¼ˆæ ‡æ³¨åœ¨ä¸šåŠ¡å±‚ç±»ä¸Šï¼‰ @Repository ï¼ˆæ ‡æ³¨åœ¨æ•°æ®è®¿é—®å±‚ç±»ä¸Šï¼‰ ä¿®æ”¹å…¥é—¨æ¡ˆä¾‹ä»£ç ï¼š\n*Controllerå±‚ï¼š* 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @RestController //@RestController = @Controller + @ResponseBody public class EmpController { @Autowired //è¿è¡Œæ—¶,ä»IOCå®¹å™¨ä¸­è·å–è¯¥ç±»å‹å¯¹è±¡,èµ‹å€¼ç»™è¯¥å˜é‡ private EmpService empService ; @RequestMapping(\u0026#34;/listEmp\u0026#34;) public Result list(){ //1. è°ƒç”¨service, è·å–æ•°æ® List\u0026lt;Emp\u0026gt; empList = empService.listEmp(); //3. å“åº”æ•°æ® return Result.success(empList); } } Serviceå±‚ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 @Service public class EmpServiceA implements EmpService { @Autowired //è¿è¡Œæ—¶,ä»IOCå®¹å™¨ä¸­è·å–è¯¥ç±»å‹å¯¹è±¡,èµ‹å€¼ç»™è¯¥å˜é‡ private EmpDao empDao ; @Override public List\u0026lt;Emp\u0026gt; listEmp() { //1. è°ƒç”¨dao, è·å–æ•°æ® List\u0026lt;Emp\u0026gt; empList = empDao.listEmp(); //2. å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç† - gender, job empList.stream().forEach(emp -\u0026gt; { //å¤„ç† gender 1: ç”·, 2: å¥³ String gender = emp.getGender(); if(\u0026#34;1\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;ç”·\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(gender)){ emp.setGender(\u0026#34;å¥³\u0026#34;); } //å¤„ç†job - 1: è®²å¸ˆ, 2: ç­ä¸»ä»» , 3: å°±ä¸šæŒ‡å¯¼ String job = emp.getJob(); if(\u0026#34;1\u0026#34;.equals(job)){ emp.setJob(\u0026#34;è®²å¸ˆ\u0026#34;); }else if(\u0026#34;2\u0026#34;.equals(job)){ emp.setJob(\u0026#34;ç­ä¸»ä»»\u0026#34;); }else if(\u0026#34;3\u0026#34;.equals(job)){ emp.setJob(\u0026#34;å°±ä¸šæŒ‡å¯¼\u0026#34;); } }); return empList; } } Daoå±‚ï¼š 1 2 3 4 5 6 7 8 9 10 11 @Repository public class EmpDaoA implements EmpDao { @Override public List\u0026lt;Emp\u0026gt; listEmp() { //1. åŠ è½½å¹¶è§£æemp.xml String file = this.getClass().getClassLoader().getResource(\u0026#34;emp.xml\u0026#34;).getFile(); System.out.println(file); List\u0026lt;Emp\u0026gt; empList = XmlParserUtils.parse(file, Emp.class); return empList; } } è¦æŠŠæŸä¸ªå¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼Œéœ€è¦åœ¨å¯¹åº”çš„ç±»ä¸ŠåŠ ä¸Šå¦‚ä¸‹æ³¨è§£ä¹‹ä¸€ï¼š\næ³¨è§£ è¯´æ˜ ä½ç½® @Controller @Componentçš„è¡ç”Ÿæ³¨è§£ æ ‡æ³¨åœ¨æ§åˆ¶å™¨ç±»ä¸Š @Service @Componentçš„è¡ç”Ÿæ³¨è§£ æ ‡æ³¨åœ¨ä¸šåŠ¡ç±»ä¸Š @Repository @Componentçš„è¡ç”Ÿæ³¨è§£ æ ‡æ³¨åœ¨æ•°æ®è®¿é—®ç±»ä¸Šï¼ˆç”±äºä¸mybatisæ•´åˆï¼Œç”¨çš„å°‘ï¼‰ @Component å£°æ˜beançš„åŸºç¡€æ³¨è§£ ä¸å±äºä»¥ä¸Šä¸‰ç±»æ—¶ï¼Œç”¨æ­¤æ³¨è§£ æŸ¥çœ‹æºç \nåœ¨IOCå®¹å™¨ä¸­ï¼Œæ¯ä¸€ä¸ªBeanéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„åå­—ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£çš„valueå±æ€§æŒ‡å®šbeançš„åå­—ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚\næ³¨æ„äº‹é¡¹:\nå£°æ˜beançš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡valueå±æ€§æŒ‡å®šbeançš„åå­—ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚\nä½¿ç”¨ä»¥ä¸Šå››ä¸ªæ³¨è§£éƒ½å¯ä»¥å£°æ˜beanï¼Œä½†æ˜¯åœ¨springbooté›†æˆwebå¼€å‘ä¸­ï¼Œå£°æ˜æ§åˆ¶å™¨beanåªèƒ½ç”¨@Controllerã€‚\nç»„ä»¶æ‰«æ\né—®é¢˜ï¼šä½¿ç”¨å‰é¢å­¦ä¹ çš„å››ä¸ªæ³¨è§£å£°æ˜çš„beanï¼Œä¸€å®šä¼šç”Ÿæ•ˆå—ï¼Ÿ\nç­”æ¡ˆï¼šä¸ä¸€å®šã€‚ï¼ˆåŸå› ï¼šbeanæƒ³è¦ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦è¢«ç»„ä»¶æ‰«æï¼‰\nä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¿®æ”¹é¡¹ç›®å·¥ç¨‹çš„ç›®å½•ç»“æ„ï¼Œæ¥æµ‹è¯•beanå¯¹è±¡æ˜¯å¦ç”Ÿæ•ˆï¼š\nè¿è¡Œç¨‹åºåï¼ŒæŠ¥é”™ï¼š\nä¸ºä»€ä¹ˆæ²¡æœ‰æ‰¾åˆ°beanå¯¹è±¡å‘¢ï¼Ÿ\nä½¿ç”¨å››å¤§æ³¨è§£å£°æ˜çš„beanï¼Œè¦æƒ³ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦è¢«ç»„ä»¶æ‰«ææ³¨è§£@ComponentScanæ‰«æ è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨æ·»åŠ @ComponentScanæ³¨è§£ï¼ŒæŒ‡å®šè¦æ‰«æçš„åŒ… ï¼ˆ==ä»…åšäº†è§£ï¼Œä¸æ¨è==ï¼‰\næ¨èåšæ³•ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼š\nå°†æˆ‘ä»¬å®šä¹‰çš„controllerï¼Œserviceï¼Œdaoè¿™äº›åŒ…å‘¢ï¼Œéƒ½æ”¾åœ¨å¼•å¯¼ç±»æ‰€åœ¨åŒ…com.itheimaçš„å­åŒ…ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å®šä¹‰çš„beanå°±ä¼šè¢«è‡ªåŠ¨çš„æ‰«æåˆ° åˆ†****å±‚è§£è€¦-IOC\u0026amp;DI-DIè¯¦è§£ ä¾èµ–æ³¨å…¥ï¼Œæ˜¯æŒ‡IOCå®¹å™¨è¦ä¸ºåº”ç”¨ç¨‹åºå»æä¾›è¿è¡Œæ—¶æ‰€ä¾èµ–çš„èµ„æºï¼Œè€Œèµ„æºæŒ‡çš„å°±æ˜¯å¯¹è±¡ã€‚\nåœ¨å…¥é—¨ç¨‹åºæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†@Autowiredè¿™ä¸ªæ³¨è§£ï¼Œå®Œæˆäº†ä¾èµ–æ³¨å…¥çš„æ“ä½œï¼Œè€Œè¿™ä¸ªAutowiredç¿»è¯‘è¿‡æ¥å«ï¼šè‡ªåŠ¨è£…é…ã€‚\n@Autowiredæ³¨è§£ï¼Œé»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼ˆå»IOCå®¹å™¨ä¸­æ‰¾æŸä¸ªç±»å‹çš„å¯¹è±¡ï¼Œç„¶åå®Œæˆæ³¨å…¥æ“ä½œï¼‰\nå…¥é—¨ç¨‹åºä¸¾ä¾‹ï¼šåœ¨EmpControllerè¿è¡Œçš„æ—¶å€™ï¼Œå°±è¦åˆ°IOCå®¹å™¨å½“ä¸­å»æŸ¥æ‰¾EmpServiceè¿™ä¸ªç±»å‹çš„å¯¹è±¡ï¼Œè€Œæˆ‘ä»¬çš„IOCå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ªEmpServiceè¿™ä¸ªç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥å°±æ‰¾åˆ°äº†è¿™ä¸ªç±»å‹çš„å¯¹è±¡å®Œæˆæ³¨å…¥æ“ä½œã€‚\né‚£å¦‚æœåœ¨IOCå®¹å™¨ä¸­ï¼Œå­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„beanå¯¹è±¡ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ\nç¨‹åºè¿è¡Œä¼šæŠ¥é”™\nå¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜å‘¢ï¼ŸSpringæä¾›äº†ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š\n@Primary @Qualifier @Resource ä½¿ç”¨@Primaryæ³¨è§£ï¼šå½“å­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„Beanæ³¨å…¥æ—¶ï¼ŒåŠ ä¸Š@Primaryæ³¨è§£ï¼Œæ¥ç¡®å®šé»˜è®¤çš„å®ç°ã€‚\nä½¿ç”¨@Qualifieræ³¨è§£ï¼šæŒ‡å®šå½“å‰è¦æ³¨å…¥çš„beanå¯¹è±¡ã€‚ åœ¨@Qualifierçš„valueå±æ€§ä¸­ï¼ŒæŒ‡å®šæ³¨å…¥çš„beançš„åç§°ã€‚\n@Qualifieræ³¨è§£ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»é…åˆ@Autowiredä½¿ç”¨ ä½¿ç”¨@Resourceæ³¨è§£ï¼šæ˜¯æŒ‰ç…§beançš„åç§°è¿›è¡Œæ³¨å…¥ã€‚é€šè¿‡nameå±æ€§æŒ‡å®šè¦æ³¨å…¥çš„beançš„åç§°ã€‚\né¢è¯•é¢˜ ï¼š @Autowird ä¸ @Resourceçš„åŒºåˆ«\n@Autowired æ˜¯springæ¡†æ¶æä¾›çš„æ³¨è§£ï¼Œè€Œ@Resourceæ˜¯JDKæä¾›çš„æ³¨è§£\n@Autowired é»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹æ³¨å…¥ï¼Œè€Œ@Resourceæ˜¯æŒ‰ç…§åç§°æ³¨å…¥\n","date":"2025-04-13T16:01:23+08:00","image":"https://nova-bryan.github.io/p/%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%88%86%E5%B1%82%E8%A7%A3%E8%80%A6/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%88%86%E5%B1%82%E8%A7%A3%E8%80%A6/","title":"è¯·æ±‚å“åº”,åˆ†å±‚è§£è€¦"},{"content":"äº‹åŠ¡å›é¡¾ åœ¨æ•°æ®åº“é˜¶æ®µæˆ‘ä»¬å·²å­¦ä¹ è¿‡äº‹åŠ¡äº†ï¼Œæˆ‘ä»¬è®²åˆ°ï¼š\näº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚äº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä¸€èµ·å‘æ•°æ®åº“æäº¤æˆ–è€…æ˜¯æ’¤é”€æ“ä½œè¯·æ±‚ã€‚æ‰€ä»¥è¿™ç»„æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚\næ€ä¹ˆæ ·æ¥æ§åˆ¶è¿™ç»„æ“ä½œï¼Œè®©è¿™ç»„æ“ä½œåŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥å‘¢ï¼Ÿæ­¤æ—¶å°±è¦æ¶‰åŠåˆ°äº‹åŠ¡çš„å…·ä½“æ“ä½œäº†ã€‚\näº‹åŠ¡çš„æ“ä½œä¸»è¦æœ‰ä¸‰æ­¥ï¼š\nå¼€å¯äº‹åŠ¡ï¼ˆä¸€ç»„æ“ä½œå¼€å§‹å‰ï¼Œå¼€å¯äº‹åŠ¡ï¼‰ï¼šstart transaction / begin ; æäº¤äº‹åŠ¡ï¼ˆè¿™ç»„æ“ä½œå…¨éƒ¨æˆåŠŸåï¼Œæäº¤äº‹åŠ¡ï¼‰ï¼šcommit ; å›æ»šäº‹åŠ¡ï¼ˆä¸­é—´ä»»ä½•ä¸€ä¸ªæ“ä½œå‡ºç°å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡ï¼‰ï¼šrollback ; Springäº‹åŠ¡ç®¡ç†-æ¡ˆä¾‹ ç®€å•çš„å›é¡¾äº†äº‹åŠ¡çš„æ¦‚å¿µä»¥åŠäº‹åŠ¡çš„åŸºæœ¬æ“ä½œä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸ªäº‹åŠ¡ç®¡ç†æ¡ˆä¾‹ï¼šè§£æ•£éƒ¨é—¨ ï¼ˆè§£æ•£éƒ¨é—¨å°±æ˜¯åˆ é™¤éƒ¨é—¨ï¼‰\néœ€æ±‚ï¼šå½“éƒ¨é—¨è§£æ•£äº†ä¸ä»…éœ€è¦æŠŠéƒ¨é—¨ä¿¡æ¯åˆ é™¤äº†ï¼Œè¿˜éœ€è¦æŠŠè¯¥éƒ¨é—¨ä¸‹çš„å‘˜å·¥æ•°æ®ä¹Ÿåˆ é™¤äº†ã€‚\næ­¥éª¤ï¼š\næ ¹æ®IDåˆ é™¤éƒ¨é—¨æ•°æ® æ ¹æ®éƒ¨é—¨IDåˆ é™¤è¯¥éƒ¨é—¨ä¸‹çš„å‘˜å·¥ ä»£ç å®ç°ï¼š\n1.DeptServiceImpl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @Slf4j @Service public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Autowired private EmpMapper empMapper; //æ ¹æ®éƒ¨é—¨idï¼Œåˆ é™¤éƒ¨é—¨ä¿¡æ¯åŠéƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ @Override public void delete(Integer id){ //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ deptMapper.deleteById(id); //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ empMapper.deleteByDeptId(id); } } 2.DeptMapper\n1 2 3 4 5 6 7 8 9 @Mapper public interface DeptMapper { /** * æ ¹æ®idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ * @param id éƒ¨é—¨id */ @Delete(\u0026#34;delete from dept where id = #{id}\u0026#34;) void deleteById(Integer id); } 3.EmpMapper\n1 2 3 4 5 6 7 8 @Mapper public interface EmpMapper { //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¸‹æ‰€æœ‰å‘˜å·¥ @Delete(\u0026#34;delete from emp where dept_id=#{deptId}\u0026#34;) public int deleteByDeptId(Integer deptId); } é‡å¯SpringBootæœåŠ¡ï¼Œä½¿ç”¨postmanæµ‹è¯•éƒ¨é—¨åˆ é™¤ï¼š\nä»£ç æ­£å¸¸æƒ…å†µä¸‹ï¼Œdeptè¡¨å’ŒEmpè¡¨ä¸­çš„æ•°æ®å·²åˆ é™¤\nä¿®æ”¹DeptServiceImplç±»ä¸­ä»£ç ï¼Œæ·»åŠ å¯èƒ½å‡ºç°å¼‚å¸¸çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Slf4j @Service public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Autowired private EmpMapper empMapper; //æ ¹æ®éƒ¨é—¨idï¼Œåˆ é™¤éƒ¨é—¨ä¿¡æ¯åŠéƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ @Override public void delete(Integer id){ //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ deptMapper.deleteById(id); //æ¨¡æ‹Ÿï¼šå¼‚å¸¸å‘ç”Ÿ int i = 1/0; //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ empMapper.deleteByDeptId(id); } } é‡å¯SpringBootæœåŠ¡ï¼Œä½¿ç”¨postmanæµ‹è¯•éƒ¨é—¨åˆ é™¤ï¼š\næŸ¥çœ‹æ•°æ®åº“è¡¨ï¼š\nåˆ é™¤äº†2å·éƒ¨é—¨ 2å·éƒ¨é—¨ä¸‹çš„å‘˜å·¥æ•°æ®æ²¡æœ‰åˆ é™¤ ä»¥ä¸Šç¨‹åºå‡ºç°çš„é—®é¢˜ï¼šå³ä½¿ç¨‹åºè¿è¡ŒæŠ›å‡ºäº†å¼‚å¸¸ï¼Œéƒ¨é—¨ä¾ç„¶åˆ é™¤äº†ï¼Œä½†æ˜¯éƒ¨é—¨ä¸‹çš„å‘˜å·¥å´æ²¡æœ‰åˆ é™¤ï¼Œé€ æˆäº†æ•°æ®çš„ä¸ä¸€è‡´ã€‚\nåŸå› åˆ†æ åŸå› ï¼š\nå…ˆæ‰§è¡Œæ ¹æ®idåˆ é™¤éƒ¨é—¨çš„æ“ä½œï¼Œè¿™æ­¥æ‰§è¡Œå®Œæ¯•ï¼Œæ•°æ®åº“è¡¨ dept ä¸­çš„æ•°æ®å°±å·²ç»åˆ é™¤äº†ã€‚ æ‰§è¡Œ 1/0 æ“ä½œï¼ŒæŠ›å‡ºå¼‚å¸¸ æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œä¸‹é¢æ‰€æœ‰çš„ä»£ç éƒ½ä¸ä¼šæ‰§è¡Œäº†ï¼Œæ ¹æ®éƒ¨é—¨IDåˆ é™¤è¯¥éƒ¨é—¨ä¸‹çš„å‘˜å·¥ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿä¸ä¼šæ‰§è¡Œ ã€‚ æ­¤æ—¶å°±å‡ºç°é—®é¢˜äº†ï¼Œéƒ¨é—¨åˆ é™¤äº†ï¼Œéƒ¨é—¨ä¸‹çš„å‘˜å·¥è¿˜åœ¨ï¼Œä¸šåŠ¡æ“ä½œå‰åæ•°æ®ä¸ä¸€è‡´ã€‚\nè€Œè¦æƒ³ä¿è¯æ“ä½œå‰åï¼Œæ•°æ®çš„ä¸€è‡´æ€§ï¼Œå°±éœ€è¦è®©è§£æ•£éƒ¨é—¨ä¸­æ¶‰åŠåˆ°çš„ä¸¤ä¸ªä¸šåŠ¡æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ ã€‚ é‚£æˆ‘ä»¬å¦‚ä½•ï¼Œè®©è¿™ä¸¤ä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å‘¢ ï¼Ÿ\né‚£å°±å¯ä»¥é€šè¿‡äº‹åŠ¡æ¥å®ç°ï¼Œå› ä¸ºä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šä¸ªä¸šåŠ¡æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚\næ­¤æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨deleteåˆ é™¤ä¸šåŠ¡åŠŸèƒ½ä¸­æ·»åŠ äº‹åŠ¡ã€‚\nåœ¨æ–¹æ³•è¿è¡Œä¹‹å‰ï¼Œå¼€å¯äº‹åŠ¡ï¼Œå¦‚æœæ–¹æ³•æˆåŠŸæ‰§è¡Œï¼Œå°±æäº¤äº‹åŠ¡ï¼Œå¦‚æœæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­å‡ºç°å¼‚å¸¸äº†ï¼Œå°±å›æ»šäº‹åŠ¡ã€‚\næ€è€ƒï¼šå¼€å‘ä¸­æ‰€æœ‰çš„ä¸šåŠ¡æ“ä½œï¼Œä¸€æ—¦æˆ‘ä»¬è¦è¿›è¡Œæ§åˆ¶äº‹åŠ¡ï¼Œæ˜¯ä¸æ˜¯éƒ½æ˜¯è¿™æ ·çš„å¥—è·¯ï¼Ÿ\nç­”æ¡ˆï¼šæ˜¯çš„ã€‚\næ‰€ä»¥åœ¨springæ¡†æ¶å½“ä¸­å°±å·²ç»æŠŠäº‹åŠ¡æ§åˆ¶çš„ä»£ç éƒ½å·²ç»å°è£…å¥½äº†ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°ã€‚æˆ‘ä»¬ä½¿ç”¨äº†springæ¡†æ¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ä¸€ä¸ªç®€å•çš„æ³¨è§£@Transactionalå°±æå®šäº†ã€‚\nTransactionlaæ³¨è§£ @Transactionalä½œç”¨ï¼šå°±æ˜¯åœ¨å½“å‰è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå¼€å§‹ä¹‹å‰æ¥å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åæäº¤äº‹åŠ¡ã€‚å¦‚æœåœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œå°±ä¼šè¿›è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œã€‚\n@Transactionalæ³¨è§£ï¼šæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ä¸šåŠ¡å±‚å½“ä¸­æ¥æ§åˆ¶äº‹åŠ¡ï¼Œå› ä¸ºåœ¨ä¸šåŠ¡å±‚å½“ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½å¯èƒ½ä¼šåŒ…å«å¤šä¸ªæ•°æ®è®¿é—®çš„æ“ä½œã€‚åœ¨ä¸šåŠ¡å±‚æ¥æ§åˆ¶äº‹åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å¤šä¸ªæ•°æ®è®¿é—®æ“ä½œæ§åˆ¶åœ¨ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ã€‚\n@Transactionalæ³¨è§£ä¹¦å†™ä½ç½®ï¼š\næ–¹æ³• å½“å‰æ–¹æ³•äº¤ç»™springè¿›è¡Œäº‹åŠ¡ç®¡ç† ç±» å½“å‰ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½äº¤ç”±springè¿›è¡Œäº‹åŠ¡ç®¡ç† æ¥å£ æ¥å£ä¸‹æ‰€æœ‰çš„å®ç°ç±»å½“ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½äº¤ç»™spring è¿›è¡Œäº‹åŠ¡ç®¡ç† æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸šåŠ¡æ–¹æ³•deleteä¸ŠåŠ ä¸Š @Transactional æ¥æ§åˆ¶äº‹åŠ¡ ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Slf4j @Service public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Autowired private EmpMapper empMapper; @Override @Transactional //å½“å‰æ–¹æ³•æ·»åŠ äº†äº‹åŠ¡ç®¡ç† public void delete(Integer id){ //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ deptMapper.deleteById(id); //æ¨¡æ‹Ÿï¼šå¼‚å¸¸å‘ç”Ÿ int i = 1/0; //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ empMapper.deleteByDeptId(id); } } åœ¨ä¸šåŠ¡åŠŸèƒ½ä¸Šæ·»åŠ @Transactionalæ³¨è§£è¿›è¡Œäº‹åŠ¡ç®¡ç†åï¼Œæˆ‘ä»¬é‡å¯SpringBootæœåŠ¡ï¼Œä½¿ç”¨postmanæµ‹è¯•ï¼š\næ·»åŠ Springäº‹åŠ¡ç®¡ç†åï¼Œç”±äºæœåŠ¡ç«¯ç¨‹åºå¼•å‘äº†å¼‚å¸¸ï¼Œæ‰€ä»¥äº‹åŠ¡è¿›è¡Œå›æ»šã€‚\nè¯´æ˜ï¼šå¯ä»¥åœ¨application.ymlé…ç½®æ–‡ä»¶ä¸­å¼€å¯äº‹åŠ¡ç®¡ç†æ—¥å¿—ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ§åˆ¶çœ‹åˆ°å’Œäº‹åŠ¡ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯äº†\n1 2 3 4 #springäº‹åŠ¡ç®¡ç†æ—¥å¿— logging: level: org.springframework.jdbc.support.JdbcTransactionManager: debug äº‹åŠ¡ç®¡ç†-äº‹åŠ¡è¿›é˜¶-rollbackForå±æ€§ å‰é¢æˆ‘ä»¬é€šè¿‡springäº‹åŠ¡ç®¡ç†æ³¨è§£@Transactionalå·²ç»æ§åˆ¶äº†ä¸šåŠ¡å±‚æ–¹æ³•çš„äº‹åŠ¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ¥è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹@Transactionaläº‹åŠ¡ç®¡ç†æ³¨è§£çš„ä½¿ç”¨ç»†èŠ‚ã€‚æˆ‘ä»¬è¿™é‡Œä¸»è¦ä»‹ç»@Transactionalæ³¨è§£å½“ä¸­çš„ä¸¤ä¸ªå¸¸è§çš„å±æ€§ï¼š\nå¼‚å¸¸å›æ»šçš„å±æ€§ï¼šrollbackFor äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼špropagation æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸‹rollbackForå±æ€§ã€‚\næˆ‘ä»¬åœ¨ä¹‹å‰ç¼–å†™çš„ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ äº†@Transactionalæ³¨è§£ï¼Œæ¥å®ç°äº‹åŠ¡ç®¡ç†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 @Transactional public void delete(Integer id){ //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ deptMapper.deleteById(id); //æ¨¡æ‹Ÿï¼šå¼‚å¸¸å‘ç”Ÿ int i = 1/0; //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ empMapper.deleteByDeptId(id); } ä»¥ä¸Šä¸šåŠ¡åŠŸèƒ½delete()æ–¹æ³•åœ¨è¿è¡Œæ—¶ï¼Œä¼šå¼•å‘é™¤0çš„ç®—æ•°è¿ç®—å¼‚å¸¸(è¿è¡Œæ—¶å¼‚å¸¸)ï¼Œå‡ºç°å¼‚å¸¸ä¹‹åï¼Œç”±äºæˆ‘ä»¬åœ¨æ–¹æ³•ä¸ŠåŠ äº†@Transactionalæ³¨è§£è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œæ‰€ä»¥å‘ç”Ÿå¼‚å¸¸ä¼šæ‰§è¡Œrollbackå›æ»šæ“ä½œï¼Œä»è€Œä¿è¯äº‹åŠ¡æ“ä½œå‰åæ•°æ®æ˜¯ä¸€è‡´çš„ã€‚\nä¸‹é¢æˆ‘ä»¬åœ¨åšä¸€ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸šåŠ¡åŠŸèƒ½ä»£ç ï¼Œåœ¨æ¨¡æ‹Ÿå¼‚å¸¸çš„ä½ç½®ä¸Šç›´æ¥æŠ›å‡ºExceptionå¼‚å¸¸ï¼ˆç¼–è¯‘æ—¶å¼‚å¸¸ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 @Transactional public void delete(Integer id) throws Exception { //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ deptMapper.deleteById(id); //æ¨¡æ‹Ÿï¼šå¼‚å¸¸å‘ç”Ÿ if(true){ throw new Exception(\u0026#34;å‡ºç°å¼‚å¸¸äº†~~~\u0026#34;); } //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ empMapper.deleteByDeptId(id); } è¯´æ˜ï¼šåœ¨serviceä¸­å‘ä¸ŠæŠ›å‡ºä¸€ä¸ªExceptionç¼–è¯‘æ—¶å¼‚å¸¸ä¹‹åï¼Œç”±äºæ˜¯controllerè°ƒç”¨serviceï¼Œæ‰€ä»¥åœ¨controllerä¸­è¦æœ‰å¼‚å¸¸å¤„ç†ä»£ç ï¼Œæ­¤æ—¶æˆ‘ä»¬é€‰æ‹©åœ¨controllerä¸­ç»§ç»­æŠŠå¼‚å¸¸å‘ä¸ŠæŠ›ã€‚\n1 2 3 4 5 6 7 8 9 @DeleteMapping(\u0026#34;/depts/{id}\u0026#34;) public Result delete(@PathVariable Integer id) throws Exception { //æ—¥å¿—è®°å½• log.info(\u0026#34;æ ¹æ®idåˆ é™¤éƒ¨é—¨\u0026#34;); //è°ƒç”¨serviceå±‚åŠŸèƒ½ deptService.delete(id); //å“åº” return Result.success(); } é‡æ–°å¯åŠ¨æœåŠ¡åæµ‹è¯•ï¼š\næŠ›å‡ºå¼‚å¸¸ä¹‹åäº‹åŠ¡ä¼šä¸ä¼šå›æ»š\nç°æœ‰è¡¨ä¸­æ•°æ®ï¼š\nä½¿ç”¨postmanæµ‹è¯•ï¼Œåˆ é™¤5å·éƒ¨é—¨\nå‘ç”Ÿäº†Exceptionå¼‚å¸¸ï¼Œä½†äº‹åŠ¡ä¾ç„¶æäº¤äº†\ndeptè¡¨ä¸­æ•°æ®ï¼š\né€šè¿‡ä»¥ä¸Šæµ‹è¯•å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å‡ºç°RuntimeException(è¿è¡Œæ—¶å¼‚å¸¸)æ‰ä¼šå›æ»šäº‹åŠ¡ã€‚\nå‡å¦‚æˆ‘ä»¬æƒ³è®©æ‰€æœ‰çš„å¼‚å¸¸éƒ½å›æ»šï¼Œéœ€è¦æ¥é…ç½®@Transactionalæ³¨è§£å½“ä¸­çš„rollbackForå±æ€§ï¼Œé€šè¿‡rollbackForè¿™ä¸ªå±æ€§å¯ä»¥æŒ‡å®šå‡ºç°ä½•ç§å¼‚å¸¸ç±»å‹å›æ»šäº‹åŠ¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Slf4j @Service public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Autowired private EmpMapper empMapper; @Override @Transactional(rollbackFor=Exception.class) public void delete(Integer id){ //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ deptMapper.deleteById(id); //æ¨¡æ‹Ÿï¼šå¼‚å¸¸å‘ç”Ÿ int num = id/0; //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ empMapper.deleteByDeptId(id); } } æ¥ä¸‹æ¥æˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œæµ‹è¯•åˆ é™¤éƒ¨é—¨çš„æ“ä½œï¼š\næ§åˆ¶å°æ—¥å¿—ï¼šæ‰§è¡Œäº†åˆ é™¤3å·éƒ¨é—¨çš„æ“ä½œï¼Œ å› ä¸ºå¼‚å¸¸åˆè¿›è¡Œäº†äº‹åŠ¡å›æ»š\næ•°æ®è¡¨ï¼š3å·éƒ¨é—¨æ²¡æœ‰åˆ é™¤\nç»“è®ºï¼š\nåœ¨Springçš„äº‹åŠ¡ç®¡ç†ä¸­ï¼Œé»˜è®¤åªæœ‰è¿è¡Œæ—¶å¼‚å¸¸ RuntimeExceptionæ‰ä¼šå›æ»šã€‚ å¦‚æœè¿˜éœ€è¦å›æ»šæŒ‡å®šç±»å‹çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡rollbackForå±æ€§æ¥æŒ‡å®šã€‚ äº‹åŠ¡ç®¡ç†-äº‹åŠ¡è¿›é˜¶-propagationå±æ€§ ä»‹ç» æˆ‘ä»¬æ¥ç€ç»§ç»­å­¦ä¹ @Transactionalæ³¨è§£å½“ä¸­çš„ç¬¬äºŒä¸ªå±æ€§propagationï¼Œè¿™ä¸ªå±æ€§æ˜¯ç”¨æ¥é…ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºçš„ã€‚\nä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå‘¢ï¼Ÿ\nå°±æ˜¯å½“ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªäº‹åŠ¡æ–¹æ³•åº”è¯¥å¦‚ä½•è¿›è¡Œäº‹åŠ¡æ§åˆ¶ã€‚ ä¾‹å¦‚ï¼šä¸¤ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œä¸€ä¸ªAæ–¹æ³•ï¼Œä¸€ä¸ªBæ–¹æ³•ã€‚åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸Šéƒ½æ·»åŠ äº†@Transactionalæ³¨è§£ï¼Œå°±ä»£è¡¨è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å…·æœ‰äº‹åŠ¡ï¼Œè€Œåœ¨Aæ–¹æ³•å½“ä¸­åˆå»è°ƒç”¨äº†Bæ–¹æ³•ã€‚\næ‰€è°“äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼ŒæŒ‡çš„å°±æ˜¯åœ¨Aæ–¹æ³•è¿è¡Œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨Aæ–¹æ³•å½“ä¸­åˆè°ƒç”¨äº†Bæ–¹æ³•ï¼Œ Bæ–¹æ³•è‡ªèº«ä¹Ÿå…·æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆBæ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œåˆ°åº•æ˜¯åŠ å…¥åˆ°Aæ–¹æ³•çš„äº‹åŠ¡å½“ä¸­æ¥ï¼Œè¿˜æ˜¯Bæ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Ÿè¿™ä¸ªå°±æ¶‰åŠåˆ°äº†äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚\næˆ‘ä»¬è¦æƒ³æ§åˆ¶äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œåœ¨@Transactionalæ³¨è§£çš„åé¢æŒ‡å®šä¸€ä¸ªå±æ€§propagationï¼Œé€šè¿‡ propagation å±æ€§æ¥æŒ‡å®šä¼ æ’­è¡Œä¸ºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹å¸¸è§çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚\nå±æ€§å€¼ å«ä¹‰ REQUIRED ã€é»˜è®¤å€¼ã€‘éœ€è¦äº‹åŠ¡ï¼Œæœ‰åˆ™åŠ å…¥ï¼Œæ— åˆ™åˆ›å»ºæ–°äº‹åŠ¡ REQUIRES_NEW éœ€è¦æ–°äº‹åŠ¡ï¼Œæ— è®ºæœ‰æ— ï¼Œæ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡ SUPPORTS æ”¯æŒäº‹åŠ¡ï¼Œæœ‰åˆ™åŠ å…¥ï¼Œæ— åˆ™åœ¨æ— äº‹åŠ¡çŠ¶æ€ä¸­è¿è¡Œ NOT_SUPPORTED ä¸æ”¯æŒäº‹åŠ¡ï¼Œåœ¨æ— äº‹åŠ¡çŠ¶æ€ä¸‹è¿è¡Œ,å¦‚æœå½“å‰å­˜åœ¨å·²æœ‰äº‹åŠ¡,åˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ MANDATORY å¿…é¡»æœ‰äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å¼‚å¸¸ NEVER å¿…é¡»æ²¡äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å¼‚å¸¸ å¯¹äºè¿™äº›äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ä»¥ä¸‹ä¸¤ä¸ªå°±å¯ä»¥äº†ï¼š\nREQUIREDï¼ˆé»˜è®¤å€¼ï¼‰ REQUIRES_NEW æ¡ˆä¾‹ **éœ€æ±‚ï¼š**è§£æ•£éƒ¨é—¨æ—¶éœ€è¦è®°å½•æ“ä½œæ—¥å¿—\nç”±äºè§£æ•£éƒ¨é—¨æ˜¯ä¸€ä¸ªéå¸¸é‡è¦è€Œä¸”éå¸¸å±é™©çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨ä¸šåŠ¡å½“ä¸­è¦æ±‚æ¯ä¸€æ¬¡æ‰§è¡Œè§£æ•£éƒ¨é—¨çš„æ“ä½œéƒ½éœ€è¦ç•™ä¸‹ç—•è¿¹ï¼Œå°±æ˜¯è¦è®°å½•æ“ä½œæ—¥å¿—ã€‚è€Œä¸”è¿˜è¦æ±‚æ— è®ºæ˜¯æ‰§è¡ŒæˆåŠŸäº†è¿˜æ˜¯æ‰§è¡Œå¤±è´¥äº†ï¼Œéƒ½éœ€è¦ç•™ä¸‹ç—•è¿¹ã€‚\næ­¥éª¤ï¼š\næ‰§è¡Œè§£æ•£éƒ¨é—¨çš„ä¸šåŠ¡ï¼šå…ˆåˆ é™¤éƒ¨é—¨ï¼Œå†åˆ é™¤éƒ¨é—¨ä¸‹çš„å‘˜å·¥ï¼ˆå‰é¢å·²å®ç°ï¼‰ è®°å½•è§£æ•£éƒ¨é—¨çš„æ—¥å¿—ï¼Œåˆ°æ—¥å¿—è¡¨ï¼ˆæœªå®ç°ï¼‰ å‡†å¤‡å·¥ä½œï¼š\nåˆ›å»ºæ•°æ®åº“è¡¨ dept_log æ—¥å¿—è¡¨ï¼š 1 2 3 4 5 create table dept_log( id int auto_increment comment \u0026#39;ä¸»é”®ID\u0026#39; primary key, create_time datetime null comment \u0026#39;æ“ä½œæ—¶é—´\u0026#39;, description varchar(300) null comment \u0026#39;æ“ä½œæè¿°\u0026#39; )comment \u0026#39;éƒ¨é—¨æ“ä½œæ—¥å¿—è¡¨\u0026#39;; 2. å¼•å…¥èµ„æ–™ä¸­æä¾›çš„å®ä½“ç±»ï¼šDeptLog\n1 2 3 4 5 6 7 8 @Data @NoArgsConstructor @AllArgsConstructor public class DeptLog { private Integer id; private LocalDateTime createTime; private String description; } 3. å¼•å…¥èµ„æ–™ä¸­æä¾›çš„Mapperæ¥å£ï¼šDeptLogMapper\n1 2 3 4 5 6 7 @Mapper public interface DeptLogMapper { @Insert(\u0026#34;insert into dept_log(create_time,description) values(#{createTime},#{description})\u0026#34;) void insert(DeptLog log); } 4. å¼•å…¥èµ„æ–™ä¸­æä¾›çš„ä¸šåŠ¡æ¥å£ï¼šDeptLogService\n1 2 3 public interface DeptLogService { void insert(DeptLog deptLog); } 5. å¼•å…¥èµ„æ–™ä¸­æä¾›çš„ä¸šåŠ¡å®ç°ç±»ï¼šDeptLogServiceImpl\n1 2 3 4 5 6 7 8 9 10 11 12 @Service public class DeptLogServiceImpl implements DeptLogService { @Autowired private DeptLogMapper deptLogMapper; @Transactional //äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼šæœ‰äº‹åŠ¡å°±åŠ å…¥ã€æ²¡æœ‰äº‹åŠ¡å°±æ–°å»ºäº‹åŠ¡ @Override public void insert(DeptLog deptLog) { deptLogMapper.insert(deptLog); } } ä»£ç å®ç°:\nä¸šåŠ¡å®ç°ç±»ï¼šDeptServiceImpl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 @Slf4j @Service //@Transactional //å½“å‰ä¸šåŠ¡å®ç°ç±»ä¸­çš„æ‰€æœ‰çš„æ–¹æ³•ï¼Œéƒ½æ·»åŠ äº†springäº‹åŠ¡ç®¡ç†æœºåˆ¶ public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Autowired private EmpMapper empMapper; @Autowired private DeptLogService deptLogService; //æ ¹æ®éƒ¨é—¨idï¼Œåˆ é™¤éƒ¨é—¨ä¿¡æ¯åŠéƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ @Override @Log @Transactional(rollbackFor = Exception.class) public void delete(Integer id) throws Exception { try { //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯ deptMapper.deleteById(id); //æ¨¡æ‹Ÿï¼šå¼‚å¸¸ if(true){ throw new Exception(\u0026#34;å‡ºç°å¼‚å¸¸äº†~~~\u0026#34;); } //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ empMapper.deleteByDeptId(id); }finally { //ä¸è®ºæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œæœ€ç»ˆéƒ½è¦æ‰§è¡Œçš„ä»£ç ï¼šè®°å½•æ—¥å¿— DeptLog deptLog = new DeptLog(); deptLog.setCreateTime(LocalDateTime.now()); deptLog.setDescription(\u0026#34;æ‰§è¡Œäº†è§£æ•£éƒ¨é—¨çš„æ“ä½œï¼Œæ­¤æ—¶è§£æ•£çš„æ˜¯\u0026#34;+id+\u0026#34;å·éƒ¨é—¨\u0026#34;); //è°ƒç”¨å…¶ä»–ä¸šåŠ¡ç±»ä¸­çš„æ–¹æ³• deptLogService.insert(deptLog); } } //çœç•¥å…¶ä»–ä»£ç ... } æµ‹è¯•:\né‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•åˆ é™¤3å·éƒ¨é—¨åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\næ‰§è¡Œäº†åˆ é™¤3å·éƒ¨é—¨æ“ä½œ æ‰§è¡Œäº†æ’å…¥éƒ¨é—¨æ—¥å¿—æ“ä½œ ç¨‹åºå‘ç”ŸExceptionå¼‚å¸¸ æ‰§è¡Œäº‹åŠ¡å›æ»šï¼ˆåˆ é™¤ã€æ’å…¥æ“ä½œå› ä¸ºåœ¨ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ï¼Œä¸¤ä¸ªæ“ä½œéƒ½ä¼šè¢«å›æ»šï¼‰ ç„¶ååœ¨dept_logè¡¨ä¸­æ²¡æœ‰è®°å½•æ—¥å¿—æ•°æ®\nåŸå› åˆ†æ:\næ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦æ¥åˆ†æä¸€ä¸‹å…·ä½“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„æ—¥å¿—æ²¡æœ‰æˆåŠŸçš„è®°å½•ã€‚\nåœ¨æ‰§è¡Œdeleteæ“ä½œæ—¶å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ å½“æ‰§è¡Œinsertæ“ä½œæ—¶ï¼Œinsertè®¾ç½®çš„äº‹åŠ¡ä¼ æ’­è¡Œæ˜¯é»˜è®¤å€¼REQUIREDï¼Œè¡¨ç¤ºæœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰åˆ™æ–°å»ºäº‹åŠ¡ æ­¤æ—¶ï¼šdeleteå’Œinsertæ“ä½œä½¿ç”¨äº†åŒä¸€ä¸ªäº‹åŠ¡ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šä¸ªæ“ä½œï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œæ‰€ä»¥å½“å¼‚å¸¸å‘ç”Ÿæ—¶è¿›è¡Œäº‹åŠ¡å›æ»šï¼Œå°±ä¼šå›æ»šdeleteå’Œinsertæ“ä½œ è§£å†³æ–¹æ¡ˆï¼š\nåœ¨DeptLogServiceImplç±»ä¸­insertæ–¹æ³•ä¸Šï¼Œæ·»åŠ @Transactional(propagation = Propagation.REQUIRES_NEW)\nPropagation.REQUIRES_NEW ï¼šä¸è®ºæ˜¯å¦æœ‰äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ ï¼Œè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 @Service public class DeptLogServiceImpl implements DeptLogService { @Autowired private DeptLogMapper deptLogMapper; @Transactional(propagation = Propagation.REQUIRES_NEW)//äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼šä¸è®ºæ˜¯å¦æœ‰äº‹åŠ¡ï¼Œéƒ½æ–°å»ºäº‹åŠ¡ @Override public void insert(DeptLog deptLog) { deptLogMapper.insert(deptLog); } } é‡å¯SpringBootæœåŠ¡ï¼Œå†æ¬¡æµ‹è¯•åˆ é™¤3å·éƒ¨é—¨ï¼š\né‚£æ­¤æ—¶ï¼ŒDeptServiceImplä¸­çš„deleteæ–¹æ³•è¿è¡Œæ—¶ï¼Œä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚ å½“è°ƒç”¨ deptLogService.insert(deptLog) æ—¶ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œé‚£æ­¤æ—¶ï¼Œå½“insertæ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åï¼Œäº‹åŠ¡å°±å·²ç»æäº¤äº†ã€‚ å³ä½¿å¤–éƒ¨çš„äº‹åŠ¡å‡ºç°å¼‚å¸¸ï¼Œå†…éƒ¨å·²ç»æäº¤çš„äº‹åŠ¡ï¼Œä¹Ÿä¸ä¼šå›æ»šäº†ï¼Œå› ä¸ºæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ã€‚\nåˆ°æ­¤äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå·²æ¼”ç¤ºå®Œæˆï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºæˆ‘ä»¬åªéœ€è¦æŒæ¡ä¸¤ä¸ªï¼šREQUIREDã€REQUIRES_NEWã€‚\nREQUIRED ï¼šå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯ç”¨è¯¥ä¼ æ’­è¡Œä¸ºå³å¯ã€‚ REQUIRES_NEW ï¼šå½“æˆ‘ä»¬ä¸å¸Œæœ›äº‹åŠ¡ä¹‹é—´ç›¸äº’å½±å“æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥ä¼ æ’­è¡Œä¸ºã€‚æ¯”å¦‚ï¼šä¸‹è®¢å•å‰éœ€è¦è®°å½•æ—¥å¿—ï¼Œä¸è®ºè®¢å•ä¿å­˜æˆåŠŸä¸å¦ï¼Œéƒ½éœ€è¦ä¿è¯æ—¥å¿—è®°å½•èƒ½å¤Ÿè®°å½•æˆåŠŸã€‚ AOPåŸºç¡€-å¿«é€Ÿå…¥é—¨ AOPæ¦‚è¿° ä»€ä¹ˆæ˜¯AOPï¼Ÿ\nAOPè‹±æ–‡å…¨ç§°ï¼šAspect Oriented Programmingï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ã€é¢å‘æ–¹é¢ç¼–ç¨‹ï¼‰ï¼Œå…¶å®è¯´ç™½äº†ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹å°±æ˜¯é¢å‘ç‰¹å®šæ–¹æ³•ç¼–ç¨‹ã€‚ é‚£ä»€ä¹ˆåˆæ˜¯é¢å‘æ–¹æ³•ç¼–ç¨‹å‘¢ï¼Œä¸ºä»€ä¹ˆåˆéœ€è¦é¢å‘æ–¹æ³•ç¼–ç¨‹å‘¢ï¼Ÿæ¥æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­åšä¸€ä¸ªè¯´æ˜ï¼š\næ¯”å¦‚ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®ä¸­å¼€å‘äº†å¾ˆå¤šçš„ä¸šåŠ¡åŠŸèƒ½ã€‚\nç„¶è€Œæœ‰ä¸€äº›ä¸šåŠ¡åŠŸèƒ½æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½ï¼Œæ‰§è¡Œè€—æ—¶è¾ƒé•¿ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹äºè¿™äº›ä¸šåŠ¡æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚ é‚£é¦–å…ˆç¬¬ä¸€æ­¥å°±éœ€è¦å®šä½å‡ºæ‰§è¡Œè€—æ—¶æ¯”è¾ƒé•¿çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå†é’ˆå¯¹äºä¸šåŠ¡æ–¹æ³•å†æ¥è¿›è¡Œä¼˜åŒ–ã€‚\næ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç»Ÿè®¡å½“å‰è¿™ä¸ªé¡¹ç›®å½“ä¸­æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ã€‚é‚£ä¹ˆç»Ÿè®¡æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶è¯¥æ€ä¹ˆå®ç°ï¼Ÿ\nå¯èƒ½å¤šæ•°äººé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯åœ¨æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•è¿è¡Œä¹‹å‰ï¼Œè®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„å¼€å§‹æ—¶é—´ã€‚åœ¨è¿™ä¸ªæ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åï¼Œå†æ¥è®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„ç»“æŸæ—¶é—´ã€‚æ‹¿ç»“æŸæ—¶é—´å‡å»å¼€å§‹æ—¶é—´ï¼Œä¸å°±æ˜¯è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œè€—æ—¶å—ï¼Ÿ\nä»¥ä¸Šåˆ†æçš„å®ç°æ–¹å¼æ˜¯å¯ä»¥è§£å†³éœ€æ±‚é—®é¢˜çš„ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªé¡¹ç›®æ¥è®²ï¼Œé‡Œé¢ä¼šåŒ…å«å¾ˆå¤šçš„ä¸šåŠ¡æ¨¡å—ï¼Œæ¯ä¸ªä¸šåŠ¡æ¨¡å—åˆåŒ…å«å¾ˆå¤šå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨æ¯ä¸€ä¸ªæ¨¡å—ä¸‹çš„ä¸šåŠ¡æ–¹æ³•ä¸­ï¼Œæ·»åŠ è®°å½•å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€è®¡ç®—æ‰§è¡Œè€—æ—¶çš„ä»£ç ï¼Œå°±ä¼šè®©ç¨‹åºå‘˜çš„å·¥ä½œå˜å¾—éå¸¸ç¹çã€‚\nè€ŒAOPé¢å‘æ–¹æ³•ç¼–ç¨‹ï¼Œå°±å¯ä»¥åšåˆ°åœ¨ä¸æ”¹åŠ¨è¿™äº›åŸå§‹æ–¹æ³•çš„åŸºç¡€ä¸Šï¼Œé’ˆå¯¹ç‰¹å®šçš„æ–¹æ³•è¿›è¡ŒåŠŸèƒ½çš„å¢å¼ºã€‚\nAOPçš„ä½œç”¨ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åœ¨ä¸ä¿®æ”¹æºä»£ç çš„åŸºç¡€ä¸Šå¯¹å·²æœ‰æ–¹æ³•è¿›è¡Œå¢å¼ºï¼ˆæ— ä¾µå…¥æ€§: è§£è€¦ï¼‰\næˆ‘ä»¬è¦æƒ³å®Œæˆç»Ÿè®¡å„ä¸ªä¸šåŠ¡æ–¹æ³•æ‰§è¡Œè€—æ—¶çš„éœ€æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œå°†è®°å½•æ–¹æ³•æ‰§è¡Œè€—æ—¶è¿™ä¸€éƒ¨åˆ†å…¬å…±çš„é€»è¾‘ä»£ç ï¼Œå®šä¹‰åœ¨æ¨¡æ¿æ–¹æ³•å½“ä¸­ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œæ¥è®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„å¼€å§‹æ—¶é—´ï¼Œåœ¨æ–¹æ³•ç»“æŸè¿è¡Œçš„æ—¶å€™ï¼Œå†æ¥è®°å½•æ–¹æ³•è¿è¡Œçš„ç»“æŸæ—¶é—´ï¼Œä¸­é—´å°±æ¥è¿è¡ŒåŸå§‹çš„ä¸šåŠ¡æ–¹æ³•ã€‚\nè€Œä¸­é—´è¿è¡Œçš„åŸå§‹ä¸šåŠ¡æ–¹æ³•ï¼Œå¯èƒ½æ˜¯å…¶ä¸­çš„ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬åªæƒ³é€šè¿‡ éƒ¨é—¨ç®¡ç†çš„ list æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ï¼Œé‚£å°±åªæœ‰è¿™ä¸€ä¸ªæ–¹æ³•æ˜¯åŸå§‹ä¸šåŠ¡æ–¹æ³•ã€‚ è€Œå¦‚æœï¼Œæˆ‘ä»¬æ˜¯å…ˆæƒ³ç»Ÿè®¡æ‰€æœ‰éƒ¨é—¨ç®¡ç†çš„ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œè€—æ—¶ï¼Œé‚£æ­¤æ—¶ï¼Œæ‰€æœ‰çš„éƒ¨é—¨ç®¡ç†çš„ä¸šåŠ¡æ–¹æ³•éƒ½æ˜¯ åŸå§‹ä¸šåŠ¡æ–¹æ³•ã€‚ é‚£é¢å‘è¿™æ ·çš„æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•è¿›è¡Œç¼–ç¨‹ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚\né‚£æ­¤æ—¶ï¼Œå½“æˆ‘ä»¬å†è°ƒç”¨éƒ¨é—¨ç®¡ç†çš„ list ä¸šåŠ¡æ–¹æ³•æ—¶å•Šï¼Œå¹¶ä¸ä¼šç›´æ¥æ‰§è¡Œ list æ–¹æ³•çš„é€»è¾‘ï¼Œè€Œæ˜¯ä¼šæ‰§è¡Œæˆ‘ä»¬æ‰€å®šä¹‰çš„ æ¨¡æ¿æ–¹æ³• ï¼Œ ç„¶åå†æ¨¡æ¿æ–¹æ³•ä¸­ï¼š\nè®°å½•æ–¹æ³•è¿è¡Œå¼€å§‹æ—¶é—´ è¿è¡ŒåŸå§‹çš„ä¸šåŠ¡æ–¹æ³•ï¼ˆé‚£æ­¤æ—¶åŸå§‹çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå°±æ˜¯ list æ–¹æ³•ï¼‰ è®°å½•æ–¹æ³•è¿è¡Œç»“æŸæ—¶é—´ï¼Œè®¡ç®—æ–¹æ³•æ‰§è¡Œè€—æ—¶ ä¸è®ºï¼Œæˆ‘ä»¬è¿è¡Œçš„æ˜¯é‚£ä¸ªä¸šåŠ¡æ–¹æ³•ï¼Œæœ€åå…¶å®è¿è¡Œçš„å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„æ¨¡æ¿æ–¹æ³•ï¼Œè€Œåœ¨æ¨¡æ¿æ–¹æ³•ä¸­ï¼Œå°±å®Œæˆäº†åŸå§‹æ–¹æ³•æ‰§è¡Œè€—æ—¶çš„ç»Ÿè®¡æ“ä½œ ã€‚(é‚£è¿™æ ·å‘¢ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å°±å®Œæˆäº†æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªä¸šåŠ¡æ–¹æ³•æ‰§è¡Œè€—æ—¶çš„ç»Ÿè®¡)\nè€Œå¤§å®¶ä¼šå‘ç°ï¼Œè¿™ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¼¼æ›¾ç›¸è¯†å•Šï¼Ÿ\nå¯¹äº†ï¼Œå°±æ˜¯å’Œæˆ‘ä»¬ä¹‹å‰æ‰€å­¦ä¹ çš„åŠ¨æ€ä»£ç†æŠ€æœ¯æ˜¯éå¸¸ç±»ä¼¼çš„ã€‚ æˆ‘ä»¬æ‰€è¯´çš„æ¨¡æ¿æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯ä»£ç†å¯¹è±¡ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œé‚£ä»£ç†å¯¹è±¡ä¸­çš„æ–¹æ³•ä»¥åŠæ ¹æ®å¯¹åº”çš„ä¸šåŠ¡éœ€è¦ï¼Œ å®Œæˆäº†å¯¹åº”çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œå½“è¿è¡ŒåŸå§‹ä¸šåŠ¡æ–¹æ³•æ—¶ï¼Œå°±ä¼šè¿è¡Œä»£ç†å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œä»è€Œå®ç°ç»Ÿè®¡ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œè€—æ—¶çš„æ“ä½œã€‚\nå…¶å®ï¼ŒAOPé¢å‘åˆ‡é¢ç¼–ç¨‹å’ŒOOPé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸€æ ·ï¼Œå®ƒä»¬éƒ½ä»…ä»…æ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œè€ŒåŠ¨æ€ä»£ç†æŠ€æœ¯æ˜¯è¿™ç§æ€æƒ³æœ€ä¸»æµçš„å®ç°æ–¹å¼ã€‚è€ŒSpringçš„AOPæ˜¯Springæ¡†æ¶çš„é«˜çº§æŠ€æœ¯ï¼Œæ—¨åœ¨ç®¡ç†beanå¯¹è±¡çš„è¿‡ç¨‹ä¸­åº•å±‚ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¯¹ç‰¹å®šçš„æ–¹æ³•è¿›è¡Œç¼–ç¨‹(åŠŸèƒ½å¢å¼º)ã€‚\nAOPçš„ä¼˜åŠ¿ï¼š\nå‡å°‘é‡å¤ä»£ç  æé«˜å¼€å‘æ•ˆç‡ ç»´æŠ¤æ–¹ä¾¿ AOPå¿«é€Ÿå…¥é—¨ åœ¨äº†è§£äº†ä»€ä¹ˆæ˜¯AOPåï¼Œæˆ‘ä»¬ä¸‹é¢é€šè¿‡ä¸€ä¸ªå¿«é€Ÿå…¥é—¨ç¨‹åºï¼Œä½“éªŒä¸‹AOPçš„å¼€å‘ï¼Œå¹¶æŒæ¡Springä¸­AOPçš„å¼€å‘æ­¥éª¤ã€‚\n**éœ€æ±‚ï¼š**ç»Ÿè®¡å„ä¸ªä¸šåŠ¡å±‚æ–¹æ³•æ‰§è¡Œè€—æ—¶ã€‚\nå®ç°æ­¥éª¤ï¼š\nå¯¼å…¥ä¾èµ–ï¼šåœ¨pom.xmlä¸­å¯¼å…¥AOPçš„ä¾èµ– ç¼–å†™AOPç¨‹åºï¼šé’ˆå¯¹äºç‰¹å®šæ–¹æ³•æ ¹æ®ä¸šåŠ¡éœ€è¦è¿›è¡Œç¼–ç¨‹ ä¸ºæ¼”ç¤ºæ–¹ä¾¿ï¼Œå¯ä»¥è‡ªå»ºæ–°é¡¹ç›®æˆ–å¯¼å…¥æä¾›çš„springboot-aop-quickstarté¡¹ç›®å·¥ç¨‹\npom.xml\n1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-aop\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; AOPç¨‹åºï¼šTimeAspect\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Component @Aspect //å½“å‰ç±»ä¸ºåˆ‡é¢ç±» @Slf4j public class TimeAspect { @Around(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public Object recordTime(ProceedingJoinPoint pjp) throws Throwable { //è®°å½•æ–¹æ³•æ‰§è¡Œå¼€å§‹æ—¶é—´ long begin = System.currentTimeMillis(); //æ‰§è¡ŒåŸå§‹æ–¹æ³• Object result = pjp.proceed(); //è®°å½•æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶é—´ long end = System.currentTimeMillis(); //è®¡ç®—æ–¹æ³•æ‰§è¡Œè€—æ—¶ log.info(pjp.getSignature()+\u0026#34;æ‰§è¡Œè€—æ—¶: {}æ¯«ç§’\u0026#34;,end-begin); return result; } } é‡æ–°å¯åŠ¨SpringBootæœåŠ¡æµ‹è¯•ç¨‹åºï¼š\næŸ¥è¯¢3å·éƒ¨é—¨ä¿¡æ¯ æˆ‘ä»¬å¯ä»¥å†æµ‹è¯•ä¸‹ï¼šæŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨ä¿¡æ¯ï¼ˆåŒæ ·æ‰§è¡ŒAOPç¨‹åºï¼‰\næˆ‘ä»¬é€šè¿‡AOPå…¥é—¨ç¨‹åºå®Œæˆäº†ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œè€—æ—¶çš„ç»Ÿè®¡ï¼Œé‚£å…¶å®AOPçš„åŠŸèƒ½è¿œä¸æ­¢äºæ­¤ï¼Œå¸¸è§çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š\nè®°å½•ç³»ç»Ÿçš„æ“ä½œæ—¥å¿— æƒé™æ§åˆ¶ äº‹åŠ¡ç®¡ç†ï¼šæˆ‘ä»¬å‰é¢æ‰€è®²è§£çš„Springäº‹åŠ¡ç®¡ç†ï¼Œåº•å±‚å…¶å®ä¹Ÿæ˜¯é€šè¿‡AOPæ¥å®ç°çš„ï¼Œåªè¦æ·»åŠ @Transactionalæ³¨è§£ä¹‹åï¼ŒAOPç¨‹åºè‡ªåŠ¨ä¼šåœ¨åŸå§‹æ–¹æ³•è¿è¡Œå‰å…ˆæ¥å¼€å¯äº‹åŠ¡ï¼Œåœ¨åŸå§‹æ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åæäº¤æˆ–å›æ»šäº‹åŠ¡ è¿™äº›éƒ½æ˜¯AOPåº”ç”¨çš„å…¸å‹åœºæ™¯ã€‚\né€šè¿‡å…¥é—¨ç¨‹åºï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æ„Ÿå—åˆ°äº†AOPé¢å‘åˆ‡é¢ç¼–ç¨‹çš„ä¸€äº›ä¼˜åŠ¿ï¼š\nä»£ç æ— ä¾µå…¥ï¼šæ²¡æœ‰ä¿®æ”¹åŸå§‹çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå°±å·²ç»å¯¹åŸå§‹çš„ä¸šåŠ¡æ–¹æ³•è¿›è¡Œäº†åŠŸèƒ½çš„å¢å¼ºæˆ–è€…æ˜¯åŠŸèƒ½çš„æ”¹å˜ å‡å°‘äº†é‡å¤ä»£ç  æé«˜å¼€å‘æ•ˆç‡ ç»´æŠ¤æ–¹ä¾¿ AOPåŸºç¡€-æ ¸å¿ƒæ¦‚å¿µ é€šè¿‡SpringAOPçš„å¿«é€Ÿå…¥é—¨ï¼Œæ„Ÿå—äº†ä¸€ä¸‹AOPé¢å‘åˆ‡é¢ç¼–ç¨‹çš„å¼€å‘æ–¹å¼ã€‚ä¸‹é¢æˆ‘ä»¬å†æ¥å­¦ä¹ AOPå½“ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›æ ¸å¿ƒæ¦‚å¿µã€‚\n1. è¿æ¥ç‚¹ï¼šJoinPointï¼Œå¯ä»¥è¢«AOPæ§åˆ¶çš„æ–¹æ³•ï¼ˆæš—å«æ–¹æ³•æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼‰\nè¿æ¥ç‚¹æŒ‡çš„æ˜¯å¯ä»¥è¢«aopæ§åˆ¶çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼šå…¥é—¨ç¨‹åºå½“ä¸­æ‰€æœ‰çš„ä¸šåŠ¡æ–¹æ³•éƒ½æ˜¯å¯ä»¥è¢«aopæ§åˆ¶çš„æ–¹æ³•\nåœ¨SpringAOPæä¾›çš„JoinPointå½“ä¸­ï¼Œå°è£…äº†è¿æ¥ç‚¹æ–¹æ³•åœ¨æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚ï¼ˆåé¢ä¼šæœ‰å…·ä½“çš„è®²è§£ï¼‰\n2. é€šçŸ¥ï¼šAdviceï¼ŒæŒ‡å“ªäº›é‡å¤çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å…±æ€§åŠŸèƒ½ï¼ˆæœ€ç»ˆä½“ç°ä¸ºä¸€ä¸ªæ–¹æ³•ï¼‰\nåœ¨å…¥é—¨ç¨‹åºä¸­æ˜¯éœ€è¦ç»Ÿè®¡å„ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨è¿™äº›ä¸šåŠ¡æ–¹æ³•è¿è¡Œå¼€å§‹ä¹‹å‰ï¼Œå…ˆè®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„å¼€å§‹æ—¶é—´ï¼Œåœ¨æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•è¿è¡Œç»“æŸçš„æ—¶å€™ï¼Œå†æ¥è®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„ç»“æŸæ—¶é—´ã€‚\nä½†æ˜¯åœ¨AOPé¢å‘åˆ‡é¢ç¼–ç¨‹å½“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™éƒ¨åˆ†é‡å¤çš„ä»£ç é€»è¾‘æŠ½å–å‡ºæ¥å•ç‹¬å®šä¹‰ã€‚æŠ½å–å‡ºæ¥çš„è¿™ä¸€éƒ¨åˆ†é‡å¤çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å…±æ€§çš„åŠŸèƒ½ã€‚\n3. åˆ‡å…¥ç‚¹ï¼šPointCutï¼ŒåŒ¹é…è¿æ¥ç‚¹çš„æ¡ä»¶ï¼Œé€šçŸ¥ä»…ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œæ—¶è¢«åº”ç”¨\nåœ¨é€šçŸ¥å½“ä¸­ï¼Œæˆ‘ä»¬æ‰€å®šä¹‰çš„å…±æ€§åŠŸèƒ½åˆ°åº•è¦åº”ç”¨åœ¨å“ªäº›æ–¹æ³•ä¸Šï¼Ÿæ­¤æ—¶å°±æ¶‰åŠåˆ°äº†åˆ‡å…¥ç‚¹pointcutæ¦‚å¿µã€‚åˆ‡å…¥ç‚¹æŒ‡çš„æ˜¯åŒ¹é…è¿æ¥ç‚¹çš„æ¡ä»¶ã€‚é€šçŸ¥ä»…ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•è¿è¡Œæ—¶æ‰ä¼šè¢«åº”ç”¨ã€‚\nåœ¨aopçš„å¼€å‘å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡ä¸€ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥æè¿°åˆ‡å…¥ç‚¹(åé¢ä¼šæœ‰è¯¦è§£)ã€‚\nå‡å¦‚ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ”¹ä¸ºDeptServiceImpl.list()ï¼Œæ­¤æ—¶å°±ä»£è¡¨ä»…ä»…åªæœ‰listè¿™ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ‡å…¥ç‚¹ã€‚åªæœ‰list()æ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™æ‰ä¼šåº”ç”¨é€šçŸ¥ã€‚\n4. åˆ‡é¢ï¼šAspectï¼Œæè¿°é€šçŸ¥ä¸åˆ‡å…¥ç‚¹çš„å¯¹åº”å…³ç³»ï¼ˆé€šçŸ¥+åˆ‡å…¥ç‚¹ï¼‰\nå½“é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ç»“åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªåˆ‡é¢ã€‚é€šè¿‡åˆ‡é¢å°±èƒ½å¤Ÿæè¿°å½“å‰aopç¨‹åºéœ€è¦é’ˆå¯¹äºå“ªä¸ªåŸå§‹æ–¹æ³•ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œä»€ä¹ˆæ ·çš„æ“ä½œã€‚\nåˆ‡é¢æ‰€åœ¨çš„ç±»ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºåˆ‡é¢ç±»ï¼ˆè¢«@Aspectæ³¨è§£æ ‡è¯†çš„ç±»ï¼‰\n5. ç›®æ ‡å¯¹è±¡ï¼šTargetï¼Œé€šçŸ¥æ‰€åº”ç”¨çš„å¯¹è±¡\nç›®æ ‡å¯¹è±¡æŒ‡çš„å°±æ˜¯é€šçŸ¥æ‰€åº”ç”¨çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºç›®æ ‡å¯¹è±¡ã€‚\nAOPçš„æ ¸å¿ƒæ¦‚å¿µæˆ‘ä»¬ä»‹ç»å®Œæ¯•ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹æˆ‘ä»¬æ‰€å®šä¹‰çš„é€šçŸ¥æ˜¯å¦‚ä½•ä¸ç›®æ ‡å¯¹è±¡ç»“åˆåœ¨ä¸€èµ·ï¼Œå¯¹ç›®æ ‡å¯¹è±¡å½“ä¸­çš„æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¢å¼ºçš„ã€‚\nSpringçš„AOPåº•å±‚æ˜¯åŸºäºåŠ¨æ€ä»£ç†æŠ€æœ¯æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨çš„åŸºäºåŠ¨æ€ä»£ç†æŠ€æœ¯ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ä»£ç†å¯¹è±¡ã€‚åœ¨ä»£ç†å¯¹è±¡å½“ä¸­å°±ä¼šå¯¹ç›®æ ‡å¯¹è±¡å½“ä¸­çš„åŸå§‹æ–¹æ³•è¿›è¡ŒåŠŸèƒ½çš„å¢å¼ºã€‚\nAOPè¿›é˜¶-é€šçŸ¥ç±»å‹ åœ¨å…¥é—¨ç¨‹åºå½“ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸€ç§åŠŸèƒ½æœ€ä¸ºå¼ºå¤§çš„é€šçŸ¥ç±»å‹ï¼šAroundç¯ç»•é€šçŸ¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 @Around(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public Object recordTime(ProceedingJoinPoint pjp) throws Throwable { //è®°å½•æ–¹æ³•æ‰§è¡Œå¼€å§‹æ—¶é—´ long begin = System.currentTimeMillis(); //æ‰§è¡ŒåŸå§‹æ–¹æ³• Object result = pjp.proceed(); //è®°å½•æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶é—´ long end = System.currentTimeMillis(); //è®¡ç®—æ–¹æ³•æ‰§è¡Œè€—æ—¶ log.info(pjp.getSignature()+\u0026#34;æ‰§è¡Œè€—æ—¶: {}æ¯«ç§’\u0026#34;,end-begin); return result; } åªè¦æˆ‘ä»¬åœ¨é€šçŸ¥æ–¹æ³•ä¸ŠåŠ ä¸Šäº†@Aroundæ³¨è§£ï¼Œå°±ä»£è¡¨å½“å‰é€šçŸ¥æ˜¯ä¸€ä¸ªç¯ç»•é€šçŸ¥ã€‚\nSpringä¸­AOPçš„é€šçŸ¥ç±»å‹ï¼š\n@Aroundï¼šç¯ç»•é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å‰ã€åéƒ½è¢«æ‰§è¡Œ @Beforeï¼šå‰ç½®é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å‰è¢«æ‰§è¡Œ @After ï¼šåç½®é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•åè¢«æ‰§è¡Œï¼Œæ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ @AfterReturning ï¼š è¿”å›åé€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•åè¢«æ‰§è¡Œï¼Œæœ‰å¼‚å¸¸ä¸ä¼šæ‰§è¡Œ @AfterThrowing ï¼š å¼‚å¸¸åé€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•å‘ç”Ÿå¼‚å¸¸åæ‰§è¡Œ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¼”ç¤ºï¼Œæ¥åŠ æ·±å¯¹äºä¸åŒé€šçŸ¥ç±»å‹çš„ç†è§£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @Slf4j @Component @Aspect public class MyAspect1 { //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void before(JoinPoint joinPoint){ log.info(\u0026#34;before ...\u0026#34;); } //ç¯ç»•é€šçŸ¥ @Around(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public Object around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable { log.info(\u0026#34;around before ...\u0026#34;); //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•æ‰§è¡Œ Object result = proceedingJoinPoint.proceed(); //åŸå§‹æ–¹æ³•å¦‚æœæ‰§è¡Œæ—¶æœ‰å¼‚å¸¸ï¼Œç¯ç»•é€šçŸ¥ä¸­çš„åç½®ä»£ç ä¸ä¼šåœ¨æ‰§è¡Œäº† log.info(\u0026#34;around after ...\u0026#34;); return result; } //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void after(JoinPoint joinPoint){ log.info(\u0026#34;after ...\u0026#34;); } //è¿”å›åé€šçŸ¥ï¼ˆç¨‹åºåœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰ @AfterReturning(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void afterReturning(JoinPoint joinPoint){ log.info(\u0026#34;afterReturning ...\u0026#34;); } //å¼‚å¸¸é€šçŸ¥ï¼ˆç¨‹åºåœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰ @AfterThrowing(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void afterThrowing(JoinPoint joinPoint){ log.info(\u0026#34;afterThrowing ...\u0026#34;); } } é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œè¿›è¡Œæµ‹è¯•ï¼š\n1. æ²¡æœ‰å¼‚å¸¸æƒ…å†µä¸‹ï¼š\nä½¿ç”¨postmanæµ‹è¯•æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ® æŸ¥çœ‹ideaä¸­æ§åˆ¶å°æ—¥å¿—è¾“å‡º\nç¨‹åºæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œ@AfterThrowingæ ‡è¯†çš„é€šçŸ¥æ–¹æ³•ä¸ä¼šæ‰§è¡Œã€‚\n2. å‡ºç°å¼‚å¸¸æƒ…å†µä¸‹ï¼š\nä¿®æ”¹DeptServiceImplä¸šåŠ¡å®ç°ç±»ä¸­çš„ä»£ç ï¼š æ·»åŠ å¼‚å¸¸\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @Slf4j @Service public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Override public List\u0026lt;Dept\u0026gt; list() { List\u0026lt;Dept\u0026gt; deptList = deptMapper.list(); //æ¨¡æ‹Ÿå¼‚å¸¸ int num = 10/0; return deptList; } //çœç•¥å…¶ä»–ä»£ç ... } é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•å‘ç”Ÿå¼‚å¸¸æƒ…å†µä¸‹é€šçŸ¥çš„æ‰§è¡Œï¼š\næŸ¥çœ‹ideaä¸­æ§åˆ¶å°æ—¥å¿—è¾“å‡º ç¨‹åºå‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼š\n@AfterReturningæ ‡è¯†çš„é€šçŸ¥æ–¹æ³•ä¸ä¼šæ‰§è¡Œï¼Œ@AfterThrowingæ ‡è¯†çš„é€šçŸ¥æ–¹æ³•æ‰§è¡Œäº† @Aroundç¯ç»•é€šçŸ¥ä¸­åŸå§‹æ–¹æ³•è°ƒç”¨æ—¶æœ‰å¼‚å¸¸ï¼Œé€šçŸ¥ä¸­çš„ç¯ç»•åçš„ä»£ç é€»è¾‘ä¹Ÿä¸ä¼šåœ¨æ‰§è¡Œäº† ï¼ˆå› ä¸ºåŸå§‹æ–¹æ³•è°ƒç”¨å·²ç»å‡ºå¼‚å¸¸äº†ï¼‰ åœ¨ä½¿ç”¨é€šçŸ¥æ—¶çš„æ³¨æ„äº‹é¡¹ï¼š\n@Aroundç¯ç»•é€šçŸ¥éœ€è¦è‡ªå·±è°ƒç”¨ ProceedingJoinPoint.proceed() æ¥è®©åŸå§‹æ–¹æ³•æ‰§è¡Œï¼Œå…¶ä»–é€šçŸ¥ä¸éœ€è¦è€ƒè™‘ç›®æ ‡æ–¹æ³•æ‰§è¡Œ @Aroundç¯ç»•é€šçŸ¥æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¿…é¡»æŒ‡å®šä¸ºObjectï¼Œæ¥æ¥æ”¶åŸå§‹æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¦åˆ™åŸå§‹æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ˜¯è·å–ä¸åˆ°è¿”å›å€¼çš„ã€‚ äº”ç§å¸¸è§çš„é€šçŸ¥ç±»å‹ï¼Œæˆ‘ä»¬å·²ç»æµ‹è¯•å®Œæ¯•äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹åˆšæ‰æ‰€ç¼–å†™çš„ä»£ç ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) //ç¯ç»•é€šçŸ¥ @Around(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) //è¿”å›åé€šçŸ¥ï¼ˆç¨‹åºåœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰ @AfterReturning(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) //å¼‚å¸¸é€šçŸ¥ï¼ˆç¨‹åºåœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰ @AfterThrowing(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) æˆ‘ä»¬å‘ç°å•Šï¼Œæ¯ä¸€ä¸ªæ³¨è§£é‡Œé¢éƒ½æŒ‡å®šäº†åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œè€Œä¸”è¿™äº›åˆ‡å…¥ç‚¹è¡¨è¾¾å¼éƒ½ä¸€æ¨¡ä¸€æ ·ã€‚æ­¤æ—¶æˆ‘ä»¬çš„ä»£ç å½“ä¸­å°±å­˜åœ¨äº†å¤§é‡çš„é‡å¤æ€§çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå‡å¦‚æ­¤æ—¶åˆ‡å…¥ç‚¹è¡¨è¾¾å¼éœ€è¦å˜åŠ¨ï¼Œå°±éœ€è¦å°†æ‰€æœ‰çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸€ä¸ªä¸€ä¸ªçš„æ¥æ”¹åŠ¨ï¼Œå°±å˜å¾—éå¸¸ç¹çäº†ã€‚\næ€ä¹ˆæ¥è§£å†³è¿™ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡å¤çš„é—®é¢˜ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ï¼šæŠ½å–\nSpringæä¾›äº†@PointCutæ³¨è§£ï¼Œè¯¥æ³¨è§£çš„ä½œç”¨æ˜¯å°†å…¬å…±çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æŠ½å–å‡ºæ¥ï¼Œéœ€è¦ç”¨åˆ°æ—¶å¼•ç”¨è¯¥åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 @Slf4j @Component @Aspect public class MyAspect1 { //åˆ‡å…¥ç‚¹æ–¹æ³•ï¼ˆå…¬å…±çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼‰ @Pointcut(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) private void pt(){ } //å‰ç½®é€šçŸ¥ï¼ˆå¼•ç”¨åˆ‡å…¥ç‚¹ï¼‰ @Before(\u0026#34;pt()\u0026#34;) public void before(JoinPoint joinPoint){ log.info(\u0026#34;before ...\u0026#34;); } //ç¯ç»•é€šçŸ¥ @Around(\u0026#34;pt()\u0026#34;) public Object around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable { log.info(\u0026#34;around before ...\u0026#34;); //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•æ‰§è¡Œ Object result = proceedingJoinPoint.proceed(); //åŸå§‹æ–¹æ³•åœ¨æ‰§è¡Œæ—¶ï¼šå‘ç”Ÿå¼‚å¸¸ //åç»­ä»£ç ä¸åœ¨æ‰§è¡Œ log.info(\u0026#34;around after ...\u0026#34;); return result; } //åç½®é€šçŸ¥ @After(\u0026#34;pt()\u0026#34;) public void after(JoinPoint joinPoint){ log.info(\u0026#34;after ...\u0026#34;); } //è¿”å›åé€šçŸ¥ï¼ˆç¨‹åºåœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰ @AfterReturning(\u0026#34;pt()\u0026#34;) public void afterReturning(JoinPoint joinPoint){ log.info(\u0026#34;afterReturning ...\u0026#34;); } //å¼‚å¸¸é€šçŸ¥ï¼ˆç¨‹åºåœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰ @AfterThrowing(\u0026#34;pt()\u0026#34;) public void afterThrowing(JoinPoint joinPoint){ log.info(\u0026#34;afterThrowing ...\u0026#34;); } } éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå½“åˆ‡å…¥ç‚¹æ–¹æ³•ä½¿ç”¨privateä¿®é¥°æ—¶ï¼Œä»…èƒ½åœ¨å½“å‰åˆ‡é¢ç±»ä¸­å¼•ç”¨è¯¥è¡¨è¾¾å¼ï¼Œ å½“å¤–éƒ¨å…¶ä»–åˆ‡é¢ç±»ä¸­ä¹Ÿè¦å¼•ç”¨å½“å‰ç±»ä¸­çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå°±éœ€è¦æŠŠprivateæ”¹ä¸ºpublicï¼Œè€Œåœ¨å¼•ç”¨çš„æ—¶å€™ï¼Œå…·ä½“çš„è¯­æ³•ä¸ºï¼š\nå…¨ç±»å.æ–¹æ³•å()ï¼Œå…·ä½“å½¢å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 @Slf4j @Component @Aspect public class MyAspect2 { //å¼•ç”¨MyAspect1åˆ‡é¢ç±»ä¸­çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ @Before(\u0026#34;com.itheima.aspect.MyAspect1.pt()\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect2 -\u0026gt; before ...\u0026#34;); } } AOPè¿›é˜¶-é€šçŸ¥é¡ºåº è®²è§£å®Œäº†Springä¸­AOPæ‰€æ”¯æŒçš„5ç§é€šçŸ¥ç±»å‹ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥ç ”ç©¶é€šçŸ¥çš„æ‰§è¡Œé¡ºåºã€‚\nå½“åœ¨é¡¹ç›®å¼€å‘å½“ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¤šä¸ªåˆ‡é¢ç±»ï¼Œè€Œå¤šä¸ªåˆ‡é¢ç±»ä¸­å¤šä¸ªåˆ‡å…¥ç‚¹éƒ½åŒ¹é…åˆ°äº†åŒä¸€ä¸ªç›®æ ‡æ–¹æ³•ã€‚æ­¤æ—¶å½“ç›®æ ‡æ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œè¿™å¤šä¸ªåˆ‡é¢ç±»å½“ä¸­çš„è¿™äº›é€šçŸ¥æ–¹æ³•éƒ½ä¼šè¿è¡Œã€‚\næ­¤æ—¶æˆ‘ä»¬å°±æœ‰ä¸€ä¸ªç–‘é—®ï¼Œè¿™å¤šä¸ªé€šçŸ¥æ–¹æ³•åˆ°åº•å“ªä¸ªå…ˆè¿è¡Œï¼Œå“ªä¸ªåè¿è¡Œï¼Ÿ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºæ¥éªŒè¯ï¼ˆè¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬å°±å®šä¹‰ä¸¤ç§ç±»å‹çš„é€šçŸ¥è¿›è¡Œæµ‹è¯•ï¼Œä¸€ç§æ˜¯å‰ç½®é€šçŸ¥@Beforeï¼Œä¸€ç§æ˜¯åç½®é€šçŸ¥@Afterï¼‰\nå®šä¹‰å¤šä¸ªåˆ‡é¢ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Slf4j @Component @Aspect public class MyAspect2 { //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect2 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void after(){ log.info(\u0026#34;MyAspect2 -\u0026gt; after ...\u0026#34;); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Slf4j @Component @Aspect public class MyAspect3 { //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect3 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void after(){ log.info(\u0026#34;MyAspect3 -\u0026gt; after ...\u0026#34;); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Slf4j @Component @Aspect public class MyAspect4 { //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect4 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void after(){ log.info(\u0026#34;MyAspect4 -\u0026gt; after ...\u0026#34;); } } é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼š\nå¤‡æ³¨ï¼š\næŠŠDeptServiceImplå®ç°ç±»ä¸­æ¨¡æ‹Ÿå¼‚å¸¸çš„ä»£ç åˆ é™¤æˆ–æ³¨é‡Šæ‰ã€‚ æ³¨é‡Šæ‰å…¶ä»–åˆ‡é¢ç±»(æŠŠ@Aspectæ³¨é‡Šå³å¯)ï¼Œä»…ä¿ç•™MyAspect2ã€MyAspect3ã€MyAspect4 ï¼Œè¿™æ ·å°±å¯ä»¥æ¸…æ™°çœ‹åˆ°æ‰§è¡Œçš„ç»“æœï¼Œè€Œä¸è¢«å…¶ä»–åˆ‡é¢ç±»å¹²æ‰°ã€‚ ä½¿ç”¨postmanæµ‹è¯•æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ® æŸ¥çœ‹ideaä¸­æ§åˆ¶å°æ—¥å¿—è¾“å‡º\né€šè¿‡ä»¥ä¸Šç¨‹åºè¿è¡Œå¯ä»¥çœ‹å‡ºåœ¨ä¸åŒåˆ‡é¢ç±»ä¸­ï¼Œé»˜è®¤æŒ‰ç…§åˆ‡é¢ç±»çš„ç±»åå­—æ¯æ’åºï¼š\nç›®æ ‡æ–¹æ³•å‰çš„é€šçŸ¥æ–¹æ³•ï¼šå­—æ¯æ’åé å‰çš„å…ˆæ‰§è¡Œ ç›®æ ‡æ–¹æ³•åçš„é€šçŸ¥æ–¹æ³•ï¼šå­—æ¯æ’åé å‰çš„åæ‰§è¡Œ å¦‚æœæˆ‘ä»¬æƒ³æ§åˆ¶é€šçŸ¥çš„æ‰§è¡Œé¡ºåºæœ‰ä¸¤ç§æ–¹å¼ï¼š\nä¿®æ”¹åˆ‡é¢ç±»çš„ç±»åï¼ˆè¿™ç§æ–¹å¼éå¸¸ç¹çã€è€Œä¸”ä¸ä¾¿ç®¡ç†ï¼‰ ä½¿ç”¨Springæä¾›çš„@Orderæ³¨è§£ ä½¿ç”¨@Orderæ³¨è§£ï¼Œæ§åˆ¶é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Slf4j @Component @Aspect @Order(2) //åˆ‡é¢ç±»çš„æ‰§è¡Œé¡ºåºï¼ˆå‰ç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°å…ˆæ‰§è¡Œ; åç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°è¶Šåæ‰§è¡Œï¼‰ public class MyAspect2 { //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect2 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void after(){ log.info(\u0026#34;MyAspect2 -\u0026gt; after ...\u0026#34;); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Slf4j @Component @Aspect @Order(3) //åˆ‡é¢ç±»çš„æ‰§è¡Œé¡ºåºï¼ˆå‰ç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°å…ˆæ‰§è¡Œ; åç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°è¶Šåæ‰§è¡Œï¼‰ public class MyAspect3 { //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect3 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void after(){ log.info(\u0026#34;MyAspect3 -\u0026gt; after ...\u0026#34;); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Slf4j @Component @Aspect @Order(1) //åˆ‡é¢ç±»çš„æ‰§è¡Œé¡ºåºï¼ˆå‰ç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°å…ˆæ‰§è¡Œ; åç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°è¶Šåæ‰§è¡Œï¼‰ public class MyAspect4 { //å‰ç½®é€šçŸ¥ @Before(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect4 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @After(\u0026#34;execution(* com.itheima.service.*.*(..))\u0026#34;) public void after(){ log.info(\u0026#34;MyAspect4 -\u0026gt; after ...\u0026#34;); } } é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•é€šçŸ¥æ‰§è¡Œé¡ºåºï¼š\né€šçŸ¥çš„æ‰§è¡Œé¡ºåºå¤§å®¶ä¸»è¦çŸ¥é“ä¸¤ç‚¹å³å¯ï¼š\nä¸åŒçš„åˆ‡é¢ç±»å½“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹é€šçŸ¥çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸åˆ‡é¢ç±»çš„ç±»åå­—æ¯æ’åºæ˜¯æœ‰å…³ç³»çš„ å¯ä»¥åœ¨åˆ‡é¢ç±»ä¸Šé¢åŠ ä¸Š@Orderæ³¨è§£ï¼Œæ¥æ§åˆ¶ä¸åŒçš„åˆ‡é¢ç±»é€šçŸ¥çš„æ‰§è¡Œé¡ºåº AOPè¿›é˜¶-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼-execution ä»AOPçš„å…¥é—¨ç¨‹åºåˆ°ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€ç›´éƒ½åœ¨ä½¿ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥æè¿°åˆ‡å…¥ç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å…·ä½“å†™æ³•ã€‚\nåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼š\næè¿°åˆ‡å…¥ç‚¹æ–¹æ³•çš„ä¸€ç§è¡¨è¾¾å¼ ä½œç”¨ï¼šä¸»è¦ç”¨æ¥å†³å®šé¡¹ç›®ä¸­çš„å“ªäº›æ–¹æ³•éœ€è¦åŠ å…¥é€šçŸ¥ å¸¸è§å½¢å¼ï¼š execution(â€¦â€¦)ï¼šæ ¹æ®æ–¹æ³•çš„ç­¾åæ¥åŒ¹é… 2. @annotation(â€¦â€¦) ï¼šæ ¹æ®æ³¨è§£åŒ¹é…\né¦–å…ˆæˆ‘ä»¬å…ˆå­¦ä¹ ç¬¬ä¸€ç§æœ€ä¸ºå¸¸è§çš„executionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚\nexecutionä¸»è¦æ ¹æ®æ–¹æ³•çš„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯æ¥åŒ¹é…ï¼Œè¯­æ³•ä¸ºï¼š\n1 execution(è®¿é—®ä¿®é¥°ç¬¦? è¿”å›å€¼ åŒ…å.ç±»å.?æ–¹æ³•å(æ–¹æ³•å‚æ•°) throws å¼‚å¸¸?) å…¶ä¸­å¸¦?çš„è¡¨ç¤ºå¯ä»¥çœç•¥çš„éƒ¨åˆ†\nè®¿é—®ä¿®é¥°ç¬¦ï¼šå¯çœç•¥ï¼ˆæ¯”å¦‚: publicã€protectedï¼‰ åŒ…å.ç±»åï¼š å¯çœç•¥ throws å¼‚å¸¸ï¼šå¯çœç•¥ï¼ˆæ³¨æ„æ˜¯æ–¹æ³•ä¸Šå£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸æ˜¯å®é™…æŠ›å‡ºçš„å¼‚å¸¸ï¼‰ ç¤ºä¾‹ï¼š\n1 @Before(\u0026#34;execution(void com.itheima.service.impl.DeptServiceImpl.delete(java.lang.Integer))\u0026#34;) å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æè¿°åˆ‡å…¥ç‚¹\n* ï¼šå•ä¸ªç‹¬ç«‹çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€ä»»æ„ç±»å‹çš„ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šé…åŒ…ã€ç±»ã€æ–¹æ³•åçš„ä¸€éƒ¨åˆ† .. ï¼šå¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„å±‚çº§çš„åŒ…ï¼Œæˆ–ä»»æ„ç±»å‹ã€ä»»æ„ä¸ªæ•°çš„å‚æ•° åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•è§„åˆ™ï¼š\næ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥ è¿”å›å€¼å¯ä»¥ä½¿ç”¨*å·ä»£æ›¿ï¼ˆä»»æ„è¿”å›å€¼ç±»å‹ï¼‰ åŒ…åå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿ï¼Œä»£è¡¨ä»»æ„åŒ…ï¼ˆä¸€å±‚åŒ…ä½¿ç”¨ä¸€ä¸ª*ï¼‰ ä½¿ç”¨..é…ç½®åŒ…åï¼Œæ ‡è¯†æ­¤åŒ…ä»¥åŠæ­¤åŒ…ä¸‹çš„æ‰€æœ‰å­åŒ… ç±»åå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿ï¼Œæ ‡è¯†ä»»æ„ç±» æ–¹æ³•åå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿ï¼Œè¡¨ç¤ºä»»æ„æ–¹æ³• å¯ä»¥ä½¿ç”¨ * é…ç½®å‚æ•°ï¼Œä¸€ä¸ªä»»æ„ç±»å‹çš„å‚æ•° å¯ä»¥ä½¿ç”¨.. é…ç½®å‚æ•°ï¼Œä»»æ„ä¸ªä»»æ„ç±»å‹çš„å‚æ•° åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ç¤ºä¾‹\nçœç•¥æ–¹æ³•çš„ä¿®é¥°ç¬¦å· 1 execution(void com.itheima.service.impl.DeptServiceImpl.delete(java.lang.Integer)) ä½¿ç”¨*ä»£æ›¿è¿”å›å€¼ç±»å‹ 1 execution(* com.itheima.service.impl.DeptServiceImpl.delete(java.lang.Integer)) ä½¿ç”¨*ä»£æ›¿åŒ…åï¼ˆä¸€å±‚åŒ…ä½¿ç”¨ä¸€ä¸ª*ï¼‰ 1 execution(* com.itheima.*.*.DeptServiceImpl.delete(java.lang.Integer)) ä½¿ç”¨..çœç•¥åŒ…å 1 execution(* com..DeptServiceImpl.delete(java.lang.Integer)) ä½¿ç”¨*ä»£æ›¿ç±»å 1 execution(* com..*.delete(java.lang.Integer)) ä½¿ç”¨*ä»£æ›¿æ–¹æ³•å 1 execution(* com..*.*(java.lang.Integer)) ä½¿ç”¨ * ä»£æ›¿å‚æ•° 1 execution(* com.itheima.service.impl.DeptServiceImpl.delete(*)) ä½¿ç”¨..çœç•¥å‚æ•° 1 execution(* com..*.*(..)) æ³¨æ„äº‹é¡¹ï¼š\næ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ ä¸”ï¼ˆ\u0026amp;\u0026amp;ï¼‰ã€æˆ–ï¼ˆ||ï¼‰ã€éï¼ˆ!ï¼‰ æ¥ç»„åˆæ¯”è¾ƒå¤æ‚çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚ 1 execution(* com.itheima.service.DeptService.list(..)) || execution(* com.itheima.service.DeptService.delete(..)) åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„ä¹¦å†™å»ºè®®ï¼š\næ‰€æœ‰ä¸šåŠ¡æ–¹æ³•ååœ¨å‘½åæ—¶å°½é‡è§„èŒƒï¼Œæ–¹ä¾¿åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å¿«é€ŸåŒ¹é…ã€‚å¦‚ï¼šæŸ¥è¯¢ç±»æ–¹æ³•éƒ½æ˜¯ find å¼€å¤´ï¼Œæ›´æ–°ç±»æ–¹æ³•éƒ½æ˜¯updateå¼€å¤´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 //ä¸šåŠ¡ç±» @Service public class DeptServiceImpl implements DeptService { public List\u0026lt;Dept\u0026gt; findAllDept() { //çœç•¥ä»£ç ... } public Dept findDeptById(Integer id) { //çœç•¥ä»£ç ... } public void updateDeptById(Integer id) { //çœç•¥ä»£ç ... } public void updateDeptByMoreCondition(Dept dept) { //çœç•¥ä»£ç ... } //å…¶ä»–ä»£ç ... } 1 2 //åŒ¹é…DeptServiceImplç±»ä¸­ä»¥findå¼€å¤´çš„æ–¹æ³• execution(* com.itheima.service.impl.DeptServiceImpl.find*(..)) æè¿°åˆ‡å…¥ç‚¹æ–¹æ³•é€šå¸¸åŸºäºæ¥å£æè¿°ï¼Œè€Œä¸æ˜¯ç›´æ¥æè¿°å®ç°ç±»ï¼Œå¢å¼ºæ‹“å±•æ€§ 1 execution(* com.itheima.service.DeptService.*(..)) åœ¨æ»¡è¶³ä¸šåŠ¡éœ€è¦çš„å‰æä¸‹ï¼Œå°½é‡ç¼©å°åˆ‡å…¥ç‚¹çš„åŒ¹é…èŒƒå›´ã€‚å¦‚ï¼šåŒ…ååŒ¹é…å°½é‡ä¸ä½¿ç”¨ ..ï¼Œä½¿ç”¨ * åŒ¹é…å•ä¸ªåŒ… 1 execution(* com.itheima.*.*.DeptServiceImpl.find*(..)) AOPè¿›é˜¶-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼-@annotation å·²ç»å­¦ä¹ äº†executionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦åŒ¹é…å¤šä¸ªæ— è§„åˆ™çš„æ–¹æ³•ï¼Œæ¯”å¦‚ï¼šlist()å’Œ delete()è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åŸºäºexecutionè¿™ç§åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥æè¿°å°±ä¸æ˜¯å¾ˆæ–¹ä¾¿äº†ã€‚è€Œåœ¨ä¹‹å‰æˆ‘ä»¬æ˜¯å°†ä¸¤ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ç»„åˆåœ¨äº†ä¸€èµ·å®Œæˆçš„éœ€æ±‚ï¼Œè¿™ä¸ªæ˜¯æ¯”è¾ƒç¹ççš„ã€‚\næˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºå¦ä¸€ç§åˆ‡å…¥ç‚¹è¡¨è¾¾å¼annotationæ¥æè¿°è¿™ä¸€ç±»çš„åˆ‡å…¥ç‚¹ï¼Œä»è€Œæ¥ç®€åŒ–åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„ä¹¦å†™ã€‚\nå®ç°æ­¥éª¤ï¼š\nç¼–å†™è‡ªå®šä¹‰æ³¨è§£ åœ¨ä¸šåŠ¡ç±»è¦åšä¸ºè¿æ¥ç‚¹çš„æ–¹æ³•ä¸Šæ·»åŠ è‡ªå®šä¹‰æ³¨è§£ è‡ªå®šä¹‰æ³¨è§£ï¼šMyLog\n1 2 3 4 @Target(ElementType.METHOD) @Retention(RetentionPolicy.RUNTIME) public @interface MyLog { } ä¸šåŠ¡ç±»ï¼šDeptServiceImpl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 @Slf4j @Service public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Override @MyLog //è‡ªå®šä¹‰æ³¨è§£ï¼ˆè¡¨ç¤ºï¼šå½“å‰æ–¹æ³•å±äºç›®æ ‡æ–¹æ³•ï¼‰ public List\u0026lt;Dept\u0026gt; list() { List\u0026lt;Dept\u0026gt; deptList = deptMapper.list(); //æ¨¡æ‹Ÿå¼‚å¸¸ //int num = 10/0; return deptList; } @Override @MyLog //è‡ªå®šä¹‰æ³¨è§£ï¼ˆè¡¨ç¤ºï¼šå½“å‰æ–¹æ³•å±äºç›®æ ‡æ–¹æ³•ï¼‰ public void delete(Integer id) { //1. åˆ é™¤éƒ¨é—¨ deptMapper.delete(id); } @Override public void save(Dept dept) { dept.setCreateTime(LocalDateTime.now()); dept.setUpdateTime(LocalDateTime.now()); deptMapper.save(dept); } @Override public Dept getById(Integer id) { return deptMapper.getById(id); } @Override public void update(Dept dept) { dept.setUpdateTime(LocalDateTime.now()); deptMapper.update(dept); } } åˆ‡é¢ç±»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @Slf4j @Component @Aspect public class MyAspect6 { //é’ˆå¯¹listæ–¹æ³•ã€deleteæ–¹æ³•è¿›è¡Œå‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ //å‰ç½®é€šçŸ¥ @Before(\u0026#34;@annotation(com.itheima.anno.MyLog)\u0026#34;) public void before(){ log.info(\u0026#34;MyAspect6 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @After(\u0026#34;@annotation(com.itheima.anno.MyLog)\u0026#34;) public void after(){ log.info(\u0026#34;MyAspect6 -\u0026gt; after ...\u0026#34;); } } é‡å¯SpringBootæœåŠ¡ï¼Œæµ‹è¯•æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š\nåˆ°æ­¤æˆ‘ä»¬ä¸¤ç§å¸¸è§çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æˆ‘å·²ç»ä»‹ç»å®Œäº†ã€‚\nexecutionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ æ ¹æ®æˆ‘ä»¬æ‰€æŒ‡å®šçš„æ–¹æ³•çš„æè¿°ä¿¡æ¯æ¥åŒ¹é…åˆ‡å…¥ç‚¹æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ€ä¸ºå¸¸ç”¨çš„ä¸€ç§æ–¹å¼ å¦‚æœæˆ‘ä»¬è¦åŒ¹é…çš„åˆ‡å…¥ç‚¹æ–¹æ³•çš„æ–¹æ³•åä¸è§„åˆ™ï¼Œæˆ–è€…æœ‰ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„éœ€æ±‚ï¼Œé€šè¿‡executionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æè¿°æ¯”è¾ƒç¹ç annotation åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ åŸºäºæ³¨è§£çš„æ–¹å¼æ¥åŒ¹é…åˆ‡å…¥ç‚¹æ–¹æ³•ã€‚è¿™ç§æ–¹å¼è™½ç„¶å¤šä¸€æ­¥æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œä½†æ˜¯ç›¸å¯¹æ¥æ¯”è¾ƒçµæ´»ã€‚æˆ‘ä»¬éœ€è¦åŒ¹é…å“ªä¸ªæ–¹æ³•ï¼Œå°±åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šå¯¹åº”çš„æ³¨è§£å°±å¯ä»¥äº† AOPè¿›é˜¶-è¿æ¥ç‚¹ è®²è§£å®Œäº†åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥è®²è§£æœ€åä¸€ä¸ªéƒ¨åˆ†è¿æ¥ç‚¹ã€‚æˆ‘ä»¬å‰é¢åœ¨è®²è§£AOPæ ¸å¿ƒæ¦‚å¿µçš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°è¿‡ä»€ä¹ˆæ˜¯è¿æ¥ç‚¹ï¼Œè¿æ¥ç‚¹å¯ä»¥ç®€å•ç†è§£ä¸ºå¯ä»¥è¢«AOPæ§åˆ¶çš„æ–¹æ³•ã€‚\næˆ‘ä»¬ç›®æ ‡å¯¹è±¡å½“ä¸­æ‰€æœ‰çš„æ–¹æ³•æ˜¯ä¸æ˜¯éƒ½æ˜¯å¯ä»¥è¢«AOPæ§åˆ¶çš„æ–¹æ³•ã€‚è€Œåœ¨SpringAOPå½“ä¸­ï¼Œè¿æ¥ç‚¹åˆç‰¹æŒ‡æ–¹æ³•çš„æ‰§è¡Œã€‚\nåœ¨Springä¸­ç”¨JoinPointæŠ½è±¡äº†è¿æ¥ç‚¹ï¼Œç”¨å®ƒå¯ä»¥è·å¾—æ–¹æ³•æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç›®æ ‡ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰ã€‚\nå¯¹äº@Aroundé€šçŸ¥ï¼Œè·å–è¿æ¥ç‚¹ä¿¡æ¯åªèƒ½ä½¿ç”¨ProceedingJoinPointç±»å‹ å¯¹äºå…¶ä»–å››ç§é€šçŸ¥ï¼Œè·å–è¿æ¥ç‚¹ä¿¡æ¯åªèƒ½ä½¿ç”¨JoinPointï¼Œå®ƒæ˜¯ProceedingJoinPointçš„çˆ¶ç±»å‹ ç¤ºä¾‹ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 @Slf4j @Component @Aspect public class MyAspect7 { @Pointcut(\u0026#34;@annotation(com.itheima.anno.MyLog)\u0026#34;) private void pt(){} //å‰ç½®é€šçŸ¥ @Before(\u0026#34;pt()\u0026#34;) public void before(JoinPoint joinPoint){ log.info(joinPoint.getSignature().getName() + \u0026#34; MyAspect7 -\u0026gt; before ...\u0026#34;); } //åç½®é€šçŸ¥ @Before(\u0026#34;pt()\u0026#34;) public void after(JoinPoint joinPoint){ log.info(joinPoint.getSignature().getName() + \u0026#34; MyAspect7 -\u0026gt; after ...\u0026#34;); } //ç¯ç»•é€šçŸ¥ @Around(\u0026#34;pt()\u0026#34;) public Object around(ProceedingJoinPoint pjp) throws Throwable { //è·å–ç›®æ ‡ç±»å String name = pjp.getTarget().getClass().getName(); log.info(\u0026#34;ç›®æ ‡ç±»åï¼š{}\u0026#34;,name); //ç›®æ ‡æ–¹æ³•å String methodName = pjp.getSignature().getName(); log.info(\u0026#34;ç›®æ ‡æ–¹æ³•åï¼š{}\u0026#34;,methodName); //è·å–æ–¹æ³•æ‰§è¡Œæ—¶éœ€è¦çš„å‚æ•° Object[] args = pjp.getArgs(); log.info(\u0026#34;ç›®æ ‡æ–¹æ³•å‚æ•°ï¼š{}\u0026#34;, Arrays.toString(args)); //æ‰§è¡ŒåŸå§‹æ–¹æ³• Object returnValue = pjp.proceed(); return returnValue; } } é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæ‰§è¡ŒæŸ¥è¯¢éƒ¨é—¨æ•°æ®çš„åŠŸèƒ½ï¼š\nAOPæ¡ˆä¾‹-è®°å½•æ“ä½œæ—¥å¿— éœ€æ±‚ éœ€æ±‚ï¼šå°†æ¡ˆä¾‹ä¸­å¢ã€åˆ ã€æ”¹ç›¸å…³æ¥å£çš„æ“ä½œæ—¥å¿—è®°å½•åˆ°æ•°æ®åº“è¡¨ä¸­\nå°±æ˜¯å½“è®¿é—®éƒ¨é—¨ç®¡ç†å’Œå‘˜å·¥ç®¡ç†å½“ä¸­çš„å¢ã€åˆ ã€æ”¹ç›¸å…³åŠŸèƒ½æ¥å£æ—¶ï¼Œéœ€è¦è¯¦ç»†çš„æ“ä½œæ—¥å¿—ï¼Œå¹¶ä¿å­˜åœ¨æ•°æ®è¡¨ä¸­ï¼Œä¾¿äºåæœŸæ•°æ®è¿½è¸ªã€‚ æ“ä½œæ—¥å¿—ä¿¡æ¯åŒ…å«ï¼š\næ“ä½œäººã€æ“ä½œæ—¶é—´ã€æ‰§è¡Œæ–¹æ³•çš„å…¨ç±»åã€æ‰§è¡Œæ–¹æ³•åã€æ–¹æ³•è¿è¡Œæ—¶å‚æ•°ã€è¿”å›å€¼ã€æ–¹æ³•æ‰§è¡Œæ—¶é•¿ æ‰€è®°å½•çš„æ—¥å¿—ä¿¡æ¯åŒ…æ‹¬å½“å‰æ¥å£çš„æ“ä½œäººæ˜¯è°æ“ä½œçš„ï¼Œä»€ä¹ˆæ—¶é—´ç‚¹æ“ä½œçš„ï¼Œä»¥åŠè®¿é—®çš„æ˜¯å“ªä¸ªç±»å½“ä¸­çš„å“ªä¸ªæ–¹æ³•ï¼Œåœ¨è®¿é—®è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ä¼ å…¥è¿›æ¥çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œè®¿é—®è¿™ä¸ªæ–¹æ³•æœ€ç»ˆæ‹¿åˆ°çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæ•´ä¸ªæ¥å£æ–¹æ³•çš„è¿è¡Œæ—¶é•¿æ˜¯å¤šé•¿æ—¶é—´ã€‚\nåˆ†æ é—®é¢˜1ï¼šé¡¹ç›®å½“ä¸­å¢åˆ æ”¹ç›¸å…³çš„æ–¹æ³•æ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šï¼Ÿ\nå¾ˆå¤š é—®é¢˜2ï¼šæˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªåŠŸèƒ½æ¥å£æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œåœ¨æ¯ä¸€ä¸ªåŠŸèƒ½æ¥å£å½“ä¸­éƒ½æ¥è®°å½•è¿™äº›æ“ä½œæ—¥å¿—å—ï¼Ÿ\nè¿™ç§åšæ³•æ¯”è¾ƒç¹ç ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ä½¿ç”¨AOPè§£å†³(æ¯ä¸€ä¸ªå¢åˆ æ”¹åŠŸèƒ½æ¥å£ä¸­è¦å®ç°çš„è®°å½•æ“ä½œæ—¥å¿—çš„é€»è¾‘ä»£ç æ˜¯ç›¸åŒ)ã€‚\nå¯ä»¥æŠŠè¿™éƒ¨åˆ†è®°å½•æ“ä½œæ—¥å¿—çš„é€šç”¨çš„ã€é‡å¤æ€§çš„é€»è¾‘ä»£ç æŠ½å–å‡ºæ¥å®šä¹‰åœ¨ä¸€ä¸ªé€šçŸ¥æ–¹æ³•å½“ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡AOPé¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ–¹å¼ï¼Œåœ¨ä¸æ”¹åŠ¨åŸå§‹åŠŸèƒ½çš„åŸºç¡€ä¸Šæ¥å¯¹åŸå§‹çš„åŠŸèƒ½è¿›è¡Œå¢å¼ºã€‚ç›®å‰æˆ‘ä»¬æ‰€å¢å¼ºçš„åŠŸèƒ½å°±æ˜¯æ¥è®°å½•æ“ä½œæ—¥å¿—ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨AOPçš„æŠ€æœ¯æ¥å®ç°ã€‚ä½¿ç”¨AOPçš„æŠ€æœ¯æ¥å®ç°ä¹Ÿæ˜¯æœ€ä¸ºç®€å•ï¼Œæœ€ä¸ºæ–¹ä¾¿çš„ã€‚\né—®é¢˜3ï¼šæ—¢ç„¶è¦åŸºäºAOPé¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ–¹å¼æ¥å®Œæˆçš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨ AOPäº”ç§é€šçŸ¥ç±»å‹å½“ä¸­çš„å“ªç§é€šçŸ¥ç±»å‹ï¼Ÿ\nç­”æ¡ˆï¼šç¯ç»•é€šçŸ¥ æ‰€è®°å½•çš„æ“ä½œæ—¥å¿—å½“ä¸­åŒ…æ‹¬ï¼šæ“ä½œäººã€æ“ä½œæ—¶é—´ï¼Œè®¿é—®çš„æ˜¯å“ªä¸ªç±»ã€å“ªä¸ªæ–¹æ³•ã€æ–¹æ³•è¿è¡Œæ—¶å‚æ•°ã€æ–¹æ³•çš„è¿”å›å€¼ã€æ–¹æ³•çš„è¿è¡Œæ—¶é•¿ã€‚\næ–¹æ³•è¿”å›å€¼ï¼Œæ˜¯åœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œåæ‰èƒ½è·å–åˆ°çš„ã€‚\næ–¹æ³•çš„è¿è¡Œæ—¶é•¿ï¼Œéœ€è¦åŸå§‹æ–¹æ³•è¿è¡Œä¹‹å‰è®°å½•å¼€å§‹æ—¶é—´ï¼ŒåŸå§‹æ–¹æ³•è¿è¡Œä¹‹åè®°å½•ç»“æŸæ—¶é—´ã€‚é€šè¿‡è®¡ç®—è·å¾—æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ã€‚\nåŸºäºä»¥ä¸Šçš„åˆ†ææˆ‘ä»¬ç¡®å®šè¦ä½¿ç”¨Aroundç¯ç»•é€šçŸ¥ã€‚\né—®é¢˜4ï¼šæœ€åä¸€ä¸ªé—®é¢˜ï¼Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æˆ‘ä»¬è¯¥æ€ä¹ˆå†™ï¼Ÿ\nç­”æ¡ˆï¼šä½¿ç”¨annotationæ¥æè¿°è¡¨è¾¾å¼ è¦åŒ¹é…ä¸šåŠ¡æ¥å£å½“ä¸­æ‰€æœ‰çš„å¢åˆ æ”¹çš„æ–¹æ³•ï¼Œè€Œå¢åˆ æ”¹æ–¹æ³•åœ¨å‘½åä¸Šæ²¡æœ‰å…±åŒçš„å‰ç¼€æˆ–åç¼€ã€‚æ­¤æ—¶å¦‚æœä½¿ç”¨executionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¼šæ¯”è¾ƒç¹çã€‚ å½“é‡åˆ°å¢åˆ æ”¹çš„æ–¹æ³•åæ²¡æœ‰è§„å¾‹æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ annotationåˆ‡å…¥ç‚¹è¡¨è¾¾å¼\næ­¥éª¤ ç®€å•åˆ†æäº†ä¸€ä¸‹å¤§æ¦‚çš„å®ç°æ€è·¯åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æ¥å®Œæˆæ¡ˆä¾‹äº†ã€‚æ¡ˆä¾‹çš„å®ç°æ­¥éª¤å…¶å®å°±ä¸¤æ­¥ï¼š\nå‡†å¤‡å·¥ä½œ å¼•å…¥AOPçš„èµ·æ­¥ä¾èµ– å¯¼å…¥èµ„æ–™ä¸­å‡†å¤‡å¥½çš„æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¹¶å¼•å…¥å¯¹åº”çš„å®ä½“ç±» ç¼–ç å®ç° è‡ªå®šä¹‰æ³¨è§£@Log å®šä¹‰åˆ‡é¢ç±»ï¼Œå®Œæˆè®°å½•æ“ä½œæ—¥å¿—çš„é€»è¾‘ å®ç° å‡†å¤‡å·¥ä½œ\n1.AOPèµ·æ­¥ä¾èµ–\n1 2 3 4 5 \u0026lt;!--AOPèµ·æ­¥ä¾èµ–--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-aop\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \\2. å¯¼å…¥èµ„æ–™ä¸­å‡†å¤‡å¥½çš„æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¹¶å¼•å…¥å¯¹åº”çš„å®ä½“ç±»\næ•°æ®è¡¨\n1 2 3 4 5 6 7 8 9 10 11 -- æ“ä½œæ—¥å¿—è¡¨ create table operate_log( id int unsigned primary key auto_increment comment \u0026#39;ID\u0026#39;, operate_user int unsigned comment \u0026#39;æ“ä½œäºº\u0026#39;, operate_time datetime comment \u0026#39;æ“ä½œæ—¶é—´\u0026#39;, class_name varchar(100) comment \u0026#39;æ“ä½œçš„ç±»å\u0026#39;, method_name varchar(100) comment \u0026#39;æ“ä½œçš„æ–¹æ³•å\u0026#39;, method_params varchar(1000) comment \u0026#39;æ–¹æ³•å‚æ•°\u0026#39;, return_value varchar(2000) comment \u0026#39;è¿”å›å€¼\u0026#39;, cost_time bigint comment \u0026#39;æ–¹æ³•æ‰§è¡Œè€—æ—¶, å•ä½:ms\u0026#39; ) comment \u0026#39;æ“ä½œæ—¥å¿—è¡¨\u0026#39;; å®ä½“ç±»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 //æ“ä½œæ—¥å¿—å®ä½“ç±» @Data @NoArgsConstructor @AllArgsConstructor public class OperateLog { private Integer id; //ä¸»é”®ID private Integer operateUser; //æ“ä½œäººID private LocalDateTime operateTime; //æ“ä½œæ—¶é—´ private String className; //æ“ä½œç±»å private String methodName; //æ“ä½œæ–¹æ³•å private String methodParams; //æ“ä½œæ–¹æ³•å‚æ•° private String returnValue; //æ“ä½œæ–¹æ³•è¿”å›å€¼ private Long costTime; //æ“ä½œè€—æ—¶ } Mapperæ¥å£\n1 2 3 4 5 6 7 8 9 @Mapper public interface OperateLogMapper { //æ’å…¥æ—¥å¿—æ•°æ® @Insert(\u0026#34;insert into operate_log (operate_user, operate_time, class_name, method_name, method_params, return_value, cost_time) \u0026#34; + \u0026#34;values (#{operateUser}, #{operateTime}, #{className}, #{methodName}, #{methodParams}, #{returnValue}, #{costTime});\u0026#34;) public void insert(OperateLog log); } ç¼–ç å®ç°\nè‡ªå®šä¹‰æ³¨è§£@Log 1 2 3 4 5 6 7 8 /** * è‡ªå®šä¹‰Logæ³¨è§£ */ @Target({ElementType.METHOD}) @Documented @Retention(RetentionPolicy.RUNTIME) public @interface Log { } ä¿®æ”¹ä¸šåŠ¡å®ç°ç±»ï¼Œåœ¨å¢åˆ æ”¹ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ @Logæ³¨è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @Slf4j @Service public class EmpServiceImpl implements EmpService { @Autowired private EmpMapper empMapper; @Override @Log public void update(Emp emp) { emp.setUpdateTime(LocalDateTime.now()); //æ›´æ–°ä¿®æ”¹æ—¶é—´ä¸ºå½“å‰æ—¶é—´ empMapper.update(emp); } @Override @Log public void save(Emp emp) { //è¡¥å…¨æ•°æ® emp.setCreateTime(LocalDateTime.now()); emp.setUpdateTime(LocalDateTime.now()); //è°ƒç”¨æ·»åŠ æ–¹æ³• empMapper.insert(emp); } @Override @Log public void delete(List\u0026lt;Integer\u0026gt; ids) { empMapper.delete(ids); } //çœç•¥å…¶ä»–ä»£ç ... } ä»¥åŒæ ·çš„æ–¹å¼ï¼Œä¿®æ”¹EmpServiceImplä¸šåŠ¡ç±»\nå®šä¹‰åˆ‡é¢ç±»ï¼Œå®Œæˆè®°å½•æ“ä½œæ—¥å¿—çš„é€»è¾‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 @Slf4j @Component @Aspect //åˆ‡é¢ç±» public class LogAspect { @Autowired private HttpServletRequest request; @Autowired private OperateLogMapper operateLogMapper; @Around(\u0026#34;@annotation(com.itheima.anno.Log)\u0026#34;) public Object recordLog(ProceedingJoinPoint joinPoint) throws Throwable { //æ“ä½œäººID - å½“å‰ç™»å½•å‘˜å·¥ID //è·å–è¯·æ±‚å¤´ä¸­çš„jwtä»¤ç‰Œ, è§£æä»¤ç‰Œ String jwt = request.getHeader(\u0026#34;token\u0026#34;); Claims claims = JwtUtils.parseJWT(jwt); Integer operateUser = (Integer) claims.get(\u0026#34;id\u0026#34;); //æ“ä½œæ—¶é—´ LocalDateTime operateTime = LocalDateTime.now(); //æ“ä½œç±»å String className = joinPoint.getTarget().getClass().getName(); //æ“ä½œæ–¹æ³•å String methodName = joinPoint.getSignature().getName(); //æ“ä½œæ–¹æ³•å‚æ•° Object[] args = joinPoint.getArgs(); String methodParams = Arrays.toString(args); long begin = System.currentTimeMillis(); //è°ƒç”¨åŸå§‹ç›®æ ‡æ–¹æ³•è¿è¡Œ Object result = joinPoint.proceed(); long end = System.currentTimeMillis(); //æ–¹æ³•è¿”å›å€¼ String returnValue = JSONObject.toJSONString(result); //æ“ä½œè€—æ—¶ Long costTime = end - begin; //è®°å½•æ“ä½œæ—¥å¿— OperateLog operateLog = new OperateLog(null,operateUser,operateTime,className,methodName,methodParams,returnValue,costTime); operateLogMapper.insert(operateLog); log.info(\u0026#34;AOPè®°å½•æ“ä½œæ—¥å¿—: {}\u0026#34; , operateLog); return result; } } ä»£ç å®ç°ç»†èŠ‚ï¼š è·å–requestå¯¹è±¡ï¼Œä»è¯·æ±‚å¤´ä¸­è·å–åˆ°jwtä»¤ç‰Œï¼Œè§£æä»¤ç‰Œè·å–å‡ºå½“å‰ç”¨æˆ·çš„idã€‚\né‡å¯SpringBootæœåŠ¡ï¼Œæµ‹è¯•æ“ä½œæ—¥å¿—è®°å½•åŠŸèƒ½ï¼š\næ·»åŠ ä¸€ä¸ªæ–°çš„éƒ¨é—¨ æ•°æ®è¡¨ ","date":"2025-04-13T16:01:23+08:00","image":"https://nova-bryan.github.io/p/%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%92%8Caop/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%92%8Caop/","title":"äº‹åŠ¡ç®¡ç†å’ŒAOP"},{"content":"é¢˜ç›® ç­”æ¡ˆï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 import java.util.*; public class Main { public static void main(String[] args) { Scanner sc = new Scanner(System.in); // è¯»å–è¾“å…¥ int n = sc.nextInt(); // çŸ¿æ´æ•° int m = sc.nextInt(); // æœ€å¤§æ­¥æ•° int[] L = new int[2000005]; // è®°å½•å·¦ä¾§çŸ¿æ´ int[] R = new int[2000005]; // è®°å½•å³ä¾§çŸ¿æ´ int[] Ls = new int[2000005]; // å·¦ä¾§å‰ç¼€å’Œ int[] Rs = new int[2000005]; // å³ä¾§å‰ç¼€å’Œ int zero = 0; // è®°å½•èµ·ç‚¹ 0 å¤„çš„çŸ¿æ´æ•°é‡ // è¯»å–çŸ¿æ´ä¿¡æ¯ for (int i = 0; i \u0026lt; n; i++) { int t = sc.nextInt(); if (t \u0026lt; 0) { L[-t]++; // å·¦ä¾§ } else if (t \u0026gt; 0) { R[t]++; // å³ä¾§ } else { zero++; // è®°å½•èµ·ç‚¹0 } } // è®¡ç®—å‰ç¼€å’Œ for (int i = 1; i \u0026lt;= 2000000; i++) { Ls[i] = L[i] + Ls[i - 1]; Rs[i] = R[i] + Rs[i - 1]; } int ans = 0; // è®°å½•æœ€å¤§å¯æ”¶é›†çŸ¿çŸ³æ•° // æšä¸¾å‘å·¦èµ°çš„æ­¥æ•° for (int i = 0; i \u0026lt;= m; i++) { int j = (m - i) / 2; // å‰©ä½™æ­¥æ•°ä¸€åŠç”¨äºå›å¤´ if (i \u0026lt; j) j = m - 2 * i; // è®¡ç®—å½“å‰èµ°æ³•çš„çŸ¿çŸ³æ•° int sums = Rs[i] + Ls[Math.max(0, j)]; ans = Math.max(ans, sums); } ans += zero; // åŠ ä¸Šèµ·ç‚¹0çš„çŸ¿çŸ³æ•°é‡ // è¾“å‡ºç­”æ¡ˆ System.out.println(ans); } } ","date":"2025-04-10T00:00:00Z","image":"https://nova-bryan.github.io/p/acwing-5995.%E6%8C%96%E7%9F%BF/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/acwing-5995.%E6%8C%96%E7%9F%BF/","title":"AcWing 5995.æŒ–çŸ¿"},{"content":"é¢˜ç›®ï¼š ç­”æ¡ˆï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 class Solution { static List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; ans; public List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; pathSum(TreeNode root, int targetSum) { if (root == null) return ans; ans=new ArrayList\u0026lt;\u0026gt;(); dfs(new ArrayList\u0026lt;\u0026gt;(),root,0,targetSum); return ans; } public static void dfs(List\u0026lt;Integer\u0026gt; list,TreeNode node,int sum,int targetSum){ if (node==null){ return; } list.add(node.val); sum += node.val; if (node.left == null \u0026amp;\u0026amp; node.right == null \u0026amp;\u0026amp; sum == targetSum) { ans.add(new ArrayList\u0026lt;\u0026gt;(list)); // è¿™é‡Œä¸€å®šè¦ new ä¸€ä¸ªå‰¯æœ¬ } dfs(list,node.left,sum,targetSum); dfs(list,node.right,sum,targetSum); list.remove(list.size()-1); } } ","date":"2025-04-09T00:00:00Z","image":"https://nova-bryan.github.io/p/leetcode113.%E8%B7%AF%E5%BE%84%E6%80%BB%E5%90%88ii/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/leetcode113.%E8%B7%AF%E5%BE%84%E6%80%BB%E5%90%88ii/","title":"LeetCode113.è·¯å¾„æ€»åˆII"},{"content":"é¢˜ç›®ï¼š ç­”æ¡ˆï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 import java.util.ArrayList; import java.util.List; class Solution { static boolean flag = false; static boolean[][] isFlag; public boolean exist(char[][] board, String word) { flag = false; // æ¯æ¬¡è°ƒç”¨è¦é‡ç½® isFlag = new boolean[board.length][board[0].length]; List\u0026lt;Character\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; word.length(); i++) { list.add(word.charAt(i)); } // ä»æ¯ä¸€ä¸ªç‚¹å¼€å§‹å°è¯•åŒ¹é… for (int i = 0; i \u0026lt; board.length; i++) { for (int j = 0; j \u0026lt; board[0].length; j++) { dfs(i, j, board, list, 0); // ç¬¬0ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é… if (flag) return true; } } return false; } public static void dfs(int i, int j, char[][] board, List\u0026lt;Character\u0026gt; list, int index) { // å¦‚æœå·²ç»å…¨éƒ¨åŒ¹é…å®Œäº† if (index == list.size()) { flag = true; return; } // è¶Šç•Œ + å·²è®¿é—® + å½“å‰å­—ç¬¦ä¸åŒ¹é… if (i \u0026lt; 0 || i \u0026gt;= board.length || j \u0026lt; 0 || j \u0026gt;= board[0].length || isFlag[i][j] || board[i][j] != list.get(index)) { return; } isFlag[i][j] = true; // é€’å½’å‘å››ä¸ªæ–¹å‘æœç´¢ dfs(i + 1, j, board, list, index + 1); dfs(i - 1, j, board, list, index + 1); dfs(i, j + 1, board, list, index + 1); dfs(i, j - 1, board, list, index + 1); isFlag[i][j] = false; // å›æº¯ } } ","date":"2025-04-09T00:00:00Z","image":"https://nova-bryan.github.io/p/leetcode79.%E5%8D%95%E8%AF%8D%E6%90%9C%E7%B4%A2/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/leetcode79.%E5%8D%95%E8%AF%8D%E6%90%9C%E7%B4%A2/","title":"LeetCode79.å•è¯æœç´¢"},{"content":"é¢˜ç›® ç­”æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 class Solution { TreeNode prev = null; public boolean isValidBST(TreeNode root) { return inorder(root); } public boolean inorder(TreeNode node) { if (node == null) return true; // å·¦å­æ ‘ if (!inorder(node.left)) return false; // å½“å‰èŠ‚ç‚¹å¿…é¡»å¤§äºä¸­åºéå†çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ if (prev != null \u0026amp;\u0026amp; node.val \u0026lt;= prev.val) return false; prev = node; // æ›´æ–°å‰ä¸€ä¸ªèŠ‚ç‚¹ // å³å­æ ‘ return inorder(node.right); } } ","date":"2025-04-09T00:00:00Z","image":"https://nova-bryan.github.io/p/leetcode98.%E9%AA%8C%E8%AF%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/leetcode98.%E9%AA%8C%E8%AF%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","title":"LeetCode98.éªŒè¯äºŒå‰æœç´¢æ ‘"},{"content":"é¢˜ç›®: åšä¸»è§£é¢˜æ€è·¯ï¼š æ•´ä½“æ€è·¯ï¼š\næœ¬é¢˜æ˜¯ä¸€ä¸ªå…³äºä¸¤å¤´å¥¶ç‰›åˆ†è›‹ç³•çš„åšå¼ˆé—®é¢˜ï¼Œå…³é”®åœ¨äºåˆ†æåœ¨åŒæ–¹éƒ½é‡‡å–æœ€ä¼˜ç­–ç•¥çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è®¡ç®—å‡ºè´èŒœå’ŒåŸƒå°”èŒœæœ€ç»ˆåƒåˆ°çš„è›‹ç³•é‡ã€‚ç”±äºè´èŒœå…ˆè¡ŒåŠ¨ï¼ˆå †å ç›¸é‚»è›‹ç³•ï¼‰ï¼ŒåŸƒå°”èŒœåè¡ŒåŠ¨ï¼ˆé€‰æ‹©æœ€å·¦æˆ–æœ€å³è›‹ç³•è—èµ·æ¥ï¼‰ï¼Œä¸”æœ€ç»ˆè´èŒœåƒå‰©ä¸‹çš„ä¸€ä¸ªè›‹ç³•ï¼ŒåŸƒå°”èŒœåƒè—èµ·æ¥çš„è›‹ç³•ï¼Œæ‰€ä»¥æ ¸å¿ƒæ˜¯æ‰¾å‡ºåŸƒå°”èŒœèƒ½è—èµ·æ¥çš„æœ€å¤§è›‹ç³•é‡ï¼Œå†ç”¨è›‹ç³•æ€»é‡å‡å»åŸƒå°”èŒœçš„é‡ï¼Œå³å¯å¾—åˆ°è´èŒœçš„é‡ã€‚\nå…·ä½“æ­¥éª¤\nå¤„ç†å¤šç»„æµ‹è¯•ç”¨ä¾‹ é¦–å…ˆè¯»å–æµ‹è¯•ç”¨ä¾‹çš„æ•°é‡ Tï¼Œç„¶åå¯¹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿›è¡Œå¤„ç†ã€‚å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå…ˆè¯»å–è›‹ç³•çš„æ•°é‡ Nã€‚\nè®¡ç®—å‰ç¼€å’Œ ä½¿ç”¨å‰ç¼€å’Œæ•°ç»„ s æ¥æ–¹ä¾¿è®¡ç®—åŒºé—´å†…è›‹ç³•çš„æ€»é‡ã€‚å‰ç¼€å’Œæ•°ç»„ s[i] è¡¨ç¤ºå‰ i ä¸ªè›‹ç³•çš„å¤§å°ä¹‹å’Œã€‚é€šè¿‡éå†è¾“å…¥çš„è›‹ç³•å¤§å°æ•°ç»„ï¼Œè®¡ç®—å‡ºå‰ç¼€å’Œæ•°ç»„ï¼š 1 2 3 4 long[] s = new long[n + 1]; String[] split = br.readLine().split(\u0026#34; \u0026#34;); for (int i = 1; i \u0026lt;= n; i++) s[i] = Long.parseLong(split[i - 1]) + s[i - 1]; ç¡®å®šåŸƒå°”èŒœè—è›‹ç³•çš„æ¬¡æ•° æ¯ä¸€è½®åŸƒå°”èŒœè—ä¸€ä¸ªè›‹ç³•ï¼Œæœ€ç»ˆåªå‰©ä¸‹ä¸€ä¸ªè›‹ç³•ç»™è´èŒœåƒï¼Œæ‰€ä»¥åŸƒå°”èŒœè—è›‹ç³•çš„æ¬¡æ•°ä¸º (n - 1) / 2ï¼Œè®°ä¸º eTotalã€‚\næ‰¾å‡ºåŸƒå°”èŒœèƒ½è—èµ·æ¥çš„æœ€å¤§è›‹ç³•é‡ åŸƒå°”èŒœè—è›‹ç³•çš„è¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ä»è›‹ç³•åºåˆ—çš„å·¦å³ä¸¤ç«¯é€‰å–ä¸€äº›è¿ç»­çš„è›‹ç³•ã€‚æˆ‘ä»¬é€šè¿‡æšä¸¾ä¸åŒçš„ç»„åˆï¼Œæ‰¾å‡ºèƒ½ä½¿åŸƒå°”èŒœè—èµ·æ¥çš„è›‹ç³•æ€»é‡æœ€å¤§çš„æƒ…å†µã€‚å…·ä½“åšæ³•æ˜¯ï¼Œæšä¸¾ä»å·¦è¾¹é€‰å– i ä¸ªè›‹ç³•ï¼Œä»å³è¾¹é€‰å– eTotal - i ä¸ªè›‹ç³•çš„æ‰€æœ‰å¯èƒ½ç»„åˆï¼Œè®¡ç®—è¿™äº›ç»„åˆçš„è›‹ç³•æ€»é‡ï¼Œå¹¶å–æœ€å¤§å€¼ä½œä¸ºåŸƒå°”èŒœèƒ½è—èµ·æ¥çš„æœ€å¤§è›‹ç³•é‡ eï¼š\n1 2 3 4 int eTotal = n - 1 \u0026gt;\u0026gt; 1; long e = 0; for (int i = 0; i \u0026lt;= eTotal; i++) e = Math.max(e, s[i] + (s[n] - s[n - eTotal + i])); è®¡ç®—è´èŒœåƒåˆ°çš„è›‹ç³•é‡ ç”¨æ‰€æœ‰è›‹ç³•çš„æ€»é‡ s[n] å‡å»åŸƒå°”èŒœè—èµ·æ¥çš„æœ€å¤§è›‹ç³•é‡ eï¼Œå³å¯å¾—åˆ°è´èŒœåƒåˆ°çš„è›‹ç³•é‡ bï¼š\n1 long b = s[n] - e; è¾“å‡ºç»“æœ å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¾“å‡ºè´èŒœå’ŒåŸƒå°”èŒœåˆ†åˆ«åƒåˆ°çš„è›‹ç³•é‡ b å’Œ eã€‚\næ€»ç»“\né€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬åˆ©ç”¨å‰ç¼€å’Œæ•°ç»„æ¥é«˜æ•ˆè®¡ç®—åŒºé—´å†…è›‹ç³•çš„æ€»é‡ï¼Œé€šè¿‡æšä¸¾ä¸åŒçš„å·¦å³ä¸¤ç«¯è›‹ç³•ç»„åˆï¼Œæ‰¾å‡ºåŸƒå°”èŒœèƒ½è—èµ·æ¥çš„æœ€å¤§è›‹ç³•é‡ï¼Œè¿›è€Œè®¡ç®—å‡ºè´èŒœåƒåˆ°çš„è›‹ç³•é‡ï¼Œä»è€Œè§£å†³äº†è¯¥åšå¼ˆé—®é¢˜ã€‚\nç­”æ¡ˆï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import java.io.*; public class Main { public static void main(String[] args) throws IOException { BufferedReader br = new BufferedReader(new InputStreamReader(System.in)); BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(System.out)); int t = Integer.parseInt(br.readLine()); while (t-- != 0) { int n = Integer.parseInt(br.readLine()); long[] s = new long[n + 1]; String[] split = br.readLine().split(\u0026#34; \u0026#34;); for (int i = 1; i \u0026lt;= n; i++) s[i] = Long.parseLong(split[i - 1]) + s[i - 1]; int eTotal = n - 1 \u0026gt;\u0026gt; 1; long e = 0; for (int i = 0; i \u0026lt;= eTotal; i++) e = Math.max(e, s[i] + (s[n] - s[n - eTotal + i])); long b = s[n] - e; bw.write(b + \u0026#34; \u0026#34; + e); bw.newLine(); } br.close(); bw.close(); } }\t","date":"2025-03-26T00:00:00Z","image":"https://nova-bryan.github.io/p/acwing-6118.-%E8%9B%8B%E7%B3%95%E6%B8%B8%E6%88%8F/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/acwing-6118.-%E8%9B%8B%E7%B3%95%E6%B8%B8%E6%88%8F/","title":"AcWing 6118. è›‹ç³•æ¸¸æˆ"},{"content":"é¢˜ç›® åšä¸»è§£é¢˜æ€è·¯ï¼š â€‹\té¦–å…ˆç†Ÿè¯»é¢˜ç›®åï¼Œå‘ç°è¦æ±‚çš„æ˜¯ï¼Œä¸€æ®µå®šé•¿å­—ç¬¦ä¸²ä¸­çš„abbå½¢å¼çš„å®šé•¿å­—ä¸²ï¼Œå¦‚æœå®šé•¿å­—ä¸²çš„æ•°é‡å¤§äºç­‰äºFçš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ—ä¸ºä¸€ç»„ç­”æ¡ˆï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå­—ç¬¦ä¸²ä¸­å¯èƒ½å­˜åœ¨è‡³å¤šä¸€ä¸ªå­—ç¬¦ä¸åŸå§‹å­—ç¬¦ä¸²ä¸ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åœ¨å­—ä¸²ä¸­æ›´æ”¹ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœå­—ç¬¦æ›´æ”¹åçš„å…³è”çš„å®šé•¿å­—ä¸²çš„æ•°é‡èƒ½å¤§äºç­‰äºFï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åˆ—å…¥ç­”æ¡ˆå½“ä¸­ï¼Œé‚£ä¹ˆæ€è·¯å°±å¾ˆæ˜æ˜¾äº†ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªcntæ•°ç»„ï¼Œç”¨æ¥ç»Ÿè®¡åŸå­—ç¬¦ä¸²ä¸­çš„å®šé•¿å­—ä¸²æ•°é‡ï¼Œå†ä¾æ¬¡æ”¹å˜åŸå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œå…±æœ‰25ç§æ›´æ”¹æƒ…å†µï¼Œæ¯æ¬¡æ”¹å˜å­—ç¬¦ï¼Œéƒ½ä¼šæ”¹å˜ä¸‰ä¸ªå®šé•¿å­—ä¸²ï¼Œå¦‚ï¼š\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡æˆ‘ä»¬æ›´æ”¹å­—ç¬¦ä¹‹å‰ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„å…³è”çš„ä¸‰ä¸ªå­—ä¸²æ•°é‡-1ï¼Œè¿™æ ·å­æˆ‘ä»¬ä¿®æ”¹ä¹‹åï¼Œå¾—åˆ°æ–°å­—ä¸²ï¼ŒåŠ å…¥åˆ°å­—ä¸²æ•°é‡ä¸­ï¼Œæ‰èƒ½æœ‰æ•ˆçš„åˆ¤æ–­æ˜¯å¦å‡ºç°äº†æœ‰æ•ˆçš„ç­”æ¡ˆå­—ä¸²ï¼Œä¸ç„¶å°±ä¼šå¤šåŠ 1ï¼Œåœ¨æ”¹å˜å­—ç¬¦ä¹‹åï¼Œå¯¹åº”çš„ä¸‰ä¸ªæ–°å­—ä¸²æ•°é‡åŠ ä¸€ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ç­”æ¡ˆå­—ä¸²ï¼Œå¦‚æœæœ‰ç­”æ¡ˆå­—ä¸²ï¼Œé‚£ä¹ˆå°±æ ‡è®°ä¸€ä¸‹ï¼ˆå¼€è¾Ÿä¸€ä¸ªæ–°çš„æ•°ç»„æ¥è®°å½•ç­”æ¡ˆå­—ä¸²ï¼‰ï¼Œæ›´æ–°å®Œä¹‹åï¼Œå†å‡å»å­—ä¸²æ•°é‡-1ï¼Œæœ€åæ¢å¤ç°åœºï¼Œå°†åŸå­—ç¬¦æ”¾å›åŸä½ï¼Œå¹¶æ›´æ–°åŸå­—ä¸²æ•°é‡ï¼Œè¿™æ ·å­å°±èƒ½è¾¾åˆ°è‡³å¤šåªæœ‰ä¸€ä¸ªå­—ç¬¦æ”¹å˜çš„æ•ˆæœï¼Œæœ€åç»Ÿè®¡ç­”æ¡ˆå­—ä¸²æ•°é‡ï¼Œå¹¶è¾“å‡ºç­”æ¡ˆå­ä¸²\nè¯´å®è¯è¿™ä¸ªé¢˜ç›®éš¾åº¦å¯¹ç›®å‰çš„æˆ‘æ¥è¯´éš¾åº¦è¿˜æ˜¯æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ææ‡‚æœ¬é¢˜ä¹‹åï¼Œå¯¹æˆ‘çš„æ€ç»´æ‹“å±•è¿˜æ˜¯æ¯”è¾ƒå¤§ï¼Œæ¨¡æ‹Ÿé¢˜ç›®æˆ–è€…éœ€è¦é‡å¤æ‰§è¡Œç±»ä¼¼æ“ä½œçš„é¢˜ç›®ï¼Œå¯ä»¥å¼€è¾Ÿä¸€ä¸ªæ›´æ–°å‡½æ•°æ¥é‡å¤æ“ä½œï¼Œç›´è§‚å¹¶ä¸”æ›´ä¸ºç®€æ´\nç­”æ¡ˆï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 import java.util.Scanner; public class Main{ private static final int N = 20010; // N è®¾ä¸ºé™æ€å¸¸é‡ private static final int M = 26; private static Integer n; private static Integer m; private static char[] s; private static int[][] cnt=new int[M][M]; private static boolean[][] ans=new boolean[M][M]; public static void main(String agrs[]){ Scanner sc=new Scanner(System.in); n =sc.nextInt(); m=sc.nextInt(); sc.nextLine(); String S=sc.nextLine(); s=S.toCharArray(); //å…ˆå°†å­—ç¬¦è½¬æ¢ä¸ºæ•°å­— for (int i = 0; i \u0026lt; s.length; i++) s[i]-=\u0026#39;a\u0026#39;; //å…ˆç»Ÿè®¡åŸå­—ç¬¦ä¸²ä¸­çš„å“å«å¯èƒ½ update(0,n-1,1); for (int i = 0; i \u0026lt; n; i++) { char t=s[i]; update(i-2,i+2,-1); for (int j = 0; j \u0026lt; 26; j++) { if (j!=t){ s[i]= (char) j; update(i-2,i+2,1); update(i-2,i+2,-1); } } s[i]=t; update(i-2,i+2,1); } int res=0; for (int i = 0; i \u0026lt; 26; i++) { for (int j = 0; j \u0026lt; 26 ; j++) { if (ans[i][j]) res++; } } System.out.println(res); for (int i = 0; i \u0026lt; 26; i++) { for (int j = 0; j \u0026lt; 26 ; j++) { if (ans[i][j]) { System.out.println(String.format(\u0026#34;%c%c%c\u0026#34;, (char) (i + \u0026#39;a\u0026#39;), (char) (j + \u0026#39;a\u0026#39;), (char) (j + \u0026#39;a\u0026#39;))); } } } } public static void update(int l,int r,int v){ l=Math.max(l,0); r=Math.min(r,n-1); for (int i = l; i+2 \u0026lt;= r ; i++) { char a=s[i],b=s[i+1],c=s[i+2]; if(a!=b\u0026amp;\u0026amp;b==c){ cnt[a][b]+=v; if (cnt[a][b]\u0026gt;=m) ans[a][b]=true; } } } } ","date":"2025-03-24T00:00:00Z","image":"https://nova-bryan.github.io/p/acwing-6123.-%E5%93%9E%E5%8F%AB%E6%97%B6%E9%97%B4/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/acwing-6123.-%E5%93%9E%E5%8F%AB%E6%97%B6%E9%97%B4/","title":"AcWing 6123. å“å«æ—¶é—´"},{"content":"Markdown åŸºæœ¬è¯­æ³• Markdownæ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œæ’ç‰ˆè¯­æ³•ç®€æ´ï¼Œè®©äººä»¬æ›´å¤šåœ°å…³æ³¨å†…å®¹æœ¬èº«è€Œéæ’ç‰ˆã€‚å®ƒä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼Œå¯ä¸HTMLæ··ç¼–ï¼Œå¯å¯¼å‡º HTMLã€PDF ä»¥åŠæœ¬èº«çš„ .md æ ¼å¼çš„æ–‡ä»¶ã€‚å› ç®€æ´ã€é«˜æ•ˆã€æ˜“è¯»ã€æ˜“å†™ï¼ŒMarkdownè¢«å¤§é‡ä½¿ç”¨ï¼Œå¦‚Githubã€Wikipediaã€ç®€ä¹¦ç­‰ã€‚\nåœ¨çº¿ä½“éªŒä¸€ä¸‹ Markdownåœ¨çº¿ç¼–è¾‘å™¨ (opens new window)ã€‚\nåƒä¸‡ä¸è¦è¢«ã€Œæ ‡è®°ã€ã€ã€Œè¯­è¨€ã€å“åˆ°ï¼ŒMarkdownçš„è¯­æ³•ååˆ†ç®€å•ï¼Œå¸¸ç”¨çš„æ ‡è®°ç¬¦å·ä¸è¶…è¿‡åä¸ªï¼Œç”¨äºæ—¥å¸¸å†™ä½œè®°å½•ç»°ç»°æœ‰ä½™ï¼Œä¸åˆ°åŠå°æ—¶å°±èƒ½å®Œå…¨æŒæ¡ã€‚\nå°±æ˜¯è¿™åä¸ªä¸åˆ°çš„æ ‡è®°ç¬¦å·ï¼Œå´èƒ½è®©äººä¼˜é›…åœ°æ²‰æµ¸å¼è®°å½•ï¼Œä¸“æ³¨å†…å®¹è€Œä¸æ˜¯çº ç»“æ’ç‰ˆï¼Œè¾¾åˆ°ã€Œå¿ƒä¸­æ— å°˜ï¼Œç å­—å…¥ç¥ã€çš„å¢ƒç•Œã€‚\nMarkdown æ ‡é¢˜è¯­æ³• è¦åˆ›å»ºæ ‡é¢˜ï¼Œè¯·åœ¨å•è¯æˆ–çŸ­è¯­å‰é¢æ·»åŠ äº•å· (#) ã€‚# çš„æ•°é‡ä»£è¡¨äº†æ ‡é¢˜çš„çº§åˆ«ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ ä¸‰ä¸ª # è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªä¸‰çº§æ ‡é¢˜ (\u0026lt;h3\u0026gt;) (ä¾‹å¦‚ï¼š### My Header)ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ # Heading level 1 \u0026lt;h1\u0026gt;Heading level 1\u0026lt;/h1\u0026gt; Heading level 1 ## Heading level 2 \u0026lt;h2\u0026gt;Heading level 2\u0026lt;/h2\u0026gt; Heading level 2 ### Heading level 3 \u0026lt;h3\u0026gt;Heading level 3\u0026lt;/h3\u0026gt; Heading level 3 #### Heading level 4 \u0026lt;h4\u0026gt;Heading level 4\u0026lt;/h4\u0026gt; Heading level 4 ##### Heading level 5 \u0026lt;h5\u0026gt;Heading level 5\u0026lt;/h5\u0026gt; Heading level 5 ###### Heading level 6 \u0026lt;h6\u0026gt;Heading level 6\u0026lt;/h6\u0026gt; Heading level 6 å¯é€‰è¯­æ³• è¿˜å¯ä»¥åœ¨æ–‡æœ¬ä¸‹æ–¹æ·»åŠ ä»»æ„æ•°é‡çš„ == å·æ¥æ ‡è¯†ä¸€çº§æ ‡é¢˜ï¼Œæˆ–è€… \u0026ndash; å·æ¥æ ‡è¯†äºŒçº§æ ‡é¢˜ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ Heading level 1=============== \u0026lt;h1\u0026gt;Heading level 1\u0026lt;/h1\u0026gt; Heading level 1 Heading level 2--------------- \u0026lt;h2\u0026gt;Heading level 2\u0026lt;/h2\u0026gt; Heading level 2 æœ€ä½³å®è·µ ä¸åŒçš„ Markdown åº”ç”¨ç¨‹åºå¤„ç† # å’Œæ ‡é¢˜ä¹‹é—´çš„ç©ºæ ¼æ–¹å¼å¹¶ä¸ä¸€è‡´ã€‚ä¸ºäº†å…¼å®¹è€ƒè™‘ï¼Œè¯·ç”¨ä¸€ä¸ªç©ºæ ¼åœ¨ # å’Œæ ‡é¢˜ä¹‹é—´è¿›è¡Œåˆ†éš”ã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this # Here's a Heading #Here's a Heading Markdown æ®µè½ è¦åˆ›å»ºæ®µè½ï¼Œè¯·ä½¿ç”¨ç©ºç™½è¡Œå°†ä¸€è¡Œæˆ–å¤šè¡Œæ–‡æœ¬è¿›è¡Œåˆ†éš”ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ I really like using Markdown.I think I'll use it to format all of my documents from now on. \u0026lt;p\u0026gt;I really like using Markdown.\u0026lt;/p\u0026gt;\u0026lt;p\u0026gt;I think I'll use it to format all of my documents from now on.\u0026lt;/p\u0026gt; I really like using Markdown.I think I\u0026rsquo;ll use it to format all of my documents from now on. æ®µè½ï¼ˆParagraphï¼‰ç”¨æ³•çš„æœ€ä½³å® ä¸è¦ç”¨ç©ºæ ¼ï¼ˆspacesï¼‰æˆ–åˆ¶è¡¨ç¬¦ï¼ˆ tabsï¼‰ç¼©è¿›æ®µè½ã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this Don't put tabs or spaces in front of your paragraphs.Keep lines left-aligned like this. This can result in unexpected formatting problems. Don't add tabs or spaces in front of paragraphs. Markdown æ¢è¡Œè¯­æ³• åœ¨ä¸€è¡Œçš„æœ«å°¾æ·»åŠ ä¸¤ä¸ªæˆ–å¤šä¸ªç©ºæ ¼ï¼Œç„¶åæŒ‰å›è½¦é”®,å³å¯åˆ›å»ºä¸€ä¸ªæ¢è¡Œ(\u0026lt;br\u0026gt;)ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ This is the first line. And this is the second line. \u0026lt;p\u0026gt;This is the first line.\u0026lt;br\u0026gt;And this is the second line.\u0026lt;/p\u0026gt; This is the first line. And this is the second line. æ¢è¡Œï¼ˆLine Breakï¼‰ç”¨æ³•çš„æœ€ä½³å®è·µ å‡ ä¹æ¯ä¸ª Markdown åº”ç”¨ç¨‹åºéƒ½æ”¯æŒä¸¤ä¸ªæˆ–å¤šä¸ªç©ºæ ¼è¿›è¡Œæ¢è¡Œï¼Œç§°ä¸º ç»“å°¾ç©ºæ ¼ï¼ˆtrailing whitespace) çš„æ–¹å¼ï¼Œä½†è¿™æ˜¯æœ‰äº‰è®®çš„ï¼Œå› ä¸ºå¾ˆéš¾åœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥çœ‹åˆ°ç©ºæ ¼ï¼Œå¹¶ä¸”å¾ˆå¤šäººåœ¨æ¯ä¸ªå¥å­åé¢éƒ½ä¼šæœ‰æ„æˆ–æ— æ„åœ°æ·»åŠ ä¸¤ä¸ªç©ºæ ¼ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œä½ å¯èƒ½è¦ä½¿ç”¨é™¤ç»“å°¾ç©ºæ ¼ä»¥å¤–çš„å…¶å®ƒæ–¹å¼æ¥æ¢è¡Œã€‚å¹¸è¿çš„æ˜¯ï¼Œå‡ ä¹æ¯ä¸ª Markdown åº”ç”¨ç¨‹åºéƒ½æ”¯æŒå¦ä¸€ç§æ¢è¡Œæ–¹å¼ï¼šHTML çš„ \u0026lt;br\u0026gt; æ ‡ç­¾ã€‚\nä¸ºäº†å…¼å®¹æ€§ï¼Œè¯·åœ¨è¡Œå°¾æ·»åŠ â€œç»“å°¾ç©ºæ ¼â€æˆ– HTML çš„ \u0026lt;br\u0026gt; æ ‡ç­¾æ¥å®ç°æ¢è¡Œã€‚\nè¿˜æœ‰ä¸¤ç§å…¶ä»–æ–¹å¼æˆ‘å¹¶ä¸æ¨èä½¿ç”¨ã€‚CommonMark å’Œå…¶å®ƒå‡ ç§è½»é‡çº§æ ‡è®°è¯­è¨€æ”¯æŒåœ¨è¡Œå°¾æ·»åŠ åæ–œæ  (\\) çš„æ–¹å¼å®ç°æ¢è¡Œï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰ Markdown åº”ç”¨ç¨‹åºéƒ½æ”¯æŒæ­¤ç§æ–¹å¼ï¼Œå› æ­¤ä»å…¼å®¹æ€§çš„è§’åº¦æ¥çœ‹ï¼Œä¸æ¨èä½¿ç”¨ã€‚å¹¶ä¸”è‡³å°‘æœ‰ä¸¤ç§è½»é‡çº§æ ‡è®°è¯­è¨€æ”¯æŒæ— é¡»åœ¨è¡Œå°¾æ·»åŠ ä»»ä½•å†…å®¹ï¼Œåªé¡»é”®å…¥å›è½¦é”®ï¼ˆreturnï¼‰å³å¯å®ç°æ¢è¡Œã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this First line with two spaces after. And the next line.First line with the HTML tag after.\u0026lt;br\u0026gt;And the next line. First line with a backslash after.\\And the next line.First line with nothing after.And the next line. Markdown å¼ºè°ƒè¯­æ³• é€šè¿‡å°†æ–‡æœ¬è®¾ç½®ä¸ºç²—ä½“æˆ–æ–œä½“æ¥å¼ºè°ƒå…¶é‡è¦æ€§ã€‚\nç²—ä½“ï¼ˆBoldï¼‰ è¦åŠ ç²—æ–‡æœ¬ï¼Œè¯·åœ¨å•è¯æˆ–çŸ­è¯­çš„å‰åå„æ·»åŠ ä¸¤ä¸ªæ˜Ÿå·ï¼ˆasterisksï¼‰æˆ–ä¸‹åˆ’çº¿ï¼ˆunderscoresï¼‰ã€‚å¦‚éœ€åŠ ç²—ä¸€ä¸ªå•è¯æˆ–çŸ­è¯­çš„ä¸­é—´éƒ¨åˆ†ç”¨ä»¥è¡¨ç¤ºå¼ºè°ƒçš„è¯ï¼Œè¯·åœ¨è¦åŠ ç²—éƒ¨åˆ†çš„ä¸¤ä¾§å„æ·»åŠ ä¸¤ä¸ªæ˜Ÿå·ï¼ˆasterisksï¼‰ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ I just love **bold text**. I just love \u0026lt;strong\u0026gt;bold text\u0026lt;/strong\u0026gt;. I just love bold text. I just love __bold text__. I just love \u0026lt;strong\u0026gt;bold text\u0026lt;/strong\u0026gt;. I just love bold text. Love**is**bold Love\u0026lt;strong\u0026gt;is\u0026lt;/strong\u0026gt;bold Loveisbold ç²—ä½“ï¼ˆBoldï¼‰ç”¨æ³•æœ€ä½³å®è·µ Markdown åº”ç”¨ç¨‹åºåœ¨å¦‚ä½•å¤„ç†å•è¯æˆ–çŸ­è¯­ä¸­é—´çš„ä¸‹åˆ’çº¿ä¸Šå¹¶ä¸ä¸€è‡´ã€‚ä¸ºå…¼å®¹è€ƒè™‘ï¼Œåœ¨å•è¯æˆ–çŸ­è¯­ä¸­é—´éƒ¨åˆ†åŠ ç²—çš„è¯ï¼Œè¯·ä½¿ç”¨æ˜Ÿå·ï¼ˆasterisksï¼‰ã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this Love**is**bold Love__is__bold æ–œä½“ï¼ˆItalicï¼‰ è¦ç”¨æ–œä½“æ˜¾ç¤ºæ–‡æœ¬ï¼Œè¯·åœ¨å•è¯æˆ–çŸ­è¯­å‰åæ·»åŠ ä¸€ä¸ªæ˜Ÿå·ï¼ˆasteriskï¼‰æˆ–ä¸‹åˆ’çº¿ï¼ˆunderscoreï¼‰ã€‚è¦æ–œä½“çªå‡ºå•è¯çš„ä¸­é—´éƒ¨åˆ†ï¼Œè¯·åœ¨å­—æ¯å‰åå„æ·»åŠ ä¸€ä¸ªæ˜Ÿå·ï¼Œä¸­é—´ä¸è¦å¸¦ç©ºæ ¼ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ Italicized text is the *cat's meow*. Italicized text is the \u0026lt;em\u0026gt;cat's meow\u0026lt;/em\u0026gt;. Italicized text is the catâ€™s meow. Italicized text is the _cat's meow_. Italicized text is the \u0026lt;em\u0026gt;cat's meow\u0026lt;/em\u0026gt;. Italicized text is the catâ€™s meow. A*cat*meow A\u0026lt;em\u0026gt;cat\u0026lt;/em\u0026gt;meow Acatmeow æ–œä½“ï¼ˆItalicï¼‰ç”¨æ³•çš„æœ€ä½³å®è·µ è¦åŒæ—¶ç”¨ç²—ä½“å’Œæ–œä½“çªå‡ºæ˜¾ç¤ºæ–‡æœ¬ï¼Œè¯·åœ¨å•è¯æˆ–çŸ­è¯­çš„å‰åå„æ·»åŠ ä¸‰ä¸ªæ˜Ÿå·æˆ–ä¸‹åˆ’çº¿ã€‚è¦åŠ ç²—å¹¶ç”¨æ–œä½“æ˜¾ç¤ºå•è¯æˆ–çŸ­è¯­çš„ä¸­é—´éƒ¨åˆ†ï¼Œè¯·åœ¨è¦çªå‡ºæ˜¾ç¤ºçš„éƒ¨åˆ†å‰åå„æ·»åŠ ä¸‰ä¸ªæ˜Ÿå·ï¼Œä¸­é—´ä¸è¦å¸¦ç©ºæ ¼ã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this A*cat*meow A_cat_meow ç²—ä½“ï¼ˆBoldï¼‰å’Œæ–œä½“ï¼ˆItalicï¼‰ è¦åŒæ—¶ç”¨ç²—ä½“å’Œæ–œä½“çªå‡ºæ˜¾ç¤ºæ–‡æœ¬ï¼Œè¯·åœ¨å•è¯æˆ–çŸ­è¯­çš„å‰åå„æ·»åŠ ä¸‰ä¸ªæ˜Ÿå·æˆ–ä¸‹åˆ’çº¿ã€‚è¦åŠ ç²—å¹¶ç”¨æ–œä½“æ˜¾ç¤ºå•è¯æˆ–çŸ­è¯­çš„ä¸­é—´éƒ¨åˆ†ï¼Œè¯·åœ¨è¦çªå‡ºæ˜¾ç¤ºçš„éƒ¨åˆ†å‰åå„æ·»åŠ ä¸‰ä¸ªæ˜Ÿå·ï¼Œä¸­é—´ä¸è¦å¸¦ç©ºæ ¼ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ This text is ***really important***. This text is \u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;really important\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt;. This text is *really important*. This text is ___really important___. This text is \u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;really important\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt;. This text is *really important*. This text is __*really important*__. This text is \u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;really important\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt;. This text is *really important*. This text is **_really important_**. This text is \u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;really important\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt;. This text is *really important*. This is really***very***important text. This is really\u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;very\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt;important text. This is really***very***important text. ç²—ä½“ï¼ˆBoldï¼‰å’Œæ–œä½“ï¼ˆItalicï¼‰ç”¨æ³•çš„æœ€ä½³å®è·µ Markdown åº”ç”¨ç¨‹åºåœ¨å¤„ç†å•è¯æˆ–çŸ­è¯­ä¸­é—´æ·»åŠ çš„ä¸‹åˆ’çº¿ä¸Šå¹¶ä¸ä¸€è‡´ã€‚ä¸ºäº†å®ç°å…¼å®¹æ€§ï¼Œè¯·ä½¿ç”¨æ˜Ÿå·å°†å•è¯æˆ–çŸ­è¯­çš„ä¸­é—´éƒ¨åˆ†åŠ ç²—å¹¶ä»¥æ–œä½“æ˜¾ç¤ºï¼Œä»¥ç¤ºé‡è¦ã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this This is really***very***important text. This is really___very___important text. Markdown å¼•ç”¨è¯­æ³• è¦åˆ›å»ºå—å¼•ç”¨ï¼Œè¯·åœ¨æ®µè½å‰æ·»åŠ ä¸€ä¸ª \u0026gt; ç¬¦å·ã€‚\n1 \u0026gt; Dorothy followed her through many of the beautiful rooms in her castle. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š\nDorothy followed her through many of the beautiful rooms in her castle.\nå¤šä¸ªæ®µè½çš„å—å¼•ç”¨\nå—å¼•ç”¨å¯ä»¥åŒ…å«å¤šä¸ªæ®µè½ã€‚ä¸ºæ®µè½ä¹‹é—´çš„ç©ºç™½è¡Œæ·»åŠ ä¸€ä¸ª \u0026gt; ç¬¦å·ã€‚\n1 2 3 \u0026gt; Dorothy followed her through many of the beautiful rooms in her castle. \u0026gt; \u0026gt; The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nDorothy followed her through many of the beautiful rooms in her castle.\nThe Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.\nåµŒå¥—å—å¼•ç”¨\nå—å¼•ç”¨å¯ä»¥åµŒå¥—ã€‚åœ¨è¦åµŒå¥—çš„æ®µè½å‰æ·»åŠ ä¸€ä¸ª \u0026gt;\u0026gt; ç¬¦å·ã€‚\n1 2 3 \u0026gt; Dorothy followed her through many of the beautiful rooms in her castle. \u0026gt; \u0026gt;\u0026gt; The Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nDorothy followed her through many of the beautiful rooms in her castle.\nThe Witch bade her clean the pots and kettles and sweep the floor and keep the fire fed with wood.\nå¸¦æœ‰å…¶å®ƒå…ƒç´ çš„å—å¼•ç”¨\nå—å¼•ç”¨å¯ä»¥åŒ…å«å…¶ä»– Markdown æ ¼å¼çš„å…ƒç´ ã€‚å¹¶éæ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½ éœ€è¦è¿›è¡Œå®éªŒä»¥æŸ¥çœ‹å“ªäº›å…ƒç´ æœ‰æ•ˆã€‚\n1 2 3 4 5 6 \u0026gt; #### The quarterly results look great! \u0026gt; \u0026gt; - Revenue was off the chart. \u0026gt; - Profits were higher than ever. \u0026gt; \u0026gt; *Everything* is going according to **plan**. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nThe quarterly results look great! Revenue was off the chart. Profits were higher than ever. Everything is going according to plan.\nMarkdown åˆ—è¡¨è¯­æ³• å¯ä»¥å°†å¤šä¸ªæ¡ç›®ç»„ç»‡æˆæœ‰åºæˆ–æ— åºåˆ—è¡¨ã€‚\næœ‰åºåˆ—è¡¨ è¦åˆ›å»ºæœ‰åºåˆ—è¡¨ï¼Œè¯·åœ¨æ¯ä¸ªåˆ—è¡¨é¡¹å‰æ·»åŠ æ•°å­—å¹¶ç´§è·Ÿä¸€ä¸ªè‹±æ–‡å¥ç‚¹ã€‚æ•°å­—ä¸å¿…æŒ‰æ•°å­¦é¡ºåºæ’åˆ—ï¼Œä½†æ˜¯åˆ—è¡¨åº”å½“ä»¥æ•°å­— 1 èµ·å§‹ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ 1. First item2. Second item3. Third item4. Fourth item \u0026lt;ol\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ol\u0026gt; First itemSecond itemThird itemFourth item 1. First item1. Second item1. Third item1. Fourth item \u0026lt;ol\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ol\u0026gt; First itemSecond itemThird itemFourth item 1. First item8. Second item3. Third item5. Fourth item \u0026lt;ol\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ol\u0026gt; First itemSecond itemThird itemFourth item 1. First item2. Second item3. Third item 1. Indented item 2. Indented item4. Fourth item \u0026lt;ol\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;ol\u0026gt;\u0026lt;li\u0026gt;Indented item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Indented item\u0026lt;/li\u0026gt;\u0026lt;/ol\u0026gt;\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ol\u0026gt; First itemSecond itemThird itemIndented itemIndented itemFourth item æœ‰åºåˆ—è¡¨æœ€ä½³å®è·µ CommonMark and a few other lightweight markup languages let you use a parenthesis ()) as a delimiter (e.g., 1) First item), but not all Markdown applications support this, so it isnâ€™t a great option from a compatibility perspective. For compatibility, use periods only.\nâœ… Do this âŒ Don\u0026rsquo;t do this 1. First item2. Second item 1) First item2) Second item æ— åºåˆ—è¡¨ è¦åˆ›å»ºæ— åºåˆ—è¡¨ï¼Œè¯·åœ¨æ¯ä¸ªåˆ—è¡¨é¡¹å‰é¢æ·»åŠ ç ´æŠ˜å· (-)ã€æ˜Ÿå· (*) æˆ–åŠ å· (+) ã€‚ç¼©è¿›ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—è¡¨é¡¹å¯åˆ›å»ºåµŒå¥—åˆ—è¡¨ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ - First item- Second item- Third item- Fourth item \u0026lt;ul\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ul\u0026gt; First itemSecond itemThird itemFourth item * First item* Second item* Third item* Fourth item \u0026lt;ul\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ul\u0026gt; First itemSecond itemThird itemFourth item + First item+ Second item+ Third item+ Fourth item \u0026lt;ul\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ul\u0026gt; First itemSecond itemThird itemFourth item - First item- Second item- Third item - Indented item - Indented item- Fourth item \u0026lt;ul\u0026gt;\u0026lt;li\u0026gt;First item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Second item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Third item\u0026lt;ul\u0026gt;\u0026lt;li\u0026gt;Indented item\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Indented item\u0026lt;/li\u0026gt;\u0026lt;/ul\u0026gt;\u0026lt;/li\u0026gt;\u0026lt;li\u0026gt;Fourth item\u0026lt;/li\u0026gt;\u0026lt;/ul\u0026gt; First itemSecond itemThird itemIndented itemIndented itemFourth item æ— åºåˆ—è¡¨æœ€ä½³å®è·µ Markdown applications donâ€™t agree on how to handle different delimiters in the same list. For compatibility, don\u0026rsquo;t mix and match delimiters in the same list â€” pick one and stick with it.\nâœ… Do this âŒ Don\u0026rsquo;t do this - First item- Second item- Third item- Fourth item + First item* Second item- Third item+ Fourth item åœ¨åˆ—è¡¨ä¸­åµŒå¥—å…¶ä»–å…ƒç´  è¦åœ¨ä¿ç•™åˆ—è¡¨è¿ç»­æ€§çš„åŒæ—¶åœ¨åˆ—è¡¨ä¸­æ·»åŠ å¦ä¸€ç§å…ƒç´ ï¼Œè¯·å°†è¯¥å…ƒç´ ç¼©è¿›å››ä¸ªç©ºæ ¼æˆ–ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š\næ®µè½ 1 2 3 4 5 6 * This is the first list item. * Here\u0026#39;s the second list item. I need to add another paragraph below the second list item. * And here\u0026#39;s the third list item. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nThis is the first list item.\nHere\u0026rsquo;s the second list item.\nI need to add another paragraph below the second list item.\nAnd here\u0026rsquo;s the third list item.\nå¼•ç”¨å— 1 2 3 4 5 6 * This is the first list item. * Here\u0026#39;s the second list item. \u0026gt; A blockquote would look great below the second list item. * And here\u0026#39;s the third list item. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nThis is the first list item.\nHere\u0026rsquo;s the second list item.\nA blockquote would look great below the second list item.\nAnd here\u0026rsquo;s the third list item.\nä»£ç å— ä»£ç å—é€šå¸¸é‡‡ç”¨å››ä¸ªç©ºæ ¼æˆ–ä¸€ä¸ªåˆ¶è¡¨ç¬¦ç¼©è¿›ã€‚å½“å®ƒä»¬è¢«æ”¾åœ¨åˆ—è¡¨ä¸­æ—¶ï¼Œè¯·å°†å®ƒä»¬ç¼©è¿›å…«ä¸ªç©ºæ ¼æˆ–ä¸¤ä¸ªåˆ¶è¡¨ç¬¦ã€‚\n1 2 3 4 5 6 7 8 9 1. Open the file. 2. Find the following code block on line 21: \u0026amp;lt;html\u0026gt; \u0026amp;lt;head\u0026gt; \u0026amp;lt;title\u0026gt;Test\u0026amp;lt;/title\u0026gt; \u0026amp;lt;/head\u0026gt; 3. Update the title to match the name of your website. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nOpen the file.\nFind the following code block on line 21:\n1 2 3 4 \u0026amp;lt;html\u0026gt; \u0026amp;lt;head\u0026gt; \u0026amp;lt;title\u0026gt;Test\u0026amp;lt;/title\u0026gt; \u0026amp;lt;/head\u0026gt; Update the title to match the name of your website.\nå›¾ç‰‡ 1 2 3 4 5 6 1. Open the file containing the Linux mascot. 2. Marvel at its beauty. ![Tux, the Linux mascot](/assets/images/tux.png) 3. Close the file. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nOpen the file containing the Linux mascot.\nMarvel at its beauty.\nClose the file.\nåˆ—è¡¨ You can nest an unordered list in an ordered list, or vice versa.\n1 2 3 4 5 6 1. First item 2. Second item 3. Third item - Indented item - Indented item 4. Fourth item æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nFirst item Second item Third item Indented item Indented item Fourth item Markdown ä»£ç è¯­æ³• è¦å°†å•è¯æˆ–çŸ­è¯­è¡¨ç¤ºä¸ºä»£ç ï¼Œè¯·å°†å…¶åŒ…è£¹åœ¨åå¼•å· (```) ä¸­ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ At the command prompt, type nano. At the command prompt, type \u0026lt;code\u0026gt;nano\u0026lt;/code\u0026gt;. At the command prompt, type nano. è½¬ä¹‰åå¼•å· å¦‚æœä½ è¦è¡¨ç¤ºä¸ºä»£ç çš„å•è¯æˆ–çŸ­è¯­ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåå¼•å·ï¼Œåˆ™å¯ä»¥é€šè¿‡å°†å•è¯æˆ–çŸ­è¯­åŒ…è£¹åœ¨åŒåå¼•å·(````)ä¸­ã€‚\nMarkdownè¯­æ³• HTML é¢„è§ˆæ•ˆæœ Use `code` in your Markdown file. \u0026lt;code\u0026gt;Use code in your Markdown file.\u0026lt;/code\u0026gt; Use code in your Markdown file. ä»£ç å— è¦åˆ›å»ºä»£ç å—ï¼Œè¯·å°†ä»£ç å—çš„æ¯ä¸€è¡Œç¼©è¿›è‡³å°‘å››ä¸ªç©ºæ ¼æˆ–ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚\n1 2 3 4 \u0026amp;lt;html\u0026gt; \u0026amp;lt;head\u0026gt; \u0026amp;lt;/head\u0026gt; \u0026amp;lt;/html\u0026gt; æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\n1 2 3 4 \u0026amp;lt;html\u0026gt; \u0026amp;lt;head\u0026gt; \u0026amp;lt;/head\u0026gt; \u0026amp;lt;/html\u0026gt; Note: è¦åˆ›å»ºä¸ç”¨ç¼©è¿›çš„ä»£ç å—ï¼Œè¯·ä½¿ç”¨ å›´æ å¼ä»£ç å—ï¼ˆfenced code blocksï¼‰.\nMarkdown åˆ†éš”çº¿è¯­æ³• è¦åˆ›å»ºåˆ†éš”çº¿ï¼Œè¯·åœ¨å•ç‹¬ä¸€è¡Œä¸Šä½¿ç”¨ä¸‰ä¸ªæˆ–å¤šä¸ªæ˜Ÿå· (***)ã€ç ´æŠ˜å· (---) æˆ–ä¸‹åˆ’çº¿ (___) ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«å…¶ä»–å†…å®¹ã€‚\n1 2 3 4 5 *** --- _________________ ä»¥ä¸Šä¸‰ä¸ªåˆ†éš”çº¿çš„æ¸²æŸ“æ•ˆæœçœ‹èµ·æ¥éƒ½ä¸€æ ·ï¼š\nåˆ†éš”çº¿ï¼ˆHorizontal Ruleï¼‰ç”¨æ³•æœ€ä½³å®è·µ ä¸ºäº†å…¼å®¹æ€§ï¼Œè¯·åœ¨åˆ†éš”çº¿çš„å‰åå‡æ·»åŠ ç©ºç™½è¡Œã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this Try to put a blank line before...---...and after a horizontal rule. Without blank lines, this would be a heading.---Don't do this! Markdown é“¾æ¥è¯­æ³• é“¾æ¥æ–‡æœ¬æ”¾åœ¨ä¸­æ‹¬å·å†…ï¼Œé“¾æ¥åœ°å€æ”¾åœ¨åé¢çš„æ‹¬å·ä¸­ï¼Œé“¾æ¥titleå¯é€‰ã€‚\nè¶…é“¾æ¥Markdownè¯­æ³•ä»£ç ï¼š[è¶…é“¾æ¥æ˜¾ç¤ºå](è¶…é“¾æ¥åœ°å€ \u0026quot;è¶…é“¾æ¥title\u0026quot;)\nå¯¹åº”çš„HTMLä»£ç ï¼š\u0026lt;a href=\u0026quot;è¶…é“¾æ¥åœ°å€\u0026quot; title=\u0026quot;è¶…é“¾æ¥title\u0026quot;\u0026gt;è¶…é“¾æ¥æ˜¾ç¤ºå\u0026lt;/a\u0026gt;\n1 è¿™æ˜¯ä¸€ä¸ªé“¾æ¥ [Markdownè¯­æ³•](https://markdown.com.cn)ã€‚ æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nè¿™æ˜¯ä¸€ä¸ªé“¾æ¥ Markdownè¯­æ³• (opens new window)ã€‚\nç»™é“¾æ¥å¢åŠ  Title é“¾æ¥titleæ˜¯å½“é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šæ—¶ä¼šå‡ºç°çš„æ–‡å­—ï¼Œè¿™ä¸ªtitleæ˜¯å¯é€‰çš„ï¼Œå®ƒæ”¾åœ¨åœ†æ‹¬å·ä¸­é“¾æ¥åœ°å€åé¢ï¼Œè·Ÿé“¾æ¥åœ°å€ä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚\n1 è¿™æ˜¯ä¸€ä¸ªé“¾æ¥ [Markdownè¯­æ³•](https://markdown.com.cn \u0026#34;æœ€å¥½çš„markdownæ•™ç¨‹\u0026#34;)ã€‚ æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nè¿™æ˜¯ä¸€ä¸ªé“¾æ¥ Markdownè¯­æ³• (opens new window)ã€‚\nç½‘å€å’ŒEmailåœ°å€ ä½¿ç”¨å°–æ‹¬å·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŠŠURLæˆ–è€…emailåœ°å€å˜æˆå¯ç‚¹å‡»çš„é“¾æ¥ã€‚\n1 2 \u0026lt;https://markdown.com.cn\u0026gt; \u0026lt;fake@example.com\u0026gt; æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nhttps://markdown.com.cn(opens new window) fake@example.com\nå¸¦æ ¼å¼åŒ–çš„é“¾æ¥ å¼ºè°ƒ é“¾æ¥, åœ¨é“¾æ¥è¯­æ³•å‰åå¢åŠ æ˜Ÿå·ã€‚ è¦å°†é“¾æ¥è¡¨ç¤ºä¸ºä»£ç ï¼Œè¯·åœ¨æ–¹æ‹¬å·ä¸­æ·»åŠ åå¼•å·ã€‚\n1 2 3 I love supporting the **[EFF](https://eff.org)**. This is the *[Markdown Guide](https://www.markdownguide.org)*. See the section on [`code`](#code). æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nI love supporting the EFF (opens new window). This is the Markdown Guide (opens new window). See the section on code.\nå¼•ç”¨ç±»å‹é“¾æ¥ å¼•ç”¨æ ·å¼é“¾æ¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„é“¾æ¥ï¼Œå®ƒä½¿URLåœ¨Markdownä¸­æ›´æ˜“äºæ˜¾ç¤ºå’Œé˜…è¯»ã€‚å‚è€ƒæ ·å¼é“¾æ¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸æ–‡æœ¬ä¿æŒå†…è”çš„éƒ¨åˆ†ä»¥åŠå­˜å‚¨åœ¨æ–‡ä»¶ä¸­å…¶ä»–ä½ç½®çš„éƒ¨åˆ†ï¼Œä»¥ä½¿æ–‡æœ¬æ˜“äºé˜…è¯»ã€‚\né“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†æ ¼å¼ å¼•ç”¨ç±»å‹çš„é“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†ä½¿ç”¨ä¸¤ç»„æ‹¬å·è¿›è¡Œæ ¼å¼è®¾ç½®ã€‚ç¬¬ä¸€ç»„æ–¹æ‹¬å·åŒ…å›´åº”æ˜¾ç¤ºä¸ºé“¾æ¥çš„æ–‡æœ¬ã€‚ç¬¬äºŒç»„æ‹¬å·æ˜¾ç¤ºäº†ä¸€ä¸ªæ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾ç”¨äºæŒ‡å‘æ‚¨å­˜å‚¨åœ¨æ–‡æ¡£å…¶ä»–ä½ç½®çš„é“¾æ¥ã€‚\nå°½ç®¡ä¸æ˜¯å¿…éœ€çš„ï¼Œå¯ä»¥åœ¨ç¬¬ä¸€ç»„å’Œç¬¬äºŒç»„æ‹¬å·ä¹‹é—´åŒ…å«ä¸€ä¸ªç©ºæ ¼ã€‚ç¬¬äºŒç»„æ‹¬å·ä¸­çš„æ ‡ç­¾ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥åŒ…å«å­—æ¯ï¼Œæ•°å­—ï¼Œç©ºæ ¼æˆ–æ ‡ç‚¹ç¬¦å·ã€‚\nä»¥ä¸‹ç¤ºä¾‹æ ¼å¼å¯¹äºé“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†æ•ˆæœç›¸åŒï¼š\n[hobbit-hole][1] [hobbit-hole] [1] é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ ¼å¼ å¼•ç”¨ç±»å‹é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†ä½¿ç”¨ä»¥ä¸‹å±æ€§è®¾ç½®æ ¼å¼ï¼š\næ”¾åœ¨æ‹¬å·ä¸­çš„æ ‡ç­¾ï¼Œå…¶åç´§è·Ÿä¸€ä¸ªå†’å·å’Œè‡³å°‘ä¸€ä¸ªç©ºæ ¼ï¼ˆä¾‹å¦‚[label]:ï¼‰ã€‚ é“¾æ¥çš„URLï¼Œå¯ä»¥é€‰æ‹©å°†å…¶æ‹¬åœ¨å°–æ‹¬å·ä¸­ã€‚ é“¾æ¥çš„å¯é€‰æ ‡é¢˜ï¼Œå¯ä»¥å°†å…¶æ‹¬åœ¨åŒå¼•å·ï¼Œå•å¼•å·æˆ–æ‹¬å·ä¸­ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ ¼å¼å¯¹äºé“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ•ˆæœç›¸åŒï¼š\n[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle [1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle \u0026quot;Hobbit lifestyles\u0026quot; [1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle 'Hobbit lifestyles' [1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle (Hobbit lifestyles) [1]: \u0026lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle\u0026gt; \u0026quot;Hobbit lifestyles\u0026quot; [1]: \u0026lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle\u0026gt; 'Hobbit lifestyles' [1]: \u0026lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle\u0026gt; (Hobbit lifestyles) å¯ä»¥å°†é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ”¾åœ¨Markdownæ–‡æ¡£ä¸­çš„ä»»ä½•ä½ç½®ã€‚æœ‰äº›äººå°†å®ƒä»¬æ”¾åœ¨å‡ºç°çš„æ®µè½ä¹‹åï¼Œæœ‰äº›äººåˆ™å°†å®ƒä»¬æ”¾åœ¨æ–‡æ¡£çš„æœ«å°¾ï¼ˆä¾‹å¦‚å°¾æ³¨æˆ–è„šæ³¨ï¼‰ã€‚\né“¾æ¥æœ€ä½³å®è·µ ä¸åŒçš„ Markdown åº”ç”¨ç¨‹åºå¤„ç†URLä¸­é—´çš„ç©ºæ ¼æ–¹å¼ä¸ä¸€æ ·ã€‚ä¸ºäº†å…¼å®¹æ€§ï¼Œè¯·å°½é‡ä½¿ç”¨%20ä»£æ›¿ç©ºæ ¼ã€‚\nâœ… Do this âŒ Don\u0026rsquo;t do this [link](https://www.example.com/my%20great%20page) [link](https://www.example.com/my great page) Markdown å›¾ç‰‡è¯­æ³• è¦æ·»åŠ å›¾åƒï¼Œè¯·ä½¿ç”¨æ„Ÿå¹å· (!), ç„¶ååœ¨æ–¹æ‹¬å·å¢åŠ æ›¿ä»£æ–‡æœ¬ï¼Œå›¾ç‰‡é“¾æ¥æ”¾åœ¨åœ†æ‹¬å·é‡Œï¼Œæ‹¬å·é‡Œçš„é“¾æ¥åå¯ä»¥å¢åŠ ä¸€ä¸ªå¯é€‰çš„å›¾ç‰‡æ ‡é¢˜æ–‡æœ¬ã€‚\næ’å…¥å›¾ç‰‡Markdownè¯­æ³•ä»£ç ï¼š![å›¾ç‰‡alt](å›¾ç‰‡é“¾æ¥ \u0026quot;å›¾ç‰‡title\u0026quot;)ã€‚\nå¯¹åº”çš„HTMLä»£ç ï¼š\u0026lt;img src=\u0026quot;å›¾ç‰‡é“¾æ¥\u0026quot; alt=\u0026quot;å›¾ç‰‡alt\u0026quot; title=\u0026quot;å›¾ç‰‡title\u0026quot;\u0026gt;\n1 ![è¿™æ˜¯å›¾ç‰‡](/assets/img/philly-magic-garden.jpg \u0026#34;Magic Gardens\u0026#34;) æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\né“¾æ¥å›¾ç‰‡ ç»™å›¾ç‰‡å¢åŠ é“¾æ¥ï¼Œè¯·å°†å›¾åƒçš„Markdown æ‹¬åœ¨æ–¹æ‹¬å·ä¸­ï¼Œç„¶åå°†é“¾æ¥æ·»åŠ åœ¨åœ†æ‹¬å·ä¸­ã€‚\n1 [![æ²™æ¼ ä¸­çš„å²©çŸ³å›¾ç‰‡](/assets/img/shiprock.jpg \u0026#34;Shiprock\u0026#34;)](https://markdown.com.cn) æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\nMarkdown è½¬ä¹‰å­—ç¬¦è¯­æ³• è¦æ˜¾ç¤ºåŸæœ¬ç”¨äºæ ¼å¼åŒ– Markdown æ–‡æ¡£çš„å­—ç¬¦ï¼Œè¯·åœ¨å­—ç¬¦å‰é¢æ·»åŠ åæ–œæ å­—ç¬¦ \\ ã€‚\n1 \\* Without the backslash, this would be a bullet in an unordered list. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š\n* Without the backslash, this would be a bullet in an unordered list.\nå¯åšè½¬ä¹‰çš„å­—ç¬¦ ä»¥ä¸‹åˆ—å‡ºçš„å­—ç¬¦éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨åæ–œæ å­—ç¬¦ä»è€Œè¾¾åˆ°è½¬ä¹‰ç›®çš„ã€‚\nCharacter Name \\ backslash ` backtick (see also escaping backticks in code) * asterisk _ underscore { } curly braces [ ] brackets ( ) parentheses # pound sign + plus sign - minus sign (hyphen) . dot ! exclamation mark | pipe (see also escaping pipe in tables) ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬ä¹‰ åœ¨ HTML æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªå­—ç¬¦éœ€è¦ç‰¹æ®Šå¤„ç†ï¼š \u0026lt; å’Œ \u0026amp; ã€‚ \u0026lt; ç¬¦å·ç”¨äºèµ·å§‹æ ‡ç­¾ï¼Œ\u0026amp; ç¬¦å·åˆ™ç”¨äºæ ‡è®° HTML å®ä½“ï¼Œå¦‚æœä½ åªæ˜¯æƒ³è¦ä½¿ç”¨è¿™äº›ç¬¦å·ï¼Œä½ å¿…é¡»è¦ä½¿ç”¨å®ä½“çš„å½¢å¼ï¼Œåƒæ˜¯ \u0026lt; å’Œ \u0026amp;ã€‚\n\u0026amp; ç¬¦å·å…¶å®å¾ˆå®¹æ˜“è®©å†™ä½œç½‘é¡µæ–‡ä»¶çš„äººæ„Ÿåˆ°å›°æ‰°ï¼Œå¦‚æœä½ è¦æ‰“ã€ŒAT\u0026amp;Tã€ ï¼Œä½ å¿…é¡»è¦å†™æˆã€ŒAT\u0026amp;Tã€ ï¼Œè¿˜å¾—è½¬æ¢ç½‘å€å†…çš„ \u0026amp; ç¬¦å·ï¼Œå¦‚æœä½ è¦é“¾æ¥åˆ°ï¼š\n1 http://images.google.com/images?num=30\u0026amp;q=larry+bird ä½ å¿…é¡»è¦æŠŠç½‘å€è½¬æˆï¼š\n1 http://images.google.com/images?num=30\u0026amp;amp;q=larry+bird æ‰èƒ½æ”¾åˆ°é“¾æ¥æ ‡ç­¾çš„ href å±æ€§é‡Œã€‚ä¸ç”¨è¯´ä¹ŸçŸ¥é“è¿™å¾ˆå®¹æ˜“å¿˜è®°ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯ HTML æ ‡å‡†æ£€æŸ¥æ‰€æ£€æŸ¥åˆ°çš„é”™è¯¯ä¸­ï¼Œæ•°é‡æœ€å¤šçš„ã€‚\nMarkdown å…è®¸ä½ ç›´æ¥ä½¿ç”¨è¿™äº›ç¬¦å·ï¼Œå®ƒå¸®ä½ è‡ªåŠ¨è½¬ä¹‰å­—ç¬¦ã€‚å¦‚æœä½ ä½¿ç”¨ \u0026amp; ç¬¦å·çš„ä½œä¸º HTML å®ä½“çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šè¢«è½¬æ¢ï¼Œè€Œåœ¨å…¶å®ƒæƒ…å†µä¸‹ï¼Œå®ƒåˆ™ä¼šè¢«è½¬æ¢æˆ \u0026amp;ã€‚æ‰€ä»¥ä½ å¦‚æœè¦åœ¨æ–‡ä»¶ä¸­æ’å…¥ä¸€ä¸ªè‘—ä½œæƒçš„ç¬¦å·ï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š\n1 \u0026amp;copy; Markdown å°†ä¸ä¼šå¯¹è¿™æ®µæ–‡å­—åšä¿®æ”¹ï¼Œä½†æ˜¯å¦‚æœä½ è¿™æ ·å†™ï¼š\n1 AT\u0026amp;T Markdown å°±ä¼šå°†å®ƒè½¬ä¸ºï¼š\n1 AT\u0026amp;amp;T ç±»ä¼¼çš„çŠ¶å†µä¹Ÿä¼šå‘ç”Ÿåœ¨ \u0026lt; ç¬¦å·ä¸Šï¼Œå› ä¸º Markdown æ”¯æŒ è¡Œå†… HTML ï¼Œå¦‚æœä½ ä½¿ç”¨ \u0026lt; ç¬¦å·ä½œä¸º HTML æ ‡ç­¾çš„åˆ†éš”ç¬¦ï¼Œé‚£ Markdown ä¹Ÿä¸ä¼šå¯¹å®ƒåšä»»ä½•è½¬æ¢ï¼Œä½†æ˜¯å¦‚æœä½ æ˜¯å†™ï¼š\n1 4 \u0026lt; 5 Markdown å°†ä¼šæŠŠå®ƒè½¬æ¢ä¸ºï¼š\n1 4 \u0026amp;lt; 5 éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Markdown çš„å—çº§å…ƒç´ å’Œå†…è”å…ƒç´ ä¸­ï¼Œ \u0026lt; å’Œ \u0026amp; ä¸¤ä¸ªç¬¦å·éƒ½ä¼šè¢«è‡ªåŠ¨è½¬æ¢æˆ HTML å®ä½“ï¼Œè¿™é¡¹ç‰¹æ€§è®©ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ Markdown å†™ HTMLã€‚ï¼ˆåœ¨ HTML è¯­æ³•ä¸­ï¼Œä½ è¦æ‰‹åŠ¨æŠŠæ‰€æœ‰çš„ \u0026lt; å’Œ \u0026amp; éƒ½è½¬æ¢ä¸º HTML å®ä½“ã€‚ï¼‰\nMarkdown å†…åµŒ HTML æ ‡ç­¾ å¯¹äº Markdown æ¶µç›–èŒƒå›´ä¹‹å¤–çš„æ ‡ç­¾ï¼Œéƒ½å¯ä»¥ç›´æ¥åœ¨æ–‡ä»¶é‡Œé¢ç”¨ HTML æœ¬èº«ã€‚å¦‚éœ€ä½¿ç”¨ HTMLï¼Œä¸éœ€è¦é¢å¤–æ ‡æ³¨è¿™æ˜¯ HTML æˆ–æ˜¯ Markdownï¼Œåªéœ€ HTML æ ‡ç­¾æ·»åŠ åˆ° Markdown æ–‡æœ¬ä¸­å³å¯ã€‚\nè¡Œçº§å…§è”æ ‡ç­¾ HTML çš„è¡Œçº§å…§è”æ ‡ç­¾å¦‚ \u0026lt;span\u0026gt;ã€\u0026lt;cite\u0026gt;ã€\u0026lt;del\u0026gt; ä¸å—é™åˆ¶ï¼Œå¯ä»¥åœ¨ Markdown çš„æ®µè½ã€åˆ—è¡¨æˆ–æ˜¯æ ‡é¢˜é‡Œä»»æ„ä½¿ç”¨ã€‚ä¾ç…§ä¸ªäººä¹ æƒ¯ï¼Œç”šè‡³å¯ä»¥ä¸ç”¨ Markdown æ ¼å¼ï¼Œè€Œé‡‡ç”¨ HTML æ ‡ç­¾æ¥æ ¼å¼åŒ–ã€‚ä¾‹å¦‚ï¼šå¦‚æœæ¯”è¾ƒå–œæ¬¢ HTML çš„ \u0026lt;a\u0026gt; æˆ– \u0026lt;img\u0026gt; æ ‡ç­¾ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æ ‡ç­¾ï¼Œè€Œä¸ç”¨ Markdown æä¾›çš„é“¾æ¥æˆ–æ˜¯å›¾ç‰‡è¯­æ³•ã€‚å½“ä½ éœ€è¦æ›´æ”¹å…ƒç´ çš„å±æ€§æ—¶ï¼ˆä¾‹å¦‚ä¸ºæ–‡æœ¬æŒ‡å®šé¢œè‰²æˆ–æ›´æ”¹å›¾åƒçš„å®½åº¦ï¼‰ï¼Œä½¿ç”¨ HTML æ ‡ç­¾æ›´æ–¹ä¾¿äº›ã€‚\nHTML è¡Œçº§å…§è”æ ‡ç­¾å’ŒåŒºå—æ ‡ç­¾ä¸åŒï¼Œåœ¨å…§è”æ ‡ç­¾çš„èŒƒå›´å†…ï¼Œ Markdown çš„è¯­æ³•æ˜¯å¯ä»¥è§£æçš„ã€‚\n1 This **word** is bold. This \u0026lt;em\u0026gt;word\u0026lt;/em\u0026gt; is italic. æ¸²æŸ“æ•ˆæœå¦‚ä¸‹:\nThis word is bold. This word is italic.\nåŒºå—æ ‡ç­¾ åŒºå—å…ƒç´ â”€â”€æ¯”å¦‚ \u0026lt;div\u0026gt;ã€\u0026lt;table\u0026gt;ã€\u0026lt;pre\u0026gt;ã€\u0026lt;p\u0026gt; ç­‰æ ‡ç­¾ï¼Œå¿…é¡»åœ¨å‰ååŠ ä¸Šç©ºè¡Œï¼Œä»¥ä¾¿äºå†…å®¹åŒºåˆ†ã€‚è€Œä¸”è¿™äº›å…ƒç´ çš„å¼€å§‹ä¸ç»“å°¾æ ‡ç­¾ï¼Œä¸å¯ä»¥ç”¨ tab æˆ–æ˜¯ç©ºç™½æ¥ç¼©è¿›ã€‚Markdown ä¼šè‡ªåŠ¨è¯†åˆ«è¿™åŒºå—å…ƒç´ ï¼Œé¿å…åœ¨åŒºå—æ ‡ç­¾å‰ååŠ ä¸Šæ²¡æœ‰å¿…è¦çš„ \u0026lt;p\u0026gt; æ ‡ç­¾ã€‚\nä¾‹å¦‚ï¼Œåœ¨ Markdown æ–‡ä»¶é‡ŒåŠ ä¸Šä¸€æ®µ HTML è¡¨æ ¼ï¼š\n1 2 3 4 5 6 7 8 9 This is a regular paragraph. \u0026lt;table\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Foo\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; This is another regular paragraph. è¯·æ³¨æ„ï¼ŒMarkdown è¯­æ³•åœ¨ HTML åŒºå—æ ‡ç­¾ä¸­å°†ä¸ä¼šè¢«è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œä½ æ— æ³•åœ¨ HTML åŒºå—å†…ä½¿ç”¨ Markdown å½¢å¼çš„*å¼ºè°ƒ*ã€‚\nHTML ç”¨æ³•æœ€ä½³å®è·µ å‡ºäºå®‰å…¨åŸå› ï¼Œå¹¶éæ‰€æœ‰ Markdown åº”ç”¨ç¨‹åºéƒ½æ”¯æŒåœ¨ Markdown æ–‡æ¡£ä¸­æ·»åŠ  HTMLã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·æŸ¥çœ‹ç›¸åº” Markdown åº”ç”¨ç¨‹åºçš„æ‰‹å†Œã€‚æŸäº›åº”ç”¨ç¨‹åºåªæ”¯æŒ HTML æ ‡ç­¾çš„å­é›†ã€‚\nå¯¹äº HTML çš„å—çº§å…ƒç´  \u0026lt;div\u0026gt;ã€\u0026lt;table\u0026gt;ã€\u0026lt;pre\u0026gt; å’Œ \u0026lt;p\u0026gt;ï¼Œè¯·åœ¨å…¶å‰åä½¿ç”¨ç©ºè¡Œï¼ˆblank linesï¼‰ä¸å…¶å®ƒå†…å®¹è¿›è¡Œåˆ†éš”ã€‚å°½é‡ä¸è¦ä½¿ç”¨åˆ¶è¡¨ç¬¦ï¼ˆtabsï¼‰æˆ–ç©ºæ ¼ï¼ˆspacesï¼‰å¯¹ HTML æ ‡ç­¾åšç¼©è¿›ï¼Œå¦åˆ™å°†å½±å“æ ¼å¼ã€‚\nåœ¨ HTML å—çº§æ ‡ç­¾å†…ä¸èƒ½ä½¿ç”¨ Markdown è¯­æ³•ã€‚ä¾‹å¦‚ \u0026lt;p\u0026gt;italic and **bold**\u0026lt;/p\u0026gt; å°†ä¸èµ·ä½œç”¨ã€‚\n","date":"2024-05-11T00:00:00Z","image":"https://nova-bryan.github.io/p/markdown_grammar/mark_hu8927113685150964021.png","permalink":"https://nova-bryan.github.io/p/markdown_grammar/","title":"Markdown_Grammar"},{"content":"æ±‚æ•´æ•°çš„å› å­ï¼ˆä¹Ÿç§°ä¸º çº¦æ•°ï¼‰å¯ä»¥ä½¿ç”¨ ä» 1 åˆ° âˆšN è¿­ä»£çš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥å¤§å¹…å‡å°‘è®¡ç®—æ¬¡æ•°ï¼Œä» O(N) ä¼˜åŒ–åˆ° O(âˆšN)ï¼Œå¤§å¹…æå‡é€Ÿåº¦ã€‚\n1. O(âˆšN) é«˜æ•ˆå› å­æšä¸¾ åŸç†ï¼š\nå¦‚æœ x æ˜¯ N çš„å› å­ï¼Œåˆ™ N/x ä¹Ÿæ˜¯ N çš„å› å­ï¼Œåªéœ€è¦éå† 1 åˆ° âˆšN å³å¯æ‰¾åˆ°æ‰€æœ‰å› å­ã€‚ ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import java.util.*; public class Main { public static void main(String[] args) { Scanner sc = new Scanner(System.in); int n = sc.nextInt(); // è¯»å–æ•´æ•° N sc.close(); List\u0026lt;Integer\u0026gt; factors = new ArrayList\u0026lt;\u0026gt;(); for (int i = 1; i * i \u0026lt;= n; i++) { if (n % i == 0) { factors.add(i); // i æ˜¯å› å­ if (i != n / i) { factors.add(n / i); // N / i ä¹Ÿæ˜¯å› å­ } } } // å› å­æ’åºï¼ˆå¦‚æœéœ€è¦ä»å°åˆ°å¤§æ’åˆ—ï¼‰ Collections.sort(factors); System.out.println(factors); } } ç¤ºä¾‹ï¼š\n1 2 è¾“å…¥: 36 è¾“å‡º: [1, 2, 3, 4, 6, 9, 12, 18, 36] æ—¶é—´å¤æ‚åº¦ï¼šO(âˆšN)ï¼Œç›¸æ¯” O(N) çš„æš´åŠ›æ–¹æ³•ï¼Œé€Ÿåº¦å¿«å¾ˆå¤šï¼\n2. åªåˆ¤æ–­å› å­ä¸ªæ•°ï¼ˆä¸å­˜å‚¨ï¼‰ å¦‚æœä½ åªæƒ³çŸ¥é“ å› å­ä¸ªæ•°ï¼Œå¯ä»¥ç”¨è®¡æ•°å™¨ï¼š\n1 2 3 4 5 6 7 8 int count = 0; for (int i = 1; i * i \u0026lt;= n; i++) { if (n % i == 0) { count++; if (i != n / i) count++; // è®¡æ•°å› å­ } } System.out.println(count); ç¤ºä¾‹ï¼š\n1 2 è¾“å…¥: 36 è¾“å‡º: 9 // å› å­ä¸ªæ•° 3. ç‰¹æ®Šä¼˜åŒ–ï¼šåªæ‰¾ç´ å› å­ å¦‚æœä½ åªæƒ³æ‰¾ ç´ æ•°å› å­ï¼ˆå³ N è¢«å“ªäº›ç´ æ•°æ•´é™¤ï¼‰ï¼Œå¯ä»¥ç”¨è¯•é™¤æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public static List\u0026lt;Integer\u0026gt; primeFactors(int n) { List\u0026lt;Integer\u0026gt; primes = new ArrayList\u0026lt;\u0026gt;(); // å…ˆé™¤å» 2 while (n % 2 == 0) { primes.add(2); n /= 2; } // å†æ£€æŸ¥å¥‡æ•° for (int i = 3; i * i \u0026lt;= n; i += 2) { while (n % i == 0) { primes.add(i); n /= i; } } // å¦‚æœå‰©ä½™çš„æ˜¯ç´ æ•° if (n \u0026gt; 1) primes.add(n); return primes; } ç¤ºä¾‹ï¼š\n1 2 è¾“å…¥: 36 è¾“å‡º: [2, 2, 3, 3] // 36 = 2Â² Ã— 3Â² æ—¶é—´å¤æ‚åº¦ï¼šO(âˆšN)ï¼Œæ¯” O(N) æ–¹æ³•å¿«å¾ˆå¤šã€‚\næ€»ç»“ æ–¹æ³• é€‚ç”¨åœºæ™¯ å¤æ‚åº¦ å¤‡æ³¨ O(âˆšN) éå†å› å­ æ‰¾å‡ºæ‰€æœ‰å› å­ O(âˆšN) æ¨è O(âˆšN) è®¡æ•°å› å­ åªæ±‚å› å­ä¸ªæ•° O(âˆšN) æ— éœ€å­˜å‚¨ è¯•é™¤æ³•æ‰¾ç´ å› å­ ä»…æ‰¾ç´ å› å­ O(âˆšN) ç”¨äºåˆ†è§£è´¨å› æ•° å¦‚æœåªæ˜¯æ‰¾å› å­ï¼Œæ¨è O(âˆšN) æ–¹æ³•ï¼Œé€Ÿåº¦å¿«ï¼Œä»£ç ç®€æ´ï¼ ğŸš€\nä¾‹é¢˜ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 import java.util.*; public class Main { public static void main(String[] args) { Scanner sc = new Scanner(System.in); long n = sc.nextLong(); // è¯»å– Nï¼Œæ³¨æ„è¿™é‡Œç”¨ longï¼Œé˜²æ­¢æº¢å‡º sc.close(); int maxLen = 0; // è®°å½•æœ€é•¿é•¿åº¦ int start = 0; // è®°å½•æœ€é•¿åºåˆ—çš„èµ·å§‹å› å­ // éå†èµ·å§‹å› å­ iï¼Œä» 2 å¼€å§‹ï¼ˆ1 ä¸ç®—ï¼‰ for (int i = 2; i * i \u0026lt;= n; i++) { long product = 1; int j = i; // è®¡ç®—è¿ç»­ä¹˜ç§¯ï¼Œç›´åˆ°è¶…å‡º N while (product * j \u0026lt;= n) { product *= j; // å¦‚æœè¿™ä¸ªè¿ç»­ä¹˜ç§¯åˆšå¥½æ•´é™¤ N if (n % product == 0) { int length = j - i + 1; // è®¡ç®—å½“å‰åºåˆ—çš„é•¿åº¦ if (length \u0026gt; maxLen) { maxLen = length; start = i; } } j++; // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªè¿ç»­å› å­ } } // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„è¿ç»­å› å­ï¼Œæœ€é•¿åºåˆ—å°±æ˜¯ N æœ¬èº« if (maxLen == 0) { System.out.println(1); System.out.println(n); } else { System.out.println(maxLen); for (int i = 0; i \u0026lt; maxLen; i++) { if (i \u0026gt; 0) System.out.print(\u0026#34;*\u0026#34;); System.out.print(start + i); } } } } ","date":"2024-05-11T00:00:00Z","image":"https://nova-bryan.github.io/p/%E6%95%B4%E6%95%B0%E5%9B%A0%E5%AD%90%E7%9A%84%E5%BF%AB%E9%80%9F%E6%B1%82%E6%B3%95/image_hu7343995253115549451.png","permalink":"https://nova-bryan.github.io/p/%E6%95%B4%E6%95%B0%E5%9B%A0%E5%AD%90%E7%9A%84%E5%BF%AB%E9%80%9F%E6%B1%82%E6%B3%95/","title":"æ•´æ•°å› å­çš„å¿«é€Ÿæ±‚æ³•"},{"content":"MySQL-DQL-åŸºæœ¬æŸ¥è¯¢ ä»‹ç»\nDQLè‹±æ–‡å…¨ç§°æ˜¯Data Query Language(æ•°æ®æŸ¥è¯¢è¯­è¨€)ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“è¡¨ä¸­çš„è®°å½•ã€‚\næŸ¥è¯¢å…³é”®å­—ï¼šSELECT\næŸ¥è¯¢æ“ä½œæ˜¯æ‰€æœ‰SQLè¯­å¥å½“ä¸­æœ€ä¸ºå¸¸è§ï¼Œä¹Ÿæ˜¯æœ€ä¸ºé‡è¦çš„æ“ä½œã€‚åœ¨ä¸€ä¸ªæ­£å¸¸çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼ŒæŸ¥è¯¢æ“ä½œçš„ä½¿ç”¨é¢‘æ¬¡æ˜¯è¦è¿œé«˜äºå¢åˆ æ”¹æ“ä½œçš„ã€‚å½“æˆ‘ä»¬æ‰“å¼€æŸä¸ªç½‘ç«™æˆ–APPæ‰€çœ‹åˆ°çš„å±•ç¤ºä¿¡æ¯ï¼Œéƒ½æ˜¯é€šè¿‡ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å¾—åˆ°çš„ï¼Œè€Œåœ¨è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šæ¶‰åŠåˆ°æ¡ä»¶ã€æ’åºã€åˆ†é¡µç­‰æ“ä½œã€‚\nè¯­æ³•\nDQLæŸ¥è¯¢è¯­å¥ï¼Œè¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨ååˆ—è¡¨ WHERE æ¡ä»¶åˆ—è¡¨ GROUP BY åˆ†ç»„å­—æ®µåˆ—è¡¨ HAVING åˆ†ç»„åæ¡ä»¶åˆ—è¡¨ ORDER BY æ’åºå­—æ®µåˆ—è¡¨ LIMIT åˆ†é¡µå‚æ•° æˆ‘ä»¬ä»Šå¤©ä¼šå°†ä¸Šé¢çš„å®Œæ•´è¯­æ³•æ‹†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†å­¦ä¹ ï¼š\nåŸºæœ¬æŸ¥è¯¢ï¼ˆä¸å¸¦ä»»ä½•æ¡ä»¶ï¼‰ æ¡ä»¶æŸ¥è¯¢ï¼ˆwhereï¼‰ åˆ†ç»„æŸ¥è¯¢ï¼ˆgroup byï¼‰ æ’åºæŸ¥è¯¢ï¼ˆorder byï¼‰ åˆ†é¡µæŸ¥è¯¢ï¼ˆlimitï¼‰ å‡†å¤‡ä¸€äº›æµ‹è¯•æ•°æ®ç”¨äºæŸ¥è¯¢æ“ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 create database db02; -- åˆ›å»ºæ•°æ®åº“ use db02; -- åˆ‡æ¢æ•°æ®åº“ -- å‘˜å·¥ç®¡ç†(å¸¦çº¦æŸ) create table tb_emp ( id int unsigned primary key auto_increment comment \u0026#39;ID\u0026#39;, username varchar(20) not null unique comment \u0026#39;ç”¨æˆ·å\u0026#39;, password varchar(32) default \u0026#39;123456\u0026#39; comment \u0026#39;å¯†ç \u0026#39;, name varchar(10) not null comment \u0026#39;å§“å\u0026#39;, gender tinyint unsigned not null comment \u0026#39;æ€§åˆ«, è¯´æ˜: 1 ç”·, 2 å¥³\u0026#39;, image varchar(300) comment \u0026#39;å›¾åƒ\u0026#39;, job tinyint unsigned comment \u0026#39;èŒä½, è¯´æ˜: 1 ç­ä¸»ä»»,2 è®²å¸ˆ, 3 å­¦å·¥ä¸»ç®¡, 4 æ•™ç ”ä¸»ç®¡\u0026#39;, entrydate date comment \u0026#39;å…¥èŒæ—¶é—´\u0026#39;, create_time datetime not null comment \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, update_time datetime not null comment \u0026#39;ä¿®æ”¹æ—¶é—´\u0026#39; ) comment \u0026#39;å‘˜å·¥è¡¨\u0026#39;; -- å‡†å¤‡æµ‹è¯•æ•°æ® INSERT INTO tb_emp (id, username, password, name, gender, image, job, entrydate, create_time, update_time) VALUES (1, \u0026#39;jinyong\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;é‡‘åº¸\u0026#39;, 1, \u0026#39;1.jpg\u0026#39;, 4, \u0026#39;2000-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:35\u0026#39;), (2, \u0026#39;zhangwuji\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ æ— å¿Œ\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2015-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:37\u0026#39;), (3, \u0026#39;yangxiao\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;æ¨é€\u0026#39;, 1, \u0026#39;3.jpg\u0026#39;, 2, \u0026#39;2008-05-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:39\u0026#39;), (4, \u0026#39;weiyixiao\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;éŸ¦ä¸€ç¬‘\u0026#39;, 1, \u0026#39;4.jpg\u0026#39;, 2, \u0026#39;2007-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:41\u0026#39;), (5, \u0026#39;changyuchun\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¸¸é‡æ˜¥\u0026#39;, 1, \u0026#39;5.jpg\u0026#39;, 2, \u0026#39;2012-12-05\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:43\u0026#39;), (6, \u0026#39;xiaozhao\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å°æ˜­\u0026#39;, 2, \u0026#39;6.jpg\u0026#39;, 3, \u0026#39;2013-09-05\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:45\u0026#39;), (7, \u0026#39;jixiaofu\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;çºªæ™“èŠ™\u0026#39;, 2, \u0026#39;7.jpg\u0026#39;, 1, \u0026#39;2005-08-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:47\u0026#39;), (8, \u0026#39;zhouzhiruo\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å‘¨èŠ·è‹¥\u0026#39;, 2, \u0026#39;8.jpg\u0026#39;, 1, \u0026#39;2014-11-09\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:49\u0026#39;), (9, \u0026#39;dingminjun\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;ä¸æ•å›\u0026#39;, 2, \u0026#39;9.jpg\u0026#39;, 1, \u0026#39;2011-03-11\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:51\u0026#39;), (10, \u0026#39;zhaomin\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;èµµæ•\u0026#39;, 2, \u0026#39;10.jpg\u0026#39;, 1, \u0026#39;2013-09-05\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:53\u0026#39;), (11, \u0026#39;luzhangke\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;é¹¿æ–å®¢\u0026#39;, 1, \u0026#39;11.jpg\u0026#39;, 2, \u0026#39;2007-02-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:55\u0026#39;), (12, \u0026#39;hebiweng\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;é¹¤ç¬”ç¿\u0026#39;, 1, \u0026#39;12.jpg\u0026#39;, 2, \u0026#39;2008-08-18\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:57\u0026#39;), (13, \u0026#39;fangdongbai\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;æ–¹ä¸œç™½\u0026#39;, 1, \u0026#39;13.jpg\u0026#39;, 1, \u0026#39;2012-11-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:35:59\u0026#39;), (14, \u0026#39;zhangsanfeng\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ ä¸‰ä¸°\u0026#39;, 1, \u0026#39;14.jpg\u0026#39;, 2, \u0026#39;2002-08-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:01\u0026#39;), (15, \u0026#39;yulianzhou\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;ä¿è²èˆŸ\u0026#39;, 1, \u0026#39;15.jpg\u0026#39;, 2, \u0026#39;2011-05-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:03\u0026#39;), (16, \u0026#39;songyuanqiao\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å®‹è¿œæ¡¥\u0026#39;, 1, \u0026#39;16.jpg\u0026#39;, 2, \u0026#39;2010-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:05\u0026#39;), (17, \u0026#39;chenyouliang\u0026#39;, \u0026#39;12345678\u0026#39;, \u0026#39;é™ˆå‹è°…\u0026#39;, 1, \u0026#39;17.jpg\u0026#39;, null, \u0026#39;2015-03-21\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:07\u0026#39;), (18, \u0026#39;zhang1\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ ä¸€\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2015-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:09\u0026#39;), (19, \u0026#39;zhang2\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ äºŒ\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2012-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:11\u0026#39;), (20, \u0026#39;zhang3\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ ä¸‰\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2018-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:13\u0026#39;), (21, \u0026#39;zhang4\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ å››\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2015-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:15\u0026#39;), (22, \u0026#39;zhang5\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ äº”\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2016-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:17\u0026#39;), (23, \u0026#39;zhang6\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ å…­\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2012-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:19\u0026#39;), (24, \u0026#39;zhang7\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ ä¸ƒ\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2006-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:21\u0026#39;), (25, \u0026#39;zhang8\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ å…«\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2002-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:23\u0026#39;), (26, \u0026#39;zhang9\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ ä¹\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2011-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:25\u0026#39;), (27, \u0026#39;zhang10\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ å\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2004-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:27\u0026#39;), (28, \u0026#39;zhang11\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ åä¸€\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2007-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:29\u0026#39;), (29, \u0026#39;zhang12\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;å¼ åäºŒ\u0026#39;, 1, \u0026#39;2.jpg\u0026#39;, 2, \u0026#39;2020-01-01\u0026#39;, \u0026#39;2022-10-27 16:35:33\u0026#39;, \u0026#39;2022-10-27 16:36:31\u0026#39;); åŸºæœ¬æŸ¥è¯¢\nåœ¨åŸºæœ¬æŸ¥è¯¢çš„DQLè¯­å¥ä¸­ï¼Œä¸å¸¦ä»»ä½•çš„æŸ¥è¯¢æ¡ä»¶ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\næŸ¥è¯¢å¤šä¸ªå­—æ®µ 1 select å­—æ®µ1, å­—æ®µ2, å­—æ®µ3 from è¡¨å; æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆé€šé…ç¬¦ï¼‰ 1 select * from è¡¨å; è®¾ç½®åˆ«å 1 select å­—æ®µ1 [ as åˆ«å1 ] , å­—æ®µ2 [ as åˆ«å2 ] from è¡¨å; å»é™¤é‡å¤è®°å½• 1 select distinct å­—æ®µåˆ—è¡¨ from è¡¨å; æ¡ˆä¾‹1ï¼šæŸ¥è¯¢æŒ‡å®šå­—æ®µ nameï¼Œentrydateå¹¶è¿”å›\n1 select name,entrydate from tb_emp; æ¡ˆä¾‹2ï¼šæŸ¥è¯¢è¿”å›æ‰€æœ‰å­—æ®µ\n1 select * from tb_emp; *å·ä»£è¡¨æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼Œåœ¨å®é™…å¼€å‘ä¸­å°½é‡å°‘ç”¨ï¼ˆä¸ç›´è§‚ã€å½±å“æ•ˆç‡ï¼‰\næ¡ˆä¾‹3ï¼šæŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„ name,entrydateï¼Œå¹¶èµ·åˆ«å(å§“åã€å…¥èŒæ—¥æœŸ)\n1 2 3 4 5 6 -- æ–¹å¼1ï¼š select name AS å§“å, entrydate AS å…¥èŒæ—¥æœŸ from tb_emp; -- æ–¹å¼2ï¼š åˆ«åä¸­æœ‰ç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œä½¿ç”¨\u0026#39;\u0026#39;æˆ–\u0026#34;\u0026#34;åŒ…å« select name AS \u0026#39;å§“ å\u0026#39;, entrydate AS \u0026#39;å…¥èŒæ—¥æœŸ\u0026#39; from tb_emp; -- æ–¹å¼3ï¼š select name AS \u0026#34;å§“å\u0026#34;, entrydate AS \u0026#34;å…¥èŒæ—¥æœŸ\u0026#34; from tb_emp; æ¡ˆä¾‹4ï¼šæŸ¥è¯¢å·²æœ‰çš„å‘˜å·¥å…³è”äº†å“ªå‡ ç§èŒä½(ä¸è¦é‡å¤)\n1 select distinct job from tb_emp; MySQL-DQL-æ¡ä»¶æŸ¥è¯¢ æ¡ä»¶æŸ¥è¯¢\nè¯­æ³•ï¼š\n1 select å­—æ®µåˆ—è¡¨ from è¡¨å where æ¡ä»¶åˆ—è¡¨ ; -- æ¡ä»¶åˆ—è¡¨ï¼šæ„å‘³ç€å¯ä»¥æœ‰å¤šä¸ªæ¡ä»¶ å­¦ä¹ æ¡ä»¶æŸ¥è¯¢å°±æ˜¯å­¦ä¹ æ¡ä»¶çš„æ„å»ºæ–¹å¼ï¼Œè€Œåœ¨SQLè¯­å¥å½“ä¸­æ„é€ æ¡ä»¶çš„è¿ç®—ç¬¦åˆ†ä¸ºä¸¤ç±»ï¼š\næ¯”è¾ƒè¿ç®—ç¬¦ é€»è¾‘è¿ç®—ç¬¦ å¸¸ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦å¦‚ä¸‹:\næ¯”è¾ƒè¿ç®—ç¬¦ åŠŸèƒ½ \u0026gt; å¤§äº \u0026gt;= å¤§äºç­‰äº \u0026lt; å°äº \u0026lt;= å°äºç­‰äº = ç­‰äº \u0026lt;\u0026gt; æˆ– != ä¸ç­‰äº between \u0026hellip; and \u0026hellip; åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…(å«æœ€å°ã€æœ€å¤§å€¼) in(\u0026hellip;) åœ¨inä¹‹åçš„åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¤šé€‰ä¸€ like å ä½ç¬¦ æ¨¡ç³ŠåŒ¹é…(_åŒ¹é…å•ä¸ªå­—ç¬¦, %åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦) is null æ˜¯null å¸¸ç”¨çš„é€»è¾‘è¿ç®—ç¬¦å¦‚ä¸‹:\né€»è¾‘è¿ç®—ç¬¦ åŠŸèƒ½ and æˆ– \u0026amp;\u0026amp; å¹¶ä¸” (å¤šä¸ªæ¡ä»¶åŒæ—¶æˆç«‹) or æˆ– || æˆ–è€… (å¤šä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹) not æˆ– ! é , ä¸æ˜¯ æ¡ˆä¾‹1ï¼šæŸ¥è¯¢ å§“å ä¸º æ¨é€ çš„å‘˜å·¥\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where name = \u0026#39;æ¨é€\u0026#39;; -- å­—ç¬¦ä¸²ä½¿ç”¨\u0026#39;\u0026#39;æˆ–\u0026#34;\u0026#34;åŒ…å« æ¡ˆä¾‹2ï¼šæŸ¥è¯¢ idå°äºç­‰äº5 çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where id \u0026lt;=5; æ¡ˆä¾‹3ï¼šæŸ¥è¯¢ æ²¡æœ‰åˆ†é…èŒä½ çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where job is null ; æ³¨æ„ï¼šæŸ¥è¯¢ä¸ºNULLçš„æ•°æ®æ—¶ï¼Œä¸èƒ½ä½¿ç”¨ = null\næ¡ˆä¾‹4ï¼šæŸ¥è¯¢ æœ‰èŒä½ çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where job is not null ; æ¡ˆä¾‹5ï¼šæŸ¥è¯¢ å¯†ç ä¸ç­‰äº \u0026lsquo;123456\u0026rsquo; çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 4 5 6 7 8 -- æ–¹å¼1ï¼š select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where password \u0026lt;\u0026gt; \u0026#39;123456\u0026#39;; -- æ–¹å¼2ï¼š select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where password != \u0026#39;123456\u0026#39;; æ¡ˆä¾‹6ï¼šæŸ¥è¯¢ å…¥èŒæ—¥æœŸ åœ¨ \u0026lsquo;2000-01-01\u0026rsquo; (åŒ…å«) åˆ° \u0026lsquo;2010-01-01\u0026rsquo;(åŒ…å«) ä¹‹é—´çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 4 5 6 7 8 -- æ–¹å¼1ï¼š select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where entrydate\u0026gt;=\u0026#39;2000-01-01\u0026#39; and entrydate\u0026lt;=\u0026#39;2010-01-01\u0026#39;; -- æ–¹å¼2ï¼š between...and select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where entrydate between \u0026#39;2000-01-01\u0026#39; and \u0026#39;2010-01-01\u0026#39;; æ¡ˆä¾‹7ï¼šæŸ¥è¯¢ å…¥èŒæ—¶é—´ åœ¨ \u0026lsquo;2000-01-01\u0026rsquo; (åŒ…å«) åˆ° \u0026lsquo;2010-01-01\u0026rsquo;(åŒ…å«) ä¹‹é—´ ä¸” æ€§åˆ«ä¸ºå¥³ çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 4 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where entrydate between \u0026#39;2000-01-01\u0026#39; and \u0026#39;2010-01-01\u0026#39; and gender = 2; æ¡ˆä¾‹8ï¼šæŸ¥è¯¢ èŒä½æ˜¯ 2 (è®²å¸ˆ), 3 (å­¦å·¥ä¸»ç®¡), 4 (æ•™ç ”ä¸»ç®¡) çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 4 5 6 7 8 -- æ–¹å¼1ï¼šä½¿ç”¨orè¿æ¥å¤šä¸ªæ¡ä»¶ select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where job=2 or job=3 or job=4; -- æ–¹å¼2ï¼šinå…³é”®å­— select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where job in (2,3,4); æ¡ˆä¾‹9ï¼šæŸ¥è¯¢ å§“å ä¸ºä¸¤ä¸ªå­—çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where name like \u0026#39;__\u0026#39;; # é€šé…ç¬¦ \u0026#34;_\u0026#34; ä»£è¡¨ä»»æ„1ä¸ªå­—ç¬¦ æ¡ˆä¾‹10ï¼šæŸ¥è¯¢ å§“ \u0026lsquo;å¼ \u0026rsquo; çš„å‘˜å·¥ä¿¡æ¯\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where name like \u0026#39;å¼ %\u0026#39;; # é€šé…ç¬¦ \u0026#34;%\u0026#34; ä»£è¡¨ä»»æ„ä¸ªå­—ç¬¦ï¼ˆ0ä¸ª ~ å¤šä¸ªï¼‰ MySQL-DQL-èšåˆå‡½æ•° ä¹‹å‰æˆ‘ä»¬åšçš„æŸ¥è¯¢éƒ½æ˜¯æ¨ªå‘æŸ¥è¯¢ï¼Œå°±æ˜¯æ ¹æ®æ¡ä»¶ä¸€è¡Œä¸€è¡Œçš„è¿›è¡Œåˆ¤æ–­ï¼Œè€Œä½¿ç”¨èšåˆå‡½æ•°æŸ¥è¯¢å°±æ˜¯çºµå‘æŸ¥è¯¢ï¼Œå®ƒæ˜¯å¯¹ä¸€åˆ—çš„å€¼è¿›è¡Œè®¡ç®—ï¼Œç„¶åè¿”å›ä¸€ä¸ªç»“æœå€¼ã€‚ï¼ˆå°†ä¸€åˆ—æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¿›è¡Œçºµå‘è®¡ç®—ï¼‰\nè¯­æ³•ï¼š\n1 select èšåˆå‡½æ•°(å­—æ®µåˆ—è¡¨) from è¡¨å ; æ³¨æ„ : èšåˆå‡½æ•°ä¼šå¿½ç•¥ç©ºå€¼ï¼Œå¯¹NULLå€¼ä¸ä½œä¸ºç»Ÿè®¡ã€‚\nå¸¸ç”¨èšåˆå‡½æ•°ï¼š\nå‡½æ•° åŠŸèƒ½ count ç»Ÿè®¡æ•°é‡ max æœ€å¤§å€¼ min æœ€å°å€¼ avg å¹³å‡å€¼ sum æ±‚å’Œ count ï¼šæŒ‰ç…§åˆ—å»ç»Ÿè®¡æœ‰å¤šå°‘è¡Œæ•°æ®ã€‚\nåœ¨æ ¹æ®æŒ‡å®šçš„åˆ—ç»Ÿè®¡çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸€åˆ—ä¸­æœ‰nullçš„è¡Œï¼Œè¯¥è¡Œä¸ä¼šè¢«ç»Ÿè®¡åœ¨å…¶ä¸­ã€‚ sum ï¼šè®¡ç®—æŒ‡å®šåˆ—çš„æ•°å€¼å’Œï¼Œå¦‚æœä¸æ˜¯æ•°å€¼ç±»å‹ï¼Œé‚£ä¹ˆè®¡ç®—ç»“æœä¸º0\nmax ï¼šè®¡ç®—æŒ‡å®šåˆ—çš„æœ€å¤§å€¼\nmin ï¼šè®¡ç®—æŒ‡å®šåˆ—çš„æœ€å°å€¼\navg ï¼šè®¡ç®—æŒ‡å®šåˆ—çš„å¹³å‡å€¼\næ¡ˆä¾‹1ï¼šç»Ÿè®¡è¯¥ä¼ä¸šå‘˜å·¥æ•°é‡\n1 2 3 4 5 6 7 8 9 10 # count(å­—æ®µ) select count(id) from tb_emp;-- ç»“æœï¼š29 select count(job) from tb_emp;-- ç»“æœï¼š28 ï¼ˆèšåˆå‡½æ•°å¯¹NULLå€¼ä¸åšè®¡ç®—ï¼‰ # count(å¸¸é‡) select count(0) from tb_emp; select count(\u0026#39;A\u0026#39;) from tb_emp; # count(*) æ¨èæ­¤å†™æ³•ï¼ˆMySQLåº•å±‚è¿›è¡Œäº†ä¼˜åŒ–ï¼‰ select count(*) from tb_emp; æ¡ˆä¾‹2ï¼šç»Ÿè®¡è¯¥ä¼ä¸šæœ€æ—©å…¥èŒçš„å‘˜å·¥\n1 select min(entrydate) from tb_emp; æ¡ˆä¾‹3ï¼šç»Ÿè®¡è¯¥ä¼ä¸šæœ€è¿Ÿå…¥èŒçš„å‘˜å·¥\n1 select max(entrydate) from tb_emp; æ¡ˆä¾‹4ï¼šç»Ÿè®¡è¯¥ä¼ä¸šå‘˜å·¥ ID çš„å¹³å‡å€¼\n1 select avg(id) from tb_emp; æ¡ˆä¾‹5ï¼šç»Ÿè®¡è¯¥ä¼ä¸šå‘˜å·¥çš„ ID ä¹‹å’Œ\n1 select sum(id) from tb_emp; MySQL-DQL-åˆ†ç»„æŸ¥è¯¢ åˆ†ç»„ï¼š æŒ‰ç…§æŸä¸€åˆ—æˆ–è€…æŸå‡ åˆ—ï¼ŒæŠŠç›¸åŒçš„æ•°æ®è¿›è¡Œåˆå¹¶è¾“å‡ºã€‚\nåˆ†ç»„å…¶å®å°±æ˜¯æŒ‰åˆ—è¿›è¡Œåˆ†ç±»(æŒ‡å®šåˆ—ä¸‹ç›¸åŒçš„æ•°æ®å½’ä¸ºä¸€ç±»)ï¼Œç„¶åå¯ä»¥å¯¹åˆ†ç±»å®Œçš„æ•°æ®è¿›è¡Œåˆå¹¶è®¡ç®—ã€‚\nåˆ†ç»„æŸ¥è¯¢é€šå¸¸ä¼šä½¿ç”¨èšåˆå‡½æ•°è¿›è¡Œè®¡ç®—ã€‚\nè¯­æ³•ï¼š\n1 select å­—æ®µåˆ—è¡¨ from è¡¨å [where æ¡ä»¶] group by åˆ†ç»„å­—æ®µå [having åˆ†ç»„åè¿‡æ»¤æ¡ä»¶]; æ¡ˆä¾‹1ï¼šæ ¹æ®æ€§åˆ«åˆ†ç»„ , ç»Ÿè®¡ç”·æ€§å’Œå¥³æ€§å‘˜å·¥çš„æ•°é‡\n1 2 3 select gender, count(*) from tb_emp group by gender; -- æŒ‰ç…§genderå­—æ®µè¿›è¡Œåˆ†ç»„ï¼ˆgenderå­—æ®µä¸‹ç›¸åŒçš„æ•°æ®å½’ä¸ºä¸€ç»„ï¼‰ æ¡ˆä¾‹2ï¼šæŸ¥è¯¢å…¥èŒæ—¶é—´åœ¨ \u0026lsquo;2015-01-01\u0026rsquo; (åŒ…å«) ä»¥å‰çš„å‘˜å·¥ , å¹¶å¯¹ç»“æœæ ¹æ®èŒä½åˆ†ç»„ , è·å–å‘˜å·¥æ•°é‡å¤§äºç­‰äº2çš„èŒä½\n1 2 3 4 5 select job, count(*) from tb_emp where entrydate \u0026lt;= \u0026#39;2015-01-01\u0026#39; -- åˆ†ç»„å‰æ¡ä»¶ group by job -- æŒ‰ç…§jobå­—æ®µåˆ†ç»„ having count(*) \u0026gt;= 2; -- åˆ†ç»„åæ¡ä»¶ æ³¨æ„äº‹é¡¹:\nâ€¢ åˆ†ç»„ä¹‹åï¼ŒæŸ¥è¯¢çš„å­—æ®µä¸€èˆ¬ä¸ºèšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µï¼ŒæŸ¥è¯¢å…¶ä»–å­—æ®µæ— ä»»ä½•æ„ä¹‰\nâ€¢ æ‰§è¡Œé¡ºåºï¼šwhere \u0026gt; èšåˆå‡½æ•° \u0026gt; having\nwhereä¸havingåŒºåˆ«ï¼ˆé¢è¯•é¢˜ï¼‰\næ‰§è¡Œæ—¶æœºä¸åŒï¼šwhereæ˜¯åˆ†ç»„ä¹‹å‰è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ»¡è¶³whereæ¡ä»¶ï¼Œä¸å‚ä¸åˆ†ç»„ï¼›è€Œhavingæ˜¯åˆ†ç»„ä¹‹åå¯¹ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚ åˆ¤æ–­æ¡ä»¶ä¸åŒï¼šwhereä¸èƒ½å¯¹èšåˆå‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼Œè€Œhavingå¯ä»¥ã€‚ MySQL-DQL-æ’åºæŸ¥è¯¢ æ’åºåœ¨æ—¥å¸¸å¼€å‘ä¸­æ˜¯éå¸¸å¸¸è§çš„ä¸€ä¸ªæ“ä½œï¼Œæœ‰å‡åºæ’åºï¼Œä¹Ÿæœ‰é™åºæ’åºã€‚\nè¯­æ³•ï¼š\n1 2 3 4 5 select å­—æ®µåˆ—è¡¨ from è¡¨å [where æ¡ä»¶åˆ—è¡¨] [group by åˆ†ç»„å­—æ®µ ] order by å­—æ®µ1 æ’åºæ–¹å¼1 , å­—æ®µ2 æ’åºæ–¹å¼2 â€¦ ; æ’åºæ–¹å¼ï¼š\nASC ï¼šå‡åºï¼ˆé»˜è®¤å€¼ï¼‰ DESCï¼šé™åº æ¡ˆä¾‹1ï¼šæ ¹æ®å…¥èŒæ—¶é—´, å¯¹å‘˜å·¥è¿›è¡Œå‡åºæ’åº\n1 2 3 4 5 6 7 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp order by entrydate ASC; -- æŒ‰ç…§entrydateå­—æ®µä¸‹çš„æ•°æ®è¿›è¡Œå‡åºæ’åº select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp order by entrydate; -- é»˜è®¤å°±æ˜¯ASCï¼ˆå‡åºï¼‰ æ³¨æ„äº‹é¡¹ï¼šå¦‚æœæ˜¯å‡åº, å¯ä»¥ä¸æŒ‡å®šæ’åºæ–¹å¼ASC\næ¡ˆä¾‹2ï¼šæ ¹æ®å…¥èŒæ—¶é—´ï¼Œå¯¹å‘˜å·¥è¿›è¡Œé™åºæ’åº\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp order by entrydate DESC; -- æŒ‰ç…§entrydateå­—æ®µä¸‹çš„æ•°æ®è¿›è¡Œé™åºæ’åº æ¡ˆä¾‹3ï¼šæ ¹æ®å…¥èŒæ—¶é—´å¯¹å…¬å¸çš„å‘˜å·¥è¿›è¡Œå‡åºæ’åºï¼Œå…¥èŒæ—¶é—´ç›¸åŒï¼Œå†æŒ‰ç…§æ›´æ–°æ—¶é—´è¿›è¡Œé™åºæ’åº\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp order by entrydate ASC , update_time DESC; æ³¨æ„äº‹é¡¹ï¼šå¦‚æœæ˜¯å¤šå­—æ®µæ’åºï¼Œå½“ç¬¬ä¸€ä¸ªå­—æ®µå€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šæ ¹æ®ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ’åº\nMySQL-DQL-åˆ†é¡µæŸ¥è¯¢ åˆ†é¡µæ“ä½œåœ¨ä¸šåŠ¡ç³»ç»Ÿå¼€å‘æ—¶ï¼Œä¹Ÿæ˜¯éå¸¸å¸¸è§çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæ—¥å¸¸æˆ‘ä»¬åœ¨ç½‘ç«™ä¸­çœ‹åˆ°çš„å„ç§å„æ ·çš„åˆ†é¡µæ¡ï¼Œåå°ä¹Ÿéƒ½éœ€è¦å€ŸåŠ©äºæ•°æ®åº“çš„åˆ†é¡µæ“ä½œã€‚\nåˆ†é¡µæŸ¥è¯¢è¯­æ³•ï¼š\n1 select å­—æ®µåˆ—è¡¨ from è¡¨å limit èµ·å§‹ç´¢å¼•, æŸ¥è¯¢è®°å½•æ•° ; æ¡ˆä¾‹1ï¼šä»èµ·å§‹ç´¢å¼•0å¼€å§‹æŸ¥è¯¢å‘˜å·¥æ•°æ®, æ¯é¡µå±•ç¤º5æ¡è®°å½•\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp limit 0 , 5; -- ä»ç´¢å¼•0å¼€å§‹ï¼Œå‘åå–5æ¡è®°å½• æ¡ˆä¾‹2ï¼šæŸ¥è¯¢ ç¬¬1é¡µ å‘˜å·¥æ•°æ®, æ¯é¡µå±•ç¤º5æ¡è®°å½•\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp limit 5; -- å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬1é¡µæ•°æ®ï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ï¼Œç›´æ¥ç®€å†™ä¸ºï¼šlimit æ¡æ•° æ¡ˆä¾‹3ï¼šæŸ¥è¯¢ ç¬¬2é¡µ å‘˜å·¥æ•°æ®, æ¯é¡µå±•ç¤º5æ¡è®°å½•\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp limit 5 , 5; -- ä»ç´¢å¼•5å¼€å§‹ï¼Œå‘åå–5æ¡è®°å½• æ¡ˆä¾‹4ï¼šæŸ¥è¯¢ ç¬¬3é¡µ å‘˜å·¥æ•°æ®, æ¯é¡µå±•ç¤º5æ¡è®°å½•\n1 2 3 select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp limit 10 , 5; -- ä»ç´¢å¼•10å¼€å§‹ï¼Œå‘åå–5æ¡è®°å½• æ³¨æ„äº‹é¡¹:\nèµ·å§‹ç´¢å¼•ä»0å¼€å§‹ã€‚ è®¡ç®—å…¬å¼ ï¼š èµ·å§‹ç´¢å¼• = ï¼ˆæŸ¥è¯¢é¡µç  - 1ï¼‰* æ¯é¡µæ˜¾ç¤ºè®°å½•æ•° åˆ†é¡µæŸ¥è¯¢æ˜¯æ•°æ®åº“çš„æ–¹è¨€ï¼Œä¸åŒçš„æ•°æ®åº“æœ‰ä¸åŒçš„å®ç°ï¼ŒMySQLä¸­æ˜¯LIMIT å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µæ•°æ®ï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ï¼Œç›´æ¥ç®€å†™ä¸º limit æ¡æ•° MySQL-DQL-æ¡ˆä¾‹ æ¡ˆä¾‹ä¸€\næ¡ˆä¾‹ï¼šæ ¹æ®éœ€æ±‚å®Œæˆå‘˜å·¥ç®¡ç†çš„æ¡ä»¶åˆ†é¡µæŸ¥è¯¢\nåˆ†æï¼šæ ¹æ®è¾“å…¥çš„æ¡ä»¶ï¼ŒæŸ¥è¯¢ç¬¬1é¡µæ•°æ®\nåœ¨å‘˜å·¥ç®¡ç†çš„åˆ—è¡¨ä¸Šæ–¹æœ‰ä¸€äº›æŸ¥è¯¢æ¡ä»¶ï¼šå‘˜å·¥å§“åã€å‘˜å·¥æ€§åˆ«ï¼Œå‘˜å·¥å…¥èŒæ—¶é—´(å¼€å§‹æ—¶é—´~ç»“æŸæ—¶é—´) å§“åï¼šå¼  æ€§åˆ«ï¼šç”· å…¥èŒæ—¶é—´ï¼š2000-01-01 ~ 2015-12-31 é™¤äº†æŸ¥è¯¢æ¡ä»¶å¤–ï¼Œåœ¨åˆ—è¡¨çš„ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªåˆ†é¡µæ¡ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†åˆ†é¡µæŸ¥è¯¢ æŸ¥è¯¢ç¬¬1é¡µæ•°æ®ï¼ˆæ¯é¡µæ˜¾ç¤º10æ¡æ•°æ®ï¼‰ åŸºäºæŸ¥è¯¢çš„ç»“æœï¼ŒæŒ‰ç…§ä¿®æ”¹æ—¶é—´è¿›è¡Œé™åºæ’åº ç»“è®ºï¼šæ¡ä»¶æŸ¥è¯¢ + åˆ†é¡µæŸ¥è¯¢ + æ’åºæŸ¥è¯¢\n1 2 3 4 5 6 7 8 9 10 11 12 -- æ ¹æ®è¾“å…¥æ¡ä»¶æŸ¥è¯¢ç¬¬1é¡µæ•°æ®ï¼ˆæ¯é¡µå±•ç¤º10æ¡è®°å½•ï¼‰ -- è¾“å…¥æ¡ä»¶ï¼š -- å§“åï¼šå¼  ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰ -- æ€§åˆ«ï¼šç”· -- å…¥èŒæ—¶é—´ï¼š2000-01-01 ~ 2015-12-31 -- åˆ†é¡µï¼š 0 , 10 -- æ’åºï¼š ä¿®æ”¹æ—¶é—´ DESC select id, username, password, name, gender, image, job, entrydate, create_time, update_time from tb_emp where name like \u0026#39;å¼ %\u0026#39; and gender = 1 and entrydate between \u0026#39;2000-01-01\u0026#39; and \u0026#39;2015-12-31\u0026#39; order by update_time desc limit 0 , 10; æ¡ˆä¾‹äºŒ\næ¡ˆä¾‹ï¼šæ ¹æ®éœ€æ±‚å®Œæˆå‘˜å·¥ä¿¡æ¯çš„ç»Ÿè®¡\nåˆ†æï¼šä»¥ä¸Šä¿¡æ¯ç»Ÿè®¡åœ¨å¼€å‘ä¸­ä¹Ÿå«å›¾å½¢æŠ¥è¡¨(å°†ç»Ÿè®¡å¥½çš„æ•°æ®ä»¥å¯è§†åŒ–çš„å½¢å¼å±•ç¤ºå‡ºæ¥)\nå‘˜å·¥æ€§åˆ«ç»Ÿè®¡ï¼šä»¥é¥¼çŠ¶å›¾çš„å½¢å¼å±•ç¤ºå‡ºä¼ä¸šç”·æ€§å‘˜äººæ•°å’Œå¥³æ€§å‘˜å·¥äººæ•° åªè¦æŸ¥è¯¢å‡ºç”·æ€§å‘˜å·¥å’Œå¥³æ€§å‘˜å·¥å„è‡ªæœ‰å¤šå°‘äººå°±å¯ä»¥äº† å‘˜å·¥èŒä½ç»Ÿè®¡ï¼šä»¥æŸ±çŠ¶å›¾çš„å½¢å¼å±•ç¤ºå„èŒä½çš„åœ¨å²—äººæ•° åªè¦æŸ¥è¯¢å‡ºå„ä¸ªèŒä½æœ‰å¤šå°‘äººå°±å¯ä»¥äº† å‘˜å·¥æ€§åˆ«ç»Ÿè®¡ï¼š\n1 2 3 4 -- if(æ¡ä»¶è¡¨è¾¾å¼, trueå–å€¼ , falseå–å€¼) select if(gender=1,\u0026#39;ç”·æ€§å‘˜å·¥\u0026#39;,\u0026#39;å¥³æ€§å‘˜å·¥\u0026#39;) AS æ€§åˆ«, count(*) AS äººæ•° from tb_emp group by gender; if(è¡¨è¾¾å¼, tvalue, fvalue) ï¼šå½“è¡¨è¾¾å¼ä¸ºtrueæ—¶ï¼Œå–å€¼tvalueï¼›å½“è¡¨è¾¾å¼ä¸ºfalseæ—¶ï¼Œå–å€¼fvalue\nå‘˜å·¥èŒä½ç»Ÿè®¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 -- case è¡¨è¾¾å¼ when å€¼1 then ç»“æœ1 when å€¼2 then ç»“æœ2 ... else result end select (case job when 1 then \u0026#39;ç­ä¸»ä»»\u0026#39; when 2 then \u0026#39;è®²å¸ˆ\u0026#39; when 3 then \u0026#39;å­¦å·¥ä¸»ç®¡\u0026#39; when 4 then \u0026#39;æ•™ç ”ä¸»ç®¡\u0026#39; else \u0026#39;æœªåˆ†é…èŒä½\u0026#39; end) AS èŒä½ , count(*) AS äººæ•° from tb_emp group by job; case è¡¨è¾¾å¼ when å€¼1 then ç»“æœ1 [when å€¼2 then ç»“æœ2 \u0026hellip;] [else result] end\nMySQL-å¤šè¡¨è®¾è®¡-ä¸€å¯¹å¤š é¡¹ç›®å¼€å‘ä¸­ï¼Œåœ¨è¿›è¡Œæ•°æ®åº“è¡¨ç»“æ„è®¾è®¡æ—¶ï¼Œä¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠä¸šåŠ¡æ¨¡å—ä¹‹é—´çš„å…³ç³»ï¼Œåˆ†æå¹¶è®¾è®¡è¡¨ç»“æ„ï¼Œç”±äºä¸šåŠ¡ä¹‹é—´ç›¸äº’å…³è”ï¼Œæ‰€ä»¥å„ä¸ªè¡¨ç»“æ„ä¹‹é—´ä¹Ÿå­˜åœ¨ç€å„ç§è”ç³»ï¼ŒåŸºæœ¬ä¸Šåˆ†ä¸ºä¸‰ç§ï¼š\nä¸€å¯¹å¤š(å¤šå¯¹ä¸€) å¤šå¯¹å¤š ä¸€å¯¹ä¸€ ä¸€å¯¹å¤š\nè¡¨è®¾è®¡\néœ€æ±‚ï¼šæ ¹æ®é¡µé¢åŸå‹åŠéœ€æ±‚æ–‡æ¡£ ï¼Œå®Œæˆéƒ¨é—¨åŠå‘˜å·¥çš„è¡¨ç»“æ„è®¾è®¡\nå‘˜å·¥ç®¡ç†é¡µé¢åŸå‹ï¼šï¼ˆå‰é¢å·²å®Œæˆtb_empè¡¨ç»“æ„è®¾è®¡ï¼‰ éƒ¨é—¨ç®¡ç†é¡µé¢åŸå‹ï¼š ç»è¿‡ä¸Šè¿°åˆ†æï¼Œç°å·²æ˜ç¡®çš„éƒ¨é—¨è¡¨ç»“æ„ï¼š\nä¸šåŠ¡å­—æ®µ ï¼š éƒ¨é—¨åç§° åŸºç¡€å­—æ®µ ï¼š id(ä¸»é”®)ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ éƒ¨é—¨è¡¨ - SQLè¯­å¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # å»ºè®®ï¼šåˆ›å»ºæ–°çš„æ•°æ®åº“ï¼ˆå¤šè¡¨è®¾è®¡å­˜æ”¾åœ¨æ–°æ•°æ®åº“ä¸‹ï¼‰ create database db03; use db03; -- éƒ¨é—¨è¡¨ create table tb_dept ( id int unsigned primary key auto_increment comment \u0026#39;ä¸»é”®ID\u0026#39;, name varchar(10) not null unique comment \u0026#39;éƒ¨é—¨åç§°\u0026#39;, create_time datetime not null comment \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, update_time datetime not null comment \u0026#39;ä¿®æ”¹æ—¶é—´\u0026#39; ) comment \u0026#39;éƒ¨é—¨è¡¨\u0026#39;; éƒ¨é—¨è¡¨åˆ›å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†ä¿®æ”¹ä¸‹å‘˜å·¥è¡¨ã€‚ä¸ºä»€ä¹ˆè¦ä¿®æ”¹å‘˜å·¥è¡¨å‘¢ï¼Ÿæ˜¯å› ä¸ºæˆ‘ä»¬ä¹‹å‰è®¾è®¡å‘˜å·¥è¡¨(å•è¡¨)çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘å‘˜å·¥çš„å½’å±éƒ¨é—¨ã€‚\nå‘˜å·¥è¡¨ï¼šæ·»åŠ å½’å±éƒ¨é—¨å­—æ®µ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 -- å‘˜å·¥è¡¨ create table tb_emp ( id int unsigned primary key auto_increment comment \u0026#39;ID\u0026#39;, username varchar(20) not null unique comment \u0026#39;ç”¨æˆ·å\u0026#39;, password varchar(32) default \u0026#39;123456\u0026#39; comment \u0026#39;å¯†ç \u0026#39;, name varchar(10) not null comment \u0026#39;å§“å\u0026#39;, gender tinyint unsigned not null comment \u0026#39;æ€§åˆ«, è¯´æ˜: 1 ç”·, 2 å¥³\u0026#39;, image varchar(300) comment \u0026#39;å›¾åƒ\u0026#39;, job tinyint unsigned comment \u0026#39;èŒä½, è¯´æ˜: 1 ç­ä¸»ä»»,2 è®²å¸ˆ, 3 å­¦å·¥ä¸»ç®¡, 4 æ•™ç ”ä¸»ç®¡\u0026#39;, entrydate date comment \u0026#39;å…¥èŒæ—¶é—´\u0026#39;, dept_id int unsigned comment \u0026#39;éƒ¨é—¨ID\u0026#39;, -- å‘˜å·¥çš„å½’å±éƒ¨é—¨ create_time datetime not null comment \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, update_time datetime not null comment \u0026#39;ä¿®æ”¹æ—¶é—´\u0026#39; ) comment \u0026#39;å‘˜å·¥è¡¨\u0026#39;; æµ‹è¯•æ•°æ®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 -- éƒ¨é—¨è¡¨æµ‹è¯•æ•°æ® insert into tb_dept (id, name, create_time, update_time) values (1,\u0026#39;å­¦å·¥éƒ¨\u0026#39;,now(),now()), (2,\u0026#39;æ•™ç ”éƒ¨\u0026#39;,now(),now()), (3,\u0026#39;å’¨è¯¢éƒ¨\u0026#39;,now(),now()), (4,\u0026#39;å°±ä¸šéƒ¨\u0026#39;,now(),now()), (5,\u0026#39;äººäº‹éƒ¨\u0026#39;,now(),now()); -- å‘˜å·¥è¡¨æµ‹è¯•æ•°æ® INSERT INTO tb_emp (id, username, password, name, gender, image, job, entrydate,dept_id, create_time, update_time) VALUES (1,\u0026#39;jinyong\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;é‡‘åº¸\u0026#39;,1,\u0026#39;1.jpg\u0026#39;,4,\u0026#39;2000-01-01\u0026#39;,2,now(),now()), (2,\u0026#39;zhangwuji\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;å¼ æ— å¿Œ\u0026#39;,1,\u0026#39;2.jpg\u0026#39;,2,\u0026#39;2015-01-01\u0026#39;,2,now(),now()), (3,\u0026#39;yangxiao\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;æ¨é€\u0026#39;,1,\u0026#39;3.jpg\u0026#39;,2,\u0026#39;2008-05-01\u0026#39;,2,now(),now()), (4,\u0026#39;weiyixiao\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;éŸ¦ä¸€ç¬‘\u0026#39;,1,\u0026#39;4.jpg\u0026#39;,2,\u0026#39;2007-01-01\u0026#39;,2,now(),now()), (5,\u0026#39;changyuchun\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;å¸¸é‡æ˜¥\u0026#39;,1,\u0026#39;5.jpg\u0026#39;,2,\u0026#39;2012-12-05\u0026#39;,2,now(),now()), (6,\u0026#39;xiaozhao\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;å°æ˜­\u0026#39;,2,\u0026#39;6.jpg\u0026#39;,3,\u0026#39;2013-09-05\u0026#39;,1,now(),now()), (7,\u0026#39;jixiaofu\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;çºªæ™“èŠ™\u0026#39;,2,\u0026#39;7.jpg\u0026#39;,1,\u0026#39;2005-08-01\u0026#39;,1,now(),now()), (8,\u0026#39;zhouzhiruo\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;å‘¨èŠ·è‹¥\u0026#39;,2,\u0026#39;8.jpg\u0026#39;,1,\u0026#39;2014-11-09\u0026#39;,1,now(),now()), (9,\u0026#39;dingminjun\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;ä¸æ•å›\u0026#39;,2,\u0026#39;9.jpg\u0026#39;,1,\u0026#39;2011-03-11\u0026#39;,1,now(),now()), (10,\u0026#39;zhaomin\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;èµµæ•\u0026#39;,2,\u0026#39;10.jpg\u0026#39;,1,\u0026#39;2013-09-05\u0026#39;,1,now(),now()), (11,\u0026#39;luzhangke\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;é¹¿æ–å®¢\u0026#39;,1,\u0026#39;11.jpg\u0026#39;,1,\u0026#39;2007-02-01\u0026#39;,1,now(),now()), (12,\u0026#39;hebiweng\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;é¹¤ç¬”ç¿\u0026#39;,1,\u0026#39;12.jpg\u0026#39;,1,\u0026#39;2008-08-18\u0026#39;,1,now(),now()), (13,\u0026#39;fangdongbai\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;æ–¹ä¸œç™½\u0026#39;,1,\u0026#39;13.jpg\u0026#39;,2,\u0026#39;2012-11-01\u0026#39;,2,now(),now()), (14,\u0026#39;zhangsanfeng\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;å¼ ä¸‰ä¸°\u0026#39;,1,\u0026#39;14.jpg\u0026#39;,2,\u0026#39;2002-08-01\u0026#39;,2,now(),now()), (15,\u0026#39;yulianzhou\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;ä¿è²èˆŸ\u0026#39;,1,\u0026#39;15.jpg\u0026#39;,2,\u0026#39;2011-05-01\u0026#39;,2,now(),now()), (16,\u0026#39;songyuanqiao\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;å®‹è¿œæ¡¥\u0026#39;,1,\u0026#39;16.jpg\u0026#39;,2,\u0026#39;2010-01-01\u0026#39;,2,now(),now()), (17,\u0026#39;chenyouliang\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;é™ˆå‹è°…\u0026#39;,1,\u0026#39;17.jpg\u0026#39;,NULL,\u0026#39;2015-03-21\u0026#39;,NULL,now(),now()); å‘˜å·¥è¡¨ - éƒ¨é—¨è¡¨ä¹‹é—´çš„å…³ç³»ï¼š\nä¸€å¯¹å¤šå…³ç³»å®ç°ï¼šåœ¨æ•°æ®åº“è¡¨ä¸­å¤šçš„ä¸€æ–¹ï¼Œæ·»åŠ å­—æ®µï¼Œæ¥å…³è”å±äºä¸€è¿™æ–¹çš„ä¸»é”®ã€‚\nMySQL-å¤šè¡¨è®¾è®¡-ä¸€å¯¹å¤š-å¤–é”® å¤–é”®çº¦æŸ\né—®é¢˜\nè¡¨ç»“æ„åˆ›å»ºå®Œæ¯•åï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸¤å¼ è¡¨çš„æ•°æ®åˆ†åˆ«ä¸ºï¼š ç°åœ¨å‘˜å·¥è¡¨ä¸­æœ‰äº”ä¸ªå‘˜å·¥éƒ½å½’å±äº1å·éƒ¨é—¨(å­¦å·¥éƒ¨)ï¼Œå½“åˆ é™¤äº†1å·éƒ¨é—¨åï¼Œæ•°æ®å˜ä¸ºï¼š\n1å·éƒ¨é—¨è¢«åˆ é™¤äº†ï¼Œä½†æ˜¯ä¾ç„¶è¿˜æœ‰5ä¸ªå‘˜å·¥æ˜¯å±äº1å·éƒ¨é—¨çš„ã€‚ æ­¤æ—¶ï¼šå°±å‡ºç°æ•°æ®çš„ä¸å®Œæ•´ã€ä¸ä¸€è‡´äº†ã€‚\né—®é¢˜åˆ†æ\nç›®å‰ä¸Šè¿°çš„ä¸¤å¼ è¡¨(å‘˜å·¥è¡¨ã€éƒ¨é—¨è¡¨)ï¼Œåœ¨æ•°æ®åº“å±‚é¢ï¼Œå¹¶æœªå»ºç«‹å…³è”ï¼Œæ‰€ä»¥æ˜¯æ— æ³•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§çš„\né—®é¢˜è§£å†³\næƒ³è§£å†³ä¸Šè¿°çš„é—®é¢˜å‘¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ•°æ®åº“ä¸­çš„ å¤–é”®çº¦æŸ æ¥è§£å†³ã€‚\nå¤–é”®çº¦æŸï¼šè®©ä¸¤å¼ è¡¨çš„æ•°æ®å»ºç«‹è¿æ¥ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚\nå¯¹åº”çš„å…³é”®å­—ï¼šforeign key\nå¤–é”®çº¦æŸçš„è¯­æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 -- åˆ›å»ºè¡¨æ—¶æŒ‡å®š create table è¡¨å( å­—æ®µå æ•°æ®ç±»å‹, ... [constraint] [å¤–é”®åç§°] foreign key (å¤–é”®å­—æ®µå) references ä¸»è¡¨ (ä¸»è¡¨åˆ—å) ); -- å»ºå®Œè¡¨åï¼Œæ·»åŠ å¤–é”® alter table è¡¨å add constraint å¤–é”®åç§° foreign key(å¤–é”®å­—æ®µå) references ä¸»è¡¨(ä¸»è¡¨åˆ—å); é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸ºå‘˜å·¥è¡¨çš„dept_id å»ºç«‹å¤–é”®çº¦æŸï¼Œæ¥å…³è”éƒ¨é—¨è¡¨çš„ä¸»é”®ã€‚\næ–¹å¼1ï¼šé€šè¿‡SQLè¯­å¥æ“ä½œ\n1 2 3 -- ä¿®æ”¹è¡¨ï¼š æ·»åŠ å¤–é”®çº¦æŸ alter table tb_emp add constraint fk_dept_id foreign key (dept_id) references tb_dept(id); æ–¹å¼2ï¼šå›¾å½¢åŒ–ç•Œé¢æ“ä½œ\nå½“æˆ‘ä»¬æ·»åŠ å¤–é”®çº¦æŸæ—¶ï¼Œæˆ‘ä»¬å¾—ä¿è¯å½“å‰æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®æ˜¯å®Œæ•´çš„ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¹‹å‰åˆ é™¤æ‰çš„æ•°æ®å†æ·»åŠ å›æ¥ã€‚\nå½“æˆ‘ä»¬æ·»åŠ äº†å¤–é”®ä¹‹åï¼Œå†åˆ é™¤IDä¸º1çš„éƒ¨é—¨ï¼Œå°±ä¼šå‘ç°ï¼Œæ­¤æ—¶æ•°æ®åº“æŠ¥é”™äº†ï¼Œä¸å…è®¸åˆ é™¤ã€‚\nå¤–é”®çº¦æŸï¼ˆforeign keyï¼‰ï¼šä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚\nç‰©ç†å¤–é”®å’Œé€»è¾‘å¤–é”®\nç‰©ç†å¤–é”® æ¦‚å¿µï¼šä½¿ç”¨foreign keyå®šä¹‰å¤–é”®å…³è”å¦å¤–ä¸€å¼ è¡¨ã€‚ ç¼ºç‚¹ï¼š å½±å“å¢ã€åˆ ã€æ”¹çš„æ•ˆç‡ï¼ˆéœ€è¦æ£€æŸ¥å¤–é”®å…³ç³»ï¼‰ã€‚ ä»…ç”¨äºå•èŠ‚ç‚¹æ•°æ®åº“ï¼Œä¸é€‚ç”¨ä¸åˆ†å¸ƒå¼ã€é›†ç¾¤åœºæ™¯ã€‚ å®¹æ˜“å¼•å‘æ•°æ®åº“çš„æ­»é”é—®é¢˜ï¼Œæ¶ˆè€—æ€§èƒ½ã€‚ é€»è¾‘å¤–é”® æ¦‚å¿µï¼šåœ¨ä¸šåŠ¡å±‚é€»è¾‘ä¸­ï¼Œè§£å†³å¤–é”®å…³è”ã€‚ é€šè¿‡é€»è¾‘å¤–é”®ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ åœ¨ç°åœ¨çš„ä¼ä¸šå¼€å‘ä¸­ï¼Œå¾ˆå°‘ä¼šä½¿ç”¨ç‰©ç†å¤–é”®ï¼Œéƒ½æ˜¯ä½¿ç”¨é€»è¾‘å¤–é”®ã€‚ ç”šè‡³åœ¨ä¸€äº›æ•°æ®åº“å¼€å‘è§„èŒƒä¸­ï¼Œä¼šæ˜ç¡®æŒ‡å‡ºç¦æ­¢ä½¿ç”¨ç‰©ç†å¤–é”® foreign key\nMySQL-å¤šè¡¨è®¾è®¡-ä¸€å¯¹ä¸€\u0026amp;å¤šå¯¹å¤š ä¸€å¯¹ä¸€\nä¸€å¯¹ä¸€å…³ç³»è¡¨åœ¨å®é™…å¼€å‘ä¸­åº”ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸æ˜¯ç”¨æ¥åšå•è¡¨çš„æ‹†åˆ†ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€å¼ å¤§è¡¨æ‹†åˆ†æˆä¸¤å¼ å°è¡¨ï¼Œå°†å¤§è¡¨ä¸­çš„ä¸€äº›åŸºç¡€å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨å½“ä¸­ï¼Œå°†å…¶ä»–çš„å­—æ®µæ”¾åœ¨å¦å¤–ä¸€å¼ è¡¨å½“ä¸­ï¼Œä»¥æ­¤æ¥æé«˜æ•°æ®çš„æ“ä½œæ•ˆç‡ã€‚\nä¸€å¯¹ä¸€çš„åº”ç”¨åœºæ™¯ï¼š ç”¨æˆ·è¡¨(åŸºæœ¬ä¿¡æ¯+èº«ä»½ä¿¡æ¯)\nåŸºæœ¬ä¿¡æ¯ï¼šç”¨æˆ·çš„IDã€å§“åã€æ€§åˆ«ã€æ‰‹æœºå·ã€å­¦å† èº«ä»½ä¿¡æ¯ï¼šæ°‘æ—ã€ç”Ÿæ—¥ã€èº«ä»½è¯å·ã€èº«ä»½è¯ç­¾å‘æœºå…³ï¼Œèº«ä»½è¯çš„æœ‰æ•ˆæœŸ(å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´) å¦‚æœåœ¨ä¸šåŠ¡ç³»ç»Ÿå½“ä¸­ï¼Œå¯¹ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢é¢‘ç‡ç‰¹åˆ«çš„é«˜ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·çš„èº«ä»½ä¿¡æ¯æŸ¥è¯¢é¢‘ç‡å¾ˆä½ï¼Œæ­¤æ—¶å‡ºäºæé«˜æŸ¥è¯¢æ•ˆç‡çš„è€ƒè™‘ï¼Œæˆ‘å°±å¯ä»¥å°†è¿™å¼ å¤§è¡¨æ‹†åˆ†æˆä¸¤å¼ å°è¡¨ï¼Œç¬¬ä¸€å¼ è¡¨å­˜æ”¾çš„æ˜¯ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œè€Œç¬¬äºŒå¼ è¡¨å­˜æ”¾çš„å°±æ˜¯ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ã€‚ä»–ä»¬ä¸¤è€…ä¹‹é—´ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½å¯¹åº”ä¸€ä¸ªèº«ä»½è¯ï¼Œè€Œä¸€ä¸ªèº«ä»½è¯ä¹Ÿåªèƒ½å…³è”ä¸€ä¸ªç”¨æˆ·ã€‚\né‚£ä¹ˆåœ¨æ•°æ®åº“å±‚é¢æ€ä¹ˆå»ä½“ç°ä¸Šè¿°ä¸¤è€…ä¹‹é—´æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»å‘¢ï¼Ÿ\nå…¶å®ä¸€å¯¹ä¸€æˆ‘ä»¬å¯ä»¥çœ‹æˆä¸€ç§ç‰¹æ®Šçš„ä¸€å¯¹å¤šã€‚ä¸€å¯¹å¤šæˆ‘ä»¬æ˜¯æ€ä¹ˆè®¾è®¡è¡¨å…³ç³»çš„ï¼Ÿæ˜¯ä¸æ˜¯åœ¨å¤šçš„ä¸€æ–¹æ·»åŠ å¤–é”®ã€‚åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å¤–é”®æ¥ä½“ç°ä¸€å¯¹ä¸€ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä»»æ„ä¸€æ–¹æ¥æ·»åŠ ä¸€ä¸ªå¤–é”®å°±å¯ä»¥äº†ã€‚\nä¸€å¯¹ä¸€ ï¼šåœ¨ä»»æ„ä¸€æ–¹åŠ å…¥å¤–é”®ï¼Œå…³è”å¦å¤–ä¸€æ–¹çš„ä¸»é”®ï¼Œå¹¶ä¸”è®¾ç½®å¤–é”®ä¸ºå”¯ä¸€çš„(UNIQUE)\nSQLè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 -- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨ create table tb_user( id int unsigned primary key auto_increment comment \u0026#39;ID\u0026#39;, name varchar(10) not null comment \u0026#39;å§“å\u0026#39;, gender tinyint unsigned not null comment \u0026#39;æ€§åˆ«, 1 ç”· 2 å¥³\u0026#39;, phone char(11) comment \u0026#39;æ‰‹æœºå·\u0026#39;, degree varchar(10) comment \u0026#39;å­¦å†\u0026#39; ) comment \u0026#39;ç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨\u0026#39;; -- æµ‹è¯•æ•°æ® insert into tb_user values (1,\u0026#39;ç™½çœ‰é¹°ç‹\u0026#39;,1,\u0026#39;18812340001\u0026#39;,\u0026#39;åˆä¸­\u0026#39;), (2,\u0026#39;é’ç¿¼è ç‹\u0026#39;,1,\u0026#39;18812340002\u0026#39;,\u0026#39;å¤§ä¸“\u0026#39;), (3,\u0026#39;é‡‘æ¯›ç‹®ç‹\u0026#39;,1,\u0026#39;18812340003\u0026#39;,\u0026#39;åˆä¸­\u0026#39;), (4,\u0026#39;ç´«è¡«é¾™ç‹\u0026#39;,2,\u0026#39;18812340004\u0026#39;,\u0026#39;ç¡•å£«\u0026#39;); -- ç”¨æˆ·èº«ä»½ä¿¡æ¯è¡¨ create table tb_user_card( id int unsigned primary key auto_increment comment \u0026#39;ID\u0026#39;, nationality varchar(10) not null comment \u0026#39;æ°‘æ—\u0026#39;, birthday date not null comment \u0026#39;ç”Ÿæ—¥\u0026#39;, idcard char(18) not null comment \u0026#39;èº«ä»½è¯å·\u0026#39;, issued varchar(20) not null comment \u0026#39;ç­¾å‘æœºå…³\u0026#39;, expire_begin date not null comment \u0026#39;æœ‰æ•ˆæœŸé™-å¼€å§‹\u0026#39;, expire_end date comment \u0026#39;æœ‰æ•ˆæœŸé™-ç»“æŸ\u0026#39;, user_id int unsigned not null unique comment \u0026#39;ç”¨æˆ·ID\u0026#39;, constraint fk_user_id foreign key (user_id) references tb_user(id) ) comment \u0026#39;ç”¨æˆ·èº«ä»½ä¿¡æ¯è¡¨\u0026#39;; -- æµ‹è¯•æ•°æ® insert into tb_user_card values (1,\u0026#39;æ±‰\u0026#39;,\u0026#39;1960-11-06\u0026#39;,\u0026#39;100000100000100001\u0026#39;,\u0026#39;æœé˜³åŒºå…¬å®‰å±€\u0026#39;,\u0026#39;2000-06-10\u0026#39;,null,1), (2,\u0026#39;æ±‰\u0026#39;,\u0026#39;1971-11-06\u0026#39;,\u0026#39;100000100000100002\u0026#39;,\u0026#39;é™å®‰åŒºå…¬å®‰å±€\u0026#39;,\u0026#39;2005-06-10\u0026#39;,\u0026#39;2025-06-10\u0026#39;,2), (3,\u0026#39;æ±‰\u0026#39;,\u0026#39;1963-11-06\u0026#39;,\u0026#39;100000100000100003\u0026#39;,\u0026#39;æ˜Œå¹³åŒºå…¬å®‰å±€\u0026#39;,\u0026#39;2006-06-10\u0026#39;,null,3), (4,\u0026#39;å›\u0026#39;,\u0026#39;1980-11-06\u0026#39;,\u0026#39;100000100000100004\u0026#39;,\u0026#39;æµ·æ·€åŒºå…¬å®‰å±€\u0026#39;,\u0026#39;2008-06-10\u0026#39;,\u0026#39;2028-06-10\u0026#39;,4); å¤šå¯¹å¤š\nå¤šå¯¹å¤šçš„å…³ç³»åœ¨å¼€å‘ä¸­å±äºä¹Ÿæ¯”è¾ƒå¸¸è§çš„ã€‚æ¯”å¦‚ï¼šå­¦ç”Ÿå’Œè€å¸ˆçš„å…³ç³»ï¼Œä¸€ä¸ªå­¦ç”Ÿå¯ä»¥æœ‰å¤šä¸ªæˆè¯¾è€å¸ˆï¼Œä¸€ä¸ªæˆè¯¾è€å¸ˆä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå­¦ç”Ÿã€‚åœ¨æ¯”å¦‚ï¼šå­¦ç”Ÿå’Œè¯¾ç¨‹çš„å…³ç³»ï¼Œä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰ä¿®å¤šé—¨è¯¾ç¨‹ï¼Œä¸€ä¸ªè¯¾ç¨‹ä¹Ÿå¯ä»¥ä¾›å¤šä¸ªå­¦ç”Ÿé€‰ä¿®ã€‚\næ¡ˆä¾‹ï¼šå­¦ç”Ÿä¸è¯¾ç¨‹çš„å…³ç³»\nå…³ç³»ï¼šä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰ä¿®å¤šé—¨è¯¾ç¨‹ï¼Œä¸€é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥ä¾›å¤šä¸ªå­¦ç”Ÿé€‰æ‹© å®ç°å…³ç³»ï¼šå»ºç«‹ç¬¬ä¸‰å¼ ä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªå¤–é”®ï¼Œåˆ†åˆ«å…³è”ä¸¤æ–¹ä¸»é”® SQLè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 -- å­¦ç”Ÿè¡¨ create table tb_student( id int auto_increment primary key comment \u0026#39;ä¸»é”®ID\u0026#39;, name varchar(10) comment \u0026#39;å§“å\u0026#39;, no varchar(10) comment \u0026#39;å­¦å·\u0026#39; ) comment \u0026#39;å­¦ç”Ÿè¡¨\u0026#39;; -- å­¦ç”Ÿè¡¨æµ‹è¯•æ•°æ® insert into tb_student(name, no) values (\u0026#39;é»›ç»®ä¸\u0026#39;, \u0026#39;2000100101\u0026#39;),(\u0026#39;è°¢é€Š\u0026#39;, \u0026#39;2000100102\u0026#39;),(\u0026#39;æ®·å¤©æ­£\u0026#39;, \u0026#39;2000100103\u0026#39;),(\u0026#39;éŸ¦ä¸€ç¬‘\u0026#39;, \u0026#39;2000100104\u0026#39;); -- è¯¾ç¨‹è¡¨ create table tb_course( id int auto_increment primary key comment \u0026#39;ä¸»é”®ID\u0026#39;, name varchar(10) comment \u0026#39;è¯¾ç¨‹åç§°\u0026#39; ) comment \u0026#39;è¯¾ç¨‹è¡¨\u0026#39;; -- è¯¾ç¨‹è¡¨æµ‹è¯•æ•°æ® insert into tb_course (name) values (\u0026#39;Java\u0026#39;), (\u0026#39;PHP\u0026#39;), (\u0026#39;MySQL\u0026#39;) , (\u0026#39;Hadoop\u0026#39;); -- å­¦ç”Ÿè¯¾ç¨‹è¡¨ï¼ˆä¸­é—´è¡¨ï¼‰ create table tb_student_course( id int auto_increment comment \u0026#39;ä¸»é”®\u0026#39; primary key, student_id int not null comment \u0026#39;å­¦ç”ŸID\u0026#39;, course_id int not null comment \u0026#39;è¯¾ç¨‹ID\u0026#39;, constraint fk_courseid foreign key (course_id) references tb_course (id), constraint fk_studentid foreign key (student_id) references tb_student (id) )comment \u0026#39;å­¦ç”Ÿè¯¾ç¨‹ä¸­é—´è¡¨\u0026#39;; -- å­¦ç”Ÿè¯¾ç¨‹è¡¨æµ‹è¯•æ•°æ® insert into tb_student_course(student_id, course_id) values (1,1),(1,2),(1,3),(2,2),(2,3),(3,4); MySQL-å¤šè¡¨è®¾è®¡-æ¡ˆä¾‹-å…³ç³»åˆ†æ æ¡ˆä¾‹ï¼š å‚è€ƒé¡µé¢åŸå‹åŠéœ€æ±‚ï¼Œè®¾è®¡åˆç†çš„è¡¨ç»“æ„\næ­¥éª¤\né˜…è¯»é¡µé¢åŸå‹åŠéœ€æ±‚æ–‡æ¡£ï¼Œåˆ†æå„ä¸ªæ¨¡å—æ¶‰åŠåˆ°çš„è¡¨ç»“æ„ï¼ŒåŠè¡¨ç»“æ„ä¹‹é—´çš„å…³ç³»ã€‚ æ ¹æ®é¡µé¢åŸå‹åŠéœ€æ±‚æ–‡æ¡£ï¼Œåˆ†æå„ä¸ªè¡¨ç»“æ„ä¸­å…·ä½“çš„å­—æ®µåŠçº¦æŸã€‚ åˆ†æ\né¡µé¢åŸå‹-åˆ†ç±»ç®¡ç† åˆ†ç±»çš„ä¿¡æ¯ï¼šåˆ†ç±»åç§°ã€åˆ†ç±»ç±»å‹[èœå“/å¥—é¤]ã€åˆ†ç±»æ’åºã€åˆ†ç±»çŠ¶æ€[ç¦ç”¨/å¯ç”¨]ã€åˆ†ç±»çš„æ“ä½œæ—¶é—´(ä¿®æ”¹æ—¶é—´)ã€‚\né¡µé¢åŸå‹-èœå“ç®¡ç† èœå“çš„ä¿¡æ¯ï¼šèœå“åç§°ã€èœå“å›¾ç‰‡ã€èœå“åˆ†ç±»ã€èœå“å”®ä»·ã€èœå“å”®å–çŠ¶æ€ã€èœå“çš„æ“ä½œæ—¶é—´(ä¿®æ”¹æ—¶é—´)ã€‚\næ€è€ƒï¼šåˆ†ç±»ä¸èœå“ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ\næ€è€ƒé€»è¾‘ï¼šä¸€ä¸ªåˆ†ç±»ä¸‹å¯ä»¥æœ‰å¤šä¸ªèœå“å—ï¼Ÿåè¿‡æ¥å†æƒ³ä¸€æƒ³ï¼Œä¸€ä¸ªèœå“ä¼šå¯¹åº”å¤šä¸ªåˆ†ç±»å—ï¼Ÿ ç­”æ¡ˆï¼šä¸€å¯¹å¤šå…³ç³»ã€‚ä¸€ä¸ªåˆ†ç±»ä¸‹ä¼šæœ‰å¤šä¸ªèœå“ï¼Œè€Œä¸€ä¸ªèœå“åªèƒ½å½’å±ä¸€ä¸ªåˆ†ç±»ã€‚\nè®¾è®¡è¡¨åŸåˆ™ï¼šåœ¨å¤šçš„ä¸€æ–¹ï¼Œæ·»åŠ å­—æ®µï¼Œå…³è”å±äºä¸€è¿™æ–¹çš„ä¸»é”®ã€‚\né¡µé¢åŸå‹-å¥—é¤ç®¡ç† å¥—é¤çš„ä¿¡æ¯ï¼šå¥—é¤åç§°ã€å¥—é¤å›¾ç‰‡ã€å¥—é¤åˆ†ç±»ã€å¥—é¤ä»·æ ¼ã€å¥—é¤å”®å–çŠ¶æ€ã€å¥—é¤çš„æ“ä½œæ—¶é—´ã€‚\næ€è€ƒï¼šå¥—é¤ä¸èœå“ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ\næ€è€ƒé€»è¾‘ï¼šä¸€ä¸ªå¥—é¤ä¸‹å¯ä»¥æœ‰å¤šä¸ªèœå“å—ï¼Ÿåè¿‡æ¥å†æƒ³ä¸€æƒ³ï¼Œä¸€ä¸ªèœå“å¯ä»¥å‡ºç°åœ¨å¤šä¸ªå¥—é¤ä¸­å—ï¼Ÿ ç­”æ¡ˆï¼šå¤šå¯¹å¤šå…³ç³»ã€‚ä¸€ä¸ªå¥—é¤ä¸‹ä¼šæœ‰å¤šä¸ªèœå“ï¼Œè€Œä¸€ä¸ªèœå“ä¹Ÿå¯ä»¥å‡ºç°åœ¨å¤šä¸ªå¥—é¤ä¸­ã€‚\nè®¾è®¡è¡¨åŸåˆ™ï¼šåˆ›å»ºç¬¬ä¸‰å¼ ä¸­é—´è¡¨ï¼Œå»ºç«‹ä¸¤ä¸ªå­—æ®µåˆ†åˆ«å…³è”èœå“è¡¨çš„ä¸»é”®å’Œå¥—é¤è¡¨çš„ä¸»é”®ã€‚\nåˆ†æé¡µé¢åŸå‹åŠéœ€æ±‚æ–‡æ¡£åï¼Œæˆ‘ä»¬è·å¾—ï¼š\nåˆ†ç±»è¡¨ ä¸šåŠ¡å­—æ®µï¼šåˆ†ç±»åç§°ã€åˆ†ç±»ç±»å‹ã€åˆ†ç±»æ’åºã€åˆ†ç±»çŠ¶æ€ åŸºç¡€å­—æ®µï¼šid(ä¸»é”®)ã€åˆ†ç±»çš„åˆ›å»ºæ—¶é—´ã€åˆ†ç±»çš„ä¿®æ”¹æ—¶é—´ èœå“è¡¨ ä¸šåŠ¡å­—æ®µï¼šèœå“åç§°ã€èœå“å›¾ç‰‡ã€èœå“åˆ†ç±»ã€èœå“å”®ä»·ã€èœå“å”®å–çŠ¶æ€ åŸºç¡€å­—æ®µï¼šid(ä¸»é”®)ã€åˆ†ç±»çš„åˆ›å»ºæ—¶é—´ã€åˆ†ç±»çš„ä¿®æ”¹æ—¶é—´ å¥—é¤è¡¨ ä¸šåŠ¡å­—æ®µï¼šå¥—é¤åç§°ã€å¥—é¤å›¾ç‰‡ã€å¥—é¤åˆ†ç±»ã€å¥—é¤ä»·æ ¼ã€å¥—é¤å”®å–çŠ¶æ€ åŸºç¡€å­—æ®µï¼šid(ä¸»é”®)ã€åˆ†ç±»çš„åˆ›å»ºæ—¶é—´ã€åˆ†ç±»çš„ä¿®æ”¹æ—¶é—´ è¡¨ç»“æ„ä¹‹é—´çš„å…³ç³»ï¼š\nåˆ†ç±»è¡¨ - èœå“è¡¨ ï¼š ä¸€å¯¹å¤š åœ¨èœå“è¡¨ä¸­æ·»åŠ å­—æ®µ(èœå“åˆ†ç±»)ï¼Œå…³è”åˆ†ç±»è¡¨ èœå“è¡¨ - å¥—é¤è¡¨ ï¼š å¤šå¯¹å¤š åˆ›å»ºç¬¬ä¸‰å¼ ä¸­é—´è¡¨(å¥—é¤èœå“å…³è”è¡¨)ï¼Œåœ¨ä¸­é—´è¡¨ä¸Šæ·»åŠ ä¸¤ä¸ªå­—æ®µ(èœå“idã€å¥—é¤id)ï¼Œåˆ†åˆ«å…³è”èœå“è¡¨å’Œåˆ†ç±»è¡¨ MySQL-å¤šè¡¨è®¾è®¡-æ¡ˆä¾‹-è¡¨ç»“æ„ è¡¨ç»“æ„\nåˆ†ç±»è¡¨ï¼šcategory\nä¸šåŠ¡å­—æ®µï¼šåˆ†ç±»åç§°ã€åˆ†ç±»ç±»å‹ã€åˆ†ç±»æ’åºã€åˆ†ç±»çŠ¶æ€ åŸºç¡€å­—æ®µï¼šid(ä¸»é”®)ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ 1 2 3 4 5 6 7 8 9 10 11 -- åˆ†ç±»è¡¨ create table category ( id int unsigned primary key auto_increment comment \u0026#39;ä¸»é”®ID\u0026#39;, name varchar(20) not null unique comment \u0026#39;åˆ†ç±»åç§°\u0026#39;, type tinyint unsigned not null comment \u0026#39;ç±»å‹ 1 èœå“åˆ†ç±» 2 å¥—é¤åˆ†ç±»\u0026#39;, sort tinyint unsigned not null comment \u0026#39;é¡ºåº\u0026#39;, status tinyint unsigned not null default 0 comment \u0026#39;çŠ¶æ€ 0 ç¦ç”¨ï¼Œ1 å¯ç”¨\u0026#39;, create_time datetime not null comment \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, update_time datetime not null comment \u0026#39;æ›´æ–°æ—¶é—´\u0026#39; ) comment \u0026#39;èœå“åŠå¥—é¤åˆ†ç±»\u0026#39;; èœå“è¡¨ï¼šdish\nä¸šåŠ¡å­—æ®µï¼šèœå“åç§°ã€èœå“å›¾ç‰‡ã€èœå“åˆ†ç±»ã€èœå“å”®ä»·ã€èœå“å”®å–çŠ¶æ€ åŸºç¡€å­—æ®µï¼šid(ä¸»é”®)ã€åˆ†ç±»çš„åˆ›å»ºæ—¶é—´ã€åˆ†ç±»çš„ä¿®æ”¹æ—¶é—´ 1 2 3 4 5 6 7 8 9 10 11 12 13 -- èœå“è¡¨ create table dish ( id int unsigned primary key auto_increment comment \u0026#39;ä¸»é”®ID\u0026#39;, name varchar(20) not null unique comment \u0026#39;èœå“åç§°\u0026#39;, category_id int unsigned not null comment \u0026#39;èœå“åˆ†ç±»ID\u0026#39;, -- é€»è¾‘å¤–é”® price decimal(8, 2) not null comment \u0026#39;èœå“ä»·æ ¼\u0026#39;, image varchar(300) not null comment \u0026#39;èœå“å›¾ç‰‡\u0026#39;, description varchar(200) comment \u0026#39;æè¿°ä¿¡æ¯\u0026#39;, status tinyint unsigned not null default 0 comment \u0026#39;çŠ¶æ€, 0 åœå”® 1 èµ·å”®\u0026#39;, create_time datetime not null comment \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, update_time datetime not null comment \u0026#39;æ›´æ–°æ—¶é—´\u0026#39; ) comment \u0026#39;èœå“\u0026#39;; å¥—é¤è¡¨ï¼šsetmeal\nä¸šåŠ¡å­—æ®µï¼šå¥—é¤åç§°ã€å¥—é¤å›¾ç‰‡ã€å¥—é¤åˆ†ç±»ã€å¥—é¤ä»·æ ¼ã€å¥—é¤å”®å–çŠ¶æ€ åŸºç¡€å­—æ®µï¼šid(ä¸»é”®)ã€åˆ†ç±»çš„åˆ›å»ºæ—¶é—´ã€åˆ†ç±»çš„ä¿®æ”¹æ—¶é—´ 1 2 3 4 5 6 7 8 9 10 11 12 13 -- å¥—é¤è¡¨ create table setmeal ( id int unsigned primary key auto_increment comment \u0026#39;ä¸»é”®ID\u0026#39;, name varchar(20) not null unique comment \u0026#39;å¥—é¤åç§°\u0026#39;, category_id int unsigned not null comment \u0026#39;åˆ†ç±»id\u0026#39;, -- é€»è¾‘å¤–é”® price decimal(8, 2) not null comment \u0026#39;å¥—é¤ä»·æ ¼\u0026#39;, image varchar(300) not null comment \u0026#39;å›¾ç‰‡\u0026#39;, description varchar(200) comment \u0026#39;æè¿°ä¿¡æ¯\u0026#39;, status tinyint unsigned not null default 0 comment \u0026#39;çŠ¶æ€ 0:åœç”¨ 1:å¯ç”¨\u0026#39;, create_time datetime not null comment \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, update_time datetime not null comment \u0026#39;æ›´æ–°æ—¶é—´\u0026#39; ) comment \u0026#39;å¥—é¤\u0026#39;; å¥—é¤èœå“å…³è”è¡¨ï¼šsetmeal_dish\n1 2 3 4 5 6 7 8 -- å¥—é¤èœå“å…³è”è¡¨ create table setmeal_dish ( id int unsigned primary key auto_increment comment \u0026#39;ä¸»é”®ID\u0026#39;, setmeal_id int unsigned not null comment \u0026#39;å¥—é¤id \u0026#39;, -- é€»è¾‘å¤–é”® dish_id int unsigned not null comment \u0026#39;èœå“id\u0026#39;, -- é€»è¾‘å¤–é”® copies tinyint unsigned not null comment \u0026#39;ä»½æ•°\u0026#39; ) comment \u0026#39;å¥—é¤èœå“å…³è”è¡¨\u0026#39;; å°ç»“\n","date":"2024-04-16T16:01:23+08:00","image":"https://nova-bryan.github.io/p/mysql-dql/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/mysql-dql/","title":"Mysql DQL"},{"content":"è‹ç©¹å¤–å–å­¦ä¹ æ–‡æ¡£ è½¯ä»¶å¼€å‘æ•´ä½“ä»‹ç» è½¯ä»¶å¼€å‘æµç¨‹ éœ€æ±‚åˆ†æ éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€äº§å“åŸå‹\nè®¾è®¡ UIè®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€æ¥å£è®¾è®¡\nç¼–ç  é¡¹ç›®ä»£ç ã€å•å…ƒæµ‹è¯•\næµ‹è¯• æµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•æŠ¥å‘Š\nä¸Šçº¿è¿ç»´ è½¯ä»¶ç¯å¢ƒå®‰è£…ã€é…ç½®\nè§’è‰²åˆ†å·¥ é¡¹ç›®ç»ç†\nå¯¹æ•´ä½“é¡¹ç›®è´Ÿè´£ï¼Œä»»åŠ¡åˆ†é…ã€æŠŠæ§è¿›åº¦\näº§å“ç»ç†\nè¿›è¡Œéœ€æ±‚è°ƒç ”ã€‚è¾“å‡ºéœ€æ±‚è°ƒç ”æ–‡æ¡£ã€äº§å“åŸå‹ç­‰\nUIè®¾è®¡å¸ˆ\næ ¹æ®äº§å“æ¨¡å‹è¾“å‡ºç•Œé¢æ•ˆæœå›¾\næ¶æ„å¸ˆ\né¡¹ç›®æ•´ä½“æ¶æ„è®¾è®¡ã€æŠ€æœ¯é€‰å‹ç­‰\nå¼€å‘å·¥ç¨‹å¸ˆ\nä»£ç å®ç°\næµ‹è¯•å·¥ç¨‹å¸ˆ\nç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œè¾“å‡ºæµ‹è¯•æŠ¥å‘Š\nè¿ç»´å·¥ç¨‹å¸ˆ\nè½¯ä»¶ç¯å¢ƒæ­å»ºã€é¡¹ç›®ä¸Šçº¿\nè½¯ä»¶ç¯å¢ƒ å¼€å‘ç¯å¢ƒ å¼€å‘äººå‘˜åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨çš„ç¯å¢ƒï¼Œä¸€èˆ¬å¤–éƒ¨ç”¨æˆ·æ— æ³•è®¿é—®\næµ‹è¯•ç¯å¢ƒ ä¸“é—¨ç»™æµ‹è¯•äººå‘˜ä½¿ç”¨çš„ç¯å¢ƒï¼Œç”¨äºæµ‹è¯•é¡¹ç›®ï¼Œä¸€èˆ¬å¤–éƒ¨ç”¨æˆ·æ— æ³•è®¿é—®\nç”Ÿäº§ç¯å¢ƒ å³çº¿ä¸Šç¯å¢ƒï¼Œæ­£å¼æä¾›å¯¹å¤–æœåŠ¡çš„ç¯å¢ƒ\nè‹ç©¹å¤–å–é¡¹ç›®ä»‹ç» é¡¹ç›®ä»‹ç» å®šä½ï¼šä¸“é—¨ä¸ºé¤é¥®ä¼ä¸šå®šåˆ¶çš„ä¸€æ¬¾è½¯ä»¶äº§å“\nåŠŸèƒ½æ¶æ„ï¼š\näº§å“åŸå‹ ç”¨äºå±•ç¤ºé¡¹ç›®çš„ä¸šåŠ¡åŠŸèƒ½\næŠ€æœ¯é€‰å‹ å±•ç¤ºé¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ¡†æ¶å’Œä¸­é—´ä»¶ç­‰\nå¼€å‘ç¯å¢ƒæ­å»º å‰ç«¯ç¯å¢ƒæ­å»º æ•´ä½“ç»“æ„ é€šè¿‡Nginxä»£ç†\nåç«¯ç¯å¢ƒæ­å»º ç†Ÿæ‚‰é¡¹ç›®ç»“æ„ sky-commonå­æ¨¡å— constantï¼šå¸¸é‡ç±» contextï¼šé¡¹ç›®ä¸Šä¸‹æ–‡ç›¸å…³ enumerationï¼šæšä¸¾ç±» exceptionï¼šè‡ªå®šä¹‰å¼‚å¸¸ç±» jsonï¼šå¤„ç†jsonè½¬æ¢ propertiesï¼šspringbooté…ç½®å±æ€§ç±»ï¼ŒæŠŠé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹å°è£…æˆå¯¹è±¡ resultï¼šåç«¯è¿”å›çš„ç»“æœ utilsï¼šå·¥å…·ç±» sky-pojoå­æ¨¡å— sky-serverå­æ¨¡å— å­˜æ”¾çš„æ˜¯ é…ç½®æ–‡ä»¶ã€é…ç½®ç±»ã€æ‹¦æˆªå™¨ã€controllerã€serviceã€mapperã€å¯åŠ¨ç±»ç­‰\nä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ åˆ›å»ºGitæœ¬åœ°ä»“åº“ åˆ›å»ºGitè¿œç¨‹ä»“åº“ å°†æœ¬åœ°æ–‡ä»¶æ¨é€åˆ°Gitè¿œç¨‹ä»“åº“ æ•°æ®åº“ç¯å¢ƒæ­å»º å‰åç«¯è”è°ƒ NginxğŸ†• åå‘ä»£ç†ï¼Œå°±æ˜¯è®©å‰ç«¯å‘é€çš„åŠ¨æ€è¯·æ±‚ç”±Nginxè½¬å‘åˆ°åç«¯æœåŠ¡å™¨\nNginxåå‘ä»£ç†çš„å¥½å¤„\næé«˜è®¿é—®é€Ÿåº¦\nè¿›è¡Œè´Ÿè½½å‡è¡¡\nå°±æ˜¯æŠŠå¤§é‡çš„è¯·æ±‚æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ–¹å¼å‡è¡¡çš„åˆ†é…ç»™é›†ç¾¤ä¸­çš„æ¯å°æœåŠ¡å™¨\nä¿è¯åç«¯æœåŠ¡å®‰å…¨\nNginxåå‘ä»£ç†çš„é…ç½®æ–¹å¼ Nginxè´Ÿè½½å‡è¡¡çš„é…ç½®æ–¹å¼ Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥ è½®è¯¢ï¼šå¹³å‡æ¥æ”¶åˆ°è¯·æ±‚\nå®Œå–„ç™»å½•åŠŸèƒ½ ä¿®æ”¹æ•°æ®åº“ä¸­çš„æ˜æ–‡å¯†ç ï¼Œæ”¹ä¸ºMD5åŠ å¯†åçš„å¯†æ–‡ ä¿®æ”¹Javaä»£ç ï¼Œå‰ç«¯æäº¤çš„å¯†ç è¿›è¡ŒMD5åŠ å¯†åå†è·Ÿæ•°æ®åº“ä¸­å¯†ç æ¯”å¯¹ å¯¼å…¥æ¥å£æ–‡æ¡£ å‰åç«¯åˆ†ç¦»å¼€å‘æµç¨‹ æ“ä½œæ­¥éª¤ è¿™é‡ŒYApiå¯æ¢æˆApiPostï¼Œå¯¼å…¥æ•°æ®é€‰æ‹©YApiå³å¯\nSwagger ä»‹ç» ä½¿ç”¨æ–¹å¼ å¯¼å…¥knife4jçš„mavenåæ ‡\nåœ¨é…ç½®ç±»ä¸­åŠ å…¥knife4jç›¸å…³é…ç½®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /** * é€šè¿‡knife4jç”Ÿæˆæ¥å£æ–‡æ¡£ * @return */ @Bean public Docket docket() { ApiInfo apiInfo = new ApiInfoBuilder() .title(\u0026#34;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£\u0026#34;) .version(\u0026#34;2.0\u0026#34;) .description(\u0026#34;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£\u0026#34;) .build(); Docket docket = new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo) .select() //æŒ‡å®šç”Ÿæˆæ¥å£éœ€è¦æ‰«æçš„åŒ… .apis(RequestHandlerSelectors.basePackage(\u0026#34;com.sky.controller\u0026#34;)) .paths(PathSelectors.any()) .build(); return docket; } è®¾ç½®é™æ€èµ„æºæ˜ å°„ï¼Œå¦åˆ™æ¥å£æ–‡æ¡£é¡µé¢æ— æ³•è®¿é—®\n1 2 3 4 5 6 7 8 9 /** * è®¾ç½®é™æ€èµ„æºæ˜ å°„ * @param registry */ protected void addResourceHandlers(ResourceHandlerRegistry registry) { log.info(\u0026#34;å¼€å§‹è®¾ç½®é™æ€èµ„æºæ˜ å°„...\u0026#34;); registry.addResourceHandler(\u0026#34;/doc.html\u0026#34;).addResourceLocations(\u0026#34;classpath:/META-INF/resources/\u0026#34;); registry.addResourceHandler(\u0026#34;/webjars/**\u0026#34;).addResourceLocations(\u0026#34;classpath:/META-INF/resources/webjars/\u0026#34;); } å¸¸ç”¨æ³¨è§£ é€šè¿‡æ³¨è§£å¯ä»¥æ§åˆ¶ç”Ÿæˆçš„æ¥å£æ–‡æ¡£ï¼Œä½¿æ¥å£æ–‡æ¡£æ‹¥æœ‰æ›´å¥½çš„å¯è¯»æ€§ï¼Œå¸¸ç”¨æ³¨è§£å¦‚ä¸‹ï¼š\nå‘˜å·¥ç®¡ç†ã€åˆ†ç±»ç®¡ç† å‘˜å·¥ç®¡ç†ç•Œé¢\nåˆ†ç±»ç®¡ç†ç•Œé¢\næ–°å¢å‘˜å·¥ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ æ¥å£è®¾è®¡ æœ¬é¡¹ç›®çº¦å®šï¼š\nç®¡ç†ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨/adminä½œä¸ºå‰ç¼€ ç”¨æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨/userä½œä¸ºå‰ç¼€ æ•°æ®åº“è®¾è®¡ employeeè¡¨ä¸ºå‘˜å·¥è¡¨ï¼Œç”¨äºå­˜å‚¨å•†å®¶å†…éƒ¨çš„å‘˜å·¥ä¿¡æ¯ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹ï¼š\nå­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ å¤‡æ³¨ id bigint ä¸»é”® è‡ªå¢â­ name varchar(32) å§“å username varchar(32) ç”¨æˆ·å å”¯ä¸€â­ password varchar(64) å¯†ç  phone varchar(11) æ‰‹æœºå· sex varchar(2) æ€§åˆ« id_number varchar(18) èº«ä»½è¯å· status int è´¦å·çŠ¶æ€ 1æ­£å¸¸ 0é”å®šâ­ create_time datetime åˆ›å»ºæ—¶é—´ update_time datetime æœ€åä¿®æ”¹æ—¶é—´ create_user bigint åˆ›å»ºäººid update_user bigint æœ€åä¿®æ”¹äººid ä»£ç å¼€å‘ æ ¹æ®æ–°å¢å‘˜å·¥æ¥å£è®¾è®¡å¯¹åº”çš„DTO\næ³¨æ„ï¼šå½“å‰ç«¯æäº¤çš„æ•°æ®å’Œå®ä½“ç±»ä¸­å¯¹åº”çš„å±æ€§å·®åˆ«æ¯”è¾ƒå¤§æ—¶ï¼Œå»ºè®®ä½¿ç”¨DTOæ¥å°è£…æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 /** * æ–°å¢å‘˜å·¥ * @param employeeDTO */ public void save(EmployeeDTO employeeDTO) { Employee employee = new Employee(); //å¯¹è±¡å±æ€§æ‹·è´ï¼Œå±æ€§åå¿…é¡»ä¸€è‡´ BeanUtils.copyProperties(employeeDTO, employee); //è®¾ç½®è´¦å·çš„çŠ¶æ€ï¼Œé»˜è®¤æ­£å¸¸çŠ¶æ€ï¼Œ1è¡¨ç¤ºæ­£å¸¸ï¼Œ0è¡¨ç¤ºé”å®š employee.setStatus(StatusConstant.ENABLE); //è®¾ç½®å¯†ç ï¼Œé»˜è®¤å¯†ç ä¸º123456 employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes())); //è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´ employee.setCreateTime(LocalDateTime.now()); employee.setUpdateTime(LocalDateTime.now()); //è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºäººidå’Œä¿®æ”¹äººid // TODO åæœŸéœ€è¦æ”¹ä¸ºå½“å‰ç™»å½•çš„ç”¨æˆ·id employee.setCreateUser(10L); employee.setUpdateUser(10L); employeeMapper.insert(employee); } åŠŸèƒ½æµ‹è¯• é€šè¿‡Swaggeræ¥å£æ–‡æ¡£æµ‹è¯• é€šè¿‡å‰åç«¯è”è°ƒæµ‹è¯• æ³¨æ„ï¼šç”±äºå¼€å‘é˜¶æ®µå‰ç«¯å’Œåç«¯æ˜¯å¹¶è¡Œå¼€å‘çš„ï¼Œåç«¯å®ŒæˆæŸä¸ªåŠŸèƒ½åï¼Œæ­¤æ—¶å‰ç«¯å¯¹åº”çš„åŠŸèƒ½å¯èƒ½è¿˜æ²¡æœ‰å¼€å‘å®Œæˆï¼Œå¯¼è‡´æ— æ³•è¿›è¡Œå‰åç«¯è”è°ƒæµ‹è¯•ã€‚æ‰€ä»¥åœ¨å¼€å‘é˜¶æ®µï¼Œåç«¯æµ‹è¯•ä¸»è¦ä»¥æ¥å£æ–‡æ¡£æµ‹è¯•ä¸ºä¸»ã€‚\nä»£ç å®Œå–„ ç¨‹åºå­˜åœ¨çš„é—®é¢˜ï¼š\nå½•å…¥çš„ç”¨æˆ·åå·²å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸åæ²¡æœ‰å¤„ç† æ–°å¢å‘˜å·¥æ—¶ï¼Œåˆ›å»ºäººidå’Œä¿®æ”¹äººidè®¾ç½®ä¸ºäº†å›ºå®šå€¼ è§£æå‡ºç™»å½•å‘˜å·¥idåï¼Œå¦‚ä½•ä¼ é€’ç»™Serviceçš„saveæ–¹æ³•ï¼Ÿ\nå‘˜å·¥åˆ†é¡µæŸ¥è¯¢ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\nä¸šåŠ¡è§„åˆ™ï¼š\næ ¹æ®æ¯é¡µå±•ç¤ºå‘˜å·¥ä¿¡æ¯ æ¯é¡µå±•ç¤º10æ¡æ•°æ® åˆ†é¡µæŸ¥è¯¢æ—¶å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè¾“å…¥å‘˜å·¥å§“åè¿›è¡ŒæŸ¥è¯¢ æ¥å£è®¾è®¡\nä»£ç å¼€å‘ å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢åç«¯è¿”å›çš„å¯¹è±¡ç±»å‹ä¸ºï¼šResult\u0026lt;PageResult\u0026gt;\nmybatisæä¾›çš„åˆ†é¡µæŸ¥è¯¢æ¡†æ¶pagehelper\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.github.pagehelper\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;pagehelper-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${pagehelper}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åŠŸèƒ½æµ‹è¯• å¯ä»¥é€šè¿‡æ¥å£æ–‡æ¡£è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå‰åç«¯è”è°ƒæµ‹è¯•ã€‚\nä»£ç å®Œå–„ æœ€åæ“ä½œæ—¶é—´éœ€è¦ä¿®æ”¹æˆå¹´æœˆæ—¥\nè§£å†³æ–¹å¼ï¼š\næ–¹å¼ä¸€ï¼šåœ¨å±æ€§ä¸ŠåŠ å…¥æ³¨è§£ï¼Œå¯¹æ—¥æœŸè¿›è¡Œæ ¼å¼åŒ–\n1 2 @JsonFormat(pattern = \u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;) private LocalDateTime updateTime æ–¹å¼äºŒï¼šåœ¨Webconfigurationä¸­æ‰©å±•SpringMvcçš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œç»Ÿä¸€å¯¹æ—¥æœŸç±»å‹è¿›è¡Œæ ¼å¼åŒ–å¤„ç†\nå¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å· éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\nä¸šåŠ¡è§„åˆ™ï¼š\nå¯ä»¥å¯¹çŠ¶æ€ä¸ºâ€œå¯ç”¨â€çš„å‘˜å·¥è´¦å·è¿›è¡Œâ€œç¦ç”¨â€æ“ä½œ å¯ä»¥å¯¹çŠ¶æ€ä¸ºâ€œç¦ç”¨â€çš„å‘˜å·¥è´¦å·è¿›è¡Œâ€œå¯ç”¨â€æ“ä½œ çŠ¶æ€ä¸ºâ€œç¦ç”¨â€çš„å‘˜å·¥è´¦å·ä¸èƒ½ç™»å½•ç³»ç»Ÿ æ¥å£è®¾è®¡\nä»£ç å¼€å‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 /** * å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å· * @param status * @param id * @return */ @PostMapping(\u0026#34;status/{status}\u0026#34;) @ApiOperation(\u0026#34;å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·\u0026#34;) public Result startOrStop(@PathVariable(\u0026#34;status\u0026#34;) Integer status, Long id) { log.info(\u0026#34;å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·ï¼š{}, {}\u0026#34;, status, id); employeeService.startOrStop(status, id); return Result.success(); } /** * å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å· * @param status * @param id */ public void startOrStop(Integer status, Long id) { // update employee set status = ? where id = ? /*Employee employee = new Employee(); employee.setStatus(status); employee.setId(id);*/ Employee employee = Employee.builder() .status(status) .id(id) .build(); employeeMapper.update(employee); } \u0026lt;update id=\u0026#34;update\u0026#34; parameterType=\u0026#34;Employee\u0026#34;\u0026gt; update employee \u0026lt;set\u0026gt; \u0026lt;if test=\u0026#34;name != null\u0026#34;\u0026gt;name = #{name},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;username != null\u0026#34;\u0026gt;username = #{username},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;password != null\u0026#34;\u0026gt;password = #{password},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;phone != null\u0026#34;\u0026gt;phone = #{phone},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;sex != null\u0026#34;\u0026gt;sex = #{sex},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;idNumber != null\u0026#34;\u0026gt;id_Number = #{idNumber},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;updateTime != null\u0026#34;\u0026gt;update_Time = #{updateTime},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;updateUser != null\u0026#34;\u0026gt;update_User = #{updateUser},\u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;status != null\u0026#34;\u0026gt;status = #{status},\u0026lt;/if\u0026gt; \u0026lt;/set\u0026gt; where id = #{id} \u0026lt;/update\u0026gt; åŠŸèƒ½æµ‹è¯• ç¼–è¾‘å‘˜å·¥ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\nç¼–è¾‘å‘˜å·¥åŠŸèƒ½æ¶‰åŠåˆ°ä¸¤ä¸ªæ¥å£ï¼š\næ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ ç¼–è¾‘å‘˜å·¥ä¿¡æ¯ ä»£ç å¼€å‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /** * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯ * @param employeeDTO * @return */ @PutMapping @ApiOperation(\u0026#34;ç¼–è¾‘å‘˜å·¥ä¿¡æ¯\u0026#34;) public Result update(@RequestBody EmployeeDTO employeeDTO) { log.info(\u0026#34;ç¼–è¾‘å‘˜å·¥ä¿¡æ¯: {}\u0026#34;, employeeDTO); employeeService.update(employeeDTO); return Result.success(); } /** * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯ * @param employeeDTO */ public void update(EmployeeDTO employeeDTO) { Employee employee = new Employee(); BeanUtils.copyProperties(employeeDTO, employee); employee.setUpdateTime(LocalDateTime.now()); employee.setUpdateUser(BaseContext.getCurrentId()); employeeMapper.update(employee); } åŠŸèƒ½æµ‹è¯• å¯¼å…¥åˆ†ç±»æ¨¡å—åŠŸèƒ½ä»£ç  éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\nä¸šåŠ¡è§„åˆ™ï¼š\nåˆ†ç±»åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ åˆ†ç±»æŒ‰ç…§ç±»å‹å¯ä»¥åˆ†ä¸ºèœå“åˆ†ç±»å’Œå¥—é¤åˆ†ç±» æ–°æ·»åŠ çš„åˆ†ç±»çŠ¶æ€é»˜è®¤ä¸ºç¦ç”¨ æ¥å£è®¾è®¡ï¼š\næ–°å¢åˆ†ç±» åˆ†ç±»åˆ†é¡µæŸ¥è¯¢ æ ¹æ®idåˆ é™¤åˆ†ç±» ä¿®æ”¹åˆ†ç±» å¯ç”¨ç¦ç”¨åˆ†ç±» æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±» æ•°æ®åº“è®¾è®¡ï¼ˆcategoryè¡¨ï¼‰ï¼š\ncategoryè¡¨ä¸ºåˆ†ç±»è¡¨ï¼Œç”¨äºå­˜å‚¨å•†å“çš„åˆ†ç±»ä¿¡æ¯ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹\nå­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ å¤‡æ³¨ id bigint ä¸»é”® è‡ªå¢ name varchar(32) åˆ†ç±»åç§° å”¯ä¸€ type int åˆ†ç±»ç±»å‹ 1èœå“åˆ†ç±» 2å¥—é¤åˆ†ç±» sort int æ’åºå­—æ®µ ç”¨äºåˆ†ç±»æ•°æ®çš„æ’åº status int çŠ¶æ€ 1å¯ç”¨ 0ç¦ç”¨ create_time datetime åˆ›å»ºæ—¶é—´ update_time datetime æœ€åä¿®æ”¹æ—¶é—´ create_user bigint åˆ›å»ºäººid update_user bigint æœ€åä¿®æ”¹äººid ä»£ç å¯¼å…¥ åŠŸèƒ½æµ‹è¯• èœå“ç®¡ç† å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……ğŸŒŸ é—®é¢˜åˆ†æ ä¸šåŠ¡è¡¨ä¸­çš„å…¬å…±å­—æ®µï¼š\né—®é¢˜ï¼šä»£ç å†—ä½™ã€ä¸ä¾¿äºåæœŸç»´æŠ¤\nå®ç°æ€è·¯ è‡ªå®šä¹‰æ³¨è§£AutoFillï¼Œç”¨äºæ ‡è¯†éœ€è¦è¿›è¡Œå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……çš„æ–¹æ³• è‡ªå®šä¹‰åˆ‡é¢ç±»AutoFillAspectï¼Œç»Ÿä¸€æ‹¦æˆªåŠ å…¥äº†AutoFillæ³¨è§£çš„æ–¹æ³•ï¼Œé€šè¿‡åå°„ä¸ºå…¬å…±å­—æ®µèµ‹å€¼ åœ¨Mapperçš„æ–¹æ³•ä¸ŠåŠ å…¥AutoFillæ³¨è§£ ä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• æ–°å¢èœå“ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nèœå“åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ èœå“å¿…é¡»å±äºæŸä¸ªåˆ†ç±»ä¸‹ï¼Œä¸èƒ½å•ç‹¬å­˜åœ¨ æ–°å¢èœå“æ—¶å¯ä»¥æ ¹æ®æƒ…å†µé€‰æ‹©èœå“çš„å£å‘³ æ¯ä¸ªèœå“å¿…é¡»å¯¹åº”ä¸€å¼ å›¾ç‰‡ æ¥å£è®¾è®¡ï¼š\næ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»ï¼ˆå·²å®Œæˆï¼‰\næ–‡ä»¶ä¸Šä¼ \næ–°å¢èœå“\næ•°æ®åº“è®¾è®¡ï¼ˆdishèœå“è¡¨å’Œdish_flavorå£å‘³è¡¨ï¼‰ï¼š\ndishè¡¨ä¸ºèœå“è¡¨ï¼Œç”¨äºå­˜å‚¨èœå“çš„ä¿¡æ¯ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹\nå­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ å¤‡æ³¨ id bigint ä¸»é”® è‡ªå¢ name varchar(32) èœå“åç§° å”¯ä¸€ category_id bigint åˆ†ç±»id é€»è¾‘å¤–é”® price decimal(10,2) èœå“ä»·æ ¼ image varchar(255) å›¾ç‰‡è·¯å¾„ description varchar(255) èœå“æè¿° status int å”®å–çŠ¶æ€ 1èµ·å”® 0åœå”® create_time datetime åˆ›å»ºæ—¶é—´ update_time datetime æœ€åä¿®æ”¹æ—¶é—´ create_user bigint åˆ›å»ºäººid update_user bigint æœ€åä¿®æ”¹äººid dish_flavorè¡¨ä¸ºèœå“å£å‘³è¡¨ï¼Œç”¨äºå­˜å‚¨èœå“çš„å£å‘³ä¿¡æ¯ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹\nå­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ å¤‡æ³¨ id bigint ä¸»é”® è‡ªå¢ dish_id bigint èœå“id é€»è¾‘å¤–é”® name varchar(32) å£å‘³åç§° value varchar(255) å£å‘³å€¼ ä»£ç å¼€å‘ å¼€å‘æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼š\nåŠŸèƒ½æµ‹è¯• èœå“åˆ†é¡µæŸ¥è¯¢ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\nä¸šåŠ¡è§„åˆ™\næ ¹æ®é¡µç å±•ç¤ºèœå“ä¿¡æ¯ æ¯é¡µå±•ç¤º10æ¡æ•°æ® åˆ†é¡µæŸ¥è¯¢æ—¶å¯ä»¥æ ¹æ®éœ€è¦è¾“å…¥èœå“åç§°ã€èœå“åˆ†ç±»ã€èœå“çŠ¶æ€è¿›è¡ŒæŸ¥è¯¢ æ¥å£è®¾è®¡\nä»£ç å¼€å‘ æ ¹æ®èœå“åˆ†é¡µæŸ¥è¯¢æ¥å£å®šä¹‰è®¾è®¡å¯¹åº”çš„DTOï¼š\næ ¹æ®èœå“åˆ†é¡µæŸ¥è¯¢æ¥å£å®šä¹‰è®¾è®¡å¯¹åº”çš„VOï¼š\nåŠŸèƒ½æµ‹è¯• åˆ é™¤èœå“ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\nä¸šåŠ¡è§„åˆ™ï¼š\nå¯ä»¥ä¸€æ¬¡åˆ é™¤ä¸€ä¸ªèœå“ï¼Œä¹Ÿå¯ä»¥æ‰¹é‡åˆ é™¤èœå“ èµ·å”®ä¸­çš„èœå“ä¸èƒ½åˆ é™¤ è¢«å¥—é¤å…³è”çš„èœå“ä¸èƒ½åˆ é™¤ åˆ é™¤èœå“åï¼Œå…³è”çš„å£å‘³æ•°æ®ä¹Ÿéœ€è¦åˆ é™¤æ‰ æ¥å£è®¾è®¡ï¼š\næ•°æ®åº“è®¾è®¡ï¼š\nä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• ä¿®æ”¹èœå“ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\næ¥å£è®¾è®¡ï¼š\næ ¹æ®idæŸ¥è¯¢å•†å“\næ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»ï¼ˆå·²å®ç°ï¼‰\næ–‡ä»¶ä¸Šä¼ ï¼ˆå·²å®ç°ï¼‰\nä¿®æ”¹å•†å“\nä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½® Rediså…¥é—¨ Redisç®€ä»‹ Redisæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„key-valueç»“æ„æ•°æ®åº“ã€‚\nåŸºäºå†…å­˜å­˜å‚¨ï¼Œè¯»å†™æ€§èƒ½é«˜ é€‚åˆå­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼ˆçƒ­ç‚¹å•†å“ã€èµ„è®¯ã€æ–°é—»ï¼‰ ä¼ä¸šåº”ç”¨å¹¿æ³› å®˜ç½‘ï¼šhttps://redis.io/\nä¸­æ–‡ç½‘ï¼šhttps://www.redis.net.cn/\nRedisä¸‹è½½ä¸å®‰è£… RedisæœåŠ¡å¯åŠ¨ä¸åœæ­¢ Redisæ•°æ®ç±»å‹ 5ç§å¸¸ç”¨æ•°æ®ç±»å‹ä»‹ç» Rediså­˜å‚¨çš„æ˜¯key-valueç»“æ„çš„æ•°æ®ï¼Œå…¶ä¸­keyæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œvalueæœ‰5ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼š\nå­—ç¬¦ä¸² string\næ™®é€šå­—ç¬¦ä¸²ï¼ŒRedisä¸­æœ€ç®€å•çš„æ•°æ®ç±»å‹\nå“ˆå¸Œ hash\nä¹Ÿå«æ•£åˆ—ï¼Œç±»ä¼¼äºJavaä¸­çš„HashMapç»“æ„\nåˆ—è¡¨ list\næŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¯ä»¥æœ‰é‡å¤å…ƒç´ ï¼Œç±»ä¼¼äºJavaä¸­çš„LinkedList\né›†åˆ set\næ— åºé›†åˆï¼Œæ²¡æœ‰é‡å¤å…ƒç´ ï¼Œç±»ä¼¼äºJavaä¸­çš„HashSet\næœ‰åºé›†åˆ sorted set/zset\né›†åˆä¸­æ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰ï¼ŒRedisæ ¹æ®åˆ†æ•°å‡åºæ’åºï¼Œæ²¡æœ‰é‡å¤å…ƒç´ \nå„ç§æ•°æ®ç±»å‹çš„ç‰¹ç‚¹ Rediså¸¸ç”¨å‘½ä»¤ å­—ç¬¦ä¸²æ“ä½œå‘½ä»¤ SET key value è®¾ç½®æŒ‡å®škeyçš„å€¼ GET key è·å–æŒ‡å®škeyçš„å€¼ SETEX key seconds value è®¾ç½®æŒ‡å®škeyçš„å€¼ï¼Œå¹¶å°†keyçš„è¿‡æœŸæ—¶é—´è®¾ä¸ºsecondsç§’ \u0026mdash;\u0026gt; çŸ­ä¿¡éªŒè¯ç  SETNX key value åªæœ‰åœ¨keyä¸å­˜åœ¨æ—¶è®¾ç½®keyçš„å€¼ å“ˆå¸Œæ“ä½œå‘½ä»¤ Redis hash æ˜¯ä¸€ä¸ªStringç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œå¸¸ç”¨å‘½ä»¤ï¼š\nHSET key field value å°†å“ˆå¸Œè¡¨ key ä¸­çš„å­—æ®µ field çš„å€¼ä¸º value HGET key field è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ HDEL key field åˆ é™¤å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­çš„æŒ‡å®šå­—æ®µ HKEYS key è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å­—æ®µ HVALS key è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼ åˆ—è¡¨æ“ä½œå‘½ä»¤ Redisåˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¸¸ç”¨å‘½ä»¤ï¼š\nLPUSH key value1 [value2] å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨ LRANGE key start stop è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´  RPOP key ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´  LLEN key è·å–åˆ—è¡¨é•¿åº¦ é›†åˆæ“ä½œå‘½ä»¤ Redis set æ˜¯ String ç±»å‹çš„æ— åºé›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œé›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ï¼Œå¸¸ç”¨å‘½ä»¤ï¼š\nSADD key member1 [member2] å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ SMEMBERS key è¿”å›é›†åˆä¸­æ‰€æœ‰çš„æˆå‘˜ SCARD key è·å–é›†åˆçš„æˆå‘˜æ•° SINTER key1 [key2] è¿”å›ç»™å®šçš„æ‰€æœ‰é›†åˆçš„äº¤é›† SUNION key1 [key2] è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›† SREM key member1 [member2] åˆ é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ æœ‰åºé›†åˆæ“ä½œå‘½ä»¤ Redisçš„æœ‰åºé›†åˆæ˜¯Stringç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸”ä¸å…è®¸æœ‰é‡å¤æˆå‘˜ã€‚æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚å¸¸ç”¨å‘½ä»¤ï¼š\nZADD key score1 member1 [score2 member2] å‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ ZRANGE key start stop [WITHSCORES] é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ ZINCRBY key increment member æœ‰åºé›†åˆä¸­å¯¹æŒ‡å®šæˆå‘˜çš„åˆ†æ•°åŠ ä¸Šå¢é‡increment ZREM key member [member\u0026hellip; ] ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ é€šç”¨å‘½ä»¤ Redisçš„é€šç”¨å‘½ä»¤æ˜¯ä¸åˆ†æ•°æ®ç±»å‹çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤ï¼š\nKEYS pattern æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼ï¼ˆpatternï¼‰çš„key EXISTS key æ£€æŸ¥ç»™å®škeyæ˜¯å¦å­˜åœ¨ TYPE key è¿”å›keyæ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹ DEL key è¯¥å‘½ä»¤ç”¨äºåœ¨keyå­˜åœ¨æ—¶åˆ é™¤key åœ¨Javaä¸­æ“ä½œRedis Redisçš„Javaå®¢æˆ·ç«¯ Redisçš„Javaå®¢æˆ·ç«¯å¾ˆå¤šï¼Œå¸¸ç”¨çš„å‡ ç§ï¼š\nJedis\nLettuce\nSpring Data Redis\næ˜¯Springçš„ä¸€éƒ¨åˆ†ï¼Œå¯¹Redisåº•å±‚å¼€å‘åŒ…è¿›è¡Œäº†é«˜åº¦å°è£…ã€‚åœ¨Springé¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨Spring Data Redisæ¥ç®€åŒ–æ“ä½œã€‚\nSpring Data Redisä½¿ç”¨æ–¹å¼ æ“ä½œæ­¥éª¤ï¼š\nå¯¼å…¥Spring Data Redis çš„Mavenåæ ‡\né…ç½®Redisæ•°æ®æº\nç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºRedisTemplateå¯¹è±¡\né€šè¿‡RedisTemplateå¯¹è±¡æ“ä½œRedis\nåº—é“ºè¥ä¸šçŠ¶æ€ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹\næ¥å£è®¾è®¡ï¼š\nè®¾ç½®è¥ä¸šçŠ¶æ€ ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€ ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€ æœ¬é¡¹ç›®çº¦å®šï¼š\nç®¡ç†ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨/adminä½œä¸ºå‰ç¼€ ç”¨æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œç»Ÿä¸€ä½¿ç”¨/userä½œä¸ºå‰ç¼€ è¥ä¸šçŠ¶æ€æ•°æ®å­˜å‚¨æ–¹å¼ï¼šåŸºäºRedisçš„å­—ç¬¦ä¸²æ¥è¿›è¡Œå­˜å‚¨\nä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• å¾®ä¿¡ç™»å½•ã€å•†å“æµè§ˆ HttpClientğŸ†• ä»‹ç» HttpClient æ˜¯Apache Jakarta Commonä¸‹çš„å­é¡¹ç›®ï¼Œå¯ä»¥ç”¨æ¥æä¾›é«˜æ•ˆçš„ã€æœ€æ–°çš„ã€åŠŸèƒ½ä¸°å¯Œçš„æ”¯æŒ HTTP åè®®çš„å®¢æˆ·ç«¯ç¼–ç¨‹å·¥å…·åŒ…ï¼Œå¹¶ä¸”å®ƒæ”¯æŒ HTTP åè®®æœ€æ–°çš„ç‰ˆæœ¬å’Œå»ºè®®ã€‚\næ ¸å¿ƒAPIï¼š\nHttpClient HttpClients CloseableHttpClient HttpGet HttpPost å‘é€è¯·æ±‚æ­¥éª¤ï¼š\nåˆ›å»ºHttpClientå¯¹è±¡ åˆ›å»ºHttpè¯·æ±‚å¯¹è±¡ \u0026mdash;\u0026gt; HttpGet/HttpPost è°ƒç”¨HttpClientçš„executeæ–¹æ³•å‘é€è¯·æ±‚ å…¥é—¨æ¡ˆä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 /** * æµ‹è¯•é€šè¿‡HttpClientå‘é€GETæ–¹å¼è¯·æ±‚ */ @Test public void testGET() throws Exception{ //åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpClient = HttpClients.createDefault(); //åˆ›å»ºè¯·æ±‚å¯¹è±¡ HttpGet httpGet = new HttpGet(\u0026#34;http://localhost:8080/user/shop/status\u0026#34;); //å‘é€è¯·æ±‚ï¼Œå¹¶æ¥å—å“åº”ç»“æœ CloseableHttpResponse response = httpClient.execute(httpGet); //è·å–æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç  int statusCode = response.getStatusLine().getStatusCode(); System.out.println(\u0026#34;æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç ä¸ºï¼š\u0026#34; + statusCode); HttpEntity entity = response.getEntity(); String body = EntityUtils.toString(entity); System.out.println(\u0026#34;æœåŠ¡ç«¯è¿”å›çš„æ•°æ®ä¸ºï¼š\u0026#34; + body); //å…³é—­èµ„æº response.close(); httpClient.close(); } /** * æµ‹è¯•é€šè¿‡HttpClientå‘é€POSTè¯·æ±‚ */ @Test public void testPost() throws Exception { //åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpClient = HttpClients.createDefault(); //åˆ›å»ºè¯·æ±‚å¯¹è±¡ HttpPost httpPost = new HttpPost(\u0026#34;http://localhost:8080/admin/employee/login\u0026#34;); JSONObject jsonObject = new JSONObject(); jsonObject.put(\u0026#34;username\u0026#34;, \u0026#34;admin\u0026#34;); jsonObject.put(\u0026#34;password\u0026#34;, \u0026#34;123456\u0026#34;); StringEntity entity = new StringEntity(jsonObject.toString()); //æŒ‡å®šè¯·æ±‚çš„ç¼–ç æ–¹å¼ entity.setContentEncoding(\u0026#34;utf-8\u0026#34;); //æ•°æ®æ ¼å¼ entity.setContentType(\u0026#34;application/json\u0026#34;); httpPost.setEntity(entity); //å‘é€è¯·æ±‚ CloseableHttpResponse response = httpClient.execute(httpPost); //è§£æè¿”å›ç»“æœ int statusCode = response.getStatusLine().getStatusCode(); System.out.println(\u0026#34;å“åº”ç ä¸ºï¼š\u0026#34; + statusCode); HttpEntity entity1 = response.getEntity(); String body = EntityUtils.toString(entity1); System.out.println(\u0026#34;å“åº”æ•°æ®ä¸ºï¼š\u0026#34; + body); //å…³é—­èµ„æº response.close(); httpClient.close(); } å¾®ä¿¡å°ç¨‹åºå¼€å‘ ä»‹ç» å‡†å¤‡å·¥ä½œ å…¥é—¨æ¡ˆä¾‹ æ“ä½œæ­¥éª¤ï¼š\näº†è§£å¾®ä¿¡å°ç¨‹åºç›®å½•ç»“æ„\nå°ç¨‹åºåŒ…å«ä¸€ä¸ªæè¿°æ•´ä½“ç¨‹åºçš„ app å’Œå¤šä¸ªæè¿°å„è‡ªé¡µé¢çš„ pageã€‚ä¸€ä¸ªå°ç¨‹åºä¸»ä½“éƒ¨åˆ†ç”±ä¸‰ä¸ªæ–‡ä»¶ç»„æˆï¼Œå¿…é¡»æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¦‚ä¸‹ï¼š\nä¸€ä¸ªå°ç¨‹åºé¡µé¢ç”±å››ä¸ªæ–‡ä»¶ç»„æˆï¼š\nç¼–å†™å°ç¨‹åºä»£ç \nç¼–è¯‘å°ç¨‹åº\nå¾®ä¿¡ç™»å½• å¯¼å…¥å°ç¨‹åºä»£ç  å¾®ä¿¡ç™»å½•æµç¨‹ å®˜ç½‘ï¼šhttps://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html\néœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nåŸºäºå¾®ä¿¡ç™»å½•å®ç°å°ç¨‹åºçš„ç™»å½•åŠŸèƒ½ å¦‚æœæ˜¯æ–°ç”¨æˆ·éœ€è¦è‡ªåŠ¨å®Œæˆæ³¨å†Œ æ¥å£è®¾è®¡ï¼š\næ•°æ®åº“è®¾è®¡ï¼ˆuserè¡¨ï¼‰ï¼š\nä»£ç å¼€å‘ é…ç½®å¾®ä¿¡ç™»å½•æ‰€éœ€é…ç½®é¡¹ï¼š\né…ç½®ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œæ—¶ä½¿ç”¨çš„é…ç½®é¡¹ï¼š\nåŠŸèƒ½æµ‹è¯• å¯¼å…¥å•†å“æµè§ˆåŠŸèƒ½ä»£ç  éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\næ¥å£è®¾è®¡ï¼š\næŸ¥è¯¢åˆ†ç±»\næ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“\næ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤\næ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“\nä»£ç å¯¼å…¥ åŠŸèƒ½æµ‹è¯• ç¼“å­˜å•†å“ã€è´­ç‰©è½¦ ç¼“å­˜èœå“ é—®é¢˜è¯´æ˜ ç”¨æˆ·ç«¯å°ç¨‹åºå±•ç¤ºçš„èœå“æ•°æ®éƒ½æ˜¯é€šè¿‡æŸ¥è¯¢æ•°æ®åº“è·å¾—ï¼Œå¦‚æœç”¨æˆ·ç«¯è®¿é—®é‡æ¯”è¾ƒå¤§ï¼Œæ•°æ®åº“è®¿é—®å‹åŠ›éšä¹‹å¢å¤§ã€‚\nå®ç°æ€è·¯ é€šè¿‡Redisæ¥ç¼“å­˜èœå“æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ“ä½œã€‚\nç¼“å­˜é€»è¾‘åˆ†æï¼š\næ¯ä¸ªåˆ†ç±»ä¸‹çš„èœå“ä¿å­˜ä¸€ä»½ç¼“å­˜æ•°æ®\næ•°æ®åº“ä¸­èœå“æ•°æ®æœ‰å˜æ›´æ—¶æ¸…ç†ç¼“å­˜æ•°æ®\nä»£ç å¼€å‘ ä¿®æ”¹ç®¡ç†ç«¯æ¥å£ DishController çš„ç›¸å…³æ–¹æ³•ï¼ŒåŠ å…¥æ¸…ç†ç¼“å­˜çš„é€»è¾‘ï¼Œéœ€è¦æ”¹é€ çš„æ–¹æ³•:\næ–°å¢èœå“ ä¿®æ”¹èœå“ æ‰¹é‡åˆ é™¤èœå“ èµ·å”®ã€åœå”®èœå“ åŠŸèƒ½æµ‹è¯• ç¼“å­˜å¥—é¤ Spring Cacheâ­ Spring Cache æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ç°äº†åŸºäºæ³¨è§£çš„ç¼“å­˜åŠŸèƒ½ï¼Œåªéœ€è¦ç®€å•åœ°åŠ ä¸€ä¸ªæ³¨è§£ï¼Œå°±èƒ½å®ç°ç¼“å­˜åŠŸèƒ½ã€‚\nSpring Cache æä¾›äº†ä¸€å±‚æŠ½è±¡ï¼Œåº•å±‚å¯ä»¥åˆ‡æ¢ä¸åŒçš„ç¼“å­˜å®ç°ï¼Œä¾‹å¦‚:\nEHCache Caffeine Redis å¸¸ç”¨æ³¨è§£ï¼š\nåœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableCachingæ³¨è§£\n1 2 3 4 5 6 7 8 9 @Slf4j @SpringBootApplication @EnableCaching //å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½ public class CacheDemoApplication { public static void main(String[] args) { SpringApplication.run(CacheDemoApplication.class,args); log.info(\u0026#34;é¡¹ç›®å¯åŠ¨æˆåŠŸ...\u0026#34;); } } åœ¨controllerä¸Šä½¿ç”¨@Cacheableã€@Cacheputã€@CacheEvictæ³¨è§£\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @RestController @RequestMapping(\u0026#34;/user\u0026#34;) @Slf4j public class UserController { @Autowired private UserMapper userMapper; @PostMapping @CachePut(cacheNames = \u0026#34;userCache\u0026#34;, key = \u0026#34;#user.id\u0026#34;) //å¦‚æœä½¿ç”¨SpringCacheç¼“å­˜æ•°æ®ï¼Œkeyçš„ç”Ÿæˆï¼šuserCache::2 public User save(@RequestBody User user){ userMapper.insert(user); return user; } @DeleteMapping @CacheEvict(cacheNames = \u0026#34;userCache\u0026#34;, key = \u0026#34;#id\u0026#34;) public void deleteById(Long id){ userMapper.deleteById(id); } @DeleteMapping(\u0026#34;/delAll\u0026#34;) @CacheEvict(cacheNames = \u0026#34;userCache\u0026#34;, allEntries = true) //åˆ é™¤userCacheä¸‹çš„æ‰€æœ‰ç¼“å­˜ public void deleteAll(){ userMapper.deleteAll(); } @GetMapping @Cacheable(cacheNames = \u0026#34;userCache\u0026#34;, key = \u0026#34;#id\u0026#34;) //keyçš„ç”Ÿæˆï¼šuserCache::10 public User getById(Long id){ User user = userMapper.getById(id); return user; } } å®ç°æ€è·¯ å…·ä½“çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š\nå¯¼å…¥SpringCacheå’ŒRedisç›¸å…³Mavenåæ ‡ åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCacheæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½ åœ¨ç”¨æˆ·ç«¯æ¥å£SetmealControllerçš„listæ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£ åœ¨ç®¡ç†ç«¯æ¥å£SetmealControllerçš„saveã€deleteã€updateã€startOrStopç­‰æ–¹æ³•ä¸ŠåŠ å…¥@CacheEvictæ³¨è§£ ä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• æ·»åŠ è´­ç‰©è½¦ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\næ¥å£è®¾è®¡ï¼š\nè¯·æ±‚æ–¹å¼ï¼šPOST è¯·æ±‚è·¯å¾„ï¼š/user/shoppingCart/add è¯·æ±‚å‚æ•°ï¼šå¥—é¤idã€èœå“idã€å£å‘³ è¿”å›ç»“æœï¼šcodeã€dataã€msg æ•°æ®åº“è®¾è®¡ï¼š\nä½œç”¨ï¼šæš‚æ—¶å­˜æ”¾æ‰€é€‰å•†å“çš„åœ°æ–¹ é€‰çš„ä»€ä¹ˆå•†å“ æ¯ä¸ªå•†å“ä¹°äº†å‡ ä¸ª ä¸åŒç”¨æˆ·çš„è´­ç‰©è½¦éœ€è¦åŒºåˆ†å¼€ ä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• æŸ¥çœ‹è´­ç‰©è½¦ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\næ¥å£è®¾è®¡ï¼š\nä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• æ¸…ç©ºè´­ç‰©è½¦ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\næ¥å£è®¾è®¡ï¼š\nåŠŸèƒ½æµ‹è¯• ä»£ç å¼€å‘ ç”¨æˆ·ä¸‹å•ã€è®¢å•æ”¯ä»˜ å¯¼å…¥åœ°å€ç°¿åŠŸèƒ½ä»£ç  éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡åŠŸèƒ½ï¼š\næŸ¥è¯¢åœ°å€åˆ—è¡¨ æ–°å¢åœ°å€ ä¿®æ”¹åœ°å€ åˆ é™¤åœ°å€ è®¾ç½®é»˜è®¤åœ°å€ æŸ¥è¯¢é»˜è®¤åœ°å€ æ¥å£è®¾è®¡ï¼š\næ–°å¢åœ°å€ æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€ä¿¡æ¯ æŸ¥è¯¢é»˜è®¤åœ°å€ æ ¹æ®idåˆ é™¤åœ°å€ æ ¹æ®idä¿®æ”¹åœ°å€ æ ¹æ®idæŸ¥è¯¢åœ°å€ è®¾ç½®é»˜è®¤åœ°å€ æ•°æ®åº“è®¾è®¡ï¼ˆaddress_bookè¡¨ï¼‰ï¼š\naddress_bookè¡¨ä¸ºåœ°å€è¡¨ï¼Œç”¨äºå­˜å‚¨Cç«¯ç”¨æˆ·çš„æ”¶è´§åœ°å€ä¿¡æ¯ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹ï¼š\nå­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ å¤‡æ³¨ id bigint ä¸»é”® è‡ªå¢ user_id bigint ç”¨æˆ·id é€»è¾‘å¤–é”® consignee varchar(50) æ”¶è´§äºº sex varchar(2) æ€§åˆ« phone varchar(11) æ‰‹æœºå· province_code varchar(12) çœä»½ç¼–ç  province_name varchar(32) çœä»½åç§° city_code varchar(12) åŸå¸‚ç¼–ç  city_name varchar(32) åŸå¸‚åç§° district_code varchar(12) åŒºå¿ç¼–ç  district_name varchar(32) åŒºå¿åç§° detail varchar(200) è¯¦ç»†åœ°å€ä¿¡æ¯ å…·ä½“åˆ°é—¨ç‰Œå· label varchar(100) æ ‡ç­¾ å…¬å¸ã€å®¶ã€å­¦æ ¡ is_default tinyint(1) æ˜¯å¦é»˜è®¤åœ°å€ 1æ˜¯ 0å¦ ä»£ç å¯¼å…¥ åŠŸèƒ½æµ‹è¯• ç”¨æˆ·ä¸‹å• éœ€æ±‚åˆ†æå’Œè®¾è®¡ ç”¨æˆ·ä¸‹å•ä¸šåŠ¡è¯´æ˜ï¼š\nåœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æ˜¯é€šè¿‡ä¸‹å•çš„æ–¹å¼é€šçŸ¥å•†å®¶ï¼Œç”¨æˆ·å·²ç»è´­ä¹°äº†å•†å“ï¼Œéœ€è¦å•†å®¶è¿›è¡Œå¤‡è´§å’Œå‘è´§ã€‚\nç”¨æˆ·ä¸‹å•åä¼šäº§ç”Ÿè®¢å•ç›¸å…³æ•°æ®ï¼Œè®¢å•æ•°æ®éœ€è¦èƒ½å¤Ÿä½“ç°å¦‚ä¸‹ä¿¡æ¯ï¼š\nç”¨æˆ·ç‚¹é¤ä¸šåŠ¡æµç¨‹ï¼š\næ¥å£è®¾è®¡ï¼ˆåˆ†æï¼‰ï¼š\næ¥å£è®¾è®¡ï¼š\næ•°æ®åº“ï¼ˆordersè¡¨ã€order_deatailè¡¨ï¼‰è®¾è®¡ï¼š\nordersè¡¨ä¸ºè®¢å•è¡¨ï¼Œç”¨äºå­˜å‚¨Cç«¯ç”¨æˆ·çš„è®¢å•æ•°æ®ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹ï¼š\nå­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ å¤‡æ³¨ id bigint ä¸»é”® è‡ªå¢ number varchar(50) è®¢å•å· status int è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ user_id bigint ç”¨æˆ·id é€»è¾‘å¤–é”® address_book_id bigint åœ°å€id é€»è¾‘å¤–é”® order_time datetime ä¸‹å•æ—¶é—´ checkout_time datetime ä»˜æ¬¾æ—¶é—´ pay_method int æ”¯ä»˜æ–¹å¼ 1å¾®ä¿¡æ”¯ä»˜ 2æ”¯ä»˜å®æ”¯ä»˜ pay_status tinyint æ”¯ä»˜çŠ¶æ€ 0æœªæ”¯ä»˜ 1å·²æ”¯ä»˜ 2é€€æ¬¾ amount decimal(10,2) è®¢å•é‡‘é¢ remark varchar(100) å¤‡æ³¨ä¿¡æ¯ phone varchar(11) æ‰‹æœºå· address varchar(255) è¯¦ç»†åœ°å€ä¿¡æ¯ user_name varchar(32) ç”¨æˆ·å§“å consignee varchar(32) æ”¶è´§äºº cancel_reason varchar(255) è®¢å•å–æ¶ˆåŸå›  rejection_reason varchar(255) æ‹’å•åŸå›  cancel_time datetime è®¢å•å–æ¶ˆæ—¶é—´ estimated_delivery_time datetime é¢„è®¡é€è¾¾æ—¶é—´ delivery_status tinyint é…é€çŠ¶æ€ 1ç«‹å³é€å‡º 0é€‰æ‹©å…·ä½“æ—¶é—´ delivery_time datetime é€è¾¾æ—¶é—´ pack_amount int æ‰“åŒ…è´¹ tableware_number int é¤å…·æ•°é‡ tableware_status tinyint é¤å…·æ•°é‡çŠ¶æ€ 1æŒ‰é¤é‡æä¾› 0é€‰æ‹©å…·ä½“æ•°é‡ order_detailè¡¨ä¸ºè®¢å•æ˜ç»†è¡¨ï¼Œç”¨äºå­˜å‚¨Cç«¯ç”¨æˆ·çš„è®¢å•æ˜ç»†æ•°æ®ã€‚å…·ä½“è¡¨ç»“æ„å¦‚ä¸‹ï¼š\nå­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ å¤‡æ³¨ id bigint ä¸»é”® è‡ªå¢ name varchar(32) å•†å“åç§° image varchar(255) å•†å“å›¾ç‰‡è·¯å¾„ order_id bigint è®¢å•id é€»è¾‘å¤–é”® dish_id bigint èœå“id é€»è¾‘å¤–é”® setmeal_id bigint å¥—é¤id é€»è¾‘å¤–é”® dish_flavor varchar(50) èœå“å£å‘³ number int å•†å“æ•°é‡ amount decimal(10,2) å•†å“å•ä»· ä»£ç å¼€å‘ æ ¹æ®ç”¨æˆ·ä¸‹å•æ¥å£çš„å‚æ•°è®¾è®¡DTOï¼š\næ ¹æ®ç”¨æˆ·ä¸‹å•æ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š\nåŠŸèƒ½æµ‹è¯• è®¢å•æ”¯ä»˜ å¾®ä¿¡æ”¯ä»˜ä»‹ç» å¾®ä¿¡æ”¯ä»˜äº§å“ï¼š\nå‚è€ƒï¼šhttps://pay.weixin.qq.com/static/product/product_index.shtm\nå¾®ä¿¡æ”¯ä»˜æ¥å…¥æµç¨‹ï¼š\nå¾®ä¿¡å°ç¨‹åºæ”¯ä»˜æ—¶åºå›¾ï¼š\nJSAPIä¸‹å•ï¼šå•†æˆ·ç³»ç»Ÿè°ƒç”¨è¯¥æ¥å£åœ¨å¾®ä¿¡æ”¯ä»˜æœåŠ¡åå°ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•\nå¾®ä¿¡å°ç¨‹åºè°ƒèµ·æ”¯ä»˜ï¼šé€šè¿‡JSAPIä¸‹å•æ¥å£è·å–åˆ°å‘èµ·æ”¯ä»˜çš„å¿…è¦å‚æ•°prepay_idï¼Œç„¶åä½¿ç”¨å¾®ä¿¡æ”¯ä»˜æä¾›çš„å°ç¨‹åºæ–¹æ³•è°ƒèµ·å°ç¨‹åºæ”¯ä»˜\nå¾®ä¿¡æ”¯ä»˜å‡†å¤‡å·¥ä½œ å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜æ—¶åºå›¾ï¼š\nè·å–å¾®ä¿¡æ”¯ä»˜å¹³å°è¯ä¹¦ã€å•†æˆ·ç§é’¥æ–‡ä»¶\nè·å–ä¸´æ—¶åŸŸåï¼šæ”¯ä»˜æˆåŠŸåå¾®ä¿¡æœåŠ¡é€šè¿‡è¯¥åŸŸåå›è°ƒæˆ‘ä»¬çš„ç¨‹åº\nä»£ç å¯¼å…¥ å¾®ä¿¡æ”¯ä»˜ç›¸å…³é…ç½®ï¼š\nåŠŸèƒ½æµ‹è¯• ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å— 1. æŸ¥è¯¢å†å²è®¢å• 1.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™\nåˆ†é¡µæŸ¥è¯¢å†å²è®¢å• å¯ä»¥æ ¹æ®è®¢å•çŠ¶æ€æŸ¥è¯¢ å±•ç¤ºè®¢å•æ•°æ®æ—¶ï¼Œéœ€è¦å±•ç¤ºçš„æ•°æ®åŒ…æ‹¬ï¼šä¸‹å•æ—¶é—´ã€è®¢å•çŠ¶æ€ã€è®¢å•é‡‘é¢ã€è®¢å•æ˜ç»†ï¼ˆå•†å“åç§°ã€å›¾ç‰‡ï¼‰ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n1.2 ä»£ç å®ç° 1.2.1 user/OrderController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 /** * å†å²è®¢å•æŸ¥è¯¢ * * @param page * @param pageSize * @param status è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ * @return */ @GetMapping(\u0026#34;/historyOrders\u0026#34;) @ApiOperation(\u0026#34;å†å²è®¢å•æŸ¥è¯¢\u0026#34;) public Result\u0026lt;PageResult\u0026gt; page(int page, int pageSize, Integer status) { PageResult pageResult = orderService.pageQuery4User(page, pageSize, status); return Result.success(pageResult); } 1.2.2 OrderService 1 2 3 4 5 6 7 8 /** * ç”¨æˆ·ç«¯è®¢å•åˆ†é¡µæŸ¥è¯¢ * @param page * @param pageSize * @param status * @return */ PageResult pageQuery4User(int page, int pageSize, Integer status); 1.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 /** * ç”¨æˆ·ç«¯è®¢å•åˆ†é¡µæŸ¥è¯¢ * * @param pageNum * @param pageSize * @param status * @return */ public PageResult pageQuery4User(int pageNum, int pageSize, Integer status) { // è®¾ç½®åˆ†é¡µ PageHelper.startPage(pageNum, pageSize); OrdersPageQueryDTO ordersPageQueryDTO = new OrdersPageQueryDTO(); ordersPageQueryDTO.setUserId(BaseContext.getCurrentId()); ordersPageQueryDTO.setStatus(status); // åˆ†é¡µæ¡ä»¶æŸ¥è¯¢ Page\u0026lt;Orders\u0026gt; page = orderMapper.pageQuery(ordersPageQueryDTO); List\u0026lt;OrderVO\u0026gt; list = new ArrayList(); // æŸ¥è¯¢å‡ºè®¢å•æ˜ç»†ï¼Œå¹¶å°è£…å…¥OrderVOè¿›è¡Œå“åº” if (page != null \u0026amp;\u0026amp; page.getTotal() \u0026gt; 0) { for (Orders orders : page) { Long orderId = orders.getId();// è®¢å•id // æŸ¥è¯¢è®¢å•æ˜ç»† List\u0026lt;OrderDetail\u0026gt; orderDetails = orderDetailMapper.getByOrderId(orderId); OrderVO orderVO = new OrderVO(); BeanUtils.copyProperties(orders, orderVO); orderVO.setOrderDetailList(orderDetails); list.add(orderVO); } } return new PageResult(page.getTotal(), list); } 1.2.4 OrderMapper 1 2 3 4 5 /** * åˆ†é¡µæ¡ä»¶æŸ¥è¯¢å¹¶æŒ‰ä¸‹å•æ—¶é—´æ’åº * @param ordersPageQueryDTO */ Page\u0026lt;Orders\u0026gt; pageQuery(OrdersPageQueryDTO ordersPageQueryDTO); 1.2.5 OrderMapper.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;select id=\u0026#34;pageQuery\u0026#34; resultType=\u0026#34;Orders\u0026#34;\u0026gt; select * from orders \u0026lt;where\u0026gt; \u0026lt;if test=\u0026#34;number != null and number!=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and number like concat(\u0026#39;%\u0026#39;,#{number},\u0026#39;%\u0026#39;) \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;phone != null and phone!=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and phone like concat(\u0026#39;%\u0026#39;,#{phone},\u0026#39;%\u0026#39;) \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;userId != null\u0026#34;\u0026gt; and user_id = #{userId} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;status != null\u0026#34;\u0026gt; and status = #{status} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;beginTime != null\u0026#34;\u0026gt; and order_time \u0026amp;gt;= #{beginTime} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;endTime != null\u0026#34;\u0026gt; and order_time \u0026amp;lt;= #{endTime} \u0026lt;/if\u0026gt; \u0026lt;/where\u0026gt; order by order_time desc \u0026lt;/select\u0026gt; 1.2.6 OrderDetailMapper 1 2 3 4 5 6 7 /** * æ ¹æ®è®¢å•idæŸ¥è¯¢è®¢å•æ˜ç»† * @param orderId * @return */ @Select(\u0026#34;select * from order_detail where order_id = #{orderId}\u0026#34;) List\u0026lt;OrderDetail\u0026gt; getByOrderId(Long orderId); 1.3 åŠŸèƒ½æµ‹è¯• ç•¥\n2. æŸ¥è¯¢è®¢å•è¯¦æƒ… 2.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\næ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n2.2 ä»£ç å®ç° 2.2.1 user/OrderController 1 2 3 4 5 6 7 8 9 10 11 12 /** * æŸ¥è¯¢è®¢å•è¯¦æƒ… * * @param id * @return */ @GetMapping(\u0026#34;/orderDetail/{id}\u0026#34;) @ApiOperation(\u0026#34;æŸ¥è¯¢è®¢å•è¯¦æƒ…\u0026#34;) public Result\u0026lt;OrderVO\u0026gt; details(@PathVariable(\u0026#34;id\u0026#34;) Long id) { OrderVO orderVO = orderService.details(id); return Result.success(orderVO); } 2.2.2 OrderService 1 2 3 4 5 6 /** * æŸ¥è¯¢è®¢å•è¯¦æƒ… * @param id * @return */ OrderVO details(Long id); 2.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /** * æŸ¥è¯¢è®¢å•è¯¦æƒ… * * @param id * @return */ public OrderVO details(Long id) { // æ ¹æ®idæŸ¥è¯¢è®¢å• Orders orders = orderMapper.getById(id); // æŸ¥è¯¢è¯¥è®¢å•å¯¹åº”çš„èœå“/å¥—é¤æ˜ç»† List\u0026lt;OrderDetail\u0026gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId()); // å°†è¯¥è®¢å•åŠå…¶è¯¦æƒ…å°è£…åˆ°OrderVOå¹¶è¿”å› OrderVO orderVO = new OrderVO(); BeanUtils.copyProperties(orders, orderVO); orderVO.setOrderDetailList(orderDetailList); return orderVO; } 2.2.4 OrderMapper 1 2 3 4 5 6 /** * æ ¹æ®idæŸ¥è¯¢è®¢å• * @param id */ @Select(\u0026#34;select * from orders where id=#{id}\u0026#34;) Orders getById(Long id); 2.3 åŠŸèƒ½æµ‹è¯• ç•¥\n3. å–æ¶ˆè®¢å• 3.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nå¾…æ”¯ä»˜å’Œå¾…æ¥å•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å¯ç›´æ¥å–æ¶ˆè®¢å• å•†å®¶å·²æ¥å•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å–æ¶ˆè®¢å•éœ€ç”µè¯æ²Ÿé€šå•†å®¶ æ´¾é€ä¸­çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å–æ¶ˆè®¢å•éœ€ç”µè¯æ²Ÿé€šå•†å®¶ å¦‚æœåœ¨å¾…æ¥å•çŠ¶æ€ä¸‹å–æ¶ˆè®¢å•ï¼Œéœ€è¦ç»™ç”¨æˆ·é€€æ¬¾ å–æ¶ˆè®¢å•åéœ€è¦å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n3.2 ä»£ç å®ç° 3.2.1 user/OrderController 1 2 3 4 5 6 7 8 9 10 11 /** * ç”¨æˆ·å–æ¶ˆè®¢å• * * @return */ @PutMapping(\u0026#34;/cancel/{id}\u0026#34;) @ApiOperation(\u0026#34;å–æ¶ˆè®¢å•\u0026#34;) public Result cancel(@PathVariable(\u0026#34;id\u0026#34;) Long id) throws Exception { orderService.userCancelById(id); return Result.success(); } 3.2.2 OrderService 1 2 3 4 5 /** * ç”¨æˆ·å–æ¶ˆè®¢å• * @param id */ void userCancelById(Long id) throws Exception; 3.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 /** * ç”¨æˆ·å–æ¶ˆè®¢å• * * @param id */ public void userCancelById(Long id) throws Exception { // æ ¹æ®idæŸ¥è¯¢è®¢å• Orders ordersDB = orderMapper.getById(id); // æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ if (ordersDB == null) { throw new OrderBusinessException(MessageConstant.ORDER_NOT_FOUND); } //è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ if (ordersDB.getStatus() \u0026gt; 2) { throw new OrderBusinessException(MessageConstant.ORDER_STATUS_ERROR); } Orders orders = new Orders(); orders.setId(ordersDB.getId()); // è®¢å•å¤„äºå¾…æ¥å•çŠ¶æ€ä¸‹å–æ¶ˆï¼Œéœ€è¦è¿›è¡Œé€€æ¬¾ if (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) { //è°ƒç”¨å¾®ä¿¡æ”¯ä»˜é€€æ¬¾æ¥å£ weChatPayUtil.refund( ordersDB.getNumber(), //å•†æˆ·è®¢å•å· ordersDB.getNumber(), //å•†æˆ·é€€æ¬¾å•å· new BigDecimal(0.01),//é€€æ¬¾é‡‘é¢ï¼Œå•ä½ å…ƒ new BigDecimal(0.01));//åŸè®¢å•é‡‘é¢ //æ”¯ä»˜çŠ¶æ€ä¿®æ”¹ä¸º é€€æ¬¾ orders.setPayStatus(Orders.REFUND); } // æ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´ orders.setStatus(Orders.CANCELLED); orders.setCancelReason(\u0026#34;ç”¨æˆ·å–æ¶ˆ\u0026#34;); orders.setCancelTime(LocalDateTime.now()); orderMapper.update(orders); } 3.3 åŠŸèƒ½æµ‹è¯• ç•¥\n4. å†æ¥ä¸€å• 4.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\næ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\nä¸šåŠ¡è§„åˆ™ï¼š\nå†æ¥ä¸€å•å°±æ˜¯å°†åŸè®¢å•ä¸­çš„å•†å“é‡æ–°åŠ å…¥åˆ°è´­ç‰©è½¦ä¸­ 4.2 ä»£ç å®ç° 4.2.1 user/OrderController 1 2 3 4 5 6 7 8 9 10 11 12 /** * å†æ¥ä¸€å• * * @param id * @return */ @PostMapping(\u0026#34;/repetition/{id}\u0026#34;) @ApiOperation(\u0026#34;å†æ¥ä¸€å•\u0026#34;) public Result repetition(@PathVariable Long id) { orderService.repetition(id); return Result.success(); } 4.2.2 OrderService 1 2 3 4 5 6 /** * å†æ¥ä¸€å• * * @param id */ void repetition(Long id); 4.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 /** * å†æ¥ä¸€å• * * @param id */ public void repetition(Long id) { // æŸ¥è¯¢å½“å‰ç”¨æˆ·id Long userId = BaseContext.getCurrentId(); // æ ¹æ®è®¢å•idæŸ¥è¯¢å½“å‰è®¢å•è¯¦æƒ… List\u0026lt;OrderDetail\u0026gt; orderDetailList = orderDetailMapper.getByOrderId(id); // å°†è®¢å•è¯¦æƒ…å¯¹è±¡è½¬æ¢ä¸ºè´­ç‰©è½¦å¯¹è±¡ List\u0026lt;ShoppingCart\u0026gt; shoppingCartList = orderDetailList.stream().map(x -\u0026gt; { ShoppingCart shoppingCart = new ShoppingCart(); // å°†åŸè®¢å•è¯¦æƒ…é‡Œé¢çš„èœå“ä¿¡æ¯é‡æ–°å¤åˆ¶åˆ°è´­ç‰©è½¦å¯¹è±¡ä¸­ BeanUtils.copyProperties(x, shoppingCart, \u0026#34;id\u0026#34;); shoppingCart.setUserId(userId); shoppingCart.setCreateTime(LocalDateTime.now()); return shoppingCart; }).collect(Collectors.toList()); // å°†è´­ç‰©è½¦å¯¹è±¡æ‰¹é‡æ·»åŠ åˆ°æ•°æ®åº“ shoppingCartMapper.insertBatch(shoppingCartList); } 4.2.4 ShoppingCartMapper 1 2 3 4 5 6 /** * æ‰¹é‡æ’å…¥è´­ç‰©è½¦æ•°æ® * * @param shoppingCartList */ void insertBatch(List\u0026lt;ShoppingCart\u0026gt; shoppingCartList); 4.2.5 ShoppingCartMapper.xml 1 2 3 4 5 6 7 8 \u0026lt;insert id=\u0026#34;insertBatch\u0026#34; parameterType=\u0026#34;list\u0026#34;\u0026gt; insert into shopping_cart (name, image, user_id, dish_id, setmeal_id, dish_flavor, number, amount, create_time) values \u0026lt;foreach collection=\u0026#34;shoppingCartList\u0026#34; item=\u0026#34;sc\u0026#34; separator=\u0026#34;,\u0026#34;\u0026gt; (#{sc.name},#{sc.image},#{sc.userId},#{sc.dishId},#{sc.setmealId},#{sc.dishFlavor},#{sc.number},#{sc.amount},#{sc.createTime}) \u0026lt;/foreach\u0026gt; \u0026lt;/insert\u0026gt; 4.3 åŠŸèƒ½æµ‹è¯• ç•¥\nå•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å— 1. è®¢å•æœç´¢ 1.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nè¾“å…¥è®¢å•å·/æ‰‹æœºå·è¿›è¡Œæœç´¢ï¼Œæ”¯æŒæ¨¡ç³Šæœç´¢ æ ¹æ®è®¢å•çŠ¶æ€è¿›è¡Œç­›é€‰ ä¸‹å•æ—¶é—´è¿›è¡Œæ—¶é—´ç­›é€‰ æœç´¢å†…å®¹ä¸ºç©ºï¼Œæç¤ºæœªæ‰¾åˆ°ç›¸å…³è®¢å• æœç´¢ç»“æœé¡µï¼Œå±•ç¤ºåŒ…å«æœç´¢å…³é”®è¯çš„å†…å®¹ åˆ†é¡µå±•ç¤ºæœç´¢åˆ°çš„è®¢å•æ•°æ® æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n1.2 ä»£ç å®ç° 1.2.1 admin/OrderController åœ¨adminåŒ…ä¸‹åˆ›å»ºOrderController\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /** * è®¢å•ç®¡ç† */ @RestController(\u0026#34;adminOrderController\u0026#34;) @RequestMapping(\u0026#34;/admin/order\u0026#34;) @Slf4j @Api(tags = \u0026#34;è®¢å•ç®¡ç†æ¥å£\u0026#34;) public class OrderController { @Autowired private OrderService orderService; /** * è®¢å•æœç´¢ * * @param ordersPageQueryDTO * @return */ @GetMapping(\u0026#34;/conditionSearch\u0026#34;) @ApiOperation(\u0026#34;è®¢å•æœç´¢\u0026#34;) public Result\u0026lt;PageResult\u0026gt; conditionSearch(OrdersPageQueryDTO ordersPageQueryDTO) { PageResult pageResult = orderService.conditionSearch(ordersPageQueryDTO); return Result.success(pageResult); } } 1.2.2 OrderService 1 2 3 4 5 6 /** * æ¡ä»¶æœç´¢è®¢å• * @param ordersPageQueryDTO * @return */ PageResult conditionSearch(OrdersPageQueryDTO ordersPageQueryDTO); 1.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 /** * è®¢å•æœç´¢ * * @param ordersPageQueryDTO * @return */ public PageResult conditionSearch(OrdersPageQueryDTO ordersPageQueryDTO) { PageHelper.startPage(ordersPageQueryDTO.getPage(), ordersPageQueryDTO.getPageSize()); Page\u0026lt;Orders\u0026gt; page = orderMapper.pageQuery(ordersPageQueryDTO); // éƒ¨åˆ†è®¢å•çŠ¶æ€ï¼Œéœ€è¦é¢å¤–è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œå°†Ordersè½¬åŒ–ä¸ºOrderVO List\u0026lt;OrderVO\u0026gt; orderVOList = getOrderVOList(page); return new PageResult(page.getTotal(), orderVOList); } private List\u0026lt;OrderVO\u0026gt; getOrderVOList(Page\u0026lt;Orders\u0026gt; page) { // éœ€è¦è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œè‡ªå®šä¹‰OrderVOå“åº”ç»“æœ List\u0026lt;OrderVO\u0026gt; orderVOList = new ArrayList\u0026lt;\u0026gt;(); List\u0026lt;Orders\u0026gt; ordersList = page.getResult(); if (!CollectionUtils.isEmpty(ordersList)) { for (Orders orders : ordersList) { // å°†å…±åŒå­—æ®µå¤åˆ¶åˆ°OrderVO OrderVO orderVO = new OrderVO(); BeanUtils.copyProperties(orders, orderVO); String orderDishes = getOrderDishesStr(orders); // å°†è®¢å•èœå“ä¿¡æ¯å°è£…åˆ°orderVOä¸­ï¼Œå¹¶æ·»åŠ åˆ°orderVOList orderVO.setOrderDishes(orderDishes); orderVOList.add(orderVO); } } return orderVOList; } /** * æ ¹æ®è®¢å•idè·å–èœå“ä¿¡æ¯å­—ç¬¦ä¸² * * @param orders * @return */ private String getOrderDishesStr(Orders orders) { // æŸ¥è¯¢è®¢å•èœå“è¯¦æƒ…ä¿¡æ¯ï¼ˆè®¢å•ä¸­çš„èœå“å’Œæ•°é‡ï¼‰ List\u0026lt;OrderDetail\u0026gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId()); // å°†æ¯ä¸€æ¡è®¢å•èœå“ä¿¡æ¯æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²ï¼ˆæ ¼å¼ï¼šå®«ä¿é¸¡ä¸*3ï¼›ï¼‰ List\u0026lt;String\u0026gt; orderDishList = orderDetailList.stream().map(x -\u0026gt; { String orderDish = x.getName() + \u0026#34;*\u0026#34; + x.getNumber() + \u0026#34;;\u0026#34;; return orderDish; }).collect(Collectors.toList()); // å°†è¯¥è®¢å•å¯¹åº”çš„æ‰€æœ‰èœå“ä¿¡æ¯æ‹¼æ¥åœ¨ä¸€èµ· return String.join(\u0026#34;\u0026#34;, orderDishList); } 1.3 åŠŸèƒ½æµ‹è¯• ç•¥\n2. å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡ 2.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\næ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n2.2 ä»£ç å®ç° 2.2.1 admin/OrderController 1 2 3 4 5 6 7 8 9 10 11 /** * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡ * * @return */ @GetMapping(\u0026#34;/statistics\u0026#34;) @ApiOperation(\u0026#34;å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡\u0026#34;) public Result\u0026lt;OrderStatisticsVO\u0026gt; statistics() { OrderStatisticsVO orderStatisticsVO = orderService.statistics(); return Result.success(orderStatisticsVO); } 2.2.2 OrderService 1 2 3 4 5 /** * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡ * @return */ OrderStatisticsVO statistics(); 2.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /** * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡ * * @return */ public OrderStatisticsVO statistics() { // æ ¹æ®çŠ¶æ€ï¼Œåˆ†åˆ«æŸ¥è¯¢å‡ºå¾…æ¥å•ã€å¾…æ´¾é€ã€æ´¾é€ä¸­çš„è®¢å•æ•°é‡ Integer toBeConfirmed = orderMapper.countStatus(Orders.TO_BE_CONFIRMED); Integer confirmed = orderMapper.countStatus(Orders.CONFIRMED); Integer deliveryInProgress = orderMapper.countStatus(Orders.DELIVERY_IN_PROGRESS); // å°†æŸ¥è¯¢å‡ºçš„æ•°æ®å°è£…åˆ°orderStatisticsVOä¸­å“åº” OrderStatisticsVO orderStatisticsVO = new OrderStatisticsVO(); orderStatisticsVO.setToBeConfirmed(toBeConfirmed); orderStatisticsVO.setConfirmed(confirmed); orderStatisticsVO.setDeliveryInProgress(deliveryInProgress); return orderStatisticsVO; } 2.2.4 OrderMapper 1 2 3 4 5 6 /** * æ ¹æ®çŠ¶æ€ç»Ÿè®¡è®¢å•æ•°é‡ * @param status */ @Select(\u0026#34;select count(id) from orders where status = #{status}\u0026#34;) Integer countStatus(Integer status); 2.3 åŠŸèƒ½æµ‹è¯• ç•¥\n3. æŸ¥è¯¢è®¢å•è¯¦æƒ… 3.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nè®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•åŸºæœ¬ä¿¡æ¯ï¼ˆçŠ¶æ€ã€è®¢å•å·ã€ä¸‹å•æ—¶é—´ã€æ”¶è´§äººã€ç”µè¯ã€æ”¶è´§åœ°å€ã€é‡‘é¢ç­‰ï¼‰ è®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•æ˜ç»†æ•°æ®ï¼ˆå•†å“åç§°ã€æ•°é‡ã€å•ä»·ï¼‰ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n3.2 ä»£ç å®ç° 3.2.1 admin/OrderController 1 2 3 4 5 6 7 8 9 10 11 12 /** * è®¢å•è¯¦æƒ… * * @param id * @return */ @GetMapping(\u0026#34;/details/{id}\u0026#34;) @ApiOperation(\u0026#34;æŸ¥è¯¢è®¢å•è¯¦æƒ…\u0026#34;) public Result\u0026lt;OrderVO\u0026gt; details(@PathVariable(\u0026#34;id\u0026#34;) Long id) { OrderVO orderVO = orderService.details(id); return Result.success(orderVO); } 3.3 åŠŸèƒ½æµ‹è¯• ç•¥\n4. æ¥å• 4.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nå•†å®¶æ¥å•å…¶å®å°±æ˜¯å°†è®¢å•çš„çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²æ¥å•â€ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n4.2 ä»£ç å®ç° 4.2.1 admin/OrderController 1 2 3 4 5 6 7 8 9 10 11 /** * æ¥å• * * @return */ @PutMapping(\u0026#34;/confirm\u0026#34;) @ApiOperation(\u0026#34;æ¥å•\u0026#34;) public Result confirm(@RequestBody OrdersConfirmDTO ordersConfirmDTO) { orderService.confirm(ordersConfirmDTO); return Result.success(); } 4.2.2 OrderService 1 2 3 4 5 6 /** * æ¥å• * * @param ordersConfirmDTO */ void confirm(OrdersConfirmDTO ordersConfirmDTO); 4.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 /** * æ¥å• * * @param ordersConfirmDTO */ public void confirm(OrdersConfirmDTO ordersConfirmDTO) { Orders orders = Orders.builder() .id(ordersConfirmDTO.getId()) .status(Orders.CONFIRMED) .build(); orderMapper.update(orders); } 4.3 åŠŸèƒ½æµ‹è¯• ç•¥\n5. æ‹’å• 5.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nå•†å®¶æ‹’å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€ åªæœ‰è®¢å•å¤„äºâ€œå¾…æ¥å•â€çŠ¶æ€æ—¶å¯ä»¥æ‰§è¡Œæ‹’å•æ“ä½œ å•†å®¶æ‹’å•æ—¶éœ€è¦æŒ‡å®šæ‹’å•åŸå›  å•†å®¶æ‹’å•æ—¶ï¼Œå¦‚æœç”¨æˆ·å·²ç»å®Œæˆäº†æ”¯ä»˜ï¼Œéœ€è¦ä¸ºç”¨æˆ·é€€æ¬¾ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n5.2 ä»£ç å®ç° 5.2.1 admin/OrderController 1 2 3 4 5 6 7 8 9 10 11 /** * æ‹’å• * * @return */ @PutMapping(\u0026#34;/rejection\u0026#34;) @ApiOperation(\u0026#34;æ‹’å•\u0026#34;) public Result rejection(@RequestBody OrdersRejectionDTO ordersRejectionDTO) throws Exception { orderService.rejection(ordersRejectionDTO); return Result.success(); } 5.2.2 OrderService 1 2 3 4 5 6 /** * æ‹’å• * * @param ordersRejectionDTO */ void rejection(OrdersRejectionDTO ordersRejectionDTO) throws Exception; 5.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 /** * æ‹’å• * * @param ordersRejectionDTO */ public void rejection(OrdersRejectionDTO ordersRejectionDTO) throws Exception { // æ ¹æ®idæŸ¥è¯¢è®¢å• Orders ordersDB = orderMapper.getById(ordersRejectionDTO.getId()); // è®¢å•åªæœ‰å­˜åœ¨ä¸”çŠ¶æ€ä¸º2ï¼ˆå¾…æ¥å•ï¼‰æ‰å¯ä»¥æ‹’å• if (ordersDB == null || !ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) { throw new OrderBusinessException(MessageConstant.ORDER_STATUS_ERROR); } //æ”¯ä»˜çŠ¶æ€ Integer payStatus = ordersDB.getPayStatus(); if (payStatus == Orders.PAID) { //ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾ String refund = weChatPayUtil.refund( ordersDB.getNumber(), ordersDB.getNumber(), new BigDecimal(0.01), new BigDecimal(0.01)); log.info(\u0026#34;ç”³è¯·é€€æ¬¾ï¼š{}\u0026#34;, refund); } // æ‹’å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€æ‹’å•åŸå› ã€å–æ¶ˆæ—¶é—´ Orders orders = new Orders(); orders.setId(ordersDB.getId()); orders.setStatus(Orders.CANCELLED); orders.setRejectionReason(ordersRejectionDTO.getRejectionReason()); orders.setCancelTime(LocalDateTime.now()); orderMapper.update(orders); } 5.3 åŠŸèƒ½æµ‹è¯• ç•¥\n6. å–æ¶ˆè®¢å• 6.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nå–æ¶ˆè®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€ å•†å®¶å–æ¶ˆè®¢å•æ—¶éœ€è¦æŒ‡å®šå–æ¶ˆåŸå›  å•†å®¶å–æ¶ˆè®¢å•æ—¶ï¼Œå¦‚æœç”¨æˆ·å·²ç»å®Œæˆäº†æ”¯ä»˜ï¼Œéœ€è¦ä¸ºç”¨æˆ·é€€æ¬¾ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n6.2 ä»£ç å®ç° 6.2.1 admin/OrderController 1 2 3 4 5 6 7 8 9 10 11 /** * å–æ¶ˆè®¢å• * * @return */ @PutMapping(\u0026#34;/cancel\u0026#34;) @ApiOperation(\u0026#34;å–æ¶ˆè®¢å•\u0026#34;) public Result cancel(@RequestBody OrdersCancelDTO ordersCancelDTO) throws Exception { orderService.cancel(ordersCancelDTO); return Result.success(); } 6.2.2 OrderService 1 2 3 4 5 6 /** * å•†å®¶å–æ¶ˆè®¢å• * * @param ordersCancelDTO */ void cancel(OrdersCancelDTO ordersCancelDTO) throws Exception; 6.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /** * å–æ¶ˆè®¢å• * * @param ordersCancelDTO */ public void cancel(OrdersCancelDTO ordersCancelDTO) throws Exception { // æ ¹æ®idæŸ¥è¯¢è®¢å• Orders ordersDB = orderMapper.getById(ordersCancelDTO.getId()); //æ”¯ä»˜çŠ¶æ€ Integer payStatus = ordersDB.getPayStatus(); if (payStatus == 1) { //ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾ String refund = weChatPayUtil.refund( ordersDB.getNumber(), ordersDB.getNumber(), new BigDecimal(0.01), new BigDecimal(0.01)); log.info(\u0026#34;ç”³è¯·é€€æ¬¾ï¼š{}\u0026#34;, refund); } // ç®¡ç†ç«¯å–æ¶ˆè®¢å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´ Orders orders = new Orders(); orders.setId(ordersCancelDTO.getId()); orders.setStatus(Orders.CANCELLED); orders.setCancelReason(ordersCancelDTO.getCancelReason()); orders.setCancelTime(LocalDateTime.now()); orderMapper.update(orders); } 6.3 åŠŸèƒ½æµ‹è¯• ç•¥\n7. æ´¾é€è®¢å• 7.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\næ´¾é€è®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œæ´¾é€ä¸­â€ åªæœ‰çŠ¶æ€ä¸ºâ€œå¾…æ´¾é€â€çš„è®¢å•å¯ä»¥æ‰§è¡Œæ´¾é€è®¢å•æ“ä½œ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n7.2 ä»£ç å®ç° 7.2.1 admin/OrderController 1 2 3 4 5 6 7 8 9 10 11 /** * æ´¾é€è®¢å• * * @return */ @PutMapping(\u0026#34;/delivery/{id}\u0026#34;) @ApiOperation(\u0026#34;æ´¾é€è®¢å•\u0026#34;) public Result delivery(@PathVariable(\u0026#34;id\u0026#34;) Long id) { orderService.delivery(id); return Result.success(); } 7.2.2 OrderService 1 2 3 4 5 6 /** * æ´¾é€è®¢å• * * @param id */ void delivery(Long id); 7.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /** * æ´¾é€è®¢å• * * @param id */ public void delivery(Long id) { // æ ¹æ®idæŸ¥è¯¢è®¢å• Orders ordersDB = orderMapper.getById(id); // æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”çŠ¶æ€ä¸º3 if (ordersDB == null || !ordersDB.getStatus().equals(Orders.CONFIRMED)) { throw new OrderBusinessException(MessageConstant.ORDER_STATUS_ERROR); } Orders orders = new Orders(); orders.setId(ordersDB.getId()); // æ›´æ–°è®¢å•çŠ¶æ€,çŠ¶æ€è½¬ä¸ºæ´¾é€ä¸­ orders.setStatus(Orders.DELIVERY_IN_PROGRESS); orderMapper.update(orders); } 7.3 åŠŸèƒ½æµ‹è¯• ç•¥\n8. å®Œæˆè®¢å• 8.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nå®Œæˆè®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å®Œæˆâ€ åªæœ‰çŠ¶æ€ä¸ºâ€œæ´¾é€ä¸­â€çš„è®¢å•å¯ä»¥æ‰§è¡Œè®¢å•å®Œæˆæ“ä½œ æ¥å£è®¾è®¡ï¼šå‚è§æ¥å£æ–‡æ¡£\n8.2 ä»£ç å®ç° 8.2.1 admin/OrderController 1 2 3 4 5 6 7 8 9 10 11 /** * å®Œæˆè®¢å• * * @return */ @PutMapping(\u0026#34;/complete/{id}\u0026#34;) @ApiOperation(\u0026#34;å®Œæˆè®¢å•\u0026#34;) public Result complete(@PathVariable(\u0026#34;id\u0026#34;) Long id) { orderService.complete(id); return Result.success(); } 8.2.2 OrderService 1 2 3 4 5 6 /** * å®Œæˆè®¢å• * * @param id */ void complete(Long id); 8.2.3 OrderServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 /** * å®Œæˆè®¢å• * * @param id */ public void complete(Long id) { // æ ¹æ®idæŸ¥è¯¢è®¢å• Orders ordersDB = orderMapper.getById(id); // æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”çŠ¶æ€ä¸º4 if (ordersDB == null || !ordersDB.getStatus().equals(Orders.DELIVERY_IN_PROGRESS)) { throw new OrderBusinessException(MessageConstant.ORDER_STATUS_ERROR); } Orders orders = new Orders(); orders.setId(ordersDB.getId()); // æ›´æ–°è®¢å•çŠ¶æ€,çŠ¶æ€è½¬ä¸ºå®Œæˆ orders.setStatus(Orders.COMPLETED); orders.setDeliveryTime(LocalDateTime.now()); orderMapper.update(orders); } 8.3 åŠŸèƒ½æµ‹è¯• ç•¥\næ ¡éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´ 1. ç¯å¢ƒå‡†å¤‡ æ³¨å†Œè´¦å·ï¼šhttps://passport.baidu.com/v2/?reg\u0026amp;tt=1671699340600\u0026amp;overseas=\u0026amp;gid=CF954C2-A3D2-417F-9FE6-B0F249ED7E33\u0026amp;tpl=pp\u0026amp;u=https%3A%2F%2Flbsyun.baidu.com%2Findex.php%3Ftitle%3Dé¦–é¡µ\nç™»å½•ç™¾åº¦åœ°å›¾å¼€æ”¾å¹³å°ï¼šhttps://lbsyun.baidu.com/\nè¿›å…¥æ§åˆ¶å°ï¼Œåˆ›å»ºåº”ç”¨ï¼Œè·å–AKï¼š\nç›¸å…³æ¥å£:\nhttps://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding\nhttps://lbsyun.baidu.com/index.php?title=webapi/directionlite-v1\n2. ä»£ç å¼€å‘ 2.1 application.yml é…ç½®å¤–å–å•†å®¶åº—é“ºåœ°å€å’Œç™¾åº¦åœ°å›¾çš„AKï¼š\n2.2 OrderServiceImpl æ”¹é€ OrderServiceImplï¼Œæ³¨å…¥ä¸Šé¢çš„é…ç½®é¡¹ï¼š\n1 2 3 4 5 @Value(\u0026#34;${sky.shop.address}\u0026#34;) private String shopAddress; @Value(\u0026#34;${sky.baidu.ak}\u0026#34;) private String ak; åœ¨OrderServiceImplä¸­æä¾›æ ¡éªŒæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 /** * æ£€æŸ¥å®¢æˆ·çš„æ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´ * @param address */ private void checkOutOfRange(String address) { Map map = new HashMap(); map.put(\u0026#34;address\u0026#34;,shopAddress); map.put(\u0026#34;output\u0026#34;,\u0026#34;json\u0026#34;); map.put(\u0026#34;ak\u0026#34;,ak); //è·å–åº—é“ºçš„ç»çº¬åº¦åæ ‡ String shopCoordinate = HttpClientUtil.doGet(\u0026#34;https://api.map.baidu.com/geocoding/v3\u0026#34;, map); JSONObject jsonObject = JSON.parseObject(shopCoordinate); if(!jsonObject.getString(\u0026#34;status\u0026#34;).equals(\u0026#34;0\u0026#34;)){ throw new OrderBusinessException(\u0026#34;åº—é“ºåœ°å€è§£æå¤±è´¥\u0026#34;); } //æ•°æ®è§£æ JSONObject location = jsonObject.getJSONObject(\u0026#34;result\u0026#34;).getJSONObject(\u0026#34;location\u0026#34;); String lat = location.getString(\u0026#34;lat\u0026#34;); String lng = location.getString(\u0026#34;lng\u0026#34;); //åº—é“ºç»çº¬åº¦åæ ‡ String shopLngLat = lat + \u0026#34;,\u0026#34; + lng; map.put(\u0026#34;address\u0026#34;,address); //è·å–ç”¨æˆ·æ”¶è´§åœ°å€çš„ç»çº¬åº¦åæ ‡ String userCoordinate = HttpClientUtil.doGet(\u0026#34;https://api.map.baidu.com/geocoding/v3\u0026#34;, map); jsonObject = JSON.parseObject(userCoordinate); if(!jsonObject.getString(\u0026#34;status\u0026#34;).equals(\u0026#34;0\u0026#34;)){ throw new OrderBusinessException(\u0026#34;æ”¶è´§åœ°å€è§£æå¤±è´¥\u0026#34;); } //æ•°æ®è§£æ location = jsonObject.getJSONObject(\u0026#34;result\u0026#34;).getJSONObject(\u0026#34;location\u0026#34;); lat = location.getString(\u0026#34;lat\u0026#34;); lng = location.getString(\u0026#34;lng\u0026#34;); //ç”¨æˆ·æ”¶è´§åœ°å€ç»çº¬åº¦åæ ‡ String userLngLat = lat + \u0026#34;,\u0026#34; + lng; map.put(\u0026#34;origin\u0026#34;,shopLngLat); map.put(\u0026#34;destination\u0026#34;,userLngLat); map.put(\u0026#34;steps_info\u0026#34;,\u0026#34;0\u0026#34;); //è·¯çº¿è§„åˆ’ String json = HttpClientUtil.doGet(\u0026#34;https://api.map.baidu.com/directionlite/v1/driving\u0026#34;, map); jsonObject = JSON.parseObject(json); if(!jsonObject.getString(\u0026#34;status\u0026#34;).equals(\u0026#34;0\u0026#34;)){ throw new OrderBusinessException(\u0026#34;é…é€è·¯çº¿è§„åˆ’å¤±è´¥\u0026#34;); } //æ•°æ®è§£æ JSONObject result = jsonObject.getJSONObject(\u0026#34;result\u0026#34;); JSONArray jsonArray = (JSONArray) result.get(\u0026#34;routes\u0026#34;); Integer distance = (Integer) ((JSONObject) jsonArray.get(0)).get(\u0026#34;distance\u0026#34;); if(distance \u0026gt; 5000){ //é…é€è·ç¦»è¶…è¿‡5000ç±³ throw new OrderBusinessException(\u0026#34;è¶…å‡ºé…é€èŒƒå›´\u0026#34;); } } åœ¨OrderServiceImplçš„submitOrderæ–¹æ³•ä¸­è°ƒç”¨ä¸Šé¢çš„æ ¡éªŒæ–¹æ³•ï¼š\nè®¢å•çŠ¶æ€å®šæ—¶å¤„ç†ã€æ¥å•æé†’å’Œå®¢æˆ·å‚¬å• Spring Task Spring Task æ˜¯Springæ¡†æ¶æä¾›çš„ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œå¯ä»¥æŒ‰ç…§çº¦å®šçš„æ—¶é—´è‡ªåŠ¨æ‰§è¡ŒæŸä¸ªä»£ç é€»è¾‘ã€‚\nå®šä½ï¼šå®šæ—¶ä»»åŠ¡æ¡†æ¶\nä½œç”¨ï¼šå®šæ—¶è‡ªåŠ¨æ‰§è¡ŒæŸæ®µJavaä»£ç \nä»‹ç» åº”ç”¨åœºæ™¯ï¼š\nä¿¡ç”¨å¡æ¯æœˆè¿˜å¡æé†’ é“¶è¡Œè´·æ¬¾æ¯æœˆè¿˜æ¬¾æé†’ ç«è½¦ç¥¨å”®ç¥¨ç³»ç»Ÿå¤„ç†æœªæ”¯ä»˜è®¢å• å…¥èŒçºªå¿µæ—¥ä¸ºç”¨æˆ·å‘é€é€šçŸ¥ cronè¡¨è¾¾å¼ cronè¡¨è¾¾å¼å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡cronè¡¨è¾¾å¼å¯ä»¥å®šä¹‰ä»»åŠ¡è§¦å‘çš„æ—¶é—´\næ„æˆè§„åˆ™ï¼šåˆ†ä¸º6æˆ–7ä¸ªåŸŸï¼Œç”±ç©ºæ ¼åˆ†éš”å¼€ï¼Œæ¯ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰\næ¯ä¸ªåŸŸçš„å«ä¹‰åˆ†åˆ«ä¸ºï¼šç§’ã€åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€å‘¨ã€å¹´(å¯é€‰) å‘¨ å’Œ æ—¥äº’æ–¥ï¼Œåªèƒ½é€‰æ‹©å…¶ä¸€ï¼Œå¦å¤–ä¸€ä¸ªé€‰æ‹©ï¼Ÿ\n2022å¹´10æœˆ12æ—¥ä¸Šåˆ9ç‚¹æ•´ å¯¹åº”çš„cronè¡¨è¾¾å¼ï¼š 0 0 9 12 10 ï¼Ÿ2022\nå…¥é—¨æ¡ˆä¾‹ Spring Taskä½¿ç”¨æ­¥éª¤ï¼š\nå¯¼å…¥Mavenåæ ‡ spring-context å¯åŠ¨ç±»æ·»åŠ æ³¨è§£@EnableSchedulingå¼€å¯ä»»åŠ¡è°ƒåº¦ è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±» è®¢å•çŠ¶æ€å®šæ—¶å¤„ç† éœ€æ±‚åˆ†æå’Œè®¾è®¡ ç”¨æˆ·ä¸‹å•åå¯èƒ½å­˜åœ¨çš„æƒ…å†µï¼š\nä¸‹å•æœªæ”¯ä»˜ï¼Œè®¢å•ä¸€ç›´å¤„äºâ€œæœªæ”¯ä»˜â€çŠ¶æ€ ç”¨æˆ·æ”¶è´§åç®¡ç†ç«¯æœªç‚¹å‡»å®ŒæˆæŒ‰é’®ï¼Œè®¢å•ä¸€ç›´å¤„äºâ€œæ´¾é€ä¸­â€çŠ¶æ€ å¯¹äºä¸Šé¢ä¸¤ç§æƒ…å†µéœ€è¦é€šè¿‡å®šæ—¶ä»»åŠ¡æ¥ä¿®æ”¹è®¢å•çŠ¶æ€ï¼Œå…·ä½“é€»è¾‘ä¸ºï¼š\né€šè¿‡å®šæ—¶ä»»åŠ¡æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨æ”¯ä»˜è¶…æ—¶è®¢å•ï¼ˆä¸‹å•åè¶…è¿‡15åˆ†é’Ÿä»æœªæ”¯ä»˜åˆ™åˆ¤å®šä¸ºæ”¯ä»˜è¶…æ—¶è®¢å•ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å–æ¶ˆâ€ é€šè¿‡å®šæ—¶ä»»åŠ¡æ¯å¤©å‡Œæ™¨1ç‚¹æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨â€œæ´¾é€ä¸­â€çš„è®¢å•ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€ ä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• WebSocket ä»‹ç» WebSocket æ˜¯åŸºäº TCP çš„ä¸€ç§æ–°çš„ç½‘ç»œåè®®ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡â€”â€”æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚\nHTTPåè®®å’ŒWebSocketåè®®å¯¹æ¯”ï¼š\nHTTPæ˜¯çŸ­è¿æ¥ WebSocketæ˜¯é•¿è¿æ¥ HTTPé€šä¿¡æ˜¯å•å‘çš„ï¼ŒåŸºäºè¯·æ±‚å“åº”æ¨¡å¼ WebSocketæ”¯æŒåŒå‘é€šä¿¡ HTTPå’ŒWebSocketåº•å±‚éƒ½æ˜¯TCPè¿æ¥ åº”ç”¨åœºæ™¯\nè§†é¢‘å¼¹å¹• ç½‘é¡µèŠå¤© ä½“è‚²å®å†µæ›´æ–° è‚¡ç¥¨åŸºé‡‘æŠ¥ä»·å®æ—¶æ›´æ–° æ•ˆæœå±•ç¤ºï¼š\nå…¥é—¨æ¡ˆä¾‹ å®ç°æ­¥éª¤ï¼š\nç›´æ¥ä½¿ç”¨websocket.htmlé¡µé¢ä½œä¸ºWebSocketå®¢æˆ·ç«¯ å¯¼å…¥WebSocketçš„mavenåæ ‡ å¯¼å…¥WebSocketæœåŠ¡ç«¯ç»„å»ºWebSocketServerï¼Œç”¨äºå’Œå®¢æˆ·ç«¯é€šä¿¡ å¯¼å…¥é…ç½®ç±»WebSocketConfigurationï¼Œæ³¨å†ŒWebSocketçš„æœåŠ¡ç«¯ç»„ä»¶ å¯¼å…¥å®šæ—¶ä»»åŠ¡ç±»WebSocketTaskï¼Œå®šæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ® æ¥å•æé†’ éœ€æ±‚åˆ†æå’Œè®¾è®¡ ç”¨æˆ·ä¸‹å•å¹¶ä¸”æ”¯ä»˜æˆåŠŸåéœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶ã€‚é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š\nè¯­éŸ³æ’­æŠ¥ å¼¹å‡ºæç¤ºæ¡† è®¾è®¡ï¼š\né€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯é¡µé¢ä¿æŒé•¿è¿æ¥çŠ¶æ€ å½“å®¢æˆ·æ”¯ä»˜åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘ç®¡ç†ç«¯æ¨é€æ¶ˆæ¯ ç®¡ç†ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥ çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeã€orderidã€content type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ï¼Œ2ä¸ºå®¢æˆ·å‚¬å• orderid ä¸ºè®¢å•id content ä¸ºæ¶ˆæ¯å†…å®¹ ä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• å®¢æˆ·å‚¬å• éœ€æ±‚åˆ†æå’Œè®¾è®¡ ç”¨æˆ·åœ¨å°ç¨‹åºä¸­ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œéœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶ã€‚é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š\nè¯­éŸ³æ’­æŠ¥ å¼¹å‡ºæç¤ºæ¡† è®¾è®¡ï¼š\né€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯é¡µé¢ä¿æŒé•¿è¿æ¥çŠ¶æ€ å½“ç”¨æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘ç®¡ç†ç«¯æ¨é€æ¶ˆæ¯ ç®¡ç†ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥ çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeã€orderidã€content type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ï¼Œ2ä¸ºå®¢æˆ·å‚¬å• orderid ä¸ºè®¢å•id content ä¸ºæ¶ˆæ¯å†…å®¹ æ¥å£è®¾è®¡ï¼š\nä»£ç å¼€å‘ åŠŸèƒ½æµ‹è¯• æ•°æ®ç»Ÿè®¡-å›¾å½¢æŠ¥è¡¨ Apache Echarts ä»‹ç» Apache Echartsæ˜¯ä¸€æ¬¾åŸºäºJavascript çš„æ•°æ®å¯è§†åŒ–å›¾è¡¨åº“ï¼Œæä¾›ç›´è§‚ï¼Œç”ŸåŠ¨ï¼Œå¯äº¤äº’ï¼Œå¯ä¸ªæ€§åŒ–å®šåˆ¶çš„æ•°æ®å¯è§†åŒ–å›¾è¡¨ã€‚\nå®˜ç½‘åœ°å€ï¼šhttps://echarts.apache.org/zh/index.html\næ•ˆæœå±•ç¤ºï¼š\nå…¥é—¨æ¡ˆä¾‹ æ€»ç»“:ä½¿ç”¨Echartsï¼Œé‡ç‚¹åœ¨äºç ”ç©¶å½“å‰å›¾è¡¨æ‰€éœ€çš„æ•°æ®æ ¼å¼ã€‚é€šå¸¸æ˜¯éœ€è¦åç«¯æä¾›ç¬¦åˆæ ¼å¼è¦æ±‚çš„åŠ¨æ€æ•°æ®ï¼Œç„¶åå“åº”ç»™å‰ç«¯æ¥å±•ç¤ºå›¾è¡¨ã€‚\nè¥ä¸šé¢ç»Ÿè®¡ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nè¥ä¸šé¢æŒ‡è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆçš„è®¢å•é‡‘é¢åˆè®¡ åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè¥ä¸šé¢æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºè¥ä¸šé¢ æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„è¥ä¸šé¢æ•°æ® æ¥å£è®¾è®¡ï¼š\nä»£ç å¼€å‘ æ ¹æ®æ¥å£å®šä¹‰è®¾è®¡å¯¹åº”çš„VOï¼š\nåŠŸèƒ½æµ‹è¯• ç”¨æˆ·ç»Ÿè®¡ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nåŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºç”¨æˆ·æ•°æ®ï¼Œxè½´ä¸ºæ—¥æœŸï¼Œyè½´ä¸ºç”¨æˆ·æ•° æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„ç”¨æˆ·æ€»é‡å’Œæ–°å¢ç”¨æˆ·é‡æ•°æ® æ¥å£è®¾è®¡ï¼š\nä»£ç å¼€å‘ æ ¹æ®ç”¨æˆ·ç»Ÿè®¡æ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š\nåŠŸèƒ½æµ‹è¯• è®¢å•ç»Ÿè®¡ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\næœ‰æ•ˆè®¢å•æŒ‡çŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€çš„è®¢å• åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè®¢å•æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºè®¢å•æ•°é‡ æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„è®¢å•æ€»æ•°å’Œæœ‰æ•ˆè®¢å•æ•° å±•ç¤ºæ‰€é€‰æ—¶é—´åŒºé—´å†…çš„æœ‰æ•ˆè®¢å•æ•°ã€æ€»è®¢å•æ•°ã€è®¢å•å®Œæˆç‡ï¼Œè®¢å•å®Œæˆç‡=æœ‰æ•ˆè®¢å•æ•°/æ€»è®¢å•æ•° * 100% æ¥å£è®¾è®¡ï¼š\nä»£ç å¼€å‘ æ ¹æ®è®¢å•ç»Ÿè®¡æ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š\nåŠŸèƒ½æµ‹è¯• é”€é‡æ’è¡ŒTop10 éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\næ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºé”€é‡å‰10çš„å•†å“ï¼ˆåŒ…æ‹¬èœå“å’Œå¥—é¤ï¼‰ åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŸ±çŠ¶å›¾é™åºå±•ç¤ºå•†å“é”€é‡ æ­¤å¤„çš„é”€é‡ä¸ºå•†å“é”€å”®çš„ä»½æ•° æ¥å£è®¾è®¡ï¼š\nä»£ç å¼€å‘ æ ¹æ®é”€é‡æ’åæ¥å£çš„è¿”å›ç»“æœè®¾è®¡VOï¼š\nåŠŸèƒ½æµ‹è¯• æ•°æ®ç»Ÿè®¡-ExcelæŠ¥è¡¨ å·¥ä½œå° éœ€æ±‚åˆ†æå’Œè®¾è®¡ å·¥ä½œå°æ˜¯ç³»ç»Ÿè¿è¥çš„æ•°æ®çœ‹æ¿ï¼Œå¹¶æä¾›å¿«æ·æ“ä½œå…¥å£ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜å•†å®¶çš„å·¥ä½œæ•ˆç‡ã€‚\nå·¥ä½œå°å±•ç¤ºçš„æ•°æ®ï¼š\nä»Šæ—¥æ•°æ® è®¢å•ç®¡ç† èœå“æ€»è§ˆ å¥—é¤æ€»è§ˆ è®¢å•ä¿¡æ¯ åè¯è§£é‡Šï¼š\nè¥ä¸šé¢ï¼šå·²å®Œæˆè®¢å•çš„æ€»é‡‘é¢ æœ‰æ•ˆè®¢å•ï¼šå·²å®Œæˆè®¢å•çš„æ•°é‡ è®¢å•å®Œæˆç‡ï¼šæœ‰æ•ˆè®¢å•æ•°ã€æ€»è®¢å•æ•° * 100 å¹³å‡å®¢å•ä»·ï¼šè¥ä¸šé¢ / æœ‰æ•ˆè®¢å•æ•° æ–°å¢ç”¨æˆ·ï¼šæ–°å¢ç”¨æˆ·çš„æ•°é‡ æ¥å£è®¾è®¡ï¼š\nä»Šæ—¥æ•°æ®æ¥å£ è®¢å•ç®¡ç†æ¥å£ èœå“æ€»è§ˆæ¥å£ å¥—é¤æ€»è§ˆæ¥å£ è®¢å•æœç´¢ï¼ˆå·²å®Œæˆï¼‰ å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡ï¼ˆå·²å®Œæˆï¼‰ ä»£ç å¯¼å…¥ åŠŸèƒ½æµ‹è¯• Apache POI ä»‹ç» Apache POlæ˜¯ä¸€ä¸ªå¤„ç†Miscrosoft Officeå„ç§æ–‡ä»¶æ ¼å¼çš„å¼€æºé¡¹ç›®ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ POl åœ¨ Java ç¨‹åºä¸­å¯¹Miscrosoft Officeå„ç§æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPOIéƒ½æ˜¯ç”¨äºæ“ä½œExcelæ–‡ä»¶ã€‚\nApache POI çš„åº”ç”¨åœºæ™¯ï¼š\né“¶è¡Œç½‘é“¶ç³»ç»Ÿå¯¼å‡ºäº¤æ˜“æ˜ç»† å„ç§ä¸šåŠ¡ç³»ç»Ÿå¯¼å‡ºExcelæŠ¥è¡¨ æ‰¹é‡å¯¼å…¥ä¸šåŠ¡æ•°æ® å…¥é—¨æ¡ˆä¾‹ Apache POIçš„mavenåæ ‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 public class POITest { /** * é€šè¿‡POIåˆ›å»ºExcelæ–‡ä»¶å¹¶ä¸”å†™å…¥æ–‡ä»¶å†…å®¹ */ public static void write() throws Exception{ //åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶ XSSFWorkbook excel = new XSSFWorkbook(); //åœ¨Excelæ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªsheeté¡µ XSSFSheet sheet = excel.createSheet(\u0026#34;info\u0026#34;); //åœ¨sheeté¡µä¸­åˆ›å»ºè¡Œå¯¹è±¡ï¼Œrownumç¼–å·ä»0å¼€å§‹ XSSFRow row = sheet.createRow(1); //åˆ›å»ºå•å…ƒæ ¼ï¼Œå¹¶ä¸”å†™å…¥æ–‡ä»¶å†…å®¹ row.createCell(1).setCellValue(\u0026#34;å§“å\u0026#34;); row.createCell(2).setCellValue(\u0026#34;åŸå¸‚\u0026#34;); //åˆ›å»ºä¸€ä¸ªæ–°è¡Œ row = sheet.createRow(2); row.createCell(1).setCellValue(\u0026#34;å¼ ä¸‰\u0026#34;); row.createCell(2).setCellValue(\u0026#34;åŒ—äº¬\u0026#34;); row = sheet.createRow(3); row.createCell(1).setCellValue(\u0026#34;æå››\u0026#34;); row.createCell(2).setCellValue(\u0026#34;å—äº¬\u0026#34;); //é€šè¿‡è¾“å‡ºæµå°†å†…å­˜ä¸­çš„Excelæ–‡ä»¶å†™å…¥ç£ç›˜ FileOutputStream out = new FileOutputStream(new File(\u0026#34;D:\\\\Projects\\\\info.xlsx\u0026#34;)); excel.write(out); //å…³é—­èµ„æº out.close(); excel.close(); } public static void main(String[] args) throws Exception { write(); } } å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨ éœ€æ±‚åˆ†æå’Œè®¾è®¡ äº§å“åŸå‹ï¼š\nå¯¼å‡ºçš„ExcelæŠ¥è¡¨æ ¼å¼ï¼š\nä¸šåŠ¡è§„åˆ™ï¼š\nå¯¼å‡ºExcelå½¢å¼çš„æŠ¥è¡¨æ–‡ä»¶ å¯¼å‡ºæœ€è¿‘30å¤©çš„è¿è¥æ•°æ® æ¥å£è®¾è®¡ï¼š\næ³¨æ„ï¼šå½“å‰æ¥å£æ²¡æœ‰è¿”å›æ•°æ®ï¼Œå› ä¸ºæŠ¥è¡¨å¯¼å‡ºåŠŸèƒ½æœ¬è´¨ä¸Šæ˜¯æ–‡ä»¶ä¸‹è½½ï¼ŒæœåŠ¡ç«¯ä¼šé€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨\nä»£ç å¼€å‘ å®ç°æ­¥éª¤ï¼š\nè®¾è®¡Excelæ¨¡æ¿æ–‡ä»¶\næŸ¥è¯¢è¿‘30å¤©çš„è¿è¥æ•°æ®\nå°†æŸ¥è¯¢åˆ°çš„è¿è¥æ•°æ®å†™å…¥æ¨¡æ¿æ–‡ä»¶\né€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨\n","date":"2024-04-13T18:46:11+08:00","image":"https://nova-bryan.github.io/p/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°"},{"content":"SpringBoot-é…ç½®ä¼˜å…ˆçº§ åœ¨æˆ‘ä»¬å‰é¢çš„è¯¾ç¨‹å½“ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®²è§£äº†SpringBooté¡¹ç›®å½“ä¸­æ”¯æŒçš„ä¸‰ç±»é…ç½®æ–‡ä»¶ï¼š\napplication.properties application.yml application.yaml åœ¨SpringBooté¡¹ç›®å½“ä¸­ï¼Œæˆ‘ä»¬è¦æƒ³é…ç½®ä¸€ä¸ªå±æ€§ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸‰ç§æ–¹å¼å½“ä¸­çš„ä»»æ„ä¸€ç§æ¥é…ç½®éƒ½å¯ä»¥ï¼Œé‚£ä¹ˆå¦‚æœé¡¹ç›®ä¸­åŒæ—¶å­˜åœ¨è¿™ä¸‰ç§é…ç½®æ–‡ä»¶ï¼Œä¸”éƒ½é…ç½®äº†åŒä¸€ä¸ªå±æ€§ï¼Œå¦‚ï¼šTomcatç«¯å£å·ï¼Œåˆ°åº•å“ªä¸€ä»½é…ç½®æ–‡ä»¶ç”Ÿæ•ˆå‘¢ï¼Ÿ\napplication.properties 1 server.port=8081 application.yml 1 2 server: port: 8082 application.yaml 1 2 server: port: 8082 æˆ‘ä»¬å¯åŠ¨SpringBootç¨‹åºï¼Œæµ‹è¯•ä¸‹ä¸‰ä¸ªé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªTomcatç«¯å£å·ç”Ÿæ•ˆï¼š\npropertiesã€yamlã€ymlä¸‰ç§é…ç½®æ–‡ä»¶åŒæ—¶å­˜åœ¨ propertiesã€yamlã€ymlä¸‰ç§é…ç½®æ–‡ä»¶ï¼Œä¼˜å…ˆçº§æœ€é«˜çš„æ˜¯properties\nyamlã€ymlä¸¤ç§é…ç½®æ–‡ä»¶åŒæ—¶å­˜åœ¨ é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æ’åï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š\npropertiesé…ç½®æ–‡ä»¶ ymlé…ç½®æ–‡ä»¶ yamlé…ç½®æ–‡ä»¶ æ³¨æ„äº‹é¡¹ï¼šè™½ç„¶springbootæ”¯æŒå¤šç§æ ¼å¼é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨é¡¹ç›®å¼€å‘æ—¶ï¼Œæ¨èç»Ÿä¸€ä½¿ç”¨ä¸€ç§æ ¼å¼çš„é…ç½®ã€‚ï¼ˆymlæ˜¯ä¸»æµï¼‰\nåœ¨SpringBooté¡¹ç›®å½“ä¸­é™¤äº†ä»¥ä¸Š3ç§é…ç½®æ–‡ä»¶å¤–ï¼ŒSpringBootä¸ºäº†å¢å¼ºç¨‹åºçš„æ‰©å±•æ€§ï¼Œé™¤äº†æ”¯æŒé…ç½®æ–‡ä»¶çš„é…ç½®æ–¹å¼ä»¥å¤–ï¼Œè¿˜æ”¯æŒå¦å¤–ä¸¤ç§å¸¸è§çš„é…ç½®æ–¹å¼ï¼š\nJavaç³»ç»Ÿå±æ€§é…ç½® ï¼ˆæ ¼å¼ï¼š -Dkey=valueï¼‰\n1 -Dserver.port=9000 å‘½ä»¤è¡Œå‚æ•° ï¼ˆæ ¼å¼ï¼š\u0026ndash;key=valueï¼‰\n1 --server.port=10010 é‚£åœ¨ideaå½“ä¸­è¿è¡Œç¨‹åºæ—¶ï¼Œå¦‚ä½•æ¥æŒ‡å®šJavaç³»ç»Ÿå±æ€§å’Œå‘½ä»¤è¡Œå‚æ•°å‘¢ï¼Ÿ\nç¼–è¾‘å¯åŠ¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ é‡å¯æœåŠ¡ï¼ŒåŒæ—¶é…ç½®Tomcatç«¯å£(ä¸‰ç§é…ç½®æ–‡ä»¶ã€ç³»ç»Ÿå±æ€§ã€å‘½ä»¤è¡Œå‚æ•°)ï¼Œæµ‹è¯•å“ªä¸ªTomcatç«¯å£å·ç”Ÿæ•ˆï¼š\nåˆ é™¤å‘½ä»¤è¡Œå‚æ•°é…ç½®ï¼Œé‡å¯SpringBootæœåŠ¡ï¼š\nä¼˜å…ˆçº§ï¼š å‘½ä»¤è¡Œå‚æ•° \u0026gt; ç³»ç»Ÿå±æ€§å‚æ•° \u0026gt; propertieså‚æ•° \u0026gt; ymlå‚æ•° \u0026gt; yamlå‚æ•°\næ€è€ƒï¼šå¦‚æœé¡¹ç›®å·²ç»æ‰“åŒ…ä¸Šçº¿äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆå¦‚ä½•æ¥è®¾ç½®Javaç³»ç»Ÿå±æ€§å’Œå‘½ä»¤è¡Œå‚æ•°å‘¢ï¼Ÿ\n1 java -Dserver.port=9000 -jar XXXXX.jar --server.port=10010 ä¸‹é¢æˆ‘ä»¬æ¥æ¼”ç¤ºä¸‹æ‰“åŒ…ç¨‹åºè¿è¡Œæ—¶æŒ‡å®šJavaç³»ç»Ÿå±æ€§å’Œå‘½ä»¤è¡Œå‚æ•°ï¼š\næ‰§è¡Œmavenæ‰“åŒ…æŒ‡ä»¤packageï¼ŒæŠŠé¡¹ç›®æ‰“æˆjaræ–‡ä»¶ ä½¿ç”¨å‘½ä»¤ï¼šjava -jar æ–¹å¼è¿è¡Œjaræ–‡ä»¶ç¨‹åº é¡¹ç›®æ‰“åŒ…ï¼š\nè¿è¡Œjarç¨‹åºï¼š\nåŒæ—¶è®¾ç½®Javaç³»ç»Ÿå±æ€§å’Œå‘½ä»¤è¡Œå‚æ•° ä»…è®¾ç½®Javaç³»ç»Ÿå±æ€§ æ³¨æ„äº‹é¡¹ï¼š\nSpringbooté¡¹ç›®è¿›è¡Œæ‰“åŒ…æ—¶ï¼Œéœ€è¦å¼•å…¥æ’ä»¶ spring-boot-maven-plugin (åŸºäºå®˜ç½‘éª¨æ¶åˆ›å»ºé¡¹ç›®ï¼Œä¼šè‡ªåŠ¨æ·»åŠ è¯¥æ’ä»¶) åœ¨SpringBooté¡¹ç›®å½“ä¸­ï¼Œå¸¸è§çš„å±æ€§é…ç½®æ–¹å¼æœ‰5ç§ï¼Œ 3ç§é…ç½®æ–‡ä»¶ï¼ŒåŠ ä¸Š2ç§å¤–éƒ¨å±æ€§çš„é…ç½®(Javaç³»ç»Ÿå±æ€§ã€å‘½ä»¤è¡Œå‚æ•°)ã€‚é€šè¿‡ä»¥ä¸Šçš„æµ‹è¯•ï¼Œæˆ‘ä»¬ä¹Ÿå¾—å‡ºäº†ä¼˜å…ˆçº§(ä»ä½åˆ°é«˜)ï¼š\napplication.yamlï¼ˆå¿½ç•¥ï¼‰ application.yml application.properties javaç³»ç»Ÿå±æ€§ï¼ˆ-Dxxx=xxxï¼‰ å‘½ä»¤è¡Œå‚æ•°ï¼ˆ\u0026ndash;xxx=xxxï¼‰ beançš„ç®¡ç†-beançš„è·å– åœ¨å‰é¢çš„è¯¾ç¨‹å½“ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®²è¿‡äº†æˆ‘ä»¬å¯ä»¥é€šè¿‡Springå½“ä¸­æä¾›çš„æ³¨è§£@Componentä»¥åŠå®ƒçš„ä¸‰ä¸ªè¡ç”Ÿæ³¨è§£ï¼ˆ@Controllerã€@Serviceã€@Repositoryï¼‰æ¥å£°æ˜IOCå®¹å™¨ä¸­çš„beanå¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå­¦ä¹ äº†å¦‚ä½•ä¸ºåº”ç”¨ç¨‹åºæ³¨å…¥è¿è¡Œæ—¶æ‰€éœ€è¦ä¾èµ–çš„beanå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–æ³¨å…¥DIã€‚\næˆ‘ä»¬ä»Šå¤©ä¸»è¦å­¦ä¹ IOCå®¹å™¨ä¸­Beançš„å…¶ä»–ä½¿ç”¨ç»†èŠ‚ï¼Œä¸»è¦å­¦ä¹ ä»¥ä¸‹ä¸‰æ–¹é¢ï¼š\nå¦‚ä½•ä»IOCå®¹å™¨ä¸­æ‰‹åŠ¨çš„è·å–åˆ°beanå¯¹è±¡ beançš„ä½œç”¨åŸŸé…ç½® ç®¡ç†ç¬¬ä¸‰æ–¹çš„beanå¯¹è±¡ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringBooté¡¹ç›®åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨çš„åˆ›å»ºIOCå®¹å™¨(ä¹Ÿç§°ä¸ºSpringå®¹å™¨)ï¼Œå¹¶ä¸”åœ¨å¯åŠ¨çš„è¿‡ç¨‹å½“ä¸­ä¼šè‡ªåŠ¨çš„å°†beanå¯¹è±¡éƒ½åˆ›å»ºå¥½ï¼Œå­˜æ”¾åœ¨IOCå®¹å™¨å½“ä¸­ã€‚åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶éœ€è¦ä¾èµ–ä»€ä¹ˆbeanå¯¹è±¡ï¼Œå°±ç›´æ¥è¿›è¡Œä¾èµ–æ³¨å…¥å°±å¯ä»¥äº†ã€‚\nè€Œåœ¨Springå®¹å™¨ä¸­æä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥ä¸»åŠ¨ä»IOCå®¹å™¨ä¸­è·å–åˆ°beanå¯¹è±¡ï¼Œä¸‹é¢ä»‹ç»3ç§å¸¸ç”¨æ–¹å¼ï¼š\næ ¹æ®nameè·å–bean\n1 Object getBean(String name) æ ¹æ®ç±»å‹è·å–bean\n1 \u0026lt;T\u0026gt; T getBean(Class\u0026lt;T\u0026gt; requiredType) æ ¹æ®nameè·å–beanï¼ˆå¸¦ç±»å‹è½¬æ¢ï¼‰\n1 \u0026lt;T\u0026gt; T getBean(String name, Class\u0026lt;T\u0026gt; requiredType) æ€è€ƒï¼šè¦ä»IOCå®¹å™¨å½“ä¸­æ¥è·å–åˆ°beanå¯¹è±¡ï¼Œéœ€è¦å…ˆæ‹¿åˆ°IOCå®¹å™¨å¯¹è±¡ï¼Œæ€ä¹ˆæ ·æ‰èƒ½æ‹¿åˆ°IOCå®¹å™¨å‘¢ï¼Ÿ\næƒ³è·å–åˆ°IOCå®¹å™¨ï¼Œç›´æ¥å°†IOCå®¹å™¨å¯¹è±¡æ³¨å…¥è¿›æ¥å°±å¯ä»¥äº† æ§åˆ¶å™¨ï¼šDeptController\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 @RestController @RequestMapping(\u0026#34;/depts\u0026#34;) public class DeptController { @Autowired private DeptService deptService; public DeptController(){ System.out.println(\u0026#34;DeptController constructor ....\u0026#34;); } @GetMapping public Result list(){ List\u0026lt;Dept\u0026gt; deptList = deptService.list(); return Result.success(deptList); } @DeleteMapping(\u0026#34;/{id}\u0026#34;) public Result delete(@PathVariable Integer id) { deptService.delete(id); return Result.success(); } @PostMapping public Result save(@RequestBody Dept dept){ deptService.save(dept); return Result.success(); } } ä¸šåŠ¡å®ç°ç±»ï¼šDeptServiceImpl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @Slf4j @Service public class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; @Override public List\u0026lt;Dept\u0026gt; list() { List\u0026lt;Dept\u0026gt; deptList = deptMapper.list(); return deptList; } @Override public void delete(Integer id) { deptMapper.delete(id); } @Override public void save(Dept dept) { dept.setCreateTime(LocalDateTime.now()); dept.setUpdateTime(LocalDateTime.now()); deptMapper.save(dept); } } Mapperæ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Mapper public interface DeptMapper { //æŸ¥è¯¢å…¨éƒ¨éƒ¨é—¨æ•°æ® @Select(\u0026#34;select * from dept\u0026#34;) List\u0026lt;Dept\u0026gt; list(); //åˆ é™¤éƒ¨é—¨ @Delete(\u0026#34;delete from dept where id = #{id}\u0026#34;) void delete(Integer id); //æ–°å¢éƒ¨é—¨ @Insert(\u0026#34;insert into dept(name, create_time, update_time) values (#{name},#{createTime},#{updateTime})\u0026#34;) void save(Dept dept); } æµ‹è¯•ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @SpringBootTest class SpringbootWebConfig2ApplicationTests { @Autowired private ApplicationContext applicationContext; //IOCå®¹å™¨å¯¹è±¡ //è·å–beanå¯¹è±¡ @Test public void testGetBean(){ //æ ¹æ®beançš„åç§°è·å– DeptController bean1 = (DeptController) applicationContext.getBean(\u0026#34;deptController\u0026#34;); System.out.println(bean1); //æ ¹æ®beançš„ç±»å‹è·å– DeptController bean2 = applicationContext.getBean(DeptController.class); System.out.println(bean2); //æ ¹æ®beançš„åç§° åŠ ç±»å‹è·å– DeptController bean3 = applicationContext.getBean(\u0026#34;deptController\u0026#34;, DeptController.class); System.out.println(bean3); } } ç¨‹åºè¿è¡Œåæ§åˆ¶å°æ—¥å¿—ï¼š\né—®é¢˜ï¼šè¾“å‡ºçš„beanå¯¹è±¡åœ°å€å€¼æ˜¯ä¸€æ ·çš„ï¼Œè¯´æ˜IOCå®¹å™¨å½“ä¸­çš„beanå¯¹è±¡æœ‰å‡ ä¸ªï¼Ÿ\nç­”æ¡ˆï¼šåªæœ‰ä¸€ä¸ªã€‚ ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒIOCä¸­çš„beanå¯¹è±¡æ˜¯å•ä¾‹ï¼‰\né‚£ä¹ˆèƒ½ä¸èƒ½å°†beanå¯¹è±¡è®¾ç½®ä¸ºéå•ä¾‹çš„(æ¯æ¬¡è·å–çš„beanéƒ½æ˜¯ä¸€ä¸ªæ–°å¯¹è±¡)ï¼Ÿ\nå¯ä»¥ï¼Œåœ¨ä¸‹ä¸€ä¸ªçŸ¥è¯†ç‚¹(beanä½œç”¨åŸŸ)ä¸­è®²è§£ã€‚\næ³¨æ„äº‹é¡¹ï¼š\nä¸Šè¿°æ‰€è¯´çš„ ã€Springé¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šæŠŠå…¶ä¸­çš„beanéƒ½åˆ›å»ºå¥½ã€‘è¿˜ä¼šå—åˆ°ä½œç”¨åŸŸåŠå»¶è¿Ÿåˆå§‹åŒ–å½±å“ï¼Œè¿™é‡Œä¸»è¦é’ˆå¯¹äºé»˜è®¤çš„å•ä¾‹éå»¶è¿ŸåŠ è½½çš„beanè€Œè¨€ã€‚ beançš„ç®¡ç†-beançš„ä½œç”¨åŸŸ åœ¨å‰é¢æˆ‘ä»¬æåˆ°çš„IOCå®¹å™¨å½“ä¸­ï¼Œé»˜è®¤beanå¯¹è±¡æ˜¯å•ä¾‹æ¨¡å¼(åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡)ã€‚é‚£ä¹ˆå¦‚ä½•è®¾ç½®beanå¯¹è±¡ä¸ºéå•ä¾‹å‘¢ï¼Ÿéœ€è¦è®¾ç½®beançš„ä½œç”¨åŸŸã€‚\nåœ¨Springä¸­æ”¯æŒäº”ç§ä½œç”¨åŸŸï¼Œåä¸‰ç§åœ¨webç¯å¢ƒæ‰ç”Ÿæ•ˆï¼š\nä½œç”¨åŸŸ è¯´æ˜ singleton å®¹å™¨å†…åŒåç§°çš„beanåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ˆå•ä¾‹ï¼‰ï¼ˆé»˜è®¤ï¼‰ prototype æ¯æ¬¡ä½¿ç”¨è¯¥beanæ—¶ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ï¼ˆéå•ä¾‹ï¼‰ request æ¯ä¸ªè¯·æ±‚èŒƒå›´å†…ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ï¼ˆwebç¯å¢ƒä¸­ï¼Œäº†è§£ï¼‰ session æ¯ä¸ªä¼šè¯èŒƒå›´å†…ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ï¼ˆwebç¯å¢ƒä¸­ï¼Œäº†è§£ï¼‰ application æ¯ä¸ªåº”ç”¨èŒƒå›´å†…ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ï¼ˆwebç¯å¢ƒä¸­ï¼Œäº†è§£ï¼‰ çŸ¥é“äº†beançš„5ç§ä½œç”¨åŸŸäº†ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆå»è®¾ç½®ä¸€ä¸ªbeançš„ä½œç”¨åŸŸå‘¢ï¼Ÿ\nå¯ä»¥å€ŸåŠ©Springä¸­çš„@Scopeæ³¨è§£æ¥è¿›è¡Œé…ç½®ä½œç”¨åŸŸ 1). æµ‹è¯•ä¸€\næ§åˆ¶å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 //é»˜è®¤beançš„ä½œç”¨åŸŸä¸ºï¼šsingleton (å•ä¾‹) @Lazy //å»¶è¿ŸåŠ è½½ï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨beanå¯¹è±¡æ—¶ï¼Œæ‰ä¼šåˆ›å»ºbeanå¯¹è±¡å¹¶äº¤ç»™iocå®¹å™¨ç®¡ç†ï¼‰ @RestController @RequestMapping(\u0026#34;/depts\u0026#34;) public class DeptController { @Autowired private DeptService deptService; public DeptController(){ System.out.println(\u0026#34;DeptController constructor ....\u0026#34;); } //çœç•¥å…¶ä»–ä»£ç ... } æµ‹è¯•ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @SpringBootTest class SpringbootWebConfig2ApplicationTests { @Autowired private ApplicationContext applicationContext; //IOCå®¹å™¨å¯¹è±¡ //beançš„ä½œç”¨åŸŸ @Test public void testScope(){ for (int i = 0; i \u0026lt; 10; i++) { DeptController deptController = applicationContext.getBean(DeptController.class); System.out.println(deptController); } } } é‡å¯SpringBootæœåŠ¡ï¼Œè¿è¡Œæµ‹è¯•æ–¹æ³•ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ‰“å°çš„æ—¥å¿—ï¼š\næ³¨æ„äº‹é¡¹ï¼š\nIOCå®¹å™¨ä¸­çš„beané»˜è®¤ä½¿ç”¨çš„ä½œç”¨åŸŸï¼šsingleton (å•ä¾‹) é»˜è®¤singletonçš„beanï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œå¯ä»¥ä½¿ç”¨@Lazyæ³¨è§£æ¥å»¶è¿Ÿåˆå§‹åŒ–(å»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶) 2). æµ‹è¯•äºŒ\nä¿®æ”¹æ§åˆ¶å™¨DeptControllerä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Scope(\u0026#34;prototype\u0026#34;) //beanä½œç”¨åŸŸä¸ºéå•ä¾‹ @Lazy //å»¶è¿ŸåŠ è½½ @RestController @RequestMapping(\u0026#34;/depts\u0026#34;) public class DeptController { @Autowired private DeptService deptService; public DeptController(){ System.out.println(\u0026#34;DeptController constructor ....\u0026#34;); } //çœç•¥å…¶ä»–ä»£ç ... } é‡å¯SpringBootæœåŠ¡ï¼Œå†æ¬¡æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼ŒæŸ¥çœ‹æ§åˆ¶å§æ‰“å°çš„æ—¥å¿—ï¼š\næ³¨æ„äº‹é¡¹ï¼š\nprototypeçš„beanï¼Œæ¯ä¸€æ¬¡ä½¿ç”¨è¯¥beançš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ å®é™…å¼€å‘å½“ä¸­ï¼Œç»å¤§éƒ¨åˆ†çš„Beanæ˜¯å•ä¾‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç»å¤§éƒ¨åˆ†Beanä¸éœ€è¦é…ç½®scopeå±æ€§ beançš„ç®¡ç†-ç¬¬ä¸‰æ–¹bean å­¦ä¹ å®Œbeançš„è·å–ã€beançš„ä½œç”¨åŸŸä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥å­¦ä¹ ç¬¬ä¸‰æ–¹beançš„é…ç½®ã€‚\nä¹‹å‰æˆ‘ä»¬æ‰€é…ç½®çš„beanï¼Œåƒcontrollerã€serviceï¼Œdaoä¸‰å±‚ä½“ç³»ä¸‹ç¼–å†™çš„ç±»ï¼Œè¿™äº›ç±»éƒ½æ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®å½“ä¸­è‡ªå·±å®šä¹‰çš„ç±»(è‡ªå®šä¹‰ç±»)ã€‚å½“æˆ‘ä»¬è¦å£°æ˜è¿™äº›beanï¼Œä¹Ÿéå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç±»ä¸ŠåŠ ä¸Š@Componentä»¥åŠå®ƒçš„è¿™ä¸‰ä¸ªè¡ç”Ÿæ³¨è§£ï¼ˆ@Controllerã€@Serviceã€@Repositoryï¼‰ï¼Œå°±å¯ä»¥æ¥å£°æ˜è¿™ä¸ªbeanå¯¹è±¡äº†ã€‚ ä½†æ˜¯åœ¨æˆ‘ä»¬é¡¹ç›®å¼€å‘å½“ä¸­ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯è¿™ä¸ªç±»å®ƒä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ï¼Œè€Œæ˜¯æˆ‘ä»¬å¼•å…¥çš„ç¬¬ä¸‰æ–¹ä¾èµ–å½“ä¸­æä¾›çš„ã€‚\nåœ¨pom.xmlæ–‡ä»¶ä¸­ï¼Œå¼•å…¥dom4jï¼š\n1 2 3 4 5 6 \u0026lt;!--Dom4j--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.dom4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dom4j\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.1.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; dom4jå°±æ˜¯ç¬¬ä¸‰æ–¹ç»„ç»‡æä¾›çš„ã€‚ dom4jä¸­çš„SAXReaderç±»å°±æ˜¯ç¬¬ä¸‰æ–¹ç¼–å†™çš„ã€‚\nå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°SAXReaderå¯¹è±¡æ—¶ï¼Œç›´æ¥è¿›è¡Œä¾èµ–æ³¨å…¥æ˜¯ä¸æ˜¯å°±å¯ä»¥äº†å‘¢ï¼Ÿ\næŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„åšæ³•ï¼Œéœ€è¦åœ¨SAXReaderç±»ä¸Šæ·»åŠ ä¸€ä¸ªæ³¨è§£@Componentï¼ˆå°†å½“å‰ç±»äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼‰ ç»“è®ºï¼šç¬¬ä¸‰æ–¹æä¾›çš„ç±»æ˜¯åªè¯»çš„ã€‚æ— æ³•åœ¨ç¬¬ä¸‰æ–¹ç±»ä¸Šæ·»åŠ @Componentæ³¨è§£æˆ–è¡ç”Ÿæ³¨è§£ã€‚\né‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€æ ·ä½¿ç”¨å¹¶å®šä¹‰ç¬¬ä¸‰æ–¹çš„beanå‘¢ï¼Ÿ\nå¦‚æœè¦ç®¡ç†çš„beanå¯¹è±¡æ¥è‡ªäºç¬¬ä¸‰æ–¹ï¼ˆä¸æ˜¯è‡ªå®šä¹‰çš„ï¼‰ï¼Œæ˜¯æ— æ³•ç”¨@Component åŠè¡ç”Ÿæ³¨è§£å£°æ˜beançš„ï¼Œå°±éœ€è¦ç”¨åˆ°**@Bean**æ³¨è§£ã€‚ è§£å†³æ–¹æ¡ˆ1ï¼šåœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ @Beanæ ‡è¯†çš„æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 @SpringBootApplication public class SpringbootWebConfig2Application { public static void main(String[] args) { SpringApplication.run(SpringbootWebConfig2Application.class, args); } //å£°æ˜ç¬¬ä¸‰æ–¹bean @Bean //å°†å½“å‰æ–¹æ³•çš„è¿”å›å€¼å¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†, æˆä¸ºIOCå®¹å™¨bean public SAXReader saxReader(){ return new SAXReader(); } } xmlæ–‡ä»¶ï¼š\n1 2 3 4 5 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;emp\u0026gt; \u0026lt;name\u0026gt;Tom\u0026lt;/name\u0026gt; \u0026lt;age\u0026gt;18\u0026lt;/age\u0026gt; \u0026lt;/emp\u0026gt; æµ‹è¯•ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @SpringBootTest class SpringbootWebConfig2ApplicationTests { @Autowired private SAXReader saxReader; //ç¬¬ä¸‰æ–¹beançš„ç®¡ç† @Test public void testThirdBean() throws Exception { Document document = saxReader.read(this.getClass().getClassLoader().getResource(\u0026#34;1.xml\u0026#34;)); Element rootElement = document.getRootElement(); String name = rootElement.element(\u0026#34;name\u0026#34;).getText(); String age = rootElement.element(\u0026#34;age\u0026#34;).getText(); System.out.println(name + \u0026#34; : \u0026#34; + age); } //çœç•¥å…¶ä»–ä»£ç ... } é‡å¯SpringBootæœåŠ¡ï¼Œæ‰§è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæ§åˆ¶å°è¾“å‡ºæ—¥å¿—ï¼š\n1 Tom : 18 è¯´æ˜ï¼šä»¥ä¸Šåœ¨å¯åŠ¨ç±»ä¸­å£°æ˜ç¬¬ä¸‰æ–¹Beançš„ä½œæ³•ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼ˆé¡¹ç›®ä¸­è¦ä¿è¯å¯åŠ¨ç±»çš„çº¯ç²¹æ€§ï¼‰\nè§£å†³æ–¹æ¡ˆ2ï¼šåœ¨é…ç½®ç±»ä¸­å®šä¹‰@Beanæ ‡è¯†çš„æ–¹æ³•\nå¦‚æœéœ€è¦å®šä¹‰ç¬¬ä¸‰æ–¹Beanæ—¶ï¼Œ é€šå¸¸ä¼šå•ç‹¬å®šä¹‰ä¸€ä¸ªé…ç½®ç±» 1 2 3 4 5 6 7 8 9 10 11 12 @Configuration //é…ç½®ç±» (åœ¨é…ç½®ç±»å½“ä¸­å¯¹ç¬¬ä¸‰æ–¹beanè¿›è¡Œé›†ä¸­çš„é…ç½®ç®¡ç†) public class CommonConfig { //å£°æ˜ç¬¬ä¸‰æ–¹bean @Bean //å°†å½“å‰æ–¹æ³•çš„è¿”å›å€¼å¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†, æˆä¸ºIOCå®¹å™¨bean //é€šè¿‡@Beanæ³¨è§£çš„name/valueå±æ€§æŒ‡å®šbeanåç§°, å¦‚æœæœªæŒ‡å®š, é»˜è®¤æ˜¯æ–¹æ³•å public SAXReader reader(DeptService deptService){ System.out.println(deptService); return new SAXReader(); } } æ³¨é‡Šæ‰SpringBootå¯åŠ¨ç±»ä¸­åˆ›å»ºç¬¬ä¸‰æ–¹beanå¯¹è±¡çš„ä»£ç ï¼Œé‡å¯æœåŠ¡ï¼Œæ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š\n1 Tom : 18 åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šä¸€ä¸ª@Beanæ³¨è§£ï¼ŒSpring å®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨çš„è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å°†æ–¹æ³•çš„è¿”å›å€¼å£°æ˜ä¸ºSpringå®¹å™¨å½“ä¸­çš„Beanå¯¹è±¡ã€‚\næ³¨æ„äº‹é¡¹ ï¼š\né€šè¿‡@Beanæ³¨è§£çš„nameæˆ–valueå±æ€§å¯ä»¥å£°æ˜beançš„åç§°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤beançš„åç§°å°±æ˜¯æ–¹æ³•åã€‚ å¦‚æœç¬¬ä¸‰æ–¹beanéœ€è¦ä¾èµ–å…¶å®ƒbeanå¯¹è±¡ï¼Œç›´æ¥åœ¨beanå®šä¹‰æ–¹æ³•ä¸­è®¾ç½®å½¢å‚å³å¯ï¼Œå®¹å™¨ä¼šæ ¹æ®ç±»å‹è‡ªåŠ¨è£…é…ã€‚ å…³äºBeanå¤§å®¶åªéœ€è¦ä¿æŒä¸€ä¸ªåŸåˆ™ï¼š\nå¦‚æœæ˜¯åœ¨é¡¹ç›®å½“ä¸­æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»ï¼Œæƒ³å°†è¿™äº›ç±»äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨@Componentä»¥åŠå®ƒçš„è¡ç”Ÿæ³¨è§£æ¥å£°æ˜å°±å¯ä»¥ã€‚ å¦‚æœè¿™ä¸ªç±»å®ƒä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ï¼Œè€Œæ˜¯å¼•å…¥çš„ç¬¬ä¸‰æ–¹ä¾èµ–å½“ä¸­æä¾›çš„ç±»ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜æƒ³å°†è¿™ä¸ªç±»äº¤ç»™IOCå®¹å™¨ç®¡ç†ã€‚æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨é…ç½®ç±»ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šä¸€ä¸ª@Beanæ³¨è§£ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥å£°æ˜ç¬¬ä¸‰æ–¹çš„beanå¯¹è±¡ã€‚ SpringBootåŸç†-èµ·æ­¥ä¾èµ– ç»è¿‡å‰é¢10å¤šå¤©è¯¾ç¨‹çš„å­¦ä¹ ï¼Œå¤§å®¶ä¹Ÿä¼šå‘ç°åŸºäºSpringBootè¿›è¡Œwebç¨‹åºçš„å¼€å‘æ˜¯éå¸¸ç®€å•ã€éå¸¸é«˜æ•ˆçš„ã€‚\nSpringBootä½¿æˆ‘ä»¬èƒ½å¤Ÿé›†ä¸­ç²¾åŠ›åœ°å»å…³æ³¨ä¸šåŠ¡åŠŸèƒ½çš„å¼€å‘ï¼Œè€Œä¸ç”¨è¿‡å¤šåœ°å…³æ³¨æ¡†æ¶æœ¬èº«çš„é…ç½®ä½¿ç”¨ã€‚è€Œæˆ‘ä»¬å‰é¢æ‰€è®²è§£çš„éƒ½æ˜¯é¢å‘åº”ç”¨å±‚é¢çš„æŠ€æœ¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å­¦ä¹ SpringBootçš„åŸç†ï¼Œè¿™éƒ¨åˆ†å†…å®¹åå‘äºåº•å±‚çš„åŸç†åˆ†æã€‚\nåœ¨å‰–æSpringBootçš„åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å¿«é€Ÿå›é¡¾ä¸€ä¸‹æˆ‘ä»¬å‰é¢æ‰€è®²è§£çš„Springå®¶æ—çš„æ¡†æ¶ã€‚\nSpringæ˜¯ç›®å‰ä¸–ç•Œä¸Šæœ€æµè¡Œçš„Javaæ¡†æ¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´åŠ å¿«é€Ÿã€æ›´åŠ å®¹æ˜“çš„æ¥æ„å»ºJavaé¡¹ç›®ã€‚è€Œåœ¨Springå®¶æ—å½“ä¸­æä¾›äº†å¾ˆå¤šä¼˜ç§€çš„æ¡†æ¶ï¼Œè€Œæ‰€æœ‰çš„æ¡†æ¶éƒ½æ˜¯åŸºäºä¸€ä¸ªåŸºç¡€æ¡†æ¶çš„SpringFramework(ä¹Ÿå°±æ˜¯Springæ¡†æ¶)ã€‚è€Œå‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥åŸºäºSpringæ¡†æ¶è¿›è¡Œé¡¹ç›®çš„å¼€å‘ï¼Œä¼šæ¯”è¾ƒç¹çã€‚\nè¿™ä¸ªç¹çä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼š\nåœ¨pom.xmlä¸­ä¾èµ–é…ç½®æ¯”è¾ƒç¹çï¼Œåœ¨é¡¹ç›®å¼€å‘æ—¶ï¼Œéœ€è¦è‡ªå·±å»æ‰¾åˆ°å¯¹åº”çš„ä¾èµ–ï¼Œè¿˜éœ€è¦æ‰¾åˆ°ä¾èµ–å®ƒæ‰€é…å¥—çš„ä¾èµ–ä»¥åŠå¯¹åº”ç‰ˆæœ¬ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚ åœ¨ä½¿ç”¨Springæ¡†æ¶è¿›è¡Œé¡¹ç›®å¼€å‘æ—¶ï¼Œéœ€è¦åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­åšå¤§é‡çš„é…ç½®ï¼Œè¿™å°±é€ æˆSpringæ¡†æ¶å…¥é—¨éš¾åº¦è¾ƒå¤§ï¼Œå­¦ä¹ æˆæœ¬è¾ƒé«˜ã€‚ åŸºäºSpringå­˜åœ¨çš„é—®é¢˜ï¼Œå®˜æ–¹åœ¨Springæ¡†æ¶4.0ç‰ˆæœ¬ä¹‹åï¼Œåˆæ¨å‡ºäº†ä¸€ä¸ªå…¨æ–°çš„æ¡†æ¶ï¼šSpringBootã€‚\né€šè¿‡ SpringBootæ¥ç®€åŒ–Springæ¡†æ¶çš„å¼€å‘(æ˜¯ç®€åŒ–ä¸æ˜¯æ›¿ä»£)ã€‚æˆ‘ä»¬ç›´æ¥åŸºäºSpringBootæ¥æ„å»ºJavaé¡¹ç›®ï¼Œä¼šè®©æˆ‘ä»¬çš„é¡¹ç›®å¼€å‘æ›´åŠ ç®€å•ï¼Œæ›´åŠ å¿«æ·ã€‚\nSpringBootæ¡†æ¶ä¹‹æ‰€ä»¥ä½¿ç”¨èµ·æ¥æ›´ç®€å•æ›´å¿«æ·ï¼Œæ˜¯å› ä¸ºSpringBootæ¡†æ¶åº•å±‚æä¾›äº†ä¸¤ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ï¼šä¸€ä¸ªæ˜¯èµ·æ­¥ä¾èµ–ï¼Œä¸€ä¸ªæ˜¯è‡ªåŠ¨é…ç½®ã€‚\né€šè¿‡SpringBootæ‰€æä¾›çš„èµ·æ­¥ä¾èµ–ï¼Œå°±å¯ä»¥å¤§å¤§çš„ç®€åŒ–pomæ–‡ä»¶å½“ä¸­ä¾èµ–çš„é…ç½®ï¼Œä»è€Œè§£å†³äº†Springæ¡†æ¶å½“ä¸­ä¾èµ–é…ç½®ç¹ççš„é—®é¢˜ã€‚\né€šè¿‡è‡ªåŠ¨é…ç½®çš„åŠŸèƒ½å°±å¯ä»¥å¤§å¤§çš„ç®€åŒ–æ¡†æ¶åœ¨ä½¿ç”¨æ—¶beançš„å£°æ˜ä»¥åŠbeançš„é…ç½®ã€‚æˆ‘ä»¬åªéœ€è¦å¼•å…¥ç¨‹åºå¼€å‘æ—¶æ‰€éœ€è¦çš„èµ·æ­¥ä¾èµ–ï¼Œé¡¹ç›®å¼€å‘æ—¶æ‰€ç”¨åˆ°å¸¸è§çš„é…ç½®éƒ½å·²ç»æœ‰äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ã€‚\nç®€å•å›é¡¾ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å­¦ä¹ ä¸‹SpringBootçš„åŸç†ã€‚å…¶å®å­¦ä¹ SpringBootçš„åŸç†å°±æ˜¯æ¥è§£æSpringBootå½“ä¸­çš„èµ·æ­¥ä¾èµ–ä¸è‡ªåŠ¨é…ç½®çš„åŸç†ã€‚æˆ‘ä»¬é¦–å…ˆæ¥å­¦ä¹ SpringBootå½“ä¸­èµ·æ­¥ä¾èµ–çš„åŸç†ã€‚\nèµ·æ­¥ä¾èµ–\nå‡å¦‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨SpringBootï¼Œç”¨çš„æ˜¯Springæ¡†æ¶è¿›è¡Œwebç¨‹åºçš„å¼€å‘ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦å¼•å…¥webç¨‹åºå¼€å‘æ‰€éœ€è¦çš„ä¸€äº›ä¾èµ–ã€‚\nspring-webmvcä¾èµ–ï¼šè¿™æ˜¯Springæ¡†æ¶è¿›è¡Œwebç¨‹åºå¼€å‘æ‰€éœ€è¦çš„ä¾èµ–\nservlet-apiä¾èµ–ï¼šServletåŸºç¡€ä¾èµ–\njackson-databindä¾èµ–ï¼šJSONå¤„ç†å·¥å…·åŒ…\nå¦‚æœè¦ä½¿ç”¨AOPï¼Œè¿˜éœ€è¦å¼•å…¥aopä¾èµ–ã€aspectä¾èµ–\né¡¹ç›®ä¸­æ‰€å¼•å…¥çš„è¿™äº›ä¾èµ–ï¼Œè¿˜éœ€è¦ä¿è¯ç‰ˆæœ¬åŒ¹é…ï¼Œå¦åˆ™å°±å¯èƒ½ä¼šå‡ºç°ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†SpringBootï¼Œå°±ä¸éœ€è¦åƒä¸Šé¢è¿™ä¹ˆç¹ççš„å¼•å…¥ä¾èµ–äº†ã€‚æˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¸€ä¸ªä¾èµ–å°±å¯ä»¥äº†ï¼Œé‚£å°±æ˜¯webå¼€å‘çš„èµ·æ­¥ä¾èµ–ï¼šspringboot-starter-webã€‚\nä¸ºä»€ä¹ˆæˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¸€ä¸ªwebå¼€å‘çš„èµ·æ­¥ä¾èµ–ï¼Œwebå¼€å‘æ‰€éœ€è¦çš„æ‰€æœ‰çš„ä¾èµ–éƒ½æœ‰äº†å‘¢ï¼Ÿ\nå› ä¸ºMavençš„ä¾èµ–ä¼ é€’ã€‚ åœ¨SpringBootç»™æˆ‘ä»¬æä¾›çš„è¿™äº›èµ·æ­¥ä¾èµ–å½“ä¸­ï¼Œå·²æä¾›äº†å½“å‰ç¨‹åºå¼€å‘æ‰€éœ€è¦çš„æ‰€æœ‰çš„å¸¸è§ä¾èµ–(å®˜ç½‘åœ°å€ï¼šhttps://docs.spring.io/spring-boot/docs/2.7.7/reference/htmlsingle/#using.build-systems.starters)ã€‚ æ¯”å¦‚ï¼šspringboot-starter-webï¼Œè¿™æ˜¯webå¼€å‘çš„èµ·æ­¥ä¾èµ–ï¼Œåœ¨webå¼€å‘çš„èµ·æ­¥ä¾èµ–å½“ä¸­ï¼Œå°±é›†æˆäº†webå¼€å‘ä¸­å¸¸è§çš„ä¾èµ–ï¼šjsonã€webã€webmvcã€tomcatç­‰ã€‚æˆ‘ä»¬åªéœ€è¦å¼•å…¥è¿™ä¸€ä¸ªèµ·æ­¥ä¾èµ–ï¼Œå…¶ä»–çš„ä¾èµ–éƒ½ä¼šè‡ªåŠ¨çš„é€šè¿‡Mavençš„ä¾èµ–ä¼ é€’è¿›æ¥ã€‚ ç»“è®ºï¼šèµ·æ­¥ä¾èµ–çš„åŸç†å°±æ˜¯Mavençš„ä¾èµ–ä¼ é€’ã€‚\nSpringBootåŸç†-è‡ªåŠ¨é…ç½®-æ¦‚è¿° è‡ªåŠ¨é…ç½®\næˆ‘ä»¬è®²è§£äº†SpringBootå½“ä¸­èµ·æ­¥ä¾èµ–çš„åŸç†ï¼Œå°±æ˜¯Mavençš„ä¾èµ–ä¼ é€’ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è§£æä¸‹è‡ªåŠ¨é…ç½®çš„åŸç†ï¼Œæˆ‘ä»¬è¦åˆ†æè‡ªåŠ¨é…ç½®çš„åŸç†ï¼Œé¦–å…ˆè¦çŸ¥é“ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®ã€‚\nSpringBootçš„è‡ªåŠ¨é…ç½®å°±æ˜¯å½“Springå®¹å™¨å¯åŠ¨åï¼Œä¸€äº›é…ç½®ç±»ã€beanå¯¹è±¡å°±è‡ªåŠ¨å­˜å…¥åˆ°äº†IOCå®¹å™¨ä¸­ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å£°æ˜ï¼Œä»è€Œç®€åŒ–äº†å¼€å‘ï¼Œçœå»äº†ç¹ççš„é…ç½®æ“ä½œã€‚\næ¯”å¦‚ï¼šæˆ‘ä»¬è¦è¿›è¡Œäº‹åŠ¡ç®¡ç†ã€è¦è¿›è¡ŒAOPç¨‹åºçš„å¼€å‘ï¼Œæ­¤æ—¶å°±ä¸éœ€è¦æˆ‘ä»¬å†å»æ‰‹åŠ¨çš„å£°æ˜è¿™äº›beanå¯¹è±¡äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å°±å¯ä»¥ä»è€Œå¤§å¤§çš„ç®€åŒ–ç¨‹åºçš„å¼€å‘ï¼Œçœå»äº†ç¹ççš„é…ç½®æ“ä½œã€‚\nä¸‹é¢æˆ‘ä»¬æ‰“å¼€ideaï¼Œä¸€èµ·æ¥çœ‹ä¸‹è‡ªåŠ¨é…ç½®çš„æ•ˆæœï¼š\nè¿è¡ŒSpringBootå¯åŠ¨ç±» å¤§å®¶ä¼šçœ‹åˆ°æœ‰ä¸¤ä¸ªCommonConfigï¼Œåœ¨ç¬¬ä¸€ä¸ªCommonConfigç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªbeanå¯¹è±¡ï¼Œbeanå¯¹è±¡çš„åå­—å«readerã€‚\nåœ¨ç¬¬äºŒä¸ªCommonConfigä¸­å®ƒçš„beanåå­—å«commonConfigï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰è¿™æ ·ä¸€ä¸ªbeanå¯¹è±¡å‘¢ï¼ŸåŸå› æ˜¯åœ¨CommonConfigé…ç½®ç±»ä¸Šæ·»åŠ äº†ä¸€ä¸ªæ³¨è§£@Configurationï¼Œè€Œ@Configurationåº•å±‚å°±æ˜¯@Component\næ‰€ä»¥é…ç½®ç±»æœ€ç»ˆä¹Ÿæ˜¯SpringIOCå®¹å™¨å½“ä¸­çš„ä¸€ä¸ªbeanå¯¹è±¡\nåœ¨IOCå®¹å™¨ä¸­é™¤äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„beanä»¥å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šé…ç½®ç±»ï¼Œè¿™äº›é…ç½®ç±»éƒ½æ˜¯SpringBootåœ¨å¯åŠ¨çš„æ—¶å€™åŠ è½½è¿›æ¥çš„é…ç½®ç±»ã€‚è¿™äº›é…ç½®ç±»åŠ è½½è¿›æ¥ä¹‹åï¼Œå®ƒä¹Ÿä¼šç”Ÿæˆå¾ˆå¤šçš„beanå¯¹è±¡ã€‚\næ¯”å¦‚ï¼šé…ç½®ç±»GsonAutoConfigurationé‡Œé¢æœ‰ä¸€ä¸ªbeanï¼Œbeançš„åå­—å«gsonï¼Œå®ƒçš„ç±»å‹æ˜¯Gsonã€‚\ncom.google.gson.Gsonæ˜¯è°·æ­ŒåŒ…ä¸­æä¾›çš„ç”¨æ¥å¤„ç†JSONæ ¼å¼æ•°æ®çš„ã€‚\nå½“æˆ‘ä»¬æƒ³è¦ä½¿ç”¨è¿™äº›é…ç½®ç±»ä¸­ç”Ÿæˆçš„beanå¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨@Autowiredå°±è‡ªåŠ¨æ³¨å…¥äº†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import com.google.gson.Gson; import com.itheima.pojo.Result; import org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; @SpringBootTest public class AutoConfigurationTests { @Autowired private Gson gson; @Test public void testJson(){ String json = gson.toJson(Result.success()); System.out.println(json); } } æ·»åŠ æ–­ç‚¹ï¼Œä½¿ç”¨debugæ¨¡å¼è¿è¡Œæµ‹è¯•ç±»ç¨‹åºï¼š\né—®é¢˜ï¼šåœ¨å½“å‰é¡¹ç›®ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰å£°æ˜è°·æ­Œæä¾›çš„Gsonè¿™ä¹ˆä¸€ä¸ªbeanå¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬å´å¯ä»¥é€šè¿‡@Autowiredä»Springå®¹å™¨ä¸­æ³¨å…¥beanå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªbeanå¯¹è±¡æ€ä¹ˆæ¥çš„ï¼Ÿ\nç­”æ¡ˆï¼šSpringBooté¡¹ç›®åœ¨å¯åŠ¨æ—¶é€šè¿‡è‡ªåŠ¨é…ç½®å®Œæˆäº†beanå¯¹è±¡çš„åˆ›å»ºã€‚\nä½“éªŒäº†SpringBootçš„è‡ªåŠ¨é…ç½®äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥åˆ†æè‡ªåŠ¨é…ç½®çš„åŸç†ã€‚å…¶å®åˆ†æè‡ªåŠ¨é…ç½®åŸç†å°±æ˜¯æ¥è§£æåœ¨SpringBooté¡¹ç›®ä¸­ï¼Œåœ¨å¼•å…¥ä¾èµ–ä¹‹åæ˜¯å¦‚ä½•å°†ä¾èµ–jaråŒ…å½“ä¸­æ‰€å®šä¹‰çš„é…ç½®ç±»ä»¥åŠbeanåŠ è½½åˆ°SpringIOCå®¹å™¨ä¸­çš„ã€‚\nSpringBootåŸç†-è‡ªåŠ¨é…ç½®-æ–¹æ¡ˆ æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æ¥å‰–æè‡ªåŠ¨é…ç½®çš„åŸç†ã€‚è§£æè‡ªåŠ¨é…ç½®çš„åŸç†å°±æ˜¯åˆ†æåœ¨ SpringBooté¡¹ç›®å½“ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥å¯¹åº”çš„ä¾èµ–ä¹‹åï¼Œæ˜¯å¦‚ä½•å°†ä¾èµ–jaråŒ…å½“ä¸­æ‰€æä¾›çš„beanä»¥åŠé…ç½®ç±»ç›´æ¥åŠ è½½åˆ°å½“å‰é¡¹ç›®çš„SpringIOCå®¹å™¨å½“ä¸­çš„ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç›´æ¥é€šè¿‡ä»£ç æ¥åˆ†æè‡ªåŠ¨é…ç½®åŸç†ã€‚\nå‡†å¤‡å·¥ä½œï¼šåœ¨Ideaä¸­å¯¼å…¥\u0026quot;èµ„æ–™\\03. è‡ªåŠ¨é…ç½®åŸç†\u0026quot;ä¸‹çš„itheima-utilså·¥ç¨‹\n1ã€åœ¨SpringBooté¡¹ç›® spring-boot-web-config2 å·¥ç¨‹ä¸­ï¼Œé€šè¿‡åæ ‡å¼•å…¥itheima-utilsä¾èµ–\n1 2 3 4 5 6 @Component public class TokenParser { public void parse(){ System.out.println(\u0026#34;TokenParser ... parse ...\u0026#34;); } } 2ã€åœ¨æµ‹è¯•ç±»ä¸­ï¼Œæ·»åŠ æµ‹è¯•æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @SpringBootTest public class AutoConfigurationTests { @Autowired private ApplicationContext applicationContext; @Test public void testTokenParse(){ System.out.println(applicationContext.getBean(TokenParser.class)); } //çœç•¥å…¶ä»–ä»£ç ... } 3ã€æ‰§è¡Œæµ‹è¯•æ–¹æ³•\nå¼‚å¸¸ä¿¡æ¯æè¿°ï¼š æ²¡æœ‰com.example.TokenParseç±»å‹çš„bean\nè¯´æ˜ï¼šåœ¨Springå®¹å™¨ä¸­æ²¡æœ‰æ‰¾åˆ°com.example.TokenParseç±»å‹çš„beanå¯¹è±¡\næ€è€ƒï¼šå¼•å…¥è¿›æ¥çš„ç¬¬ä¸‰æ–¹ä¾èµ–å½“ä¸­çš„beanä»¥åŠé…ç½®ç±»ä¸ºä»€ä¹ˆæ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ\nåŸå› åœ¨æˆ‘ä»¬ä¹‹å‰è®²è§£IOCçš„æ—¶å€™æœ‰æåˆ°è¿‡ï¼Œåœ¨ç±»ä¸Šæ·»åŠ @Componentæ³¨è§£æ¥å£°æ˜beanå¯¹è±¡æ—¶ï¼Œè¿˜éœ€è¦ä¿è¯@Componentæ³¨è§£èƒ½è¢«Springçš„ç»„ä»¶æ‰«æåˆ°ã€‚ SpringBooté¡¹ç›®ä¸­çš„@SpringBootApplicationæ³¨è§£ï¼Œå…·æœ‰åŒ…æ‰«æçš„ä½œç”¨ï¼Œä½†æ˜¯å®ƒåªä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„å½“å‰åŒ…ä»¥åŠå­åŒ…ã€‚ å½“å‰åŒ…ï¼šcom.itheimaï¼Œ ç¬¬ä¸‰æ–¹ä¾èµ–ä¸­æä¾›çš„åŒ…ï¼šcom.exampleï¼ˆæ‰«æä¸åˆ°ï¼‰ é‚£ä¹ˆå¦‚ä½•è§£å†³ä»¥ä¸Šé—®é¢˜çš„å‘¢ï¼Ÿ\næ–¹æ¡ˆ1ï¼š@ComponentScan ç»„ä»¶æ‰«æ æ–¹æ¡ˆ2ï¼š@Import å¯¼å…¥ï¼ˆä½¿ç”¨@Importå¯¼å…¥çš„ç±»ä¼šè¢«SpringåŠ è½½åˆ°IOCå®¹å™¨ä¸­ï¼‰ æ–¹æ¡ˆä¸€\n@ComponentScanç»„ä»¶æ‰«æ\n1 2 3 4 5 6 7 @SpringBootApplication @ComponentScan({\u0026#34;com.itheima\u0026#34;,\u0026#34;com.example\u0026#34;}) //æŒ‡å®šè¦æ‰«æçš„åŒ… public class SpringbootWebConfig2Application { public static void main(String[] args) { SpringApplication.run(SpringbootWebConfig2Application.class, args); } } é‡æ–°æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°æ—¥å¿—è¾“å‡ºï¼š\nå¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœé‡‡ç”¨ä»¥ä¸Šè¿™ç§æ–¹å¼æ¥å®Œæˆè‡ªåŠ¨é…ç½®ï¼Œé‚£æˆ‘ä»¬è¿›è¡Œé¡¹ç›®å¼€å‘æ—¶ï¼Œå½“éœ€è¦å¼•å…¥å¤§é‡çš„ç¬¬ä¸‰æ–¹çš„ä¾èµ–ï¼Œå°±éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šé…ç½®Nå¤šè¦æ‰«æçš„åŒ…ï¼Œè¿™ç§æ–¹å¼ä¼šå¾ˆç¹çã€‚è€Œä¸”è¿™ç§å¤§é¢ç§¯çš„æ‰«ææ€§èƒ½ä¹Ÿæ¯”è¾ƒä½ã€‚\nç¼ºç‚¹ï¼š\nä½¿ç”¨ç¹ç æ€§èƒ½ä½ ç»“è®ºï¼šSpringBootä¸­å¹¶æ²¡æœ‰é‡‡ç”¨ä»¥ä¸Šè¿™ç§æ–¹æ¡ˆã€‚\næ–¹æ¡ˆäºŒ\n@Importå¯¼å…¥\nå¯¼å…¥å½¢å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š å¯¼å…¥æ™®é€šç±» å¯¼å…¥é…ç½®ç±» å¯¼å…¥ImportSelectoræ¥å£å®ç°ç±» 1). ä½¿ç”¨@Importå¯¼å…¥æ™®é€šç±»ï¼š\n1 2 3 4 5 6 7 @Import(TokenParser.class) //å¯¼å…¥çš„ç±»ä¼šè¢«SpringåŠ è½½åˆ°IOCå®¹å™¨ä¸­ @SpringBootApplication public class SpringbootWebConfig2Application { public static void main(String[] args) { SpringApplication.run(SpringbootWebConfig2Application.class, args); } } é‡æ–°æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°æ—¥å¿—è¾“å‡ºï¼š\n2). ä½¿ç”¨@Importå¯¼å…¥é…ç½®ç±»ï¼š\né…ç½®ç±» 1 2 3 4 5 6 7 8 9 10 11 12 @Configuration public class HeaderConfig { @Bean public HeaderParser headerParser(){ return new HeaderParser(); } @Bean public HeaderGenerator headerGenerator(){ return new HeaderGenerator(); } } å¯åŠ¨ç±» 1 2 3 4 5 6 7 @Import(HeaderConfig.class) //å¯¼å…¥é…ç½®ç±» @SpringBootApplication public class SpringbootWebConfig2Application { public static void main(String[] args) { SpringApplication.run(SpringbootWebConfig2Application.class, args); } } æµ‹è¯•ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @SpringBootTest public class AutoConfigurationTests { @Autowired private ApplicationContext applicationContext; @Test public void testHeaderParser(){ System.out.println(applicationContext.getBean(HeaderParser.class)); } @Test public void testHeaderGenerator(){ System.out.println(applicationContext.getBean(HeaderGenerator.class)); } //çœç•¥å…¶ä»–ä»£ç ... } æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼š\n3). ä½¿ç”¨@Importå¯¼å…¥ImportSelectoræ¥å£å®ç°ç±»ï¼š\nImportSelectoræ¥å£å®ç°ç±» 1 2 3 4 5 6 public class MyImportSelector implements ImportSelector { public String[] selectImports(AnnotationMetadata importingClassMetadata) { //è¿”å›å€¼å­—ç¬¦ä¸²æ•°ç»„ï¼ˆæ•°ç»„ä¸­å°è£…äº†å…¨é™å®šåç§°çš„ç±»ï¼‰ return new String[]{\u0026#34;com.example.HeaderConfig\u0026#34;}; } } å¯åŠ¨ç±» 1 2 3 4 5 6 7 8 @Import(MyImportSelector.class) //å¯¼å…¥ImportSelectoræ¥å£å®ç°ç±» @SpringBootApplication public class SpringbootWebConfig2Application { public static void main(String[] args) { SpringApplication.run(SpringbootWebConfig2Application.class, args); } } æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼š\næˆ‘ä»¬ä½¿ç”¨@Importæ³¨è§£é€šè¿‡è¿™ä¸‰ç§æ–¹å¼éƒ½å¯ä»¥å¯¼å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ä¸­æ‰€æä¾›çš„beanæˆ–è€…æ˜¯é…ç½®ç±»ã€‚\næ€è€ƒï¼šå¦‚æœåŸºäºä»¥ä¸Šæ–¹å¼å®Œæˆè‡ªåŠ¨é…ç½®ï¼Œå½“è¦å¼•å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹ä¾èµ–æ—¶ï¼Œæ˜¯ä¸æ˜¯è¿˜è¦çŸ¥é“ç¬¬ä¸‰æ–¹ä¾èµ–ä¸­æœ‰å“ªäº›é…ç½®ç±»å’Œå“ªäº›Beanå¯¹è±¡ï¼Ÿ\nç­”æ¡ˆï¼šæ˜¯çš„ã€‚ ï¼ˆå¯¹ç¨‹åºå‘˜æ¥è®²ï¼Œå¾ˆä¸å‹å¥½ï¼Œè€Œä¸”æ¯”è¾ƒç¹çï¼‰ æ€è€ƒï¼šå½“æˆ‘ä»¬è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä¾èµ–ä¸­åˆ°åº•æœ‰å“ªäº›beanå’Œé…ç½®ç±»ï¼Œè°æœ€æ¸…æ¥šï¼Ÿ\nç­”æ¡ˆï¼šç¬¬ä¸‰æ–¹ä¾èµ–è‡ªèº«æœ€æ¸…æ¥šã€‚ ç»“è®ºï¼šæˆ‘ä»¬ä¸ç”¨è‡ªå·±æŒ‡å®šè¦å¯¼å…¥å“ªäº›beanå¯¹è±¡å’Œé…ç½®ç±»äº†ï¼Œè®©ç¬¬ä¸‰æ–¹ä¾èµ–å®ƒè‡ªå·±æ¥æŒ‡å®šã€‚\næ€ä¹ˆè®©ç¬¬ä¸‰æ–¹ä¾èµ–è‡ªå·±æŒ‡å®šbeanå¯¹è±¡å’Œé…ç½®ç±»ï¼Ÿ\næ¯”è¾ƒå¸¸è§çš„æ–¹æ¡ˆå°±æ˜¯ç¬¬ä¸‰æ–¹ä¾èµ–ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£ä¸€èˆ¬éƒ½ä»¥@EnableXxxxå¼€å¤´çš„æ³¨è§£ï¼Œæ³¨è§£ä¸­å°è£…çš„å°±æ˜¯@Importæ³¨è§£ 4). ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–æä¾›çš„ @EnableXxxxxæ³¨è§£\nç¬¬ä¸‰æ–¹ä¾èµ–ä¸­æä¾›çš„æ³¨è§£ 1 2 3 4 5 @Retention(RetentionPolicy.RUNTIME) @Target(ElementType.TYPE) @Import(MyImportSelector.class)//æŒ‡å®šè¦å¯¼å…¥å“ªäº›beanå¯¹è±¡æˆ–é…ç½®ç±» public @interface EnableHeaderConfig { } åœ¨ä½¿ç”¨æ—¶åªéœ€åœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š@EnableXxxxxæ³¨è§£å³å¯ 1 2 3 4 5 6 7 @EnableHeaderConfig //ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–æä¾›çš„Enableå¼€å¤´çš„æ³¨è§£ @SpringBootApplication public class SpringbootWebConfig2Application { public static void main(String[] args) { SpringApplication.run(SpringbootWebConfig2Application.class, args); } } æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼š\nä»¥ä¸Šå››ç§æ–¹å¼éƒ½å¯ä»¥å®Œæˆå¯¼å…¥æ“ä½œï¼Œä½†æ˜¯ç¬¬4ç§æ–¹å¼ä¼šæ›´æ–¹ä¾¿æ›´ä¼˜é›…ï¼Œè€Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯SpringBootå½“ä¸­æ‰€é‡‡ç”¨çš„æ–¹å¼ã€‚\nSpringBootåŸç†-è‡ªåŠ¨é…ç½®-åŸç†åˆ†æ-æºç è·Ÿè¸ª å‰é¢æˆ‘ä»¬è®²è§£äº†åœ¨é¡¹ç›®å½“ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ä¹‹åï¼Œå¦‚ä½•åŠ è½½ç¬¬ä¸‰æ–¹ä¾èµ–ä¸­å®šä¹‰å¥½çš„beanå¯¹è±¡ä»¥åŠé…ç½®ç±»ï¼Œä»è€Œå®Œæˆè‡ªåŠ¨é…ç½®æ“ä½œã€‚é‚£ä¸‹é¢æˆ‘ä»¬é€šè¿‡æºç è·Ÿè¸ªçš„å½¢å¼æ¥å‰–æä¸‹SpringBootåº•å±‚åˆ°åº•æ˜¯å¦‚ä½•å®Œæˆè‡ªåŠ¨é…ç½®çš„ã€‚\næºç è·Ÿè¸ªæŠ€å·§ï¼š\nåœ¨è·Ÿè¸ªæ¡†æ¶æºç çš„æ—¶å€™ï¼Œä¸€å®šè¦æŠ“ä½å…³é”®ç‚¹ï¼Œæ‰¾åˆ°æ ¸å¿ƒæµç¨‹ã€‚ä¸€å®šä¸è¦ä»å¤´åˆ°å°¾ä¸€è¡Œä»£ç å»çœ‹ï¼Œä¸€ä¸ªæ–¹æ³•çš„å»ç ”ç©¶ï¼Œä¸€å®šè¦æ‰¾åˆ°å…³é”®æµç¨‹ï¼ŒæŠ“ä½å…³é”®ç‚¹ï¼Œå…ˆåœ¨å®è§‚ä¸Šå¯¹æ•´ä¸ªæµç¨‹æˆ–è€…æ•´ä¸ªåŸç†æœ‰ä¸€ä¸ªè®¤è¯†ï¼Œæœ‰ç²¾åŠ›å†å»ç ”ç©¶å…¶ä¸­çš„ç»†èŠ‚ã€‚\nè¦ææ¸…æ¥šSpringBootçš„è‡ªåŠ¨é…ç½®åŸç†ï¼Œè¦ä»SpringBootå¯åŠ¨ç±»ä¸Šä½¿ç”¨çš„æ ¸å¿ƒæ³¨è§£@SpringBootApplicationå¼€å§‹åˆ†æï¼š\nåœ¨@SpringBootApplicationæ³¨è§£ä¸­åŒ…å«äº†ï¼š\nå…ƒæ³¨è§£ï¼ˆä¸å†è§£é‡Šï¼‰ @SpringBootConfiguration @EnableAutoConfiguration @ComponentScan æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªæ³¨è§£ï¼š@SpringBootConfiguration\n@SpringBootConfigurationæ³¨è§£ä¸Šä½¿ç”¨äº†@Configurationï¼Œè¡¨æ˜SpringBootå¯åŠ¨ç±»å°±æ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚\n@Indexedæ³¨è§£ï¼Œæ˜¯ç”¨æ¥åŠ é€Ÿåº”ç”¨å¯åŠ¨çš„ï¼ˆä¸ç”¨å…³å¿ƒï¼‰ã€‚\næ¥ä¸‹æ¥å†å…ˆçœ‹@ComponentScanæ³¨è§£ï¼š\n@ComponentScanæ³¨è§£æ˜¯ç”¨æ¥è¿›è¡Œç»„ä»¶æ‰«æçš„ï¼Œæ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰è¢«@ComponentåŠå…¶è¡ç”Ÿæ³¨è§£å£°æ˜çš„ç±»ã€‚\nSpringBootå¯åŠ¨ç±»ï¼Œä¹‹æ‰€ä»¥å…·å¤‡æ‰«æåŒ…åŠŸèƒ½ï¼Œå°±æ˜¯å› ä¸ºåŒ…å«äº†@ComponentScanæ³¨è§£ã€‚\næœ€åæˆ‘ä»¬æ¥çœ‹çœ‹@EnableAutoConfigurationæ³¨è§£ï¼ˆè‡ªåŠ¨é…ç½®æ ¸å¿ƒæ³¨è§£ï¼‰ï¼š\nä½¿ç”¨@Importæ³¨è§£ï¼Œå¯¼å…¥äº†å®ç°ImportSelectoræ¥å£çš„å®ç°ç±»ã€‚\nAutoConfigurationImportSelectorç±»æ˜¯ImportSelectoræ¥å£çš„å®ç°ç±»ã€‚\nAutoConfigurationImportSelectorç±»ä¸­é‡å†™äº†ImportSelectoræ¥å£çš„selectImports()æ–¹æ³•ï¼š\nselectImports()æ–¹æ³•åº•å±‚è°ƒç”¨getAutoConfigurationEntry()æ–¹æ³•ï¼Œè·å–å¯è‡ªåŠ¨é…ç½®çš„é…ç½®ç±»ä¿¡æ¯é›†åˆ\ngetAutoConfigurationEntry()æ–¹æ³•é€šè¿‡è°ƒç”¨getCandidateConfigurations(annotationMetadata, attributes)æ–¹æ³•è·å–åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»çš„é›†åˆ\ngetCandidateConfigurationsæ–¹æ³•çš„åŠŸèƒ½ï¼š\nè·å–æ‰€æœ‰åŸºäºMETA-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.importsæ–‡ä»¶ã€META-INF/spring.factoriesæ–‡ä»¶ä¸­é…ç½®ç±»çš„é›†åˆ\nMETA-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.importsæ–‡ä»¶å’ŒMETA-INF/spring.factoriesæ–‡ä»¶è¿™ä¸¤ä¸ªæ–‡ä»¶åœ¨å“ªé‡Œå‘¢ï¼Ÿ\né€šå¸¸åœ¨å¼•å…¥çš„èµ·æ­¥ä¾èµ–ä¸­ï¼Œéƒ½æœ‰åŒ…å«ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶ åœ¨å‰é¢åœ¨ç»™å¤§å®¶æ¼”ç¤ºè‡ªåŠ¨é…ç½®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨æµ‹è¯•ç±»å½“ä¸­æ³¨å…¥äº†ä¸€ä¸ªå«gsonçš„beanå¯¹è±¡ï¼Œè¿›è¡ŒJSONæ ¼å¼è½¬æ¢ã€‚è™½ç„¶æˆ‘ä»¬æ²¡æœ‰é…ç½®beanå¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯å¯ä»¥ç›´æ¥æ³¨å…¥ä½¿ç”¨çš„ã€‚åŸå› å°±æ˜¯å› ä¸ºåœ¨è‡ªåŠ¨é…ç½®ç±»å½“ä¸­åšäº†è‡ªåŠ¨é…ç½®ã€‚åˆ°åº•æ˜¯åœ¨å“ªä¸ªè‡ªåŠ¨é…ç½®ç±»å½“ä¸­åšçš„è‡ªåŠ¨é…ç½®å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡æœç´¢æ¥æŸ¥è¯¢ä¸€ä¸‹ã€‚\nåœ¨META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.importsé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†ç¬¬ä¸‰æ–¹ä¾èµ–Gsonçš„é…ç½®ç±»ï¼šGsonAutoConfiguration\nç¬¬ä¸‰æ–¹ä¾èµ–ä¸­æä¾›çš„GsonAutoConfigurationç±»ï¼š\nåœ¨GsonAutoConfigurationç±»ä¸Šï¼Œæ·»åŠ äº†æ³¨è§£@AutoConfigurationï¼Œé€šè¿‡æŸ¥çœ‹æºç ï¼Œå¯ä»¥æ˜ç¡®ï¼šGsonAutoConfigurationç±»æ˜¯ä¸€ä¸ªé…ç½®ã€‚\nçœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶å°±åº”è¯¥æ˜ç™½ä¸ºä»€ä¹ˆå¯ä»¥å®Œæˆè‡ªåŠ¨é…ç½®äº†ï¼ŒåŸç†å°±æ˜¯åœ¨é…ç½®ç±»ä¸­å®šä¹‰ä¸€ä¸ª@Beanæ ‡è¯†çš„æ–¹æ³•ï¼Œè€ŒSpringä¼šè‡ªåŠ¨è°ƒç”¨é…ç½®ç±»ä¸­ä½¿ç”¨@Beanæ ‡è¯†çš„æ–¹æ³•ï¼Œå¹¶æŠŠæ–¹æ³•çš„è¿”å›å€¼æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚\nè‡ªåŠ¨é…ç½®æºç å°ç»“\nè‡ªåŠ¨é…ç½®åŸç†æºç å…¥å£å°±æ˜¯@SpringBootApplicationæ³¨è§£ï¼Œåœ¨è¿™ä¸ªæ³¨è§£ä¸­å°è£…äº†3ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯ï¼š\n@SpringBootConfiguration å£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±» @ComponentScan è¿›è¡Œç»„ä»¶æ‰«æï¼ˆSpringBootä¸­é»˜è®¤æ‰«æçš„æ˜¯å¯åŠ¨ç±»æ‰€åœ¨çš„å½“å‰åŒ…åŠå…¶å­åŒ…ï¼‰ @EnableAutoConfiguration å°è£…äº†@Importæ³¨è§£ï¼ˆImportæ³¨è§£ä¸­æŒ‡å®šäº†ä¸€ä¸ªImportSelectoræ¥å£çš„å®ç°ç±»ï¼‰ åœ¨å®ç°ç±»é‡å†™çš„selectImports()æ–¹æ³•ï¼Œè¯»å–å½“å‰é¡¹ç›®ä¸‹æ‰€æœ‰ä¾èµ–jaråŒ…ä¸­META-INF/spring.factoriesã€META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.importsä¸¤ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„é…ç½®ç±»ï¼ˆé…ç½®ç±»ä¸­å®šä¹‰äº†@Beanæ³¨è§£æ ‡è¯†çš„æ–¹æ³•ï¼‰ã€‚ å½“SpringBootç¨‹åºå¯åŠ¨æ—¶ï¼Œå°±ä¼šåŠ è½½é…ç½®æ–‡ä»¶å½“ä¸­æ‰€å®šä¹‰çš„é…ç½®ç±»ï¼Œå¹¶å°†è¿™äº›é…ç½®ç±»ä¿¡æ¯(ç±»çš„å…¨é™å®šå)å°è£…åˆ°Stringç±»å‹çš„æ•°ç»„ä¸­ï¼Œæœ€ç»ˆé€šè¿‡@Importæ³¨è§£å°†è¿™äº›é…ç½®ç±»å…¨éƒ¨åŠ è½½åˆ°Springçš„IOCå®¹å™¨ä¸­ï¼Œäº¤ç»™IOCå®¹å™¨ç®¡ç†ã€‚\næœ€åå‘¢ç»™å¤§å®¶æŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼šåœ¨META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.importsæ–‡ä»¶ä¸­å®šä¹‰çš„é…ç½®ç±»éå¸¸å¤šï¼Œè€Œä¸”æ¯ä¸ªé…ç½®ç±»ä¸­åˆå¯ä»¥å®šä¹‰å¾ˆå¤šçš„beanï¼Œé‚£è¿™äº›beanéƒ½ä¼šæ³¨å†Œåˆ°Springçš„IOCå®¹å™¨ä¸­å—ï¼Ÿ\nç­”æ¡ˆï¼šå¹¶ä¸æ˜¯ã€‚ åœ¨å£°æ˜beanå¯¹è±¡æ—¶ï¼Œä¸Šé¢æœ‰åŠ ä¸€ä¸ªä»¥@Conditionalå¼€å¤´çš„æ³¨è§£ï¼Œè¿™ç§æ³¨è§£çš„ä½œç”¨å°±æ˜¯æŒ‰ç…§æ¡ä»¶è¿›è¡Œè£…é…ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶ä¹‹åï¼Œæ‰ä¼šå°†beanæ³¨å†Œåˆ°Springçš„IOCå®¹å™¨ä¸­ï¼ˆä¸‹é¢ä¼šè¯¦ç»†æ¥è®²è§£ï¼‰\nSpringBootåŸç†-è‡ªåŠ¨é…ç½®-åŸç†åˆ†æ-@Conditional æˆ‘ä»¬åœ¨è·Ÿè¸ªSpringBootè‡ªåŠ¨é…ç½®çš„æºç çš„æ—¶å€™ï¼Œåœ¨è‡ªåŠ¨é…ç½®ç±»å£°æ˜beançš„æ—¶å€™ï¼Œé™¤äº†åœ¨æ–¹æ³•ä¸ŠåŠ äº†ä¸€ä¸ª@Beanæ³¨è§£ä»¥å¤–ï¼Œè¿˜ä¼šç»å¸¸ç”¨åˆ°ä¸€ä¸ªæ³¨è§£ï¼Œå°±æ˜¯ä»¥Conditionalå¼€å¤´çš„è¿™ä¸€ç±»çš„æ³¨è§£ã€‚ä»¥Conditionalå¼€å¤´çš„è¿™äº›æ³¨è§£éƒ½æ˜¯æ¡ä»¶è£…é…çš„æ³¨è§£ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸‹æ¡ä»¶è£…é…æ³¨è§£ã€‚\n@Conditionalæ³¨è§£ï¼š\nä½œç”¨ï¼šæŒ‰ç…§ä¸€å®šçš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨æ»¡è¶³ç»™å®šæ¡ä»¶åæ‰ä¼šæ³¨å†Œå¯¹åº”çš„beanå¯¹è±¡åˆ°Springçš„IOCå®¹å™¨ä¸­ã€‚ ä½ç½®ï¼šæ–¹æ³•ã€ç±» @Conditionalæœ¬èº«æ˜¯ä¸€ä¸ªçˆ¶æ³¨è§£ï¼Œæ´¾ç”Ÿå‡ºå¤§é‡çš„å­æ³¨è§£ï¼š @ConditionalOnClassï¼šåˆ¤æ–­ç¯å¢ƒä¸­æœ‰å¯¹åº”å­—èŠ‚ç æ–‡ä»¶ï¼Œæ‰æ³¨å†Œbeanåˆ°IOCå®¹å™¨ã€‚ @ConditionalOnMissingBeanï¼šåˆ¤æ–­ç¯å¢ƒä¸­æ²¡æœ‰å¯¹åº”çš„bean(ç±»å‹æˆ–åç§°)ï¼Œæ‰æ³¨å†Œbeanåˆ°IOCå®¹å™¨ã€‚ @ConditionalOnPropertyï¼šåˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æœ‰å¯¹åº”å±æ€§å’Œå€¼ï¼Œæ‰æ³¨å†Œbeanåˆ°IOCå®¹å™¨ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¥æ¼”ç¤ºä¸‹Conditionalæ³¨è§£çš„ä½¿ç”¨ï¼š\n@ConditionalOnClassæ³¨è§£ 1 2 3 4 5 6 7 8 9 10 11 @Configuration public class HeaderConfig { @Bean @ConditionalOnClass(name=\u0026#34;io.jsonwebtoken.Jwts\u0026#34;)//ç¯å¢ƒä¸­å­˜åœ¨æŒ‡å®šçš„è¿™ä¸ªç±»ï¼Œæ‰ä¼šå°†è¯¥beanåŠ å…¥IOCå®¹å™¨ public HeaderParser headerParser(){ return new HeaderParser(); } //çœç•¥å…¶ä»–ä»£ç ... } pom.xml 1 2 3 4 5 6 \u0026lt;!--JWTä»¤ç‰Œ--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.9.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æµ‹è¯•ç±» 1 2 3 4 5 6 7 8 9 10 11 12 @SpringBootTest public class AutoConfigurationTests { @Autowired private ApplicationContext applicationContext; @Test public void testHeaderParser(){ System.out.println(applicationContext.getBean(HeaderParser.class)); } //çœç•¥å…¶ä»–ä»£ç ... } æ‰§è¡ŒtestHeaderParser()æµ‹è¯•æ–¹æ³•ï¼š\nå› ä¸ºio.jsonwebtoken.Jwtså­—èŠ‚ç æ–‡ä»¶åœ¨å¯åŠ¨SpringBootç¨‹åºæ—¶å·²å­˜åœ¨ï¼Œæ‰€ä»¥åˆ›å»ºHeaderParserå¯¹è±¡å¹¶æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚\n@ConditionalOnMissingBeanæ³¨è§£ 1 2 3 4 5 6 7 8 9 10 11 @Configuration public class HeaderConfig { @Bean @ConditionalOnMissingBean //ä¸å­˜åœ¨è¯¥ç±»å‹çš„beanï¼Œæ‰ä¼šå°†è¯¥beanåŠ å…¥IOCå®¹å™¨ public HeaderParser headerParser(){ return new HeaderParser(); } //çœç•¥å…¶ä»–ä»£ç ... } æ‰§è¡ŒtestHeaderParser()æµ‹è¯•æ–¹æ³•ï¼š\nSpringBootåœ¨è°ƒç”¨@Beanæ ‡è¯†çš„headerParser()å‰ï¼ŒIOCå®¹å™¨ä¸­æ˜¯æ²¡æœ‰HeaderParserç±»å‹çš„beanï¼Œæ‰€ä»¥HeaderParserå¯¹è±¡æ­£å¸¸åˆ›å»ºï¼Œå¹¶æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚\nå†æ¬¡ä¿®æ”¹@ConditionalOnMissingBeanæ³¨è§£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 @Configuration public class HeaderConfig { @Bean @ConditionalOnMissingBean(name=\u0026#34;deptController2\u0026#34;)//ä¸å­˜åœ¨æŒ‡å®šåç§°çš„beanï¼Œæ‰ä¼šå°†è¯¥beanåŠ å…¥IOCå®¹å™¨ public HeaderParser headerParser(){ return new HeaderParser(); } //çœç•¥å…¶ä»–ä»£ç ... } æ‰§è¡ŒtestHeaderParser()æµ‹è¯•æ–¹æ³•ï¼š\nå› ä¸ºåœ¨SpringBootç¯å¢ƒä¸­ä¸å­˜åœ¨åå­—å«deptController2çš„beanå¯¹è±¡ï¼Œæ‰€ä»¥åˆ›å»ºHeaderParserå¯¹è±¡å¹¶æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚\nå†æ¬¡ä¿®æ”¹@ConditionalOnMissingBeanæ³¨è§£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 @Configuration public class HeaderConfig { @Bean @ConditionalOnMissingBean(HeaderConfig.class)//ä¸å­˜åœ¨æŒ‡å®šç±»å‹çš„beanï¼Œæ‰ä¼šå°†beanåŠ å…¥IOCå®¹å™¨ public HeaderParser headerParser(){ return new HeaderParser(); } //çœç•¥å…¶ä»–ä»£ç ... } 1 2 3 4 5 6 7 8 9 10 11 12 @SpringBootTest public class AutoConfigurationTests { @Autowired private ApplicationContext applicationContext; @Test public void testHeaderParser(){ System.out.println(applicationContext.getBean(HeaderParser.class)); } //çœç•¥å…¶ä»–ä»£ç ... } æ‰§è¡ŒtestHeaderParser()æµ‹è¯•æ–¹æ³•ï¼š\nå› ä¸ºHeaderConfigç±»ä¸­æ·»åŠ @Configurationæ³¨è§£ï¼Œè€Œ@Configurationæ³¨è§£ä¸­åŒ…å«äº†@Componentï¼Œæ‰€ä»¥SpringBootå¯åŠ¨æ—¶ä¼šåˆ›å»ºHeaderConfigç±»å¯¹è±¡ï¼Œå¹¶æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚\nå½“IOCå®¹å™¨ä¸­æœ‰HeaderConfigç±»å‹çš„beanå­˜åœ¨æ—¶ï¼Œä¸ä¼šæŠŠåˆ›å»ºHeaderParserå¯¹è±¡æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚è€ŒIOCå®¹å™¨ä¸­æ²¡æœ‰HeaderParserç±»å‹çš„å¯¹è±¡æ—¶ï¼Œé€šè¿‡getBean(HeaderParser.class)æ–¹æ³•è·å–beanå¯¹è±¡æ—¶ï¼Œå¼•å‘å¼‚å¸¸ï¼šNoSuchBeanDefinitionException\n@ConditionalOnPropertyæ³¨è§£ï¼ˆè¿™ä¸ªæ³¨è§£å’Œé…ç½®æ–‡ä»¶å½“ä¸­é…ç½®çš„å±æ€§æœ‰å…³ç³»ï¼‰ å…ˆåœ¨application.ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹çš„é”®å€¼å¯¹ï¼š\n1 name: itheima åœ¨å£°æ˜beançš„æ—¶å€™å°±å¯ä»¥æŒ‡å®šä¸€ä¸ªæ¡ä»¶@ConditionalOnProperty\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Configuration public class HeaderConfig { @Bean @ConditionalOnProperty(name =\u0026#34;name\u0026#34;,havingValue = \u0026#34;itheima\u0026#34;)//é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨æŒ‡å®šå±æ€§åä¸å€¼ï¼Œæ‰ä¼šå°†beanåŠ å…¥IOCå®¹å™¨ public HeaderParser headerParser(){ return new HeaderParser(); } @Bean public HeaderGenerator headerGenerator(){ return new HeaderGenerator(); } } æ‰§è¡ŒtestHeaderParser()æµ‹è¯•æ–¹æ³•ï¼š\nä¿®æ”¹@ConditionalOnPropertyæ³¨è§£ï¼š havingValueçš„å€¼ä¿®æ”¹ä¸º\u0026quot;itheima2\u0026quot;\n1 2 3 4 5 @Bean @ConditionalOnProperty(name =\u0026#34;name\u0026#34;,havingValue = \u0026#34;itheima2\u0026#34;)//é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨æŒ‡å®šå±æ€§åä¸å€¼ï¼Œæ‰ä¼šå°†beanåŠ å…¥IOCå®¹å™¨ public HeaderParser headerParser(){ return new HeaderParser(); } å†æ¬¡æ‰§è¡ŒtestHeaderParser()æµ‹è¯•æ–¹æ³•ï¼š\nå› ä¸ºapplication.ymlé…ç½®æ–‡ä»¶ä¸­ï¼Œä¸å­˜åœ¨ï¼š name: itheima2ï¼Œæ‰€ä»¥HeaderParserå¯¹è±¡åœ¨IOCå®¹å™¨ä¸­ä¸å­˜åœ¨\næˆ‘ä»¬å†å›å¤´çœ‹çœ‹ä¹‹å‰è®²è§£SpringBootæºç æ—¶æåˆ°çš„ä¸€ä¸ªé…ç½®ç±»ï¼šGsonAutoConfiguration\næœ€åå†ç»™å¤§å®¶æ¢³ç†ä¸€ä¸‹è‡ªåŠ¨é…ç½®åŸç†ï¼š\nè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒå°±åœ¨@SpringBootApplicationæ³¨è§£ä¸Šï¼ŒSpringBootApplicationè¿™ä¸ªæ³¨è§£åº•å±‚åŒ…å«äº†3ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯ï¼š\n@SpringBootConfiguration\n@ComponentScan\n@EnableAutoConfiguration\n@EnableAutoConfigurationè¿™ä¸ªæ³¨è§£æ‰æ˜¯è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒã€‚\nå®ƒå°è£…äº†ä¸€ä¸ª@Importæ³¨è§£ï¼ŒImportæ³¨è§£é‡Œé¢æŒ‡å®šäº†ä¸€ä¸ªImportSelectoræ¥å£çš„å®ç°ç±»ã€‚ åœ¨è¿™ä¸ªå®ç°ç±»ä¸­ï¼Œé‡å†™äº†ImportSelectoræ¥å£ä¸­çš„selectImports()æ–¹æ³•ã€‚ è€ŒselectImports()æ–¹æ³•ä¸­ä¼šå»è¯»å–ä¸¤ä»½é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„é…ç½®ç±»åšä¸ºselectImports()æ–¹æ³•çš„è¿”å›å€¼è¿”å›ï¼Œè¿”å›å€¼ä»£è¡¨çš„å°±æ˜¯éœ€è¦å°†å“ªäº›ç±»äº¤ç»™Springçš„IOCå®¹å™¨è¿›è¡Œç®¡ç†ã€‚ é‚£ä¹ˆæ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»çš„ä¸­å£°æ˜çš„beanéƒ½ä¼šåŠ è½½åˆ°Springçš„IOCå®¹å™¨ä¸­å—? å…¶å®å¹¶ä¸ä¼šï¼Œå› ä¸ºè¿™äº›é…ç½®ç±»ä¸­åœ¨å£°æ˜beanæ—¶ï¼Œé€šå¸¸éƒ½ä¼šæ·»åŠ @Conditionalå¼€å¤´çš„æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å°±æ˜¯è¿›è¡Œæ¡ä»¶è£…é…ã€‚è€ŒSpringä¼šæ ¹æ®Conditionalæ³¨è§£æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œbeançš„åˆ›å»ºã€‚ @Enable å¼€å¤´çš„æ³¨è§£åº•å±‚ï¼Œå®ƒå°±å°è£…äº†ä¸€ä¸ªæ³¨è§£ import æ³¨è§£ï¼Œå®ƒé‡Œé¢æŒ‡å®šäº†ä¸€ä¸ªç±»ï¼Œæ˜¯ ImportSelector æ¥å£çš„å®ç°ç±»ã€‚åœ¨å®ç°ç±»å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å»å®ç° ImportSelector æ¥å£å½“ä¸­çš„ä¸€ä¸ªæ–¹æ³• selectImports è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨çš„å°±æ˜¯æˆ‘éœ€è¦å°†å“ªäº›ç±»äº¤ç»™ spring çš„ IOCå®¹å™¨è¿›è¡Œç®¡ç†ã€‚ æ­¤æ—¶å®ƒä¼šå»è¯»å–ä¸¤ä»½é…ç½®æ–‡ä»¶ï¼Œä¸€ä»½å„¿æ˜¯ spring.factoriesï¼Œå¦å¤–ä¸€ä»½å„¿æ˜¯ autoConfiguration.importsã€‚è€Œåœ¨ autoConfiguration.imports è¿™ä»½å„¿æ–‡ä»¶å½“ä¸­ï¼Œå®ƒå°±ä¼šå»é…ç½®å¤§é‡çš„è‡ªåŠ¨é…ç½®çš„ç±»ã€‚ è€Œå‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°è¿‡è¿™äº›æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»å½“ä¸­ï¼Œæ‰€æœ‰çš„ beanéƒ½ä¼šåŠ è½½åˆ° spring çš„ IOC å®¹å™¨å½“ä¸­å—ï¼Ÿå…¶å®å¹¶ä¸ä¼šï¼Œå› ä¸ºè¿™äº›é…ç½®ç±»å½“ä¸­ï¼Œåœ¨å£°æ˜ bean çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šåŠ ä¸Šè¿™ä¹ˆä¸€ç±»@Conditional å¼€å¤´çš„æ³¨è§£ã€‚è¿™ä¸ªæ³¨è§£å°±æ˜¯è¿›è¡Œæ¡ä»¶è£…é…ã€‚æ‰€ä»¥SpringBootéå¸¸çš„æ™ºèƒ½ï¼Œå®ƒä¼šæ ¹æ® @Conditional æ³¨è§£æ¥è¿›è¡Œæ¡ä»¶è£…é…ã€‚åªæœ‰æ¡ä»¶æˆç«‹ï¼Œå®ƒæ‰ä¼šå£°æ˜è¿™ä¸ªbeanï¼Œæ‰ä¼šå°†è¿™ä¸ª bean äº¤ç»™ IOC å®¹å™¨ç®¡ç†ã€‚ SpringBootåŸç†-è‡ªåŠ¨é…ç½®-æ¡ˆä¾‹(è‡ªå®šä¹‰starteråˆ†æ) å‰é¢æˆ‘ä»¬è§£æäº†SpringBootä¸­è‡ªåŠ¨é…ç½®çš„åŸç†ï¼Œä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰starteræ¡ˆä¾‹æ¥åŠ æ·±å¤§å®¶å¯¹äºè‡ªåŠ¨é…ç½®åŸç†çš„ç†è§£ã€‚é¦–å…ˆä»‹ç»ä¸€ä¸‹è‡ªå®šä¹‰starterçš„ä¸šåŠ¡åœºæ™¯ï¼Œå†æ¥åˆ†æä¸€ä¸‹å…·ä½“çš„æ“ä½œæ­¥éª¤ã€‚\næ‰€è°“starteræŒ‡çš„å°±æ˜¯SpringBootå½“ä¸­çš„èµ·æ­¥ä¾èµ–ã€‚åœ¨SpringBootå½“ä¸­å·²ç»ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„èµ·æ­¥ä¾èµ–äº†ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜éœ€è¦è‡ªå®šä¹‰ starter èµ·æ­¥ä¾èµ–ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨å®é™…çš„é¡¹ç›®å¼€å‘å½“ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°å¾ˆå¤šç¬¬ä¸‰æ–¹çš„æŠ€æœ¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹çš„æŠ€æœ¯å®˜æ–¹éƒ½ç»™æˆ‘ä»¬æä¾›äº†ä¸SpringBootæ•´åˆçš„starterèµ·æ­¥ä¾èµ–ï¼Œä½†æ˜¯è¿™äº›æŠ€æœ¯åˆéå¸¸çš„é€šç”¨ï¼Œåœ¨å¾ˆå¤šé¡¹ç›®ç»„å½“ä¸­éƒ½åœ¨ä½¿ç”¨ã€‚\nä¸šåŠ¡åœºæ™¯ï¼š\næˆ‘ä»¬å‰é¢æ¡ˆä¾‹å½“ä¸­æ‰€ä½¿ç”¨çš„é˜¿é‡Œäº‘OSSå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œç°åœ¨é˜¿é‡Œäº‘çš„å®˜æ–¹æ˜¯æ²¡æœ‰ç»™æˆ‘ä»¬æä¾›å¯¹åº”çš„èµ·æ­¥ä¾èµ–çš„ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨èµ·æ¥å°±ä¼šæ¯”è¾ƒç¹çï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥å¯¹åº”çš„ä¾èµ–ã€‚æˆ‘ä»¬è¿˜éœ€è¦åœ¨é…ç½®æ–‡ä»¶å½“ä¸­è¿›è¡Œé…ç½®ï¼Œè¿˜éœ€è¦åŸºäºå®˜æ–¹SDKç¤ºä¾‹æ¥æ”¹é€ å¯¹åº”çš„å·¥å…·ç±»ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å½“ä¸­æ‰å¯ä»¥è¿›è¡Œä½¿ç”¨ã€‚ å¤§å®¶æƒ³åœ¨æˆ‘ä»¬å½“å‰é¡¹ç›®å½“ä¸­ä½¿ç”¨äº†é˜¿é‡Œäº‘OSSï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè¿™ä¹ˆå¤šæ­¥çš„æ“ä½œã€‚åœ¨åˆ«çš„é¡¹ç›®ç»„å½“ä¸­è¦æƒ³ä½¿ç”¨é˜¿é‡Œäº‘OSSï¼Œæ˜¯ä¸æ˜¯ä¹Ÿéœ€è¦è¿›è¡Œè¿™ä¹ˆå¤šæ­¥çš„æ“ä½œï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰ä¸€äº›å…¬å…±ç»„ä»¶ï¼Œåœ¨è¿™äº›å…¬å…±ç»„ä»¶å½“ä¸­ï¼Œæˆ‘å°±å¯ä»¥æå‰æŠŠéœ€è¦é…ç½®çš„beanéƒ½æå‰é…ç½®å¥½ã€‚å°†æ¥åœ¨é¡¹ç›®å½“ä¸­ï¼Œæˆ‘è¦æƒ³ä½¿ç”¨è¿™ä¸ªæŠ€æœ¯ï¼Œæˆ‘ç›´æ¥å°†ç»„ä»¶å¯¹åº”çš„åæ ‡ç›´æ¥å¼•å…¥è¿›æ¥ï¼Œå°±å·²ç»è‡ªåŠ¨é…ç½®å¥½äº†ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå…¬å…±ç»„ä»¶æä¾›ç»™åˆ«çš„é¡¹ç›®ç»„è¿›è¡Œä½¿ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§çš„ç®€åŒ–æˆ‘ä»¬çš„å¼€å‘ã€‚ åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šå°†è¿™äº›å…¬å…±ç»„ä»¶å°è£…ä¸ºSpringBootå½“ä¸­çš„starterï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„èµ·æ­¥ä¾èµ–ã€‚\nSpringBootå®˜æ–¹starterå‘½åï¼š spring-boot-starter-xxxx\nç¬¬ä¸‰ç»„ç»‡æä¾›çš„starterå‘½åï¼š xxxx-spring-boot-starter\nMybatisæä¾›äº†é…ç½®ç±»ï¼Œå¹¶ä¸”ä¹Ÿæä¾›äº†springbootä¼šè‡ªåŠ¨è¯»å–çš„é…ç½®æ–‡ä»¶ã€‚å½“SpringBooté¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šè¯»å–åˆ°spring.factoriesé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ç±»å¹¶åŠ è½½é…ç½®ç±»ï¼Œç”Ÿæˆç›¸å…³beanå¯¹è±¡æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚\nç»“æœï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨SpringBootç¨‹åºä¸­ä½¿ç”¨Mybatisè‡ªåŠ¨é…ç½®çš„beanå¯¹è±¡ã€‚\nåœ¨è‡ªå®šä¹‰ä¸€ä¸ªèµ·æ­¥ä¾èµ–starterçš„æ—¶å€™ï¼ŒæŒ‰ç…§è§„èŒƒéœ€è¦å®šä¹‰ä¸¤ä¸ªæ¨¡å—ï¼š\nstarteræ¨¡å—ï¼ˆè¿›è¡Œä¾èµ–ç®¡ç†[æŠŠç¨‹åºå¼€å‘æ‰€éœ€è¦çš„ä¾èµ–éƒ½å®šä¹‰åœ¨starterèµ·æ­¥ä¾èµ–ä¸­]ï¼‰ autoconfigureæ¨¡å—ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰ å°†æ¥åœ¨é¡¹ç›®å½“ä¸­è¿›è¡Œç›¸å…³åŠŸèƒ½å¼€å‘æ—¶ï¼Œåªéœ€è¦å¼•å…¥ä¸€ä¸ªèµ·æ­¥ä¾èµ–å°±å¯ä»¥äº†ï¼Œå› ä¸ºå®ƒä¼šå°†autoconfigureè‡ªåŠ¨é…ç½®çš„ä¾èµ–ç»™ä¼ é€’ä¸‹æ¥ã€‚\nä¸Šé¢æˆ‘ä»¬ç®€å•ä»‹ç»äº†è‡ªå®šä¹‰starterçš„åœºæ™¯ï¼Œä»¥åŠè‡ªå®šä¹‰starteræ—¶æ¶‰åŠåˆ°çš„æ¨¡å—ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®Œæˆä¸€ä¸ªè‡ªå®šä¹‰starterçš„æ¡ˆä¾‹ã€‚\néœ€æ±‚ï¼šè‡ªå®šä¹‰aliyun-oss-spring-boot-starterï¼Œå®Œæˆé˜¿é‡Œäº‘OSSæ“ä½œå·¥å…·ç±»AliyunOSSUtilsçš„è‡ªåŠ¨é…ç½®ã€‚\nç›®æ ‡ï¼šå¼•å…¥èµ·æ­¥ä¾èµ–å¼•å…¥ä¹‹åï¼Œè¦æƒ³ä½¿ç”¨é˜¿é‡Œäº‘OSSï¼Œæ³¨å…¥AliyunOSSUtilsç›´æ¥ä½¿ç”¨å³å¯ã€‚\nä¹‹å‰é˜¿é‡Œäº‘OSSçš„ä½¿ç”¨ï¼š\né…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 #é…ç½®é˜¿é‡Œäº‘OSSå‚æ•° aliyun: oss: endpoint: https://oss-cn-shanghai.aliyuncs.com accessKeyId: accessKeySecret: bucketName: web-framework01 AliOSSPropertiesç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 @Data @Component @ConfigurationProperties(prefix = \u0026#34;aliyun.oss\u0026#34;) public class AliOSSProperties { //åŒºåŸŸ private String endpoint; //èº«ä»½ID private String accessKeyId ; //èº«ä»½å¯†é’¥ private String accessKeySecret ; //å­˜å‚¨ç©ºé—´ private String bucketName; } AliOSSUtilså·¥å…·ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 @Component //å½“å‰ç±»å¯¹è±¡ç”±Springåˆ›å»ºå’Œç®¡ç† public class AliOSSUtils { @Autowired private AliOSSProperties aliOSSProperties; /** * å®ç°ä¸Šä¼ å›¾ç‰‡åˆ°OSS */ public String upload(MultipartFile multipartFile) throws IOException { // è·å–ä¸Šä¼ çš„æ–‡ä»¶çš„è¾“å…¥æµ InputStream inputStream = multipartFile.getInputStream(); // é¿å…æ–‡ä»¶è¦†ç›– String originalFilename = multipartFile.getOriginalFilename(); String fileName = UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf(\u0026#34;.\u0026#34;)); //ä¸Šä¼ æ–‡ä»¶åˆ° OSS OSS ossClient = new OSSClientBuilder().build(aliOSSProperties.getEndpoint(), aliOSSProperties.getAccessKeyId(), aliOSSProperties.getAccessKeySecret()); ossClient.putObject(aliOSSProperties.getBucketName(), fileName, inputStream); //æ–‡ä»¶è®¿é—®è·¯å¾„ String url =aliOSSProperties.getEndpoint().split(\u0026#34;//\u0026#34;)[0] + \u0026#34;//\u0026#34; + aliOSSProperties.getBucketName() + \u0026#34;.\u0026#34; + aliOSSProperties.getEndpoint().split(\u0026#34;//\u0026#34;)[1] + \u0026#34;/\u0026#34; + fileName; // å…³é—­ossClient ossClient.shutdown(); return url;// æŠŠä¸Šä¼ åˆ°ossçš„è·¯å¾„è¿”å› } } å½“æˆ‘ä»¬åœ¨é¡¹ç›®å½“ä¸­è¦ä½¿ç”¨é˜¿é‡Œäº‘OSSï¼Œå°±å¯ä»¥æ³¨å…¥AliOSSUtilså·¥å…·ç±»æ¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€‚ä½†è¿™ç§æ–¹å¼å…¶å®æ˜¯æ¯”è¾ƒç¹ççš„ã€‚\nå¤§å®¶å†æ€è€ƒï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨é˜¿é‡Œäº‘OSSï¼Œéœ€è¦åšè¿™ä¹ˆå‡ æ­¥ï¼Œå°†æ¥å¤§å®¶åœ¨å¼€å‘å…¶ä»–çš„é¡¹ç›®çš„æ—¶å€™ï¼Œä½ ä½¿ç”¨é˜¿é‡Œäº‘OSSï¼Œè¿™å‡ æ­¥ä½ è¦ä¸è¦åšï¼Ÿå½“å›¢é˜Ÿä¸­å…¶ä»–å°ä¼™ä¼´ä¹Ÿåœ¨ä½¿ç”¨é˜¿é‡Œäº‘OSSçš„æ—¶å€™ï¼Œæ­¥éª¤ ä¸ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚\næ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åˆ¶ä½œä¸€ä¸ªå…¬å…±ç»„ä»¶(è‡ªå®šä¹‰starter)ã€‚starterå®šä¹‰å¥½ä¹‹åï¼Œå°†æ¥è¦ä½¿ç”¨é˜¿é‡Œäº‘OSSè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œåªéœ€è¦å°†èµ·æ­¥ä¾èµ–å¼•å…¥è¿›æ¥ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥æ³¨å…¥AliOSSUtilsä½¿ç”¨äº†ã€‚\néœ€æ±‚æ˜ç¡®äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹å…·ä½“çš„å®ç°æ­¥éª¤ï¼š\nç¬¬1æ­¥ï¼šåˆ›å»ºè‡ªå®šä¹‰starteræ¨¡å—ï¼ˆè¿›è¡Œä¾èµ–ç®¡ç†ï¼‰ æŠŠé˜¿é‡Œäº‘OSSæ‰€æœ‰çš„ä¾èµ–ç»Ÿä¸€ç®¡ç†èµ·æ¥ ç¬¬2æ­¥ï¼šåˆ›å»ºautoconfigureæ¨¡å— åœ¨starterä¸­å¼•å…¥autoconfigure ï¼ˆæˆ‘ä»¬ä½¿ç”¨æ—¶åªéœ€è¦å¼•å…¥starterèµ·æ­¥ä¾èµ–å³å¯ï¼‰ ç¬¬3æ­¥ï¼šåœ¨autoconfigureä¸­å®Œæˆè‡ªåŠ¨é…ç½® å®šä¹‰ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œåœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­å°†æ‰€è¦é…ç½®çš„beanéƒ½æå‰é…ç½®å¥½ å®šä¹‰é…ç½®æ–‡ä»¶ï¼ŒæŠŠè‡ªåŠ¨é…ç½®ç±»çš„å…¨ç±»åå®šä¹‰åœ¨é…ç½®æ–‡ä»¶ä¸­ æˆ‘ä»¬åˆ†æå®Œè‡ªå®šä¹‰é˜¿é‡Œäº‘OSSè‡ªåŠ¨é…ç½®çš„æ“ä½œæ­¥éª¤äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§åˆ†æçš„æ­¥éª¤æ¥å®ç°è‡ªå®šä¹‰starterã€‚\nSpringBootåŸç†-è‡ªåŠ¨é…ç½®-æ¡ˆä¾‹(è‡ªå®šä¹‰starterå®ç°) è‡ªå®šä¹‰starterçš„æ­¥éª¤æˆ‘ä»¬åˆšæ‰å·²ç»åˆ†æäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æŒ‰ç…§åˆ†æçš„æ­¥éª¤æ¥å®Œæˆè‡ªå®šä¹‰starterçš„å¼€å‘ã€‚\né¦–å…ˆæˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸¤ä¸ªMavenæ¨¡å—ï¼š\n1). aliyun-oss-spring-boot-starteræ¨¡å—\nåˆ›å»ºå®Œstarteræ¨¡å—åï¼Œåˆ é™¤å¤šä½™çš„æ–‡ä»¶ï¼Œæœ€ç»ˆä¿ç•™å†…å®¹å¦‚ä¸‹ï¼š\nåˆ é™¤pom.xmlæ–‡ä»¶ä¸­å¤šä½™çš„å†…å®¹åï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.aliyun.oss\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;aliyun-oss-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;11\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; 2). aliyun-oss-spring-boot-autoconfigureæ¨¡å—\nåˆ›å»ºå®Œstarteræ¨¡å—åï¼Œåˆ é™¤å¤šä½™çš„æ–‡ä»¶ï¼Œæœ€ç»ˆä¿ç•™å†…å®¹å¦‚ä¸‹ï¼š\nåˆ é™¤pom.xmlæ–‡ä»¶ä¸­å¤šä½™çš„å†…å®¹åï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.aliyun.oss\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;aliyun-oss-spring-boot-autoconfigure\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;11\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„åˆ†æï¼Œæ˜¯éœ€è¦åœ¨starteræ¨¡å—ä¸­æ¥å¼•å…¥autoconfigureè¿™ä¸ªæ¨¡å—çš„ã€‚æ‰“å¼€starteræ¨¡å—ä¸­çš„pomæ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.aliyun.oss\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;aliyun-oss-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;11\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!--å¼•å…¥autoconfigureæ¨¡å—--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.aliyun.oss\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;aliyun-oss-spring-boot-autoconfigure\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; å‰ä¸¤æ­¥å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æ˜¯æœ€å…³é”®çš„å°±æ˜¯ç¬¬ä¸‰æ­¥ï¼š\nåœ¨autoconfigureæ¨¡å—å½“ä¸­æ¥å®Œæˆè‡ªåŠ¨é…ç½®æ“ä½œã€‚\næˆ‘ä»¬å°†ä¹‹å‰æ¡ˆä¾‹ä¸­æ‰€ä½¿ç”¨çš„é˜¿é‡Œäº‘OSSéƒ¨åˆ†çš„ä»£ç ç›´æ¥æ‹·è´åˆ°autoconfigureæ¨¡å—ä¸‹ï¼Œç„¶åè¿›è¡Œæ”¹é€ å°±è¡Œäº†ã€‚\næ‹·è´è¿‡æ¥åï¼Œè¿˜ç¼ºå¤±ä¸€äº›ç›¸å…³çš„ä¾èµ–ï¼Œéœ€è¦æŠŠç›¸å…³ä¾èµ–ä¹Ÿæ‹·è´è¿‡æ¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.aliyun.oss\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;aliyun-oss-spring-boot-autoconfigure\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;11\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--å¼•å…¥webèµ·æ­¥ä¾èµ–--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--Lombok--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--é˜¿é‡Œäº‘OSS--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.aliyun.oss\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;aliyun-sdk-oss\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.15.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.xml.bind\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jaxb-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.activation\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;activation\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.1.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- no more than 2.3.3--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.glassfish.jaxb\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jaxb-runtime\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; ç°åœ¨å¤§å®¶æ€è€ƒä¸‹ï¼Œåœ¨ç±»ä¸Šæ·»åŠ çš„@Componentæ³¨è§£è¿˜æœ‰ç”¨å—ï¼Ÿ\nç­”æ¡ˆï¼šæ²¡ç”¨äº†ã€‚ åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œå¹¶ä¸ä¼šå»æ‰«æcom.aliyun.ossè¿™ä¸ªåŒ…ï¼Œä¸æ‰«æè¿™ä¸ªåŒ…é‚£ç±»ä¸Šçš„æ³¨è§£ä¹Ÿå°±å¤±å»äº†ä½œç”¨ã€‚\n@Componentæ³¨è§£ä¸éœ€è¦ä½¿ç”¨äº†ï¼Œå¯ä»¥ä»ç±»ä¸Šåˆ é™¤äº†ã€‚\nåˆ é™¤åæŠ¥çº¢è‰²é”™è¯¯ï¼Œæš‚æ—¶ä¸ç†ä¼šï¼Œåé¢å†æ¥å¤„ç†ã€‚\nåˆ é™¤AliOSSUtilsç±»ä¸­çš„@Componentæ³¨è§£ã€@Autowiredæ³¨è§£\nä¸‹é¢æˆ‘ä»¬å°±è¦å®šä¹‰ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»äº†ï¼Œåœ¨è‡ªåŠ¨é…ç½®ç±»å½“ä¸­æ¥å£°æ˜AliOSSUtilsçš„beanå¯¹è±¡ã€‚\nAliOSSAutoConfigurationç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 @Configuration//å½“å‰ç±»ä¸ºSpringé…ç½®ç±» @EnableConfigurationProperties(AliOSSProperties.class)//å¯¼å…¥AliOSSPropertiesç±»ï¼Œå¹¶äº¤ç»™SpringIOCç®¡ç† public class AliOSSAutoConfiguration { //åˆ›å»ºAliOSSUtilså¯¹è±¡ï¼Œå¹¶äº¤ç»™SpringIOCå®¹å™¨ @Bean public AliOSSUtils aliOSSUtils(AliOSSProperties aliOSSProperties){ AliOSSUtils aliOSSUtils = new AliOSSUtils(); aliOSSUtils.setAliOSSProperties(aliOSSProperties); return aliOSSUtils; } } AliOSSPropertiesç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 /*é˜¿é‡Œäº‘OSSç›¸å…³é…ç½®*/ @Data @ConfigurationProperties(prefix = \u0026#34;aliyun.oss\u0026#34;) public class AliOSSProperties { //åŒºåŸŸ private String endpoint; //èº«ä»½ID private String accessKeyId ; //èº«ä»½å¯†é’¥ private String accessKeySecret ; //å­˜å‚¨ç©ºé—´ private String bucketName; } AliOSSUtilsç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @Data public class AliOSSUtils { private AliOSSProperties aliOSSProperties; /** * å®ç°ä¸Šä¼ å›¾ç‰‡åˆ°OSS */ public String upload(MultipartFile multipartFile) throws IOException { // è·å–ä¸Šä¼ çš„æ–‡ä»¶çš„è¾“å…¥æµ InputStream inputStream = multipartFile.getInputStream(); // é¿å…æ–‡ä»¶è¦†ç›– String originalFilename = multipartFile.getOriginalFilename(); String fileName = UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf(\u0026#34;.\u0026#34;)); //ä¸Šä¼ æ–‡ä»¶åˆ° OSS OSS ossClient = new OSSClientBuilder().build(aliOSSProperties.getEndpoint(), aliOSSProperties.getAccessKeyId(), aliOSSProperties.getAccessKeySecret()); ossClient.putObject(aliOSSProperties.getBucketName(), fileName, inputStream); //æ–‡ä»¶è®¿é—®è·¯å¾„ String url =aliOSSProperties.getEndpoint().split(\u0026#34;//\u0026#34;)[0] + \u0026#34;//\u0026#34; + aliOSSProperties.getBucketName() + \u0026#34;.\u0026#34; + aliOSSProperties.getEndpoint().split(\u0026#34;//\u0026#34;)[1] + \u0026#34;/\u0026#34; + fileName; // å…³é—­ossClient ossClient.shutdown(); return url;// æŠŠä¸Šä¼ åˆ°ossçš„è·¯å¾„è¿”å› } } åœ¨aliyun-oss-spring-boot-autoconfigureæ¨¡å—ä¸­çš„resourcesä¸‹ï¼Œæ–°å»ºè‡ªåŠ¨é…ç½®æ–‡ä»¶ï¼š\nMETA-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports 1 com.aliyun.oss.AliOSSAutoConfiguration è‡ªå®šä¹‰starteræµ‹è¯•\né˜¿é‡Œäº‘OSSçš„starteræˆ‘ä»¬åˆšæ‰å·²ç»å®šä¹‰å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥åšä¸€ä¸ªæµ‹è¯•ã€‚\nä»Šå¤©çš„è¯¾ç¨‹èµ„æ–™å½“ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªè‡ªå®šä¹‰starterçš„æµ‹è¯•å·¥ç¨‹ã€‚æˆ‘ä»¬ç›´æ¥æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹ã€‚æµ‹è¯•å·¥ç¨‹å°±æ˜¯springboot-autoconfiguration-testï¼Œæˆ‘ä»¬åªéœ€è¦å°†æµ‹è¯•å·¥ç¨‹ç›´æ¥å¯¼å…¥åˆ°Ideaå½“ä¸­å³å¯ã€‚\næµ‹è¯•å‰å‡†å¤‡ï¼š\nåœ¨testå·¥ç¨‹ä¸­å¼•å…¥é˜¿é‡Œäº‘starterä¾èµ– é€šè¿‡ä¾èµ–ä¼ é€’ï¼Œä¼šæŠŠautoconfigureä¾èµ–ä¹Ÿå¼•å…¥äº† 1 2 3 4 5 6 \u0026lt;!--å¼•å…¥é˜¿é‡Œäº‘OSSèµ·æ­¥ä¾èµ–--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.aliyun.oss\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;aliyun-oss-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 2. åœ¨testå·¥ç¨‹ä¸­çš„application.ymlæ–‡ä»¶ä¸­ï¼Œé…ç½®é˜¿é‡Œäº‘OSSé…ç½®å‚æ•°ä¿¡æ¯ï¼ˆä»ä»¥å‰çš„å·¥ç¨‹ä¸­æ‹·è´å³å¯ï¼‰\n1 2 3 4 5 6 7 #é…ç½®é˜¿é‡Œäº‘OSSå‚æ•° aliyun: oss: endpoint: https://oss-cn-shanghai.aliyuncs.com accessKeyId: accessKeySecret: bucketName: web-framework01 3. åœ¨testå·¥ç¨‹ä¸­çš„UploadControllerç±»ç¼–å†™ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @RestController public class UploadController { @Autowired private AliOSSUtils aliOSSUtils; @PostMapping(\u0026#34;/upload\u0026#34;) public String upload(MultipartFile image) throws Exception { //ä¸Šä¼ æ–‡ä»¶åˆ°é˜¿é‡Œäº‘ OSS String url = aliOSSUtils.upload(image); return url; } } ç¼–å†™å®Œä»£ç åï¼Œæˆ‘ä»¬å¯åŠ¨å½“å‰çš„SpringBootæµ‹è¯•å·¥ç¨‹ï¼š\néšç€SpringBooté¡¹ç›®å¯åŠ¨ï¼Œè‡ªåŠ¨é…ç½®ä¼šæŠŠAliOSSUtilsçš„beanå¯¹è±¡è£…é…åˆ°IOCå®¹å™¨ä¸­ ç”¨postmanå·¥å…·è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼š\né€šè¿‡æ–­ç‚¹å¯ä»¥çœ‹åˆ°è‡ªåŠ¨æ³¨å…¥AliOSSUtilsçš„beanå¯¹è±¡ï¼š\nWebåç«¯å¼€å‘-æ€»ç»“ åˆ°æ­¤åŸºäºSpringBootè¿›è¡Œwebåç«¯å¼€å‘çš„ç›¸å…³çŸ¥è¯†æˆ‘ä»¬å·²ç»å­¦ä¹ å®Œæ¯•äº†ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€èµ·é’ˆå¯¹è¿™æ®µwebè¯¾ç¨‹åšä¸€ä¸ªæ€»ç»“ã€‚\næˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹å…³äºwebåç«¯å¼€å‘ï¼Œæˆ‘ä»¬éƒ½å­¦ä¹ äº†å“ªäº›å†…å®¹ï¼Œä»¥åŠæ¯ä¸€å—çŸ¥è¯†ï¼Œå…·ä½“æ˜¯å±äºå“ªä¸ªæ¡†æ¶çš„ã€‚\nwebåç«¯å¼€å‘ç°åœ¨åŸºæœ¬ä¸Šéƒ½æ˜¯åŸºäºæ ‡å‡†çš„ä¸‰å±‚æ¶æ„è¿›è¡Œå¼€å‘çš„ï¼Œåœ¨ä¸‰å±‚æ¶æ„å½“ä¸­ï¼ŒControlleræ§åˆ¶å™¨å±‚è´Ÿè´£æ¥æ”¶è¯·æ±‚å“åº”æ•°æ®ï¼ŒServiceä¸šåŠ¡å±‚è´Ÿè´£å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œè€ŒDaoæ•°æ®è®¿é—®å±‚ä¹Ÿå«æŒä¹…å±‚ï¼Œå°±æ˜¯ç”¨æ¥å¤„ç†æ•°æ®è®¿é—®æ“ä½œçš„ï¼Œæ¥å®Œæˆæ•°æ®åº“å½“ä¸­æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚\nåœ¨ä¸‰å±‚æ¶æ„å½“ä¸­ï¼Œå‰ç«¯å‘èµ·è¯·æ±‚é¦–å…ˆä¼šåˆ°è¾¾Controller(ä¸è¿›è¡Œé€»è¾‘å¤„ç†)ï¼Œç„¶åControllerä¼šç›´æ¥è°ƒç”¨Service è¿›è¡Œé€»è¾‘å¤„ç†ï¼Œ Serviceå†è°ƒç”¨Daoå®Œæˆæ•°æ®è®¿é—®æ“ä½œã€‚\nå¦‚æœæˆ‘ä»¬åœ¨æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†ä¹‹å‰ï¼Œéœ€è¦å»åšä¸€äº›é€šç”¨çš„ä¸šåŠ¡å¤„ç†ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬è¦è¿›è¡Œç»Ÿä¸€çš„ç™»å½•æ ¡éªŒï¼Œæˆ‘ä»¬è¦è¿›è¡Œç»Ÿä¸€çš„å­—ç¬¦ç¼–ç ç­‰è¿™äº›æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©äºJavawebå½“ä¸­ä¸‰å¤§ç»„ä»¶ä¹‹ä¸€çš„è¿‡æ»¤å™¨Filteræˆ–è€…æ˜¯Springå½“ä¸­æä¾›çš„æ‹¦æˆªå™¨Interceptoræ¥å®ç°ã€‚\nè€Œä¸ºäº†å®ç°ä¸‰å±‚æ¶æ„å±‚ä¸å±‚ä¹‹é—´çš„è§£è€¦ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Springæ¡†æ¶å½“ä¸­çš„ç¬¬ä¸€å¤§æ ¸å¿ƒï¼šIOCæ§åˆ¶åè½¬ä¸DIä¾èµ–æ³¨å…¥ã€‚\næ‰€è°“æ§åˆ¶åè½¬ï¼ŒæŒ‡çš„æ˜¯å°†å¯¹è±¡åˆ›å»ºçš„æ§åˆ¶æƒç”±åº”ç”¨ç¨‹åºè‡ªèº«äº¤ç»™å¤–éƒ¨å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„IOCå®¹å™¨æˆ–Springå®¹å™¨ã€‚\nè€ŒDIä¾èµ–æ³¨å…¥æŒ‡çš„æ˜¯å®¹å™¨ä¸ºç¨‹åºæä¾›è¿è¡Œæ—¶æ‰€éœ€è¦çš„èµ„æºã€‚\né™¤äº†IOCä¸DIæˆ‘ä»¬è¿˜è®²åˆ°äº†AOPé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œè¿˜æœ‰Springä¸­çš„äº‹åŠ¡ç®¡ç†ã€å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œä»¥åŠä¼ é€’ä¼šè¯æŠ€æœ¯Cookieã€Sessionä»¥åŠæ–°çš„ä¼šè¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆJWTä»¤ç‰Œï¼Œé˜¿é‡Œäº‘OSSå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œä»¥åŠé€šè¿‡MybatisæŒä¹…å±‚æ¶æ„æ“ä½œæ•°æ®åº“ç­‰æŠ€æœ¯ã€‚\næˆ‘ä»¬åœ¨å­¦ä¹ è¿™äº›webåç«¯å¼€å‘æŠ€æœ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäºä¸»æµçš„SpringBootè¿›è¡Œæ•´åˆä½¿ç”¨çš„ã€‚è€ŒSpringBootåˆæ˜¯ç”¨æ¥ç®€åŒ–å¼€å‘ï¼Œæé«˜å¼€å‘æ•ˆç‡çš„ã€‚åƒè¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€IOCã€DIã€AOPã€äº‹åŠ¡ç®¡ç†ç­‰è¿™äº›æŠ€æœ¯åˆ°åº•æ˜¯å“ªä¸ªæ¡†æ¶æä¾›çš„æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ\nFilterè¿‡æ»¤å™¨ã€Cookieã€ Sessionè¿™äº›éƒ½æ˜¯ä¼ ç»Ÿçš„JavaWebæä¾›çš„æŠ€æœ¯ã€‚\nJWTä»¤ç‰Œã€é˜¿é‡Œäº‘OSSå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œæ˜¯ç°åœ¨ä¼ä¸šé¡¹ç›®ä¸­å¸¸è§çš„ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚\nIOCæ§åˆ¶åè½¬ã€DIä¾èµ–æ³¨å…¥ã€AOPé¢å‘åˆ‡é¢ç¼–ç¨‹ã€äº‹åŠ¡ç®¡ç†ã€å…¨å±€å¼‚å¸¸å¤„ç†ã€æ‹¦æˆªå™¨ç­‰ï¼Œè¿™äº›æŠ€æœ¯éƒ½æ˜¯ Spring Frameworkæ¡†æ¶å½“ä¸­æä¾›çš„æ ¸å¿ƒåŠŸèƒ½ã€‚\nMybatiså°±æ˜¯ä¸€ä¸ªæŒä¹…å±‚çš„æ¡†æ¶ï¼Œæ˜¯ç”¨æ¥æ“ä½œæ•°æ®åº“çš„ã€‚\nåœ¨Springæ¡†æ¶çš„ç”Ÿæ€ä¸­ï¼Œå¯¹webç¨‹åºå¼€å‘æä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œå¦‚ï¼šå…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€æ‹¦æˆªå™¨è¿™äº›éƒ½æ˜¯Springæ¡†æ¶ä¸­webå¼€å‘æ¨¡å—æ‰€æä¾›çš„åŠŸèƒ½ï¼Œè€ŒSpringæ¡†æ¶çš„webå¼€å‘æ¨¡å—ï¼Œæˆ‘ä»¬ä¹Ÿç§°ä¸ºï¼šSpringMVC\nSpringMVCä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¡†æ¶ï¼Œå®ƒæ˜¯Springæ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯Springæ¡†æ¶ä¸­çš„webå¼€å‘æ¨¡å—ï¼Œæ˜¯ç”¨æ¥ç®€åŒ–åŸå§‹çš„Servletç¨‹åºå¼€å‘çš„ã€‚\nå¤–ç•Œä¿—ç§°çš„SSMï¼Œå°±æ˜¯ç”±ï¼šSpringMVCã€Spring Frameworkã€Mybatisä¸‰å—ç»„æˆã€‚\nåŸºäºä¼ ç»Ÿçš„SSMæ¡†æ¶è¿›è¡Œæ•´åˆå¼€å‘é¡¹ç›®ä¼šæ¯”è¾ƒç¹çï¼Œè€Œä¸”æ•ˆç‡ä¹Ÿæ¯”è¾ƒä½ï¼Œæ‰€ä»¥åœ¨ç°åœ¨çš„ä¼ä¸šé¡¹ç›®å¼€å‘å½“ä¸­ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›´æ¥åŸºäºSpringBootæ•´åˆSSMè¿›è¡Œé¡¹ç›®å¼€å‘çš„ã€‚\n","date":"2024-04-13T16:01:26+08:00","image":"https://nova-bryan.github.io/p/springboot%E5%8E%9F%E7%90%86%E5%92%8Cbean%E7%9A%84%E7%AE%A1%E7%90%86/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/springboot%E5%8E%9F%E7%90%86%E5%92%8Cbean%E7%9A%84%E7%AE%A1%E7%90%86/","title":"SpringBootåŸç†å’ŒBeançš„ç®¡ç†"},{"content":"ç™»å½•åŸºç¡€åŠŸèƒ½ åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†éƒ¨é—¨ç®¡ç†ã€å‘˜å·¥ç®¡ç†çš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†æ˜¯å¤§å®¶ä¼šå‘ç°ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç™»å½•ï¼Œå°±ç›´æ¥è®¿é—®åˆ°äº†Tliasæ™ºèƒ½å­¦ä¹ è¾…åŠ©ç³»ç»Ÿçš„åå°ã€‚ è¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜å°±æ˜¯ç™»å½•è®¤è¯ã€‚ æœ€ç»ˆæˆ‘ä»¬è¦å®ç°çš„æ•ˆæœå°±æ˜¯ç”¨æˆ·å¿…é¡»ç™»å½•ä¹‹åï¼Œæ‰å¯ä»¥è®¿é—®åå°ç³»ç»Ÿä¸­çš„åŠŸèƒ½ã€‚\néœ€æ±‚ åœ¨ç™»å½•ç•Œé¢ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥ç”¨æˆ·çš„ç”¨æˆ·åä»¥åŠå¯†ç ï¼Œç„¶åç‚¹å‡» \u0026ldquo;ç™»å½•\u0026rdquo; æŒ‰é’®å°±è¦è¯·æ±‚æœåŠ¡å™¨ï¼ŒæœåŠ¡ç«¯åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åæˆ–è€…å¯†ç æ˜¯å¦æ­£ç¡®ã€‚å¦‚æœæ­£ç¡®ï¼Œåˆ™è¿”å›æˆåŠŸç»“æœï¼Œå‰ç«¯è·³è½¬è‡³ç³»ç»Ÿé¦–é¡µé¢ã€‚\næ¥å£æ–‡æ¡£ æˆ‘ä»¬å‚ç…§æ¥å£æ–‡æ¡£æ¥å¼€å‘ç™»å½•åŠŸèƒ½\nåŸºæœ¬ä¿¡æ¯\n1 2 3 è¯·æ±‚è·¯å¾„ï¼š/login è¯·æ±‚æ–¹å¼ï¼šPOST æ¥å£æè¿°ï¼šè¯¥æ¥å£ç”¨äºå‘˜å·¥ç™»å½•Tliasæ™ºèƒ½å­¦ä¹ è¾…åŠ©ç³»ç»Ÿï¼Œç™»å½•å®Œæ¯•åï¼Œç³»ç»Ÿä¸‹å‘JWTä»¤ç‰Œã€‚ è¯·æ±‚å‚æ•°\nå‚æ•°æ ¼å¼ï¼šapplication/json\nå‚æ•°è¯´æ˜ï¼š\nåç§° ç±»å‹ æ˜¯å¦å¿…é¡» å¤‡æ³¨ username string å¿…é¡» ç”¨æˆ·å password string å¿…é¡» å¯†ç  è¯·æ±‚æ•°æ®æ ·ä¾‹ï¼š\n1 2 3 4 { \u0026#34;username\u0026#34;: \u0026#34;jinyong\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;123456\u0026#34; } å“åº”æ•°æ® å‚æ•°æ ¼å¼ï¼šapplication/json\nå‚æ•°è¯´æ˜ï¼š\nåç§° ç±»å‹ æ˜¯å¦å¿…é¡» é»˜è®¤å€¼ å¤‡æ³¨ å…¶ä»–ä¿¡æ¯ code number å¿…é¡» å“åº”ç , 1 æˆåŠŸ ; 0 å¤±è´¥ msg string éå¿…é¡» æç¤ºä¿¡æ¯ data string å¿…é¡» è¿”å›çš„æ•°æ® , jwtä»¤ç‰Œ å“åº”æ•°æ®æ ·ä¾‹ï¼š\n1 2 3 4 5 { \u0026#34;code\u0026#34;: 1, \u0026#34;msg\u0026#34;: \u0026#34;success\u0026#34;, \u0026#34;data\u0026#34;: \u0026#34;eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoi6YeR5bq4IiwiaWQiOjEsInVzZXJuYW1lIjoiamlueW9uZyIsImV4cCI6MTY2MjIwNzA0OH0.KkUc_CXJZJ8Dd063eImx4H9Ojfrr6XMJ-yVzaWCVZCo\u0026#34; } æ€è·¯åˆ†æ ç™»å½•æœåŠ¡ç«¯çš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯ï¼šæ¥æ”¶å‰ç«¯è¯·æ±‚ä¼ é€’çš„ç”¨æˆ·åå’Œå¯†ç  ï¼Œç„¶åå†æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœç”¨æˆ·ä¿¡æ¯å­˜åœ¨ï¼Œåˆ™è¯´æ˜ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®ã€‚å¦‚æœæŸ¥è¯¢åˆ°çš„ç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç é”™è¯¯ã€‚\nåŠŸèƒ½å¼€å‘ LoginController\n1 2 3 4 5 6 7 8 9 10 11 12 @RestController public class LoginController { @Autowired private EmpService empService; @PostMapping(\u0026#34;/login\u0026#34;) public Result login(@RequestBody Emp emp){ Emp e = empService.login(emp); return e != null ? Result.success():Result.error(\u0026#34;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\u0026#34;); } } EmpService\n1 2 3 4 5 6 7 8 9 10 11 public interface EmpService { /** * ç”¨æˆ·ç™»å½• * @param emp * @return */ public Emp login(Emp emp); //çœç•¥å…¶ä»–ä»£ç ... } EmpServiceImpl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Slf4j @Service public class EmpServiceImpl implements EmpService { @Autowired private EmpMapper empMapper; @Override public Emp login(Emp emp) { //è°ƒç”¨daoå±‚åŠŸèƒ½ï¼šç™»å½• Emp loginEmp = empMapper.getByUsernameAndPassword(emp); //è¿”å›æŸ¥è¯¢ç»“æœç»™Controller return loginEmp; } //çœç•¥å…¶ä»–ä»£ç ... } EmpMapper\n1 2 3 4 5 6 7 8 9 10 @Mapper public interface EmpMapper { @Select(\u0026#34;select id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time \u0026#34; + \u0026#34;from emp \u0026#34; + \u0026#34;where username=#{username} and password =#{password}\u0026#34;) public Emp getByUsernameAndPassword(Emp emp); //çœç•¥å…¶ä»–ä»£ç ... } æµ‹è¯• åŠŸèƒ½å¼€å‘å®Œæ¯•åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨æœåŠ¡ï¼Œæ‰“å¼€postmanè¿›è¡Œæµ‹è¯•äº†ã€‚\nå‘èµ·POSTè¯·æ±‚ï¼Œè®¿é—®ï¼šhttp://localhost:8080/login\npostmanæµ‹è¯•é€šè¿‡äº†ï¼Œé‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»“åˆç€å‰ç«¯å·¥ç¨‹è¿›è¡Œè”è°ƒæµ‹è¯•ã€‚\nå…ˆé€€å‡ºç³»ç»Ÿï¼Œè¿›å…¥åˆ°ç™»å½•é¡µé¢ï¼š\nåœ¨ç™»å½•é¡µé¢è¾“å…¥è´¦æˆ·å¯†ç ï¼š\nç™»å½•æˆåŠŸä¹‹åè¿›å…¥åˆ°åå°ç®¡ç†ç³»ç»Ÿé¡µé¢ï¼š\nç™»å½•æ ¡éªŒ-æ¦‚è¿° é—®é¢˜åˆ†æ æˆ‘ä»¬å·²ç»å®Œæˆäº†åŸºç¡€ç™»å½•åŠŸèƒ½çš„å¼€å‘ä¸æµ‹è¯•ï¼Œåœ¨æˆ‘ä»¬ç™»å½•æˆåŠŸåå°±å¯ä»¥è¿›å…¥åˆ°åå°ç®¡ç†ç³»ç»Ÿä¸­è¿›è¡Œæ•°æ®çš„æ“ä½œã€‚\nä½†æ˜¯å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æ–°çš„é¡µé¢ä¸Šè¾“å…¥åœ°å€ï¼šhttp://localhost:9528/#/system/deptï¼Œå‘ç°æ²¡æœ‰ç™»å½•ä»ç„¶å¯ä»¥è¿›å…¥åˆ°åç«¯ç®¡ç†ç³»ç»Ÿé¡µé¢ã€‚\nè€ŒçœŸæ­£çš„ç™»å½•åŠŸèƒ½åº”è¯¥æ˜¯ï¼šç™»é™†åæ‰èƒ½è®¿é—®åç«¯ç³»ç»Ÿé¡µé¢ï¼Œä¸ç™»é™†åˆ™è·³è½¬ç™»é™†é¡µé¢è¿›è¡Œç™»é™†ã€‚\nä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿå…¶å®åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯å› ä¸ºé’ˆå¯¹äºæˆ‘ä»¬å½“å‰æ‰€å¼€å‘çš„éƒ¨é—¨ç®¡ç†ã€å‘˜å·¥ç®¡ç†ä»¥åŠæ–‡ä»¶ä¸Šä¼ ç­‰ç›¸å…³æ¥å£æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯å¹¶æ²¡æœ‰åšä»»ä½•çš„åˆ¤æ–­ï¼Œæ²¡æœ‰å»åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•äº†ã€‚æ‰€ä»¥æ— è®ºç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œéƒ½å¯ä»¥è®¿é—®éƒ¨é—¨ç®¡ç†ä»¥åŠå‘˜å·¥ç®¡ç†çš„ç›¸å…³æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬ç›®å‰æ‰€å¼€å‘çš„ç™»å½•åŠŸèƒ½ï¼Œå®ƒåªæ˜¯å¾’æœ‰å…¶è¡¨ã€‚è€Œæˆ‘ä»¬è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦å®Œæˆä¸€æ­¥éå¸¸é‡è¦çš„æ“ä½œï¼šç™»å½•æ ¡éªŒã€‚\nä»€ä¹ˆæ˜¯ç™»å½•æ ¡éªŒï¼Ÿ\næ‰€è°“ç™»å½•æ ¡éªŒï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°æµè§ˆå™¨å‘é€è¿‡æ¥çš„è¯·æ±‚ä¹‹åï¼Œé¦–å…ˆæˆ‘ä»¬è¦å¯¹è¯·æ±‚è¿›è¡Œæ ¡éªŒã€‚å…ˆè¦æ ¡éªŒä¸€ä¸‹ç”¨æˆ·ç™»å½•äº†æ²¡æœ‰ï¼Œå¦‚æœç”¨æˆ·å·²ç»ç™»å½•äº†ï¼Œå°±ç›´æ¥æ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡æ“ä½œå°±å¯ä»¥äº†ï¼›å¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæ­¤æ—¶å°±ä¸å…è®¸ä»–æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡æ“ä½œï¼Œç›´æ¥ç»™å‰ç«¯å“åº”ä¸€ä¸ªé”™è¯¯çš„ç»“æœï¼Œæœ€ç»ˆè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¦æ±‚ä»–ç™»å½•æˆåŠŸä¹‹åï¼Œå†æ¥è®¿é—®å¯¹åº”çš„æ•°æ®ã€‚ äº†è§£å®Œä»€ä¹ˆæ˜¯ç™»å½•æ ¡éªŒä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸€ä¸‹ç™»å½•æ ¡éªŒå¤§æ¦‚çš„å®ç°æ€è·¯ã€‚\né¦–å…ˆæˆ‘ä»¬åœ¨å®è§‚ä¸Šå…ˆæœ‰ä¸€ä¸ªè®¤çŸ¥ï¼š\nå‰é¢åœ¨è®²è§£HTTPåè®®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°HTTPåè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚ä»€ä¹ˆåˆæ˜¯æ— çŠ¶æ€çš„åè®®ï¼Ÿ\næ‰€è°“æ— çŠ¶æ€ï¼ŒæŒ‡çš„æ˜¯æ¯ä¸€æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚å¹¶ä¸ä¼šæºå¸¦ä¸Šä¸€æ¬¡è¯·æ±‚çš„æ•°æ®ã€‚è€Œæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œäº¤äº’ï¼ŒåŸºäºHTTPåè®®ä¹Ÿå°±æ„å‘³ç€ç°åœ¨æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨æ¥è®¿é—®äº†ç™»é™†è¿™ä¸ªæ¥å£ï¼Œå®ç°äº†ç™»é™†çš„æ“ä½œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ‰§è¡Œå…¶ä»–ä¸šåŠ¡æ“ä½œæ—¶ï¼ŒæœåŠ¡å™¨ä¹Ÿå¹¶ä¸çŸ¥é“è¿™ä¸ªå‘˜å·¥åˆ°åº•ç™»é™†äº†æ²¡æœ‰ã€‚å› ä¸ºHTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸¤æ¬¡è¯·æ±‚ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥æ˜¯æ— æ³•åˆ¤æ–­è¿™ä¸ªå‘˜å·¥åˆ°åº•ç™»é™†äº†æ²¡æœ‰ã€‚\né‚£åº”è¯¥æ€ä¹ˆæ¥å®ç°ç™»å½•æ ¡éªŒçš„æ“ä½œå‘¢ï¼Ÿå…·ä½“çš„å®ç°æ€è·¯å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š\nåœ¨å‘˜å·¥ç™»å½•æˆåŠŸåï¼Œéœ€è¦å°†ç”¨æˆ·ç™»å½•æˆåŠŸçš„ä¿¡æ¯å­˜èµ·æ¥ï¼Œè®°å½•ç”¨æˆ·å·²ç»ç™»å½•æˆåŠŸçš„æ ‡è®°ã€‚ åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡Œç»Ÿä¸€æ‹¦æˆªï¼Œæ‹¦æˆªåè¿›è¡Œç™»å½•æ ¡éªŒã€‚ æƒ³è¦åˆ¤æ–­å‘˜å·¥æ˜¯å¦å·²ç»ç™»å½•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘˜å·¥ç™»å½•æˆåŠŸä¹‹åï¼Œå­˜å‚¨ä¸€ä¸ªç™»å½•æˆåŠŸçš„æ ‡è®°ï¼Œæ¥ä¸‹æ¥åœ¨æ¯ä¸€ä¸ªæ¥å£æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œå…ˆåšä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªå‘˜å·¥åˆ°åº•ç™»å½•äº†æ²¡æœ‰ã€‚å¦‚æœæ˜¯ç™»å½•äº†ï¼Œå°±å¯ä»¥æ‰§è¡Œæ­£å¸¸çš„ä¸šåŠ¡æ“ä½œï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼Œä¼šç›´æ¥ç»™å‰ç«¯è¿”å›ä¸€ä¸ªé”™è¯¯çš„ä¿¡æ¯ï¼Œå‰ç«¯æ‹¿åˆ°è¿™ä¸ªé”™è¯¯ä¿¡æ¯ä¹‹åä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚\næˆ‘ä»¬ç¨‹åºä¸­æ‰€å¼€å‘çš„æŸ¥è¯¢åŠŸèƒ½ã€åˆ é™¤åŠŸèƒ½ã€æ·»åŠ åŠŸèƒ½ã€ä¿®æ”¹åŠŸèƒ½ï¼Œéƒ½éœ€è¦ä½¿ç”¨ä»¥ä¸Šå¥—è·¯è¿›è¡Œç™»å½•æ ¡éªŒã€‚æ­¤æ—¶å°±ä¼šå‡ºç°ï¼šç›¸åŒä»£ç é€»è¾‘ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½éœ€è¦ç¼–å†™ï¼Œå°±ä¼šé€ æˆä»£ç éå¸¸ç¹çã€‚\nä¸ºäº†ç®€åŒ–è¿™å—æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§æŠ€æœ¯ï¼šç»Ÿä¸€æ‹¦æˆªæŠ€æœ¯ã€‚\né€šè¿‡ç»Ÿä¸€æ‹¦æˆªçš„æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ‹¦æˆªæµè§ˆå™¨å‘é€è¿‡æ¥çš„æ‰€æœ‰çš„è¯·æ±‚ï¼Œæ‹¦æˆªåˆ°è¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡è¯·æ±‚æ¥è·å–ä¹‹å‰æ‰€å­˜å…¥çš„ç™»å½•æ ‡è®°ï¼Œåœ¨è·å–åˆ°ç™»å½•æ ‡è®°ä¸”æ ‡è®°ä¸ºç™»å½•æˆåŠŸï¼Œå°±è¯´æ˜å‘˜å·¥å·²ç»ç™»å½•äº†ã€‚å¦‚æœå·²ç»ç™»å½•ï¼Œæˆ‘ä»¬å°±ç›´æ¥æ”¾è¡Œ(æ„æ€å°±æ˜¯å¯ä»¥è®¿é—®æ­£å¸¸çš„ä¸šåŠ¡æ¥å£äº†)ã€‚\næˆ‘ä»¬è¦å®Œæˆä»¥ä¸Šæ“ä½œï¼Œä¼šæ¶‰åŠåˆ°webå¼€å‘ä¸­çš„ä¸¤ä¸ªæŠ€æœ¯ï¼š\nä¼šè¯æŠ€æœ¯ ç»Ÿä¸€æ‹¦æˆªæŠ€æœ¯ è€Œç»Ÿä¸€æ‹¦æˆªæŠ€æœ¯ç°å®æ–¹æ¡ˆä¹Ÿæœ‰ä¸¤ç§ï¼š\nServletè§„èŒƒä¸­çš„Filterè¿‡æ»¤å™¨ Springæä¾›çš„interceptoræ‹¦æˆªå™¨ ä¸‹é¢æˆ‘ä»¬å…ˆå­¦ä¹ ä¼šè¯æŠ€æœ¯ï¼Œç„¶åå†å­¦ä¹ ç»Ÿä¸€æ‹¦æˆªæŠ€æœ¯ã€‚\nç™»å½•è®¤è¯-ç™»å½•æ ¡éªŒ-ä¼šè¯æŠ€æœ¯ ä¼šè¯æŠ€æœ¯ä»‹ç» ä»€ä¹ˆæ˜¯ä¼šè¯ï¼Ÿ\nåœ¨æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»å½“ä¸­ï¼Œä¼šè¯æŒ‡çš„å°±æ˜¯è°ˆè¯ã€äº¤è°ˆã€‚\nåœ¨webå¼€å‘å½“ä¸­ï¼Œä¼šè¯æŒ‡çš„å°±æ˜¯æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¸€æ¬¡è¿æ¥ï¼Œæˆ‘ä»¬å°±ç§°ä¸ºä¸€æ¬¡ä¼šè¯ã€‚\nåœ¨ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿™ä¸ªä¼šè¯å°±å»ºç«‹äº†ï¼Œç›´åˆ°æœ‰ä»»ä½•ä¸€æ–¹æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶ä¼šè¯å°±ç»“æŸäº†ã€‚åœ¨ä¸€æ¬¡ä¼šè¯å½“ä¸­ï¼Œæ˜¯å¯ä»¥åŒ…å«å¤šæ¬¡è¯·æ±‚å’Œå“åº”çš„ã€‚\næ¯”å¦‚ï¼šæ‰“å¼€äº†æµè§ˆå™¨æ¥è®¿é—®webæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆæµè§ˆå™¨ä¸èƒ½å…³é—­ã€æœåŠ¡å™¨ä¸èƒ½æ–­å¼€ï¼‰\nç¬¬1æ¬¡ï¼šè®¿é—®çš„æ˜¯ç™»å½•çš„æ¥å£ï¼Œå®Œæˆç™»å½•æ“ä½œ ç¬¬2æ¬¡ï¼šè®¿é—®çš„æ˜¯éƒ¨é—¨ç®¡ç†æ¥å£ï¼ŒæŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ® ç¬¬3æ¬¡ï¼šè®¿é—®çš„æ˜¯å‘˜å·¥ç®¡ç†æ¥å£ï¼ŒæŸ¥è¯¢å‘˜å·¥æ•°æ® åªè¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½æ²¡æœ‰å…³é—­ï¼Œä»¥ä¸Š3æ¬¡è¯·æ±‚éƒ½å±äºä¸€æ¬¡ä¼šè¯å½“ä¸­å®Œæˆçš„ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¼šè¯æ˜¯å’Œæµè§ˆå™¨å…³è”çš„ï¼Œå½“æœ‰ä¸‰ä¸ªæµè§ˆå™¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹äº†è¿æ¥æ—¶ï¼Œå°±ä¼šæœ‰ä¸‰ä¸ªä¼šè¯ã€‚åŒä¸€ä¸ªæµè§ˆå™¨åœ¨æœªå…³é—­ä¹‹å‰è¯·æ±‚äº†å¤šæ¬¡æœåŠ¡å™¨ï¼Œè¿™å¤šæ¬¡è¯·æ±‚æ˜¯å±äºåŒä¸€ä¸ªä¼šè¯ã€‚æ¯”å¦‚ï¼š1ã€2ã€3è¿™ä¸‰ä¸ªè¯·æ±‚éƒ½æ˜¯å±äºåŒä¸€ä¸ªä¼šè¯ã€‚å½“æˆ‘ä»¬å…³é—­æµè§ˆå™¨ä¹‹åï¼Œè¿™æ¬¡ä¼šè¯å°±ç»“æŸäº†ã€‚è€Œå¦‚æœæˆ‘ä»¬æ˜¯ç›´æ¥æŠŠwebæœåŠ¡å™¨å…³äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ä¼šè¯å°±éƒ½ç»“æŸäº†ã€‚\nçŸ¥é“äº†ä¼šè¯çš„æ¦‚å¿µäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥äº†è§£ä¸‹ä¼šè¯è·Ÿè¸ªã€‚\nä¼šè¯è·Ÿè¸ªï¼šä¸€ç§ç»´æŠ¤æµè§ˆå™¨çŠ¶æ€çš„æ–¹æ³•ï¼ŒæœåŠ¡å™¨éœ€è¦è¯†åˆ«å¤šæ¬¡è¯·æ±‚æ˜¯å¦æ¥è‡ªäºåŒä¸€æµè§ˆå™¨ï¼Œä»¥ä¾¿åœ¨åŒä¸€æ¬¡ä¼šè¯çš„å¤šæ¬¡è¯·æ±‚é—´å…±äº«æ•°æ®ã€‚\næœåŠ¡å™¨ä¼šæ¥æ”¶å¾ˆå¤šçš„è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨æ˜¯éœ€è¦è¯†åˆ«å‡ºè¿™äº›è¯·æ±‚æ˜¯ä¸æ˜¯åŒä¸€ä¸ªæµè§ˆå™¨å‘å‡ºæ¥çš„ã€‚æ¯”å¦‚ï¼š1å’Œ2è¿™ä¸¤ä¸ªè¯·æ±‚æ˜¯ä¸æ˜¯åŒä¸€ä¸ªæµè§ˆå™¨å‘å‡ºæ¥çš„ï¼Œ3å’Œ5è¿™ä¸¤ä¸ªè¯·æ±‚ä¸æ˜¯åŒä¸€ä¸ªæµè§ˆå™¨å‘å‡ºæ¥çš„ã€‚å¦‚æœæ˜¯åŒä¸€ä¸ªæµè§ˆå™¨å‘å‡ºæ¥çš„ï¼Œå°±è¯´æ˜æ˜¯åŒä¸€ä¸ªä¼šè¯ã€‚å¦‚æœæ˜¯ä¸åŒçš„æµè§ˆå™¨å‘å‡ºæ¥çš„ï¼Œå°±è¯´æ˜æ˜¯ä¸åŒçš„ä¼šè¯ã€‚è€Œè¯†åˆ«å¤šæ¬¡è¯·æ±‚æ˜¯å¦æ¥è‡ªäºåŒä¸€æµè§ˆå™¨çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±ç§°ä¸ºä¼šè¯è·Ÿè¸ªã€‚\næˆ‘ä»¬ä½¿ç”¨ä¼šè¯è·Ÿè¸ªæŠ€æœ¯å°±æ˜¯è¦å®Œæˆåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ï¼Œå¤šä¸ªè¯·æ±‚ä¹‹é—´è¿›è¡Œå…±äº«æ•°æ®ã€‚\nä¸ºä»€ä¹ˆè¦å…±äº«æ•°æ®å‘¢ï¼Ÿ\nç”±äºHTTPæ˜¯æ— çŠ¶æ€åè®®ï¼Œåœ¨åé¢è¯·æ±‚ä¸­æ€ä¹ˆæ‹¿åˆ°å‰ä¸€æ¬¡è¯·æ±‚ç”Ÿæˆçš„æ•°æ®å‘¢ï¼Ÿæ­¤æ—¶å°±éœ€è¦åœ¨ä¸€æ¬¡ä¼šè¯çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´è¿›è¡Œæ•°æ®å…±äº«\nä¼šè¯è·Ÿè¸ªæŠ€æœ¯æœ‰ä¸¤ç§ï¼š\nCookieï¼ˆå®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼‰ æ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨å½“ä¸­ Sessionï¼ˆæœåŠ¡ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼‰ æ•°æ®å­˜å‚¨åœ¨å‚¨åœ¨æœåŠ¡ç«¯ ä»¤ç‰ŒæŠ€æœ¯ ç™»å½•è®¤è¯-ç™»å½•æ ¡éªŒ-ä¼šè¯è·Ÿè¸ªæ–¹æ¡ˆä¸€ ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†ä»€ä¹ˆæ˜¯ä¼šè¯ï¼Œä»€ä¹ˆæ˜¯ä¼šè¯è·Ÿè¸ªï¼Œå¹¶ä¸”ä¹Ÿæåˆ°äº†ä¼šè¯è·Ÿè¸ª 3 ç§å¸¸è§çš„æŠ€æœ¯æ–¹æ¡ˆã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å¯¹æ¯”ä¸€ä¸‹è¿™ 3 ç§ä¼šè¯è·Ÿè¸ªçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ¥çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°æ€è·¯ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¼˜ç¼ºç‚¹ã€‚\næ–¹æ¡ˆä¸€-Cookie cookie æ˜¯å®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼Œå®ƒæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ cookie æ¥è·Ÿè¸ªä¼šè¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æµè§ˆå™¨ç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚æ¥è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯æ¥è®¾ç½®ä¸€ä¸ªcookieã€‚\næ¯”å¦‚ç¬¬ä¸€æ¬¡è¯·æ±‚äº†ç™»å½•æ¥å£ï¼Œç™»å½•æ¥å£æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¾ç½®ä¸€ä¸ªcookieï¼Œåœ¨ cookie å½“ä¸­æˆ‘ä»¬å°±å¯ä»¥æ¥å­˜å‚¨ç”¨æˆ·ç›¸å…³çš„ä¸€äº›æ•°æ®ä¿¡æ¯ã€‚æ¯”å¦‚æˆ‘å¯ä»¥åœ¨ cookie å½“ä¸­æ¥å­˜å‚¨å½“å‰ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åï¼Œç”¨æˆ·çš„IDã€‚\næœåŠ¡å™¨ç«¯åœ¨ç»™å®¢æˆ·ç«¯åœ¨å“åº”æ•°æ®çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨çš„å°† cookie å“åº”ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°å“åº”å›æ¥çš„ cookie ä¹‹åï¼Œä¼šè‡ªåŠ¨çš„å°† cookie çš„å€¼å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚æ¥ä¸‹æ¥åœ¨åç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚å½“ä¸­ï¼Œéƒ½ä¼šå°†æµè§ˆå™¨æœ¬åœ°æ‰€å­˜å‚¨çš„ cookie è‡ªåŠ¨åœ°æºå¸¦åˆ°æœåŠ¡ç«¯ã€‚\næ¥ä¸‹æ¥åœ¨æœåŠ¡ç«¯æˆ‘ä»¬å°±å¯ä»¥è·å–åˆ° cookie çš„å€¼ã€‚æˆ‘ä»¬å¯ä»¥å»åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ª cookie çš„å€¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ä¸ªcookieï¼Œå°±è¯´æ˜å®¢æˆ·ç«¯ä¹‹å‰æ˜¯æ²¡æœ‰è®¿é—®ç™»å½•æ¥å£çš„ï¼›å¦‚æœå­˜åœ¨ cookie çš„å€¼ï¼Œå°±è¯´æ˜å®¢æˆ·ç«¯ä¹‹å‰å·²ç»ç™»å½•å®Œæˆäº†ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åŸºäº cookie åœ¨åŒä¸€æ¬¡ä¼šè¯çš„ä¸åŒè¯·æ±‚ä¹‹é—´æ¥å…±äº«æ•°æ®ã€‚\næˆ‘åˆšæ‰åœ¨ä»‹ç»æµç¨‹çš„æ—¶å€™ï¼Œç”¨äº† 3 ä¸ªè‡ªåŠ¨ï¼š\næœåŠ¡å™¨ä¼š è‡ªåŠ¨ çš„å°† cookie å“åº”ç»™æµè§ˆå™¨ã€‚ æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”å›æ¥çš„æ•°æ®ä¹‹åï¼Œä¼š è‡ªåŠ¨ çš„å°† cookie å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚ åœ¨åç»­çš„è¯·æ±‚å½“ä¸­ï¼Œæµè§ˆå™¨ä¼š è‡ªåŠ¨ çš„å°† cookie æºå¸¦åˆ°æœåŠ¡å™¨ç«¯ã€‚ ä¸ºä»€ä¹ˆè¿™ä¸€åˆ‡éƒ½æ˜¯è‡ªåŠ¨åŒ–è¿›è¡Œçš„ï¼Ÿ\næ˜¯å› ä¸º cookie å®ƒæ˜¯ HTP åè®®å½“ä¸­æ‰€æ”¯æŒçš„æŠ€æœ¯ï¼Œè€Œå„å¤§æµè§ˆå™¨å‚å•†éƒ½æ”¯æŒäº†è¿™ä¸€æ ‡å‡†ã€‚åœ¨ HTTP åè®®å®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå“åº”å¤´å’Œè¯·æ±‚å¤´ï¼š\nå“åº”å¤´ Set-Cookie ï¼šè®¾ç½®Cookieæ•°æ®çš„ è¯·æ±‚å¤´ Cookieï¼šæºå¸¦Cookieæ•°æ®çš„ ä»£ç æµ‹è¯•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Slf4j @RestController public class SessionController { //è®¾ç½®Cookie @GetMapping(\u0026#34;/c1\u0026#34;) public Result cookie1(HttpServletResponse response){ response.addCookie(new Cookie(\u0026#34;login_username\u0026#34;,\u0026#34;itheima\u0026#34;)); //è®¾ç½®Cookie/å“åº”Cookie return Result.success(); } //è·å–Cookie @GetMapping(\u0026#34;/c2\u0026#34;) public Result cookie2(HttpServletRequest request){ Cookie[] cookies = request.getCookies(); for (Cookie cookie : cookies) { if(cookie.getName().equals(\u0026#34;login_username\u0026#34;)){ System.out.println(\u0026#34;login_username: \u0026#34;+cookie.getValue()); //è¾“å‡ºnameä¸ºlogin_usernameçš„cookie } } return Result.success(); } } A. è®¿é—®c1æ¥å£ï¼Œè®¾ç½®Cookieï¼Œhttp://localhost:8080/c1\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½®çš„cookieï¼Œé€šè¿‡å“åº”å¤´Set-Cookieå“åº”ç»™æµè§ˆå™¨ï¼Œå¹¶ä¸”æµè§ˆå™¨ä¼šå°†Cookieï¼Œå­˜å‚¨åœ¨æµè§ˆå™¨ç«¯ã€‚\nB. è®¿é—®c2æ¥å£ http://localhost:8080/c2ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šè‡ªåŠ¨çš„å°†Cookieæºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œæ˜¯é€šè¿‡è¯·æ±‚å¤´Cookieï¼Œæºå¸¦çš„ã€‚\nä¼˜ç¼ºç‚¹\nä¼˜ç‚¹ï¼šHTTPåè®®ä¸­æ”¯æŒçš„æŠ€æœ¯ï¼ˆåƒSet-Cookie å“åº”å¤´çš„è§£æä»¥åŠ Cookie è¯·æ±‚å¤´æ•°æ®çš„æºå¸¦ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ˜¯æ— éœ€æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œçš„ï¼‰ ç¼ºç‚¹ï¼š ç§»åŠ¨ç«¯APP(Androidã€IOS)ä¸­æ— æ³•ä½¿ç”¨Cookie ä¸å®‰å…¨ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±ç¦ç”¨Cookie Cookieä¸èƒ½è·¨åŸŸ è·¨åŸŸä»‹ç»ï¼š\nç°åœ¨çš„é¡¹ç›®ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å‰åç«¯åˆ†ç¦»çš„ï¼Œå‰åç«¯æœ€ç»ˆä¹Ÿä¼šåˆ†å¼€éƒ¨ç½²ï¼Œå‰ç«¯éƒ¨ç½²åœ¨æœåŠ¡å™¨ 192.168.150.200 ä¸Šï¼Œç«¯å£ 80ï¼Œåç«¯éƒ¨ç½²åœ¨ 192.168.150.100ä¸Šï¼Œç«¯å£ 8080 æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ç›´æ¥è®¿é—®å‰ç«¯å·¥ç¨‹ï¼Œè®¿é—®urlï¼šhttp://192.168.150.200/login.html ç„¶ååœ¨è¯¥é¡µé¢å‘èµ·è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè€ŒæœåŠ¡ç«¯æ‰€åœ¨åœ°å€ä¸å†æ˜¯localhostï¼Œè€Œæ˜¯æœåŠ¡å™¨çš„IPåœ°å€192.168.150.100ï¼Œå‡è®¾è®¿é—®æ¥å£åœ°å€ä¸ºï¼šhttp://192.168.150.100:8080/login é‚£æ­¤æ—¶å°±å­˜åœ¨è·¨åŸŸæ“ä½œäº†ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ http://192.168.150.200/login.html è¿™ä¸ªé¡µé¢ä¸Šè®¿é—®äº†http://192.168.150.100:8080/login æ¥å£ æ­¤æ—¶å¦‚æœæœåŠ¡å™¨è®¾ç½®äº†ä¸€ä¸ªCookieï¼Œè¿™ä¸ªCookieæ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼Œå› ä¸ºCookieæ— æ³•è·¨åŸŸ åŒºåˆ†è·¨åŸŸçš„ç»´åº¦ï¼š\nåè®® IP/åè®® ç«¯å£ åªè¦ä¸Šè¿°çš„ä¸‰ä¸ªç»´åº¦æœ‰ä»»ä½•ä¸€ä¸ªç»´åº¦ä¸åŒï¼Œé‚£å°±æ˜¯è·¨åŸŸæ“ä½œ\nä¸¾ä¾‹ï¼š\nhttp://192.168.150.200/login.html \u0026mdash;\u0026mdash;\u0026mdash;-\u0026gt; https://192.168.150.200/login [åè®®ä¸åŒï¼Œè·¨åŸŸ]\nhttp://192.168.150.200/login.html \u0026mdash;\u0026mdash;\u0026mdash;-\u0026gt; http://192.168.150.100/login [IPä¸åŒï¼Œè·¨åŸŸ]\nhttp://192.168.150.200/login.html \u0026mdash;\u0026mdash;\u0026mdash;-\u0026gt; http://192.168.150.200:8080/login [ç«¯å£ä¸åŒï¼Œè·¨åŸŸ]\nhttp://192.168.150.200/login.html \u0026mdash;\u0026mdash;\u0026mdash;-\u0026gt; http://192.168.150.200/login [ä¸è·¨åŸŸ]\nç™»å½•è®¤è¯-ç™»å½•æ ¡éªŒ-ä¼šè¯è·Ÿè¸ªæ–¹æ¡ˆäºŒã€ä¸‰ æ–¹æ¡ˆäºŒ-Session å‰é¢ä»‹ç»çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°Sessionï¼Œå®ƒæ˜¯æœåŠ¡å™¨ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼Œæ‰€ä»¥å®ƒæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ã€‚è€Œ Session çš„åº•å±‚å…¶å®å°±æ˜¯åŸºäºæˆ‘ä»¬åˆšæ‰æ‰€ä»‹ç»çš„ Cookie æ¥å®ç°çš„ã€‚\nè·å–Session\nå¦‚æœæˆ‘ä»¬ç°åœ¨è¦åŸºäº Session æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼Œæµè§ˆå™¨åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨å½“ä¸­æ¥è·å–åˆ°ä¼šè¯å¯¹è±¡Sessionã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚Session ï¼Œä¼šè¯å¯¹è±¡æ˜¯ä¸å­˜åœ¨çš„ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨ä¼šè‡ªåŠ¨çš„åˆ›å»ºä¸€ä¸ªä¼šè¯å¯¹è±¡Session ã€‚è€Œæ¯ä¸€ä¸ªä¼šè¯å¯¹è±¡Session ï¼Œå®ƒéƒ½æœ‰ä¸€ä¸ªIDï¼ˆç¤ºæ„å›¾ä¸­Sessionåé¢æ‹¬å·ä¸­çš„1ï¼Œå°±è¡¨ç¤ºIDï¼‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Session çš„IDã€‚\nå“åº”Cookie (JSESSIONID)\næ¥ä¸‹æ¥ï¼ŒæœåŠ¡å™¨ç«¯åœ¨ç»™æµè§ˆå™¨å“åº”æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šå°† Session çš„ ID é€šè¿‡ Cookie å“åº”ç»™æµè§ˆå™¨ã€‚å…¶å®åœ¨å“åº”å¤´å½“ä¸­å¢åŠ äº†ä¸€ä¸ª Set-Cookie å“åº”å¤´ã€‚è¿™ä¸ª Set-Cookie å“åº”å¤´å¯¹åº”çš„å€¼æ˜¯ä¸æ˜¯cookieï¼Ÿ cookie çš„åå­—æ˜¯å›ºå®šçš„ JSESSIONID ä»£è¡¨çš„æœåŠ¡å™¨ç«¯ä¼šè¯å¯¹è±¡ Session çš„ IDã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨è¯†åˆ«è¿™ä¸ªå“åº”å¤´ï¼Œç„¶åè‡ªåŠ¨å°†Cookieå­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚\næŸ¥æ‰¾Session\næ¥ä¸‹æ¥ï¼Œåœ¨åç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚å½“ä¸­ï¼Œéƒ½ä¼šå°† Cookie çš„æ•°æ®è·å–å‡ºæ¥ï¼Œå¹¶ä¸”æºå¸¦åˆ°æœåŠ¡ç«¯ã€‚æ¥ä¸‹æ¥æœåŠ¡å™¨æ‹¿åˆ°JSESSIONIDè¿™ä¸ª Cookie çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ Session çš„IDã€‚æ‹¿åˆ° ID ä¹‹åï¼Œå°±ä¼šä»ä¼—å¤šçš„ Session å½“ä¸­æ¥æ‰¾åˆ°å½“å‰è¯·æ±‚å¯¹åº”çš„ä¼šè¯å¯¹è±¡Sessionã€‚\nè¿™æ ·æˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥é€šè¿‡ Session ä¼šè¯å¯¹è±¡åœ¨åŒä¸€æ¬¡ä¼šè¯çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´æ¥å…±äº«æ•°æ®äº†ï¼Ÿå¥½ï¼Œè¿™å°±æ˜¯åŸºäº Session è¿›è¡Œä¼šè¯è·Ÿè¸ªçš„æµç¨‹ã€‚\nä»£ç æµ‹è¯•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Slf4j @RestController public class SessionController { @GetMapping(\u0026#34;/s1\u0026#34;) public Result session1(HttpSession session){ log.info(\u0026#34;HttpSession-s1: {}\u0026#34;, session.hashCode()); session.setAttribute(\u0026#34;loginUser\u0026#34;, \u0026#34;tom\u0026#34;); //å¾€sessionä¸­å­˜å‚¨æ•°æ® return Result.success(); } @GetMapping(\u0026#34;/s2\u0026#34;) public Result session2(HttpServletRequest request){ HttpSession session = request.getSession(); log.info(\u0026#34;HttpSession-s2: {}\u0026#34;, session.hashCode()); Object loginUser = session.getAttribute(\u0026#34;loginUser\u0026#34;); //ä»sessionä¸­è·å–æ•°æ® log.info(\u0026#34;loginUser: {}\u0026#34;, loginUser); return Result.success(loginUser); } } A. è®¿é—® s1 æ¥å£ï¼Œhttp://localhost:8080/s1\nè¯·æ±‚å®Œæˆä¹‹åï¼Œåœ¨å“åº”å¤´ä¸­ï¼Œå°±ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ªSet-Cookieçš„å“åº”å¤´ï¼Œé‡Œé¢å“åº”å›æ¥äº†ä¸€ä¸ªCookieï¼Œå°±æ˜¯JSESSIONIDï¼Œè¿™ä¸ªå°±æ˜¯æœåŠ¡ç«¯ä¼šè¯å¯¹è±¡ Session çš„IDã€‚\nB. è®¿é—® s2 æ¥å£ï¼Œhttp://localhost:8080/s2\næ¥ä¸‹æ¥ï¼Œåœ¨åç»­çš„æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šå°†Cookieçš„å€¼ï¼Œæºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œé‚£æœåŠ¡ç«¯å‘¢ï¼Œæ¥æ”¶åˆ°Cookieä¹‹åï¼Œä¼šè‡ªåŠ¨çš„æ ¹æ®JSESSIONIDçš„å€¼ï¼Œæ‰¾åˆ°å¯¹åº”çš„ä¼šè¯å¯¹è±¡Sessionã€‚\né‚£ç»è¿‡è¿™ä¸¤æ­¥æµ‹è¯•ï¼Œå¤§å®¶ä¹Ÿä¼šçœ‹åˆ°ï¼Œåœ¨æ§åˆ¶å°ä¸­è¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š\nä¸¤æ¬¡è¯·æ±‚ï¼Œè·å–åˆ°çš„Sessionä¼šè¯å¯¹è±¡çš„hashcodeæ˜¯ä¸€æ ·çš„ï¼Œå°±è¯´æ˜æ˜¯åŒä¸€ä¸ªä¼šè¯å¯¹è±¡ã€‚è€Œä¸”ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œå¾€Sessionä¼šè¯å¯¹è±¡ä¸­å­˜å‚¨çš„å€¼ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œä¹Ÿè·å–åˆ°äº†ã€‚ é‚£è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Sessionä¼šè¯å¯¹è±¡ï¼Œåœ¨åŒä¸€ä¸ªä¼šè¯çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´æ¥è¿›è¡Œæ•°æ®å…±äº«äº†ã€‚\nä¼˜ç¼ºç‚¹\nä¼˜ç‚¹ï¼šSessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡ç«¯çš„ï¼Œå®‰å…¨ ç¼ºç‚¹ï¼š æœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒä¸‹æ— æ³•ç›´æ¥ä½¿ç”¨Session ç§»åŠ¨ç«¯APP(Androidã€IOS)ä¸­æ— æ³•ä½¿ç”¨Cookie ç”¨æˆ·å¯ä»¥è‡ªå·±ç¦ç”¨Cookie Cookieä¸èƒ½è·¨åŸŸ PSï¼šSession åº•å±‚æ˜¯åŸºäºCookieå®ç°çš„ä¼šè¯è·Ÿè¸ªï¼Œå¦‚æœCookieä¸å¯ç”¨ï¼Œåˆ™è¯¥æ–¹æ¡ˆï¼Œä¹Ÿå°±å¤±æ•ˆäº†ã€‚\næœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒä¸ºä½•æ— æ³•ä½¿ç”¨Sessionï¼Ÿ\né¦–å…ˆç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç°åœ¨æ‰€å¼€å‘çš„é¡¹ç›®ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šåªéƒ¨ç½²åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå› ä¸ºä¸€å°æœåŠ¡å™¨ä¼šå­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå°±æ˜¯å•ç‚¹æ•…éšœã€‚æ‰€è°“å•ç‚¹æ•…éšœï¼ŒæŒ‡çš„å°±æ˜¯ä¸€æ—¦è¿™å°æœåŠ¡å™¨æŒ‚äº†ï¼Œæ•´ä¸ªåº”ç”¨éƒ½æ²¡æ³•è®¿é—®äº†ã€‚ æ‰€ä»¥åœ¨ç°åœ¨çš„ä¼ä¸šé¡¹ç›®å¼€å‘å½“ä¸­ï¼Œæœ€ç»ˆéƒ¨ç½²çš„æ—¶å€™éƒ½æ˜¯ä»¥é›†ç¾¤çš„å½¢å¼æ¥è¿›è¡Œéƒ¨ç½²ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªé¡¹ç›®å®ƒä¼šéƒ¨ç½²å¤šä»½ã€‚æ¯”å¦‚è¿™ä¸ªé¡¹ç›®æˆ‘ä»¬ç°åœ¨å°±éƒ¨ç½²äº† 3 ä»½ã€‚\nè€Œç”¨æˆ·åœ¨è®¿é—®çš„æ—¶å€™ï¼Œåˆ°åº•è®¿é—®è¿™ä¸‰å°å…¶ä¸­çš„å“ªä¸€å°ï¼Ÿå…¶å®ç”¨æˆ·åœ¨è®¿é—®çš„æ—¶å€™ï¼Œä»–ä¼šè®¿é—®ä¸€å°å‰ç½®çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å«è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åœ¨åé¢é¡¹ç›®å½“ä¸­ä¼šè¯¦ç»†è®²è§£ã€‚ç›®å‰å¤§å®¶å…ˆæœ‰ä¸€ä¸ªå°è±¡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†å‰ç«¯å‘èµ·çš„è¯·æ±‚å‡åŒ€çš„åˆ†å‘ç»™åé¢çš„è¿™ä¸‰å°æœåŠ¡å™¨ã€‚\næ­¤æ—¶å‡å¦‚æˆ‘ä»¬é€šè¿‡ session æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼Œå¯èƒ½å°±ä¼šå­˜åœ¨è¿™æ ·ä¸€ä¸ªé—®é¢˜ã€‚ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨è¦è¿›è¡Œç™»å½•æ“ä½œï¼Œæ­¤æ—¶ä¼šå‘èµ·ç™»å½•è¯·æ±‚ã€‚ç™»å½•è¯·æ±‚åˆ°è¾¾è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå°†è¿™ä¸ªè¯·æ±‚è½¬ç»™äº†ç¬¬ä¸€å° Tomcat æœåŠ¡å™¨ã€‚\nTomcat æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œè¦è·å–åˆ°ä¼šè¯å¯¹è±¡sessionã€‚è·å–åˆ°ä¼šè¯å¯¹è±¡ session ä¹‹åï¼Œè¦ç»™æµè§ˆå™¨å“åº”æ•°æ®ï¼Œæœ€ç»ˆåœ¨ç»™æµè§ˆå™¨å“åº”æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šæºå¸¦è¿™ä¹ˆä¸€ä¸ª cookie çš„åå­—ï¼Œå°±æ˜¯ JSESSIONID ï¼Œä¸‹ä¸€æ¬¡å†è¯·æ±‚çš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯åˆä¼šå°† Cookie æºå¸¦åˆ°æœåŠ¡ç«¯ï¼Ÿ\nå¥½ã€‚æ­¤æ—¶å‡å¦‚åˆæ‰§è¡Œäº†ä¸€æ¬¡æŸ¥è¯¢æ“ä½œï¼Œè¦æŸ¥è¯¢éƒ¨é—¨çš„æ•°æ®ã€‚è¿™æ¬¡è¯·æ±‚åˆ°è¾¾è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¹‹åï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨å°†è¿™æ¬¡è¯·æ±‚è½¬ç»™äº†ç¬¬äºŒå° Tomcat æœåŠ¡å™¨ï¼Œæ­¤æ—¶ä»–å°±è¦åˆ°ç¬¬äºŒå° Tomcat æœåŠ¡å™¨å½“ä¸­ã€‚æ ¹æ®JSESSIONID ä¹Ÿå°±æ˜¯å¯¹åº”çš„ session çš„ ID å€¼ï¼Œè¦æ‰¾å¯¹åº”çš„ session ä¼šè¯å¯¹è±¡ã€‚\næˆ‘æƒ³è¯·é—®åœ¨ç¬¬äºŒå°æœåŠ¡å™¨å½“ä¸­æœ‰æ²¡æœ‰è¿™ä¸ªIDçš„ä¼šè¯å¯¹è±¡ Sessionï¼Œ æ˜¯æ²¡æœ‰çš„ã€‚æ­¤æ—¶æ˜¯ä¸æ˜¯å°±å‡ºç°é—®é¢˜äº†ï¼Ÿæˆ‘åŒä¸€ä¸ªæµè§ˆå™¨å‘èµ·äº† 2 æ¬¡è¯·æ±‚ï¼Œç»“æœè·å–åˆ°çš„ä¸æ˜¯åŒä¸€ä¸ªä¼šè¯å¯¹è±¡ï¼Œè¿™å°±æ˜¯Sessionè¿™ç§ä¼šè¯è·Ÿè¸ªæ–¹æ¡ˆå®ƒçš„ç¼ºç‚¹ï¼Œåœ¨æœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒä¸‹æ— æ³•ç›´æ¥ä½¿ç”¨Sessionã€‚\nå¤§å®¶ä¼šçœ‹åˆ°ä¸Šé¢è¿™ä¸¤ç§ä¼ ç»Ÿçš„ä¼šè¯æŠ€æœ¯ï¼Œåœ¨ç°åœ¨çš„ä¼ä¸šå¼€å‘å½“ä¸­æ˜¯ä¸æ˜¯ä¼šå­˜åœ¨å¾ˆå¤šçš„é—®é¢˜ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œåœ¨ç°åœ¨çš„ä¼ä¸šå¼€å‘å½“ä¸­ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šé‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œé€šè¿‡ä»¤ç‰ŒæŠ€æœ¯æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹ä»¤ç‰ŒæŠ€æœ¯ï¼Œæ¥çœ‹ä¸€ä¸‹ä»¤ç‰ŒæŠ€æœ¯åˆæ˜¯å¦‚ä½•è·Ÿè¸ªä¼šè¯çš„ã€‚\nç™»å½•æ ¡éªŒ-JWTä»¤ç‰Œ-ä»‹ç» å‰é¢æˆ‘ä»¬ä»‹ç»äº†åŸºäºä»¤ç‰ŒæŠ€æœ¯æ¥å®ç°ä¼šè¯è¿½è¸ªã€‚è¿™é‡Œæ‰€æåˆ°çš„ä»¤ç‰Œå°±æ˜¯ç”¨æˆ·èº«ä»½çš„æ ‡è¯†ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä»¤ç‰Œçš„å½¢å¼æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åŠŸèƒ½å¼ºå¤§çš„ JWTä»¤ç‰Œã€‚\nä»‹ç» JWTå…¨ç§°ï¼šJSON Web Token ï¼ˆå®˜ç½‘ï¼šhttps://jwt.io/ï¼‰\nå®šä¹‰äº†ä¸€ç§ç®€æ´çš„ã€è‡ªåŒ…å«çš„æ ¼å¼ï¼Œç”¨äºåœ¨é€šä¿¡åŒæ–¹ä»¥jsonæ•°æ®æ ¼å¼å®‰å…¨çš„ä¼ è¾“ä¿¡æ¯ã€‚ç”±äºæ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å¯é çš„ã€‚\nç®€æ´ï¼šæ˜¯æŒ‡jwtå°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥åœ¨è¯·æ±‚å‚æ•°æˆ–è€…æ˜¯è¯·æ±‚å¤´å½“ä¸­ç›´æ¥ä¼ é€’ã€‚\nè‡ªåŒ…å«ï¼šæŒ‡çš„æ˜¯jwtä»¤ç‰Œï¼Œçœ‹ä¼¼æ˜¯ä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚åœ¨jwtä»¤ç‰Œä¸­å­˜å‚¨è‡ªå®šä¹‰çš„æ•°æ®å†…å®¹ã€‚å¦‚ï¼šå¯ä»¥ç›´æ¥åœ¨jwtä»¤ç‰Œä¸­å­˜å‚¨ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ã€‚\nç®€å•æ¥è®²ï¼Œjwtå°±æ˜¯å°†åŸå§‹çš„jsonæ•°æ®æ ¼å¼è¿›è¡Œäº†å®‰å…¨çš„å°è£…ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åŸºäºjwtåœ¨é€šä¿¡åŒæ–¹å®‰å…¨çš„è¿›è¡Œä¿¡æ¯ä¼ è¾“äº†ã€‚\nJWTçš„ç»„æˆï¼š ï¼ˆJWTä»¤ç‰Œç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œä¸‰ä¸ªéƒ¨åˆ†ä¹‹é—´ä½¿ç”¨è‹±æ–‡çš„ç‚¹æ¥åˆ†å‰²ï¼‰\nç¬¬ä¸€éƒ¨åˆ†ï¼šHeader(å¤´ï¼‰ï¼Œ è®°å½•ä»¤ç‰Œç±»å‹ã€ç­¾åç®—æ³•ç­‰ã€‚ ä¾‹å¦‚ï¼š{\u0026ldquo;alg\u0026rdquo;:\u0026ldquo;HS256\u0026rdquo;,\u0026ldquo;type\u0026rdquo;:\u0026ldquo;JWT\u0026rdquo;}\nç¬¬äºŒéƒ¨åˆ†ï¼šPayload(æœ‰æ•ˆè½½è·ï¼‰ï¼Œæºå¸¦ä¸€äº›è‡ªå®šä¹‰ä¿¡æ¯ã€é»˜è®¤ä¿¡æ¯ç­‰ã€‚ ä¾‹å¦‚ï¼š{\u0026ldquo;id\u0026rdquo;:\u0026ldquo;1\u0026rdquo;,\u0026ldquo;username\u0026rdquo;:\u0026ldquo;Tom\u0026rdquo;}\nç¬¬ä¸‰éƒ¨åˆ†ï¼šSignature(ç­¾åï¼‰ï¼Œé˜²æ­¢Tokenè¢«ç¯¡æ”¹ã€ç¡®ä¿å®‰å…¨æ€§ã€‚å°†headerã€payloadï¼Œå¹¶åŠ å…¥æŒ‡å®šç§˜é’¥ï¼Œé€šè¿‡æŒ‡å®šç­¾åç®—æ³•è®¡ç®—è€Œæ¥ã€‚\nç­¾åçš„ç›®çš„å°±æ˜¯ä¸ºäº†é˜²jwtä»¤ç‰Œè¢«ç¯¡æ”¹ï¼Œè€Œæ­£æ˜¯å› ä¸ºjwtä»¤ç‰Œæœ€åä¸€ä¸ªéƒ¨åˆ†æ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œæ‰€ä»¥æ•´ä¸ªjwt ä»¤ç‰Œæ˜¯éå¸¸å®‰å…¨å¯é çš„ã€‚ä¸€æ—¦jwtä»¤ç‰Œå½“ä¸­ä»»ä½•ä¸€ä¸ªéƒ¨åˆ†ã€ä»»ä½•ä¸€ä¸ªå­—ç¬¦è¢«ç¯¡æ”¹äº†ï¼Œæ•´ä¸ªä»¤ç‰Œåœ¨æ ¡éªŒçš„æ—¶å€™éƒ½ä¼šå¤±è´¥ï¼Œæ‰€ä»¥å®ƒæ˜¯éå¸¸å®‰å…¨å¯é çš„ã€‚\nJWTæ˜¯å¦‚ä½•å°†åŸå§‹çš„JSONæ ¼å¼æ•°æ®ï¼Œè½¬å˜ä¸ºå­—ç¬¦ä¸²çš„å‘¢ï¼Ÿ\nå…¶å®åœ¨ç”ŸæˆJWTä»¤ç‰Œæ—¶ï¼Œä¼šå¯¹JSONæ ¼å¼çš„æ•°æ®è¿›è¡Œä¸€æ¬¡ç¼–ç ï¼šè¿›è¡Œbase64ç¼–ç \nBase64ï¼šæ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°çš„å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„ç¼–ç æ–¹å¼ã€‚æ—¢ç„¶èƒ½ç¼–ç ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€ä¹Ÿèƒ½è§£ç ã€‚æ‰€ä½¿ç”¨çš„64ä¸ªå­—ç¬¦åˆ†åˆ«æ˜¯Aåˆ°Zã€aåˆ°zã€ 0- 9ï¼Œä¸€ä¸ªåŠ å·ï¼Œä¸€ä¸ªæ–œæ ï¼ŒåŠ èµ·æ¥å°±æ˜¯64ä¸ªå­—ç¬¦ã€‚ä»»ä½•æ•°æ®ç»è¿‡base64ç¼–ç ä¹‹åï¼Œæœ€ç»ˆå°±ä¼šé€šè¿‡è¿™64ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºã€‚å½“ç„¶è¿˜æœ‰ä¸€ä¸ªç¬¦å·ï¼Œé‚£å°±æ˜¯ç­‰å·ã€‚ç­‰å·å®ƒæ˜¯ä¸€ä¸ªè¡¥ä½çš„ç¬¦å·\néœ€è¦æ³¨æ„çš„æ˜¯Base64æ˜¯ç¼–ç æ–¹å¼ï¼Œè€Œä¸æ˜¯åŠ å¯†æ–¹å¼ã€‚\nJWTä»¤ç‰Œæœ€å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯ç™»å½•è®¤è¯ï¼š\nåœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚æ¥æ‰§è¡Œç™»å½•æ“ä½œï¼Œæ­¤æ—¶ä¼šè®¿é—®ç™»å½•çš„æ¥å£ï¼Œå¦‚æœç™»å½•æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªjwtä»¤ç‰Œï¼Œå°†ç”Ÿæˆçš„ jwtä»¤ç‰Œè¿”å›ç»™å‰ç«¯ã€‚ å‰ç«¯æ‹¿åˆ°jwtä»¤ç‰Œä¹‹åï¼Œä¼šå°†jwtä»¤ç‰Œå­˜å‚¨èµ·æ¥ã€‚åœ¨åç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚ä¸­éƒ½ä¼šå°†jwtä»¤ç‰Œæºå¸¦åˆ°æœåŠ¡ç«¯ã€‚ æœåŠ¡ç«¯ç»Ÿä¸€æ‹¦æˆªè¯·æ±‚ä¹‹åï¼Œå…ˆæ¥åˆ¤æ–­ä¸€ä¸‹è¿™æ¬¡è¯·æ±‚æœ‰æ²¡æœ‰æŠŠä»¤ç‰Œå¸¦è¿‡æ¥ï¼Œå¦‚æœæ²¡æœ‰å¸¦è¿‡æ¥ï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œå¦‚æœå¸¦è¿‡æ¥äº†ï¼Œè¿˜è¦æ ¡éªŒä¸€ä¸‹ä»¤ç‰Œæ˜¯å¦æ˜¯æœ‰æ•ˆã€‚å¦‚æœæœ‰æ•ˆï¼Œå°±ç›´æ¥æ”¾è¡Œè¿›è¡Œè¯·æ±‚çš„å¤„ç†ã€‚ åœ¨JWTç™»å½•è®¤è¯çš„åœºæ™¯ä¸­æˆ‘ä»¬å‘ç°ï¼Œæ•´ä¸ªæµç¨‹å½“ä¸­æ¶‰åŠåˆ°ä¸¤æ­¥æ“ä½œï¼š\nåœ¨ç™»å½•æˆåŠŸä¹‹åï¼Œè¦ç”Ÿæˆä»¤ç‰Œã€‚ æ¯ä¸€æ¬¡è¯·æ±‚å½“ä¸­ï¼Œè¦æ¥æ”¶ä»¤ç‰Œå¹¶å¯¹ä»¤ç‰Œè¿›è¡Œæ ¡éªŒã€‚ ç¨åæˆ‘ä»¬å†æ¥å­¦ä¹ å¦‚ä½•æ¥ç”Ÿæˆjwtä»¤ç‰Œï¼Œä»¥åŠå¦‚ä½•æ¥æ ¡éªŒjwtä»¤ç‰Œã€‚\nç™»å½•æ ¡éªŒ-JWTä»¤ç‰Œ-ç”Ÿæˆå’Œæ ¡éªŒ ç”Ÿæˆå’Œæ ¡éªŒ ç®€å•ä»‹ç»äº†JWTä»¤ç‰Œä»¥åŠJWTä»¤ç‰Œçš„ç»„æˆä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å­¦ä¹ åŸºäºJavaä»£ç å¦‚ä½•ç”Ÿæˆå’Œæ ¡éªŒJWTä»¤ç‰Œã€‚\né¦–å…ˆæˆ‘ä»¬å…ˆæ¥å®ç°JWTä»¤ç‰Œçš„ç”Ÿæˆã€‚è¦æƒ³ä½¿ç”¨JWTä»¤ç‰Œï¼Œéœ€è¦å…ˆå¼•å…¥JWTçš„ä¾èµ–ï¼š\n1 2 3 4 5 6 \u0026lt;!-- JWTä¾èµ–--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.9.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨å¼•å…¥å®ŒJWTæ¥èµ–åï¼Œå°±å¯ä»¥è°ƒç”¨å·¥å…·åŒ…ä¸­æä¾›çš„APIæ¥å®ŒæˆJWTä»¤ç‰Œçš„ç”Ÿæˆå’Œæ ¡éªŒ\nå·¥å…·ç±»ï¼šJwts\nç”ŸæˆJWTä»£ç å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Test public void genJwt(){ Map\u0026lt;String,Object\u0026gt; claims = new HashMap\u0026lt;\u0026gt;(); claims.put(\u0026#34;id\u0026#34;,1); claims.put(\u0026#34;username\u0026#34;,\u0026#34;Tom\u0026#34;); String jwt = Jwts.builder() .setClaims(claims) //è‡ªå®šä¹‰å†…å®¹(è½½è·) .signWith(SignatureAlgorithm.HS256, \u0026#34;itheima\u0026#34;) //ç­¾åç®—æ³• .setExpiration(new Date(System.currentTimeMillis() + 24*3600*1000)) //æœ‰æ•ˆæœŸ .compact(); System.out.println(jwt); } è¿è¡Œæµ‹è¯•æ–¹æ³•ï¼š\n1 eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNjcyNzI5NzMwfQ.fHi0Ub8npbyt71UqLXDdLyipptLgxBUg_mSuGJtXtBk è¾“å‡ºçš„ç»“æœå°±æ˜¯ç”Ÿæˆçš„JWTä»¤ç‰Œ,ï¼Œé€šè¿‡è‹±æ–‡çš„ç‚¹åˆ†å‰²å¯¹ä¸‰ä¸ªéƒ¨åˆ†è¿›è¡Œåˆ†å‰²ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”Ÿæˆçš„ä»¤ç‰Œå¤åˆ¶ä¸€ä¸‹ï¼Œç„¶åæ‰“å¼€JWTçš„å®˜ç½‘ï¼Œå°†ç”Ÿæˆçš„ä»¤ç‰Œç›´æ¥æ”¾åœ¨Encodedä½ç½®ï¼Œæ­¤æ—¶å°±ä¼šè‡ªåŠ¨çš„å°†ä»¤ç‰Œè§£æå‡ºæ¥ã€‚\nç¬¬ä¸€éƒ¨åˆ†è§£æå‡ºæ¥ï¼Œçœ‹åˆ°JSONæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ä¸ºHS256ã€‚\nç¬¬äºŒä¸ªéƒ¨åˆ†æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ï¼Œä¹‹å‰æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®å°±æ˜¯idï¼Œè¿˜æœ‰ä¸€ä¸ªexpä»£è¡¨çš„æ˜¯æˆ‘ä»¬æ‰€è®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€‚\nç”±äºå‰ä¸¤ä¸ªéƒ¨åˆ†æ˜¯base64ç¼–ç ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ç›´æ¥è§£ç å‡ºæ¥ã€‚ä½†æœ€åä¸€ä¸ªéƒ¨åˆ†å¹¶ä¸æ˜¯base64ç¼–ç ï¼Œæ˜¯ç»è¿‡ç­¾åç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªéƒ¨åˆ†æ˜¯ä¸ä¼šè§£æçš„ã€‚\nå®ç°äº†JWTä»¤ç‰Œçš„ç”Ÿæˆï¼Œä¸‹é¢æˆ‘ä»¬æ¥ç€ä½¿ç”¨Javaä»£ç æ¥æ ¡éªŒJWTä»¤ç‰Œ(è§£æç”Ÿæˆçš„ä»¤ç‰Œ)ï¼š\n1 2 3 4 5 6 7 8 9 @Test public void parseJwt(){ Claims claims = Jwts.parser() .setSigningKey(\u0026#34;itheima\u0026#34;)//æŒ‡å®šç­¾åå¯†é’¥ï¼ˆå¿…é¡»ä¿è¯å’Œç”Ÿæˆä»¤ç‰Œæ—¶ä½¿ç”¨ç›¸åŒçš„ç­¾åå¯†é’¥ï¼‰ .parseClaimsJws(\u0026#34;eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNjcyNzI5NzMwfQ.fHi0Ub8npbyt71UqLXDdLyipptLgxBUg_mSuGJtXtBk\u0026#34;) .getBody(); System.out.println(claims); } è¿è¡Œæµ‹è¯•æ–¹æ³•ï¼š\n1 {id=1, exp=1672729730} ä»¤ç‰Œè§£æåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°idå’Œè¿‡æœŸæ—¶é—´ï¼Œå¦‚æœåœ¨è§£æçš„è¿‡ç¨‹å½“ä¸­æ²¡æœ‰æŠ¥é”™ï¼Œå°±è¯´æ˜è§£ææˆåŠŸäº†ã€‚\nä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªæµ‹è¯•ï¼šæŠŠä»¤ç‰Œheaderä¸­çš„æ•°å­—9å˜ä¸º8ï¼Œè¿è¡Œæµ‹è¯•æ–¹æ³•åå‘ç°æŠ¥é”™ï¼š\nåŸheaderï¼š eyJhbGciOiJIUzI1NiJ9\nä¿®æ”¹ä¸ºï¼š eyJhbGciOiJIUzI1NiJ8\nç»“è®ºï¼šç¯¡æ”¹ä»¤ç‰Œä¸­çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨å¯¹ä»¤ç‰Œè¿›è¡Œè§£ææ—¶éƒ½ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥JWTä»¤ç‰Œæ˜¯éå¸¸å®‰å…¨å¯é çš„ã€‚\næˆ‘ä»¬ç»§ç»­æµ‹è¯•ï¼šä¿®æ”¹ç”Ÿæˆä»¤ç‰Œçš„æ—¶æŒ‡å®šçš„è¿‡æœŸæ—¶é—´ï¼Œä¿®æ”¹ä¸º1åˆ†é’Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @Test public void genJwt(){ Map\u0026lt;String,Object\u0026gt; claims = new HashMap\u0026lt;\u0026gt;(); claims.put(â€œidâ€,1); claims.put(â€œusernameâ€,â€œTomâ€); String jwt = Jwts.builder() .setClaims(claims) //è‡ªå®šä¹‰å†…å®¹(è½½è·) .signWith(SignatureAlgorithm.HS256, â€œitheimaâ€) //ç­¾åç®—æ³• .setExpiration(new Date(System.currentTimeMillis() + 60*1000)) //æœ‰æ•ˆæœŸ60ç§’ .compact(); System.out.println(jwt); //è¾“å‡ºç»“æœï¼šeyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNjczMDA5NzU0fQ.RcVIR65AkGiax-ID6FjW60eLFH3tPTKdoK7UtE4A1ro } @Test public void parseJwt(){ Claims claims = Jwts.parser() .setSigningKey(\u0026#34;itheima\u0026#34;)//æŒ‡å®šç­¾åå¯†é’¥ .parseClaimsJws(\u0026#34;eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNjczMDA5NzU0fQ.RcVIR65AkGiax-ID6FjW60eLFH3tPTKdoK7UtE4A1ro\u0026#34;) .getBody(); System.out.println(claims); } ç­‰å¾…1åˆ†é’Ÿä¹‹åè¿è¡Œæµ‹è¯•æ–¹æ³•å‘ç°ä¹ŸæŠ¥é”™äº†ï¼Œè¯´æ˜ï¼šJWTä»¤ç‰Œè¿‡æœŸåï¼Œä»¤ç‰Œå°±å¤±æ•ˆäº†ï¼Œè§£æçš„ä¸ºéæ³•ä»¤ç‰Œã€‚\né€šè¿‡ä»¥ä¸Šæµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨JWTä»¤ç‰Œæ—¶éœ€è¦æ³¨æ„ï¼š\nJWTæ ¡éªŒæ—¶ä½¿ç”¨çš„ç­¾åç§˜é’¥ï¼Œå¿…é¡»å’Œç”ŸæˆJWTä»¤ç‰Œæ—¶ä½¿ç”¨çš„ç§˜é’¥æ˜¯é…å¥—çš„ã€‚ å¦‚æœJWTä»¤ç‰Œè§£ææ ¡éªŒæ—¶æŠ¥é”™ï¼Œåˆ™è¯´æ˜ JWTä»¤ç‰Œè¢«ç¯¡æ”¹ æˆ– å¤±æ•ˆäº†ï¼Œä»¤ç‰Œéæ³•ã€‚ ç™»å½•æ ¡éªŒ-JWTä»¤ç‰Œ-ç™»å½•åä¸‹å‘ä»¤ç‰Œ ç™»å½•ä¸‹å‘ä»¤ç‰Œ JWTä»¤ç‰Œçš„ç”Ÿæˆå’Œæ ¡éªŒçš„åŸºæœ¬æ“ä½œæˆ‘ä»¬å·²ç»å­¦ä¹ å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦åœ¨æ¡ˆä¾‹å½“ä¸­é€šè¿‡JWTä»¤ç‰ŒæŠ€æœ¯æ¥è·Ÿè¸ªä¼šè¯ã€‚å…·ä½“çš„æ€è·¯æˆ‘ä»¬å‰é¢å·²ç»åˆ†æè¿‡äº†ï¼Œä¸»è¦å°±æ˜¯ä¸¤æ­¥æ“ä½œï¼š\nç”Ÿæˆä»¤ç‰Œ åœ¨ç™»å½•æˆåŠŸä¹‹åæ¥ç”Ÿæˆä¸€ä¸ªJWTä»¤ç‰Œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªä»¤ç‰Œç›´æ¥è¿”å›ç»™å‰ç«¯ æ ¡éªŒä»¤ç‰Œ æ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œä»è¯·æ±‚ä¸­è·å–åˆ°ä»¤ç‰Œï¼Œå¯¹ä»¤ç‰Œè¿›è¡Œè§£ææ ¡éªŒ é‚£æˆ‘ä»¬é¦–å…ˆæ¥å®Œæˆï¼šç™»å½•æˆåŠŸä¹‹åç”ŸæˆJWTä»¤ç‰Œï¼Œå¹¶ä¸”æŠŠä»¤ç‰Œè¿”å›ç»™å‰ç«¯ã€‚\nJWTä»¤ç‰Œæ€ä¹ˆè¿”å›ç»™å‰ç«¯å‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦å†æ¥çœ‹ä¸€ä¸‹æ¥å£æ–‡æ¡£å½“ä¸­å…³äºç™»å½•æ¥å£çš„æè¿°ï¼ˆä¸»è¦çœ‹å“åº”æ•°æ®ï¼‰ï¼š\nå“åº”æ•°æ®\nå‚æ•°æ ¼å¼ï¼šapplication/json\nå‚æ•°è¯´æ˜ï¼š\nåç§° ç±»å‹ æ˜¯å¦å¿…é¡» é»˜è®¤å€¼ å¤‡æ³¨ å…¶ä»–ä¿¡æ¯ code number å¿…é¡» å“åº”ç , 1 æˆåŠŸ ; 0 å¤±è´¥ msg string éå¿…é¡» æç¤ºä¿¡æ¯ data string å¿…é¡» è¿”å›çš„æ•°æ® , jwtä»¤ç‰Œ å“åº”æ•°æ®æ ·ä¾‹ï¼š\n1 2 3 4 5 { \u0026#34;code\u0026#34;: 1, \u0026#34;msg\u0026#34;: \u0026#34;success\u0026#34;, \u0026#34;data\u0026#34;: \u0026#34;eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoi6YeR5bq4IiwiaWQiOjEsInVzZXJuYW1lIjoiamlueW9uZyIsImV4cCI6MTY2MjIwNzA0OH0.KkUc_CXJZJ8Dd063eImx4H9Ojfrr6XMJ-yVzaWCVZCo\u0026#34; } å¤‡æ³¨è¯´æ˜ ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹å‘JWTä»¤ç‰Œï¼Œç„¶ååœ¨åç»­çš„æ¯æ¬¡è¯·æ±‚ä¸­ï¼Œéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´headerä¸­æºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œè¯·æ±‚å¤´çš„åç§°ä¸º token ï¼Œå€¼ä¸º ç™»å½•æ—¶ä¸‹å‘çš„JWTä»¤ç‰Œã€‚\nå¦‚æœæ£€æµ‹åˆ°ç”¨æˆ·æœªç™»å½•ï¼Œåˆ™ä¼šè¿”å›å¦‚ä¸‹å›ºå®šé”™è¯¯ä¿¡æ¯ï¼š\n1 2 3 4 5 { \u0026#34;code\u0026#34;: 0, \u0026#34;msg\u0026#34;: \u0026#34;NOT_LOGIN\u0026#34;, \u0026#34;data\u0026#34;: null } è§£è¯»å®Œæ¥å£æ–‡æ¡£ä¸­çš„æè¿°äº†ï¼Œç›®å‰æˆ‘ä»¬å…ˆæ¥å®Œæˆä»¤ç‰Œçš„ç”Ÿæˆå’Œä»¤ç‰Œçš„ä¸‹å‘ï¼Œæˆ‘ä»¬åªéœ€è¦ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œè¿”å›ç»™å‰ç«¯å°±å¯ä»¥äº†ã€‚\nå®ç°æ­¥éª¤ï¼š\nå¼•å…¥JWTå·¥å…·ç±» åœ¨é¡¹ç›®å·¥ç¨‹ä¸‹åˆ›å»ºcom.itheima.utilsåŒ…ï¼Œå¹¶æŠŠæä¾›JWTå·¥å…·ç±»å¤åˆ¶åˆ°è¯¥åŒ…ä¸‹ ç™»å½•å®Œæˆåï¼Œè°ƒç”¨å·¥å…·ç±»ç”ŸæˆJWTä»¤ç‰Œå¹¶è¿”å› JWTå·¥å…·ç±»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 public class JwtUtils { private static String signKey = \u0026#34;itheima\u0026#34;;//ç­¾åå¯†é’¥ private static Long expire = 43200000L; //æœ‰æ•ˆæ—¶é—´ /** * ç”ŸæˆJWTä»¤ç‰Œ * @param claims JWTç¬¬äºŒéƒ¨åˆ†è´Ÿè½½ payload ä¸­å­˜å‚¨çš„å†…å®¹ * @return */ public static String generateJwt(Map\u0026lt;String, Object\u0026gt; claims){ String jwt = Jwts.builder() .addClaims(claims)//è‡ªå®šä¹‰ä¿¡æ¯ï¼ˆæœ‰æ•ˆè½½è·ï¼‰ .signWith(SignatureAlgorithm.HS256, signKey)//ç­¾åç®—æ³•ï¼ˆå¤´éƒ¨ï¼‰ .setExpiration(new Date(System.currentTimeMillis() + expire))//è¿‡æœŸæ—¶é—´ .compact(); return jwt; } /** * è§£æJWTä»¤ç‰Œ * @param jwt JWTä»¤ç‰Œ * @return JWTç¬¬äºŒéƒ¨åˆ†è´Ÿè½½ payload ä¸­å­˜å‚¨çš„å†…å®¹ */ public static Claims parseJWT(String jwt){ Claims claims = Jwts.parser() .setSigningKey(signKey)//æŒ‡å®šç­¾åå¯†é’¥ .parseClaimsJws(jwt)//æŒ‡å®šä»¤ç‰ŒToken .getBody(); return claims; } } ç™»å½•æˆåŠŸï¼Œç”ŸæˆJWTä»¤ç‰Œå¹¶è¿”å›\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 @RestController @Slf4j public class LoginController { //ä¾èµ–ä¸šåŠ¡å±‚å¯¹è±¡ @Autowired private EmpService empService; @PostMapping(\u0026#34;/login\u0026#34;) public Result login(@RequestBody Emp emp) { //è°ƒç”¨ä¸šåŠ¡å±‚ï¼šç™»å½•åŠŸèƒ½ Emp loginEmp = empService.login(emp); //åˆ¤æ–­ï¼šç™»å½•ç”¨æˆ·æ˜¯å¦å­˜åœ¨ if(loginEmp !=null ){ //è‡ªå®šä¹‰ä¿¡æ¯ Map\u0026lt;String , Object\u0026gt; claims = new HashMap\u0026lt;\u0026gt;(); claims.put(\u0026#34;id\u0026#34;, loginEmp.getId()); claims.put(\u0026#34;username\u0026#34;,loginEmp.getUsername()); claims.put(\u0026#34;name\u0026#34;,loginEmp.getName()); //ä½¿ç”¨JWTå·¥å…·ç±»ï¼Œç”Ÿæˆèº«ä»½ä»¤ç‰Œ String token = JwtUtils.generateJwt(claims); return Result.success(token); } return Result.error(\u0026#34;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\u0026#34;); } } é‡å¯æœåŠ¡ï¼Œæ‰“å¼€postmanæµ‹è¯•ç™»å½•æ¥å£ï¼š\næ‰“å¼€æµè§ˆå™¨å®Œæˆå‰åç«¯è”è°ƒæ“ä½œï¼šåˆ©ç”¨å¼€å‘è€…å·¥å…·ï¼ŒæŠ“å–ä¸€ä¸‹ç½‘ç»œè¯·æ±‚\nç™»å½•è¯·æ±‚å®Œæˆåï¼Œå¯ä»¥çœ‹åˆ°JWTä»¤ç‰Œå·²ç»å“åº”ç»™äº†å‰ç«¯ï¼Œæ­¤æ—¶å‰ç«¯å°±ä¼šå°†JWTä»¤ç‰Œå­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚\næœåŠ¡å™¨å“åº”çš„JWTä»¤ç‰Œå­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨å“ªé‡Œäº†å‘¢ï¼Ÿ\nåœ¨å½“å‰æ¡ˆä¾‹ä¸­ï¼ŒJWTä»¤ç‰Œå­˜å‚¨åœ¨æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ç©ºé—´local storageä¸­äº†ã€‚ local storageæ˜¯æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ï¼Œåœ¨ç§»åŠ¨ç«¯ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚ æˆ‘ä»¬åœ¨å‘èµ·ä¸€ä¸ªæŸ¥è¯¢éƒ¨é—¨æ•°æ®çš„è¯·æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«ä¸€ä¸ªtoken(JWTä»¤ç‰Œ)ï¼Œåç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚å½“ä¸­ï¼Œéƒ½ä¼šå°†è¿™ä¸ªä»¤ç‰Œæºå¸¦åˆ°æœåŠ¡ç«¯ã€‚\nç™»å½•æ ¡éªŒ-Filter-å…¥é—¨ åˆšæ‰é€šè¿‡æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨åç»­çš„è¯·æ±‚å½“ä¸­ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦JWTä»¤ç‰Œåˆ°æœåŠ¡ç«¯ï¼Œè€ŒæœåŠ¡ç«¯éœ€è¦ç»Ÿä¸€æ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦æºå¸¦çš„æœ‰åˆæ³•çš„JWTä»¤ç‰Œã€‚ é‚£æ€ä¹ˆæ ·æ¥ç»Ÿä¸€æ‹¦æˆªåˆ°æ‰€æœ‰çš„è¯·æ±‚æ ¡éªŒä»¤ç‰Œçš„æœ‰æ•ˆæ€§å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬ä¼šå­¦ä¹ ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š\nFilterè¿‡æ»¤å™¨ Interceptoræ‹¦æˆªå™¨ æˆ‘ä»¬é¦–å…ˆæ¥å­¦ä¹ è¿‡æ»¤å™¨Filterã€‚\nå¿«é€Ÿå…¥é—¨ ä»€ä¹ˆæ˜¯Filterï¼Ÿ\nFilterè¡¨ç¤ºè¿‡æ»¤å™¨ï¼Œæ˜¯ JavaWebä¸‰å¤§ç»„ä»¶(Servletã€Filterã€Listener)ä¹‹ä¸€ã€‚ è¿‡æ»¤å™¨å¯ä»¥æŠŠå¯¹èµ„æºçš„è¯·æ±‚æ‹¦æˆªä¸‹æ¥ï¼Œä»è€Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ ä½¿ç”¨äº†è¿‡æ»¤å™¨ä¹‹åï¼Œè¦æƒ³è®¿é—®webæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå¿…é¡»å…ˆç»è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨å¤„ç†å®Œæ¯•ä¹‹åï¼Œæ‰å¯ä»¥è®¿é—®å¯¹åº”çš„èµ„æºã€‚ è¿‡æ»¤å™¨ä¸€èˆ¬å®Œæˆä¸€äº›é€šç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šç™»å½•æ ¡éªŒã€ç»Ÿä¸€ç¼–ç å¤„ç†ã€æ•æ„Ÿå­—ç¬¦å¤„ç†ç­‰ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡Filterå¿«é€Ÿå…¥é—¨ç¨‹åºæŒæ¡è¿‡æ»¤å™¨çš„åŸºæœ¬ä½¿ç”¨æ“ä½œï¼š\nç¬¬1æ­¥ï¼Œå®šä¹‰è¿‡æ»¤å™¨ ï¼š1.å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç° Filter æ¥å£ï¼Œå¹¶é‡å†™å…¶æ‰€æœ‰æ–¹æ³•ã€‚ ç¬¬2æ­¥ï¼Œé…ç½®è¿‡æ»¤å™¨ï¼šFilterç±»ä¸ŠåŠ  @WebFilter æ³¨è§£ï¼Œé…ç½®æ‹¦æˆªèµ„æºçš„è·¯å¾„ã€‚å¼•å¯¼ç±»ä¸ŠåŠ  @ServletComponentScan å¼€å¯Servletç»„ä»¶æ”¯æŒã€‚ *å®šä¹‰è¿‡æ»¤å™¨*\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 //å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°ä¸€ä¸ªæ ‡å‡†çš„Filterè¿‡æ»¤å™¨çš„æ¥å£ public class DemoFilter implements Filter { @Override //åˆå§‹åŒ–æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡ public void init(FilterConfig filterConfig) throws ServletException { System.out.println(\u0026#34;init åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œäº†\u0026#34;); } @Override //æ‹¦æˆªåˆ°è¯·æ±‚ä¹‹åè°ƒç”¨, è°ƒç”¨å¤šæ¬¡ public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { System.out.println(\u0026#34;Demo æ‹¦æˆªåˆ°äº†è¯·æ±‚...æ”¾è¡Œå‰é€»è¾‘\u0026#34;); //æ”¾è¡Œ chain.doFilter(request,response); } @Override //é”€æ¯æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡ public void destroy() { System.out.println(\u0026#34;destroy é”€æ¯æ–¹æ³•æ‰§è¡Œäº†\u0026#34;); } } initæ–¹æ³•ï¼šè¿‡æ»¤å™¨çš„åˆå§‹åŒ–æ–¹æ³•ã€‚åœ¨webæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨çš„åˆ›å»ºFilterè¿‡æ»¤å™¨å¯¹è±¡ï¼Œåœ¨åˆ›å»ºè¿‡æ»¤å™¨å¯¹è±¡çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨initåˆå§‹åŒ–æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚ doFilteræ–¹æ³•ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨æ¯ä¸€æ¬¡æ‹¦æˆªåˆ°è¯·æ±‚ä¹‹åéƒ½ä¼šè¢«è°ƒç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯ä¼šè¢«è°ƒç”¨å¤šæ¬¡çš„ï¼Œæ¯æ‹¦æˆªåˆ°ä¸€æ¬¡è¯·æ±‚å°±ä¼šè°ƒç”¨ä¸€æ¬¡doFilter()æ–¹æ³•ã€‚ destroyæ–¹æ³•ï¼š æ˜¯é”€æ¯çš„æ–¹æ³•ã€‚å½“æˆ‘ä»¬å…³é—­æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨çš„è°ƒç”¨é”€æ¯æ–¹æ³•destroyï¼Œè€Œè¿™ä¸ªé”€æ¯æ–¹æ³•ä¹Ÿåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚ åœ¨å®šä¹‰å®ŒFilterä¹‹åï¼ŒFilterå…¶å®å¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œè¿˜éœ€è¦å®ŒæˆFilterçš„é…ç½®ï¼ŒFilterçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨Filterç±»ä¸Šæ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼š@WebFilterï¼Œå¹¶æŒ‡å®šå±æ€§urlPatternsï¼Œé€šè¿‡è¿™ä¸ªå±æ€§æŒ‡å®šè¿‡æ»¤å™¨è¦æ‹¦æˆªå“ªäº›è¯·æ±‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @WebFilter(urlPatterns = \u0026#34;/*\u0026#34;) //é…ç½®è¿‡æ»¤å™¨è¦æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ï¼ˆ /* è¡¨ç¤ºæ‹¦æˆªæµè§ˆå™¨çš„æ‰€æœ‰è¯·æ±‚ ï¼‰ public class DemoFilter implements Filter { @Override //åˆå§‹åŒ–æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡ public void init(FilterConfig filterConfig) throws ServletException { System.out.println(\u0026#34;init åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œäº†\u0026#34;); } @Override //æ‹¦æˆªåˆ°è¯·æ±‚ä¹‹åè°ƒç”¨, è°ƒç”¨å¤šæ¬¡ public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { System.out.println(\u0026#34;Demo æ‹¦æˆªåˆ°äº†è¯·æ±‚...æ”¾è¡Œå‰é€»è¾‘\u0026#34;); //æ”¾è¡Œ chain.doFilter(request,response); } @Override //é”€æ¯æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡ public void destroy() { System.out.println(\u0026#34;destroy é”€æ¯æ–¹æ³•æ‰§è¡Œäº†\u0026#34;); } } å½“æˆ‘ä»¬åœ¨Filterç±»ä¸Šé¢åŠ äº†@WebFilteræ³¨è§£ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šé¢åŠ ä¸Šä¸€ä¸ªæ³¨è§£@ServletComponentScanï¼Œé€šè¿‡è¿™ä¸ª@ServletComponentScanæ³¨è§£æ¥å¼€å¯SpringBooté¡¹ç›®å¯¹äºServletç»„ä»¶çš„æ”¯æŒã€‚\n1 2 3 4 5 6 7 8 9 @ServletComponentScan @SpringBootApplication public class TliasWebManagementApplication { public static void main(String[] args) { SpringApplication.run(TliasWebManagementApplication.class, args); } } é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œæ‰§è¡Œéƒ¨é—¨ç®¡ç†çš„è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºäº†è¿‡æ»¤å™¨ä¸­çš„å†…å®¹ï¼š\næ³¨æ„äº‹é¡¹ï¼š\nåœ¨è¿‡æ»¤å™¨Filterä¸­ï¼Œå¦‚æœä¸æ‰§è¡Œæ”¾è¡Œæ“ä½œï¼Œå°†æ— æ³•è®¿é—®åé¢çš„èµ„æºã€‚ æ”¾è¡Œæ“ä½œï¼šchain.doFilter(request, response);\nç°åœ¨æˆ‘ä»¬å·²å®Œæˆäº†Filterè¿‡æ»¤å™¨çš„åŸºæœ¬ä½¿ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬å°†å­¦ä¹ Filterè¿‡æ»¤å™¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›ç»†èŠ‚ã€‚\nç™»å½•æ ¡éªŒ-Filter-è¯¦è§£ï¼ˆæ‰§è¡Œæµç¨‹-æ‹¦æˆªè·¯å¾„ï¼‰ Filterè¿‡æ»¤å™¨çš„å¿«é€Ÿå…¥é—¨ç¨‹åºæˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹è¿‡æ»¤å™¨Filteråœ¨ä½¿ç”¨ä¸­çš„ä¸€äº›ç»†èŠ‚ã€‚ä¸»è¦ä»‹ç»ä»¥ä¸‹3ä¸ªæ–¹é¢çš„ç»†èŠ‚ï¼š\nè¿‡æ»¤å™¨çš„æ‰§è¡Œæµç¨‹ è¿‡æ»¤å™¨çš„æ‹¦æˆªè·¯å¾„é…ç½® è¿‡æ»¤å™¨é“¾ æ‰§è¡Œæµç¨‹ é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿‡æ»¤å™¨çš„æ‰§è¡Œæµç¨‹ï¼š\nè¿‡æ»¤å™¨å½“ä¸­æˆ‘ä»¬æ‹¦æˆªåˆ°äº†è¯·æ±‚ä¹‹åï¼Œå¦‚æœå¸Œæœ›ç»§ç»­è®¿é—®åé¢çš„webèµ„æºï¼Œå°±è¦æ‰§è¡Œæ”¾è¡Œæ“ä½œï¼Œæ”¾è¡Œå°±æ˜¯è°ƒç”¨ FilterChainå¯¹è±¡å½“ä¸­çš„doFilter()æ–¹æ³•ï¼Œåœ¨è°ƒç”¨doFilter()è¿™ä¸ªæ–¹æ³•ä¹‹å‰æ‰€ç¼–å†™çš„ä»£ç å±äºæ”¾è¡Œä¹‹å‰çš„é€»è¾‘ã€‚\nåœ¨æ”¾è¡Œåè®¿é—®å®Œ web èµ„æºä¹‹åè¿˜ä¼šå›åˆ°è¿‡æ»¤å™¨å½“ä¸­ï¼Œå›åˆ°è¿‡æ»¤å™¨ä¹‹åå¦‚æœ‰éœ€æ±‚è¿˜å¯ä»¥æ‰§è¡Œæ”¾è¡Œä¹‹åçš„é€»è¾‘ï¼Œæ”¾è¡Œä¹‹åçš„é€»è¾‘æˆ‘ä»¬å†™åœ¨doFilter()è¿™è¡Œä»£ç ä¹‹åã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @WebFilter(urlPatterns = \u0026#34;/*\u0026#34;) public class DemoFilter implements Filter { @Override //åˆå§‹åŒ–æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡ public void init(FilterConfig filterConfig) throws ServletException { System.out.println(\u0026#34;init åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œäº†\u0026#34;); } @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { System.out.println(\u0026#34;DemoFilter æ”¾è¡Œå‰é€»è¾‘.....\u0026#34;); //æ”¾è¡Œè¯·æ±‚ filterChain.doFilter(servletRequest,servletResponse); System.out.println(\u0026#34;DemoFilter æ”¾è¡Œåé€»è¾‘.....\u0026#34;); } @Override //é”€æ¯æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡ public void destroy() { System.out.println(\u0026#34;destroy é”€æ¯æ–¹æ³•æ‰§è¡Œäº†\u0026#34;); } } æ‹¦æˆªè·¯å¾„ æ‰§è¡Œæµç¨‹æˆ‘ä»¬ææ¸…æ¥šä¹‹åï¼Œæ¥ä¸‹æ¥å†æ¥ä»‹ç»ä¸€ä¸‹è¿‡æ»¤å™¨çš„æ‹¦æˆªè·¯å¾„ï¼ŒFilterå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œé…ç½®ä¸åŒçš„æ‹¦æˆªèµ„æºè·¯å¾„ï¼š\næ‹¦æˆªè·¯å¾„ urlPatternså€¼ å«ä¹‰ æ‹¦æˆªå…·ä½“è·¯å¾„ /login åªæœ‰è®¿é—® /login è·¯å¾„æ—¶ï¼Œæ‰ä¼šè¢«æ‹¦æˆª ç›®å½•æ‹¦æˆª /emps/* è®¿é—®/empsä¸‹çš„æ‰€æœ‰èµ„æºï¼Œéƒ½ä¼šè¢«æ‹¦æˆª æ‹¦æˆªæ‰€æœ‰ /* è®¿é—®æ‰€æœ‰èµ„æºï¼Œéƒ½ä¼šè¢«æ‹¦æˆª ä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•\u0026quot;æ‹¦æˆªå…·ä½“è·¯å¾„\u0026quot;ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @WebFilter(urlPatterns = \u0026#34;/login\u0026#34;) //æ‹¦æˆª/loginå…·ä½“è·¯å¾„ public class DemoFilter implements Filter { @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { System.out.println(\u0026#34;DemoFilter æ”¾è¡Œå‰é€»è¾‘.....\u0026#34;); //æ”¾è¡Œè¯·æ±‚ filterChain.doFilter(servletRequest,servletResponse); System.out.println(\u0026#34;DemoFilter æ”¾è¡Œåé€»è¾‘.....\u0026#34;); } @Override public void init(FilterConfig filterConfig) throws ServletException { Filter.super.init(filterConfig); } @Override public void destroy() { Filter.super.destroy(); } } æµ‹è¯•1ï¼šè®¿é—®éƒ¨é—¨ç®¡ç†è¯·æ±‚ï¼Œå‘ç°è¿‡æ»¤å™¨æ²¡æœ‰æ‹¦æˆªè¯·æ±‚\næµ‹è¯•2ï¼šè®¿é—®ç™»å½•è¯·æ±‚/loginï¼Œå‘ç°è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚\nä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•\u0026quot;ç›®å½•æ‹¦æˆª\u0026quot;ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @WebFilter(urlPatterns = \u0026#34;/depts/*\u0026#34;) //æ‹¦æˆªæ‰€æœ‰ä»¥/deptså¼€å¤´ï¼Œåé¢æ˜¯ä»€ä¹ˆæ— æ‰€è°“ public class DemoFilter implements Filter { @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { System.out.println(\u0026#34;DemoFilter æ”¾è¡Œå‰é€»è¾‘.....\u0026#34;); //æ”¾è¡Œè¯·æ±‚ filterChain.doFilter(servletRequest,servletResponse); System.out.println(\u0026#34;DemoFilter æ”¾è¡Œåé€»è¾‘.....\u0026#34;); } @Override public void init(FilterConfig filterConfig) throws ServletException { Filter.super.init(filterConfig); } @Override public void destroy() { Filter.super.destroy(); } } æµ‹è¯•1ï¼šè®¿é—®éƒ¨é—¨ç®¡ç†è¯·æ±‚ï¼Œå‘ç°è¿‡æ»¤å™¨æ‹¦æˆªäº†è¯·æ±‚\næµ‹è¯•2ï¼šè®¿é—®ç™»å½•è¯·æ±‚/loginï¼Œå‘ç°è¿‡æ»¤å™¨æ²¡æœ‰æ‹¦æˆªè¯·æ±‚\nç™»å½•æ ¡éªŒ-Filter-è¯¦è§£ï¼ˆè¿‡æ»¤å™¨é“¾ï¼‰ è¿‡æ»¤å™¨é“¾ æœ€åæˆ‘ä»¬åœ¨æ¥ä»‹ç»ä¸‹è¿‡æ»¤å™¨é“¾ï¼Œä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨é“¾å‘¢ï¼Ÿæ‰€è°“è¿‡æ»¤å™¨é“¾æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªwebåº”ç”¨ç¨‹åºå½“ä¸­ï¼Œå¯ä»¥é…ç½®å¤šä¸ªè¿‡æ»¤å™¨ï¼Œå¤šä¸ªè¿‡æ»¤å™¨å°±å½¢æˆäº†ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ã€‚\næ¯”å¦‚ï¼šåœ¨æˆ‘ä»¬webæœåŠ¡å™¨å½“ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™ä¸¤ä¸ªè¿‡æ»¤å™¨å°±å½¢æˆäº†ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ã€‚\nè€Œè¿™ä¸ªé“¾ä¸Šçš„è¿‡æ»¤å™¨åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œï¼Œä¼šå…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªFilterï¼Œæ”¾è¡Œä¹‹åå†æ¥æ‰§è¡Œç¬¬äºŒä¸ªFilterï¼Œå¦‚æœæ‰§è¡Œåˆ°äº†æœ€åä¸€ä¸ªè¿‡æ»¤å™¨æ”¾è¡Œä¹‹åï¼Œæ‰ä¼šè®¿é—®å¯¹åº”çš„webèµ„æºã€‚\nè®¿é—®å®Œwebèµ„æºä¹‹åï¼ŒæŒ‰ç…§æˆ‘ä»¬åˆšæ‰æ‰€ä»‹ç»çš„è¿‡æ»¤å™¨çš„æ‰§è¡Œæµç¨‹ï¼Œè¿˜ä¼šå›åˆ°è¿‡æ»¤å™¨å½“ä¸­æ¥æ‰§è¡Œè¿‡æ»¤å™¨æ”¾è¡Œåçš„é€»è¾‘ï¼Œè€Œåœ¨æ‰§è¡Œæ”¾è¡Œåçš„é€»è¾‘çš„æ—¶å€™ï¼Œé¡ºåºæ˜¯åç€çš„ã€‚\nå…ˆè¦æ‰§è¡Œè¿‡æ»¤å™¨2æ”¾è¡Œä¹‹åçš„é€»è¾‘ï¼Œå†æ¥æ‰§è¡Œè¿‡æ»¤å™¨1æ”¾è¡Œä¹‹åçš„é€»è¾‘ï¼Œæœ€ååœ¨ç»™æµè§ˆå™¨å“åº”æ•°æ®ã€‚\nä»¥ä¸Šå°±æ˜¯å½“æˆ‘ä»¬åœ¨webåº”ç”¨å½“ä¸­é…ç½®äº†å¤šä¸ªè¿‡æ»¤å™¨ï¼Œå½¢æˆäº†è¿™æ ·ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ä»¥åŠè¿‡æ»¤å™¨é“¾çš„æ‰§è¡Œé¡ºåºã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ideaæ¥éªŒè¯ä¸‹è¿‡æ»¤å™¨é“¾ã€‚\néªŒè¯æ­¥éª¤ï¼š\nåœ¨filteråŒ…ä¸‹å†æ¥æ–°å»ºä¸€ä¸ªFilterè¿‡æ»¤å™¨ç±»ï¼šAbcFilter åœ¨AbcFilterè¿‡æ»¤å™¨ä¸­ç¼–å†™æ”¾è¡Œå‰å’Œæ”¾è¡Œåé€»è¾‘ é…ç½®AbcFilterè¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚è·¯å¾„ä¸ºï¼š/* é‡å¯SpringBootæœåŠ¡ï¼ŒæŸ¥çœ‹DemoFilterã€AbcFilterçš„æ‰§è¡Œæ—¥å¿— AbcFilterè¿‡æ»¤å™¨\n1 2 3 4 5 6 7 8 9 10 11 12 @WebFilter(urlPatterns = \u0026#34;/*\u0026#34;) public class AbcFilter implements Filter { @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { System.out.println(\u0026#34;Abc æ‹¦æˆªåˆ°äº†è¯·æ±‚... æ”¾è¡Œå‰é€»è¾‘\u0026#34;); //æ”¾è¡Œ chain.doFilter(request,response); System.out.println(\u0026#34;Abc æ‹¦æˆªåˆ°äº†è¯·æ±‚... æ”¾è¡Œåé€»è¾‘\u0026#34;); } } DemoFilterè¿‡æ»¤å™¨\n1 2 3 4 5 6 7 8 9 10 11 12 @WebFilter(urlPatterns = \u0026#34;/*\u0026#34;) public class DemoFilter implements Filter { @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { System.out.println(\u0026#34;DemoFilter æ”¾è¡Œå‰é€»è¾‘.....\u0026#34;); //æ”¾è¡Œè¯·æ±‚ filterChain.doFilter(servletRequest,servletResponse); System.out.println(\u0026#34;DemoFilter æ”¾è¡Œåé€»è¾‘.....\u0026#34;); } } æ‰“å¼€æµè§ˆå™¨è®¿é—®ç™»å½•æ¥å£ï¼š\né€šè¿‡æ§åˆ¶å°æ—¥å¿—çš„è¾“å‡ºï¼Œå¤§å®¶å‘ç°AbcFilterå…ˆæ‰§è¡ŒDemoFilteråæ‰§è¡Œï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nå…¶å®æ˜¯å’Œè¿‡æ»¤å™¨çš„ç±»åæœ‰å…³ç³»ã€‚ä»¥æ³¨è§£æ–¹å¼é…ç½®çš„Filterè¿‡æ»¤å™¨ï¼Œå®ƒçš„æ‰§è¡Œä¼˜å…ˆçº§æ˜¯æŒ‰æ—¶è¿‡æ»¤å™¨ç±»åçš„è‡ªåŠ¨æ’åºç¡®å®šçš„ï¼Œç±»åæ’åè¶Šé å‰ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚\nå‡å¦‚æˆ‘ä»¬æƒ³è®©DemoFilterå…ˆæ‰§è¡Œï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä¿®æ”¹ç±»åã€‚\næµ‹è¯•ï¼šä¿®æ”¹AbcFilterç±»åä¸ºXbcFilterï¼Œè¿è¡Œç¨‹åºæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—\n1 2 3 4 5 6 7 8 9 10 11 12 @WebFilter(urlPatterns = \u0026#34;/*\u0026#34;) public class XbcFilter implements Filter { @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { System.out.println(\u0026#34;Xbc æ‹¦æˆªåˆ°äº†è¯·æ±‚...æ”¾è¡Œå‰é€»è¾‘\u0026#34;); //æ”¾è¡Œ chain.doFilter(request,response); System.out.println(\u0026#34;Xbc æ‹¦æˆªåˆ°äº†è¯·æ±‚...æ”¾è¡Œåé€»è¾‘\u0026#34;); } } åˆ°æ­¤ï¼Œå…³äºè¿‡æ»¤å™¨çš„ä½¿ç”¨ç»†èŠ‚ï¼Œæˆ‘ä»¬å·²ç»å…¨éƒ¨ä»‹ç»å®Œæ¯•äº†ã€‚\nç™»å½•æ ¡éªŒ-Filter-ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨ 12.1 åˆ†æ è¿‡æ»¤å™¨Filterçš„å¿«é€Ÿå…¥é—¨ä»¥åŠä½¿ç”¨ç»†èŠ‚æˆ‘ä»¬å·²ç»ä»‹ç»å®Œäº†ï¼Œæ¥ä¸‹æ¥æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿‡æ»¤å™¨Filteræ¥å®Œæˆæ¡ˆä¾‹å½“ä¸­çš„ç™»å½•æ ¡éªŒåŠŸèƒ½ã€‚\næˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸‹å‰é¢åˆ†æè¿‡çš„ç™»å½•æ ¡éªŒçš„åŸºæœ¬æµç¨‹ï¼š\nè¦è¿›å…¥åˆ°åå°ç®¡ç†ç³»ç»Ÿï¼Œæˆ‘ä»¬å¿…é¡»å…ˆå®Œæˆç™»å½•æ“ä½œï¼Œæ­¤æ—¶å°±éœ€è¦è®¿é—®ç™»å½•æ¥å£loginã€‚ ç™»å½•æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¼šåœ¨æœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªJWTä»¤ç‰Œï¼Œå¹¶ä¸”æŠŠJWTä»¤ç‰Œè¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯ä¼šå°†JWTä»¤ç‰Œå­˜å‚¨ä¸‹æ¥ã€‚ åœ¨åç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚å½“ä¸­ï¼Œéƒ½ä¼šå°†JWTä»¤ç‰Œæºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œè¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯ä¹‹åï¼Œè¦æƒ³å»è®¿é—®å¯¹åº”çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»å…ˆè¦æ ¡éªŒä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚ å¯¹äºæ ¡éªŒä»¤ç‰Œçš„è¿™ä¸€å—æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨ç™»å½•æ ¡éªŒçš„è¿‡æ»¤å™¨ï¼Œåœ¨è¿‡æ»¤å™¨å½“ä¸­æ¥æ ¡éªŒä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚å¦‚æœä»¤ç‰Œæ˜¯æ— æ•ˆçš„ï¼Œå°±å“åº”ä¸€ä¸ªé”™è¯¯çš„ä¿¡æ¯ï¼Œä¹Ÿä¸ä¼šå†å»æ”¾è¡Œè®¿é—®å¯¹åº”çš„èµ„æºäº†ã€‚å¦‚æœä»¤ç‰Œå­˜åœ¨ï¼Œå¹¶ä¸”å®ƒæ˜¯æœ‰æ•ˆçš„ï¼Œæ­¤æ—¶å°±ä¼šæ”¾è¡Œå»è®¿é—®å¯¹åº”çš„webèµ„æºï¼Œæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡æ“ä½œã€‚ å¤§æ¦‚æ¸…æ¥šäº†åœ¨Filterè¿‡æ»¤å™¨çš„å®ç°æ­¥éª¤äº†ï¼Œé‚£åœ¨æ­£å¼å¼€å‘ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š\næ‰€æœ‰çš„è¯·æ±‚ï¼Œæ‹¦æˆªåˆ°äº†ä¹‹åï¼Œéƒ½éœ€è¦æ ¡éªŒä»¤ç‰Œå—ï¼Ÿ ç­”æ¡ˆï¼šç™»å½•è¯·æ±‚ä¾‹å¤– æ‹¦æˆªåˆ°è¯·æ±‚åï¼Œä»€ä¹ˆæƒ…å†µä¸‹æ‰å¯ä»¥æ”¾è¡Œï¼Œæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Ÿ ç­”æ¡ˆï¼šæœ‰ä»¤ç‰Œï¼Œä¸”ä»¤ç‰Œæ ¡éªŒé€šè¿‡(åˆæ³•)ï¼›å¦åˆ™éƒ½è¿”å›æœªç™»å½•é”™è¯¯ç»“æœ å…·ä½“æµç¨‹ æˆ‘ä»¬è¦å®Œæˆç™»å½•æ ¡éªŒï¼Œä¸»è¦æ˜¯åˆ©ç”¨Filterè¿‡æ»¤å™¨å®ç°ï¼Œè€ŒFilterè¿‡æ»¤å™¨çš„æµç¨‹æ­¥éª¤ï¼š\nåŸºäºä¸Šé¢çš„ä¸šåŠ¡æµç¨‹ï¼Œæˆ‘ä»¬åˆ†æå‡ºå…·ä½“çš„æ“ä½œæ­¥éª¤ï¼š\nè·å–è¯·æ±‚url åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œ è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰ åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ æ”¾è¡Œ ä»£ç å®ç° åˆ†ææ¸…æ¥šäº†ä»¥ä¸Šçš„é—®é¢˜åï¼Œæˆ‘ä»¬å°±å‚ç…§æ¥å£æ–‡æ¡£æ¥å¼€å‘ç™»å½•åŠŸèƒ½äº†ï¼Œç™»å½•æ¥å£æè¿°å¦‚ä¸‹ï¼š\nåŸºæœ¬ä¿¡æ¯\n1 2 3 4 5 è¯·æ±‚è·¯å¾„ï¼š/login è¯·æ±‚æ–¹å¼ï¼šPOST æ¥å£æè¿°ï¼šè¯¥æ¥å£ç”¨äºå‘˜å·¥ç™»å½•Tliasæ™ºèƒ½å­¦ä¹ è¾…åŠ©ç³»ç»Ÿï¼Œç™»å½•å®Œæ¯•åï¼Œç³»ç»Ÿä¸‹å‘JWTä»¤ç‰Œã€‚ è¯·æ±‚å‚æ•°\nå‚æ•°æ ¼å¼ï¼šapplication/json\nå‚æ•°è¯´æ˜ï¼š\nåç§° ç±»å‹ æ˜¯å¦å¿…é¡» å¤‡æ³¨ username string å¿…é¡» ç”¨æˆ·å password string å¿…é¡» å¯†ç  è¯·æ±‚æ•°æ®æ ·ä¾‹ï¼š\n1 2 3 4 { \u0026#34;username\u0026#34;: \u0026#34;jinyong\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;123456\u0026#34; } å“åº”æ•°æ® å‚æ•°æ ¼å¼ï¼šapplication/json\nå‚æ•°è¯´æ˜ï¼š\nåç§° ç±»å‹ æ˜¯å¦å¿…é¡» é»˜è®¤å€¼ å¤‡æ³¨ å…¶ä»–ä¿¡æ¯ code number å¿…é¡» å“åº”ç , 1 æˆåŠŸ ; 0 å¤±è´¥ msg string éå¿…é¡» æç¤ºä¿¡æ¯ data string å¿…é¡» è¿”å›çš„æ•°æ® , jwtä»¤ç‰Œ å“åº”æ•°æ®æ ·ä¾‹ï¼š\n1 2 3 4 5 { \u0026#34;code\u0026#34;: 1, \u0026#34;msg\u0026#34;: \u0026#34;success\u0026#34;, \u0026#34;data\u0026#34;: \u0026#34;eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoi6YeR5bq4IiwiaWQiOjEsInVzZXJuYW1lIjoiamlueW9uZyIsImV4cCI6MTY2MjIwNzA0OH0.KkUc_CXJZJ8Dd063eImx4H9Ojfrr6XMJ-yVzaWCVZCo\u0026#34; } å¤‡æ³¨è¯´æ˜ ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹å‘JWTä»¤ç‰Œï¼Œç„¶ååœ¨åç»­çš„æ¯æ¬¡è¯·æ±‚ä¸­ï¼Œéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´headerä¸­æºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œè¯·æ±‚å¤´çš„åç§°ä¸º token ï¼Œå€¼ä¸º ç™»å½•æ—¶ä¸‹å‘çš„JWTä»¤ç‰Œã€‚\nå¦‚æœæ£€æµ‹åˆ°ç”¨æˆ·æœªç™»å½•ï¼Œåˆ™ä¼šè¿”å›å¦‚ä¸‹å›ºå®šé”™è¯¯ä¿¡æ¯ï¼š\n1 2 3 4 5 { \u0026#34;code\u0026#34;: 0, \u0026#34;msg\u0026#34;: \u0026#34;NOT_LOGIN\u0026#34;, \u0026#34;data\u0026#34;: null } ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨ï¼šLoginCheckFilter\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 @Slf4j @WebFilter(urlPatterns = \u0026#34;/*\u0026#34;) //æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ public class LoginCheckFilter implements Filter { @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain chain) throws IOException, ServletException { //å‰ç½®ï¼šå¼ºåˆ¶è½¬æ¢ä¸ºhttpåè®®çš„è¯·æ±‚å¯¹è±¡ã€å“åº”å¯¹è±¡ ï¼ˆè½¬æ¢åŸå› ï¼šè¦ä½¿ç”¨å­ç±»ä¸­ç‰¹æœ‰æ–¹æ³•ï¼‰ HttpServletRequest request = (HttpServletRequest) servletRequest; HttpServletResponse response = (HttpServletResponse) servletResponse; //1.è·å–è¯·æ±‚url String url = request.getRequestURL().toString(); log.info(\u0026#34;è¯·æ±‚è·¯å¾„ï¼š{}\u0026#34;, url); //è¯·æ±‚è·¯å¾„ï¼šhttp://localhost:8080/login //2.åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œ if(url.contains(\u0026#34;/login\u0026#34;)){ chain.doFilter(request, response);//æ”¾è¡Œè¯·æ±‚ return;//ç»“æŸå½“å‰æ–¹æ³•çš„æ‰§è¡Œ } //3.è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰ String token = request.getHeader(\u0026#34;token\u0026#34;); log.info(\u0026#34;ä»è¯·æ±‚å¤´ä¸­è·å–çš„ä»¤ç‰Œï¼š{}\u0026#34;,token); //4.åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ if(!StringUtils.hasLength(token)){ log.info(\u0026#34;Tokenä¸å­˜åœ¨\u0026#34;); Result responseResult = Result.error(\u0026#34;NOT_LOGIN\u0026#34;); //æŠŠResultå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼å­—ç¬¦ä¸² (fastjsonæ˜¯é˜¿é‡Œå·´å·´æä¾›çš„ç”¨äºå®ç°å¯¹è±¡å’Œjsonçš„è½¬æ¢å·¥å…·ç±») String json = JSONObject.toJSONString(responseResult); response.setContentType(\u0026#34;application/json;charset=utf-8\u0026#34;); //å“åº” response.getWriter().write(json); return; } //5.è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ try { JwtUtils.parseJWT(token); }catch (Exception e){ log.info(\u0026#34;ä»¤ç‰Œè§£æå¤±è´¥!\u0026#34;); Result responseResult = Result.error(\u0026#34;NOT_LOGIN\u0026#34;); //æŠŠResultå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼å­—ç¬¦ä¸² (fastjsonæ˜¯é˜¿é‡Œå·´å·´æä¾›çš„ç”¨äºå®ç°å¯¹è±¡å’Œjsonçš„è½¬æ¢å·¥å…·ç±») String json = JSONObject.toJSONString(responseResult); response.setContentType(\u0026#34;application/json;charset=utf-8\u0026#34;); //å“åº” response.getWriter().write(json); return; } //6.æ”¾è¡Œ chain.doFilter(request, response); } } åœ¨ä¸Šè¿°è¿‡æ»¤å™¨çš„åŠŸèƒ½å®ç°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹jsonå¤„ç†çš„å·¥å…·åŒ…fastjsonã€‚æˆ‘ä»¬è¦æƒ³ä½¿ç”¨ï¼Œéœ€è¦å¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;fastjson\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.76\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ç™»å½•æ ¡éªŒçš„è¿‡æ»¤å™¨æˆ‘ä»¬ç¼–å†™å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é‡æ–°å¯åŠ¨æœåŠ¡æ¥åšä¸€ä¸ªæµ‹è¯•ï¼š\næµ‹è¯•å‰å…ˆæŠŠä¹‹å‰æ‰€ç¼–å†™çš„æµ‹è¯•ä½¿ç”¨çš„è¿‡æ»¤å™¨ï¼Œæš‚æ—¶æ³¨é‡Šæ‰ã€‚ç›´æ¥å°†@WebFilteræ³¨è§£ç»™æ³¨é‡Šæ‰å³å¯ã€‚\næµ‹è¯•1ï¼šæœªç™»å½•æ˜¯å¦å¯ä»¥è®¿é—®éƒ¨é—¨ç®¡ç†é¡µé¢\né¦–å…ˆå…³é—­æµè§ˆå™¨ï¼Œé‡æ–°æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥ï¼šhttp://localhost:9528/#/system/dept\nç”±äºç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œç™»å½•æ ¡éªŒè¿‡æ»¤å™¨è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå‰ç«¯é¡µé¢æ ¹æ®è¿”å›çš„é”™è¯¯ä¿¡æ¯ç»“æœï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢äº†\næµ‹è¯•2ï¼šå…ˆè¿›è¡Œç™»å½•æ“ä½œï¼Œå†è®¿é—®éƒ¨é—¨ç®¡ç†é¡µé¢ ç™»å½•æ ¡éªŒæˆåŠŸä¹‹åï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ç›¸å…³ä¸šåŠ¡æ“ä½œé¡µé¢\nç™»å½•æ ¡éªŒ-Interceptor-å…¥é—¨ å­¦ä¹ å®Œäº†è¿‡æ»¤å™¨Filterä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å­¦ä¹ æ‹¦æˆªå™¨Interseptorã€‚\næ‹¦æˆªå™¨æˆ‘ä»¬ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ–¹é¢è¿›è¡Œè®²è§£ï¼š\nä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨ï¼Œå¹¶é€šè¿‡å¿«é€Ÿå…¥é—¨ç¨‹åºä¸Šæ‰‹æ‹¦æˆªå™¨ æ‹¦æˆªå™¨çš„ä½¿ç”¨ç»†èŠ‚ é€šè¿‡æ‹¦æˆªå™¨Interceptorå®Œæˆç™»å½•æ ¡éªŒåŠŸèƒ½ æˆ‘ä»¬å…ˆå­¦ä¹ ç¬¬ä¸€å—å†…å®¹ï¼šæ‹¦æˆªå™¨å¿«é€Ÿå…¥é—¨\nå¿«é€Ÿå…¥é—¨ ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨ï¼Ÿ\næ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œç±»ä¼¼äºè¿‡æ»¤å™¨ã€‚ æ‹¦æˆªå™¨æ˜¯Springæ¡†æ¶ä¸­æä¾›çš„ï¼Œç”¨æ¥åŠ¨æ€æ‹¦æˆªæ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œã€‚ æ‹¦æˆªå™¨çš„ä½œç”¨ï¼š\næ‹¦æˆªè¯·æ±‚ï¼Œåœ¨æŒ‡å®šæ–¹æ³•è°ƒç”¨å‰åï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦æ‰§è¡Œé¢„å…ˆè®¾å®šçš„ä»£ç ã€‚ åœ¨æ‹¦æˆªå™¨å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¹Ÿæ˜¯åšä¸€äº›é€šç”¨æ€§çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æ¥æ‹¦æˆªå‰ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå°†ç™»å½•æ ¡éªŒçš„é€»è¾‘å…¨éƒ¨ç¼–å†™åœ¨æ‹¦æˆªå™¨å½“ä¸­ã€‚åœ¨æ ¡éªŒçš„è¿‡ç¨‹å½“ä¸­ï¼Œå¦‚å‘ç°ç”¨æˆ·ç™»å½•äº†(æºå¸¦JWTä»¤ç‰Œä¸”æ˜¯åˆæ³•ä»¤ç‰Œ)ï¼Œå°±å¯ä»¥ç›´æ¥æ”¾è¡Œï¼Œå»è®¿é—®springå½“ä¸­çš„èµ„æºã€‚å¦‚æœæ ¡éªŒæ—¶å‘ç°å¹¶æ²¡æœ‰ç™»å½•æˆ–æ˜¯éæ³•ä»¤ç‰Œï¼Œå°±å¯ä»¥ç›´æ¥ç»™å‰ç«¯å“åº”æœªç™»å½•çš„é”™è¯¯ä¿¡æ¯ã€‚\nä¸‹é¢æˆ‘ä»¬é€šè¿‡å¿«é€Ÿå…¥é—¨ç¨‹åºï¼Œæ¥å­¦ä¹ ä¸‹æ‹¦æˆªå™¨çš„åŸºæœ¬ä½¿ç”¨ã€‚æ‹¦æˆªå™¨çš„ä½¿ç”¨æ­¥éª¤å’Œè¿‡æ»¤å™¨ç±»ä¼¼ï¼Œä¹Ÿåˆ†ä¸ºä¸¤æ­¥ï¼š\nå®šä¹‰æ‹¦æˆªå™¨ æ³¨å†Œé…ç½®æ‹¦æˆªå™¨ **è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼š**å®ç°HandlerInterceptoræ¥å£ï¼Œå¹¶é‡å†™å…¶æ‰€æœ‰æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 //è‡ªå®šä¹‰æ‹¦æˆªå™¨ @Component public class LoginCheckInterceptor implements HandlerInterceptor { //ç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œã€‚ è¿”å›trueï¼šæ”¾è¡Œ è¿”å›falseï¼šä¸æ”¾è¡Œ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { System.out.println(\u0026#34;preHandle .... \u0026#34;); return true; //trueè¡¨ç¤ºæ”¾è¡Œ } //ç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œåæ‰§è¡Œ @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception { System.out.println(\u0026#34;postHandle ... \u0026#34;); } //è§†å›¾æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œï¼Œæœ€åæ‰§è¡Œ @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { System.out.println(\u0026#34;afterCompletion .... \u0026#34;); } } æ³¨æ„ï¼š\npreHandleæ–¹æ³•ï¼šç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œã€‚ è¿”å›trueï¼šæ”¾è¡Œ è¿”å›falseï¼šä¸æ”¾è¡Œ\npostHandleæ–¹æ³•ï¼šç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œåæ‰§è¡Œ\nafterCompletionæ–¹æ³•ï¼šè§†å›¾æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œï¼Œæœ€åæ‰§è¡Œ\næ³¨å†Œé…ç½®æ‹¦æˆªå™¨ï¼šå®ç°WebMvcConfigureræ¥å£ï¼Œå¹¶é‡å†™addInterceptorsæ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Configuration public class WebConfig implements WebMvcConfigurer { //è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨å¯¹è±¡ @Autowired private LoginCheckInterceptor loginCheckInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) { //æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡ registry.addInterceptor(loginCheckInterceptor).addPathPatterns(\u0026#34;/**\u0026#34;);//è®¾ç½®æ‹¦æˆªå™¨æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ï¼ˆ /** è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼‰ } } é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæ‰“å¼€postmanæµ‹è¯•ï¼š\næ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥åšä¸€ä¸ªæµ‹è¯•ï¼šå°†æ‹¦æˆªå™¨ä¸­è¿”å›å€¼æ”¹ä¸ºfalse\nä½¿ç”¨postmanï¼Œå†æ¬¡ç‚¹å‡»sendå‘é€è¯·æ±‚åï¼Œæ²¡æœ‰å“åº”æ•°æ®ï¼Œè¯´æ˜è¯·æ±‚è¢«æ‹¦æˆªäº†æ²¡æœ‰æ”¾è¡Œ\nç™»å½•æ ¡éªŒ-Interceptor-è¯¦è§£ æ‹¦æˆªå™¨çš„å…¥é—¨ç¨‹åºå®Œæˆä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä»‹ç»æ‹¦æˆªå™¨çš„ä½¿ç”¨ç»†èŠ‚ã€‚æ‹¦æˆªå™¨çš„ä½¿ç”¨ç»†èŠ‚æˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸¤ä¸ªéƒ¨åˆ†ï¼š\næ‹¦æˆªå™¨çš„æ‹¦æˆªè·¯å¾„é…ç½® æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹ æ‹¦æˆªè·¯å¾„ é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹æ‹¦æˆªå™¨çš„æ‹¦æˆªè·¯å¾„çš„é…ç½®ï¼Œåœ¨æ³¨å†Œé…ç½®æ‹¦æˆªå™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦æŒ‡å®šæ‹¦æˆªå™¨çš„æ‹¦æˆªè·¯å¾„ï¼Œé€šè¿‡addPathPatterns(\u0026quot;è¦æ‹¦æˆªè·¯å¾„\u0026quot;)æ–¹æ³•ï¼Œå°±å¯ä»¥æŒ‡å®šè¦æ‹¦æˆªå“ªäº›èµ„æºã€‚\nåœ¨å…¥é—¨ç¨‹åºä¸­æˆ‘ä»¬é…ç½®çš„æ˜¯/**ï¼Œè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰èµ„æºï¼Œè€Œåœ¨é…ç½®æ‹¦æˆªå™¨æ—¶ï¼Œä¸ä»…å¯ä»¥æŒ‡å®šè¦æ‹¦æˆªå“ªäº›èµ„æºï¼Œè¿˜å¯ä»¥æŒ‡å®šä¸æ‹¦æˆªå“ªäº›èµ„æºï¼Œåªéœ€è¦è°ƒç”¨excludePathPatterns(\u0026quot;ä¸æ‹¦æˆªè·¯å¾„\u0026quot;)æ–¹æ³•ï¼ŒæŒ‡å®šå“ªäº›èµ„æºä¸éœ€è¦æ‹¦æˆªã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Configuration public class WebConfig implements WebMvcConfigurer { //æ‹¦æˆªå™¨å¯¹è±¡ @Autowired private LoginCheckInterceptor loginCheckInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) { //æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡ registry.addInterceptor(loginCheckInterceptor) .addPathPatterns(\u0026#34;/**\u0026#34;)//è®¾ç½®æ‹¦æˆªå™¨æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ï¼ˆ /** è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼‰ .excludePathPatterns(\u0026#34;/login\u0026#34;);//è®¾ç½®ä¸æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ } } åœ¨æ‹¦æˆªå™¨ä¸­é™¤äº†å¯ä»¥è®¾ç½®/**æ‹¦æˆªæ‰€æœ‰èµ„æºå¤–ï¼Œè¿˜æœ‰ä¸€äº›å¸¸è§æ‹¦æˆªè·¯å¾„è®¾ç½®ï¼š\næ‹¦æˆªè·¯å¾„ å«ä¹‰ ä¸¾ä¾‹ /* ä¸€çº§è·¯å¾„ èƒ½åŒ¹é…/deptsï¼Œ/empsï¼Œ/loginï¼Œä¸èƒ½åŒ¹é… /depts/1 /** ä»»æ„çº§è·¯å¾„ èƒ½åŒ¹é…/deptsï¼Œ/depts/1ï¼Œ/depts/1/2 /depts/* /deptsä¸‹çš„ä¸€çº§è·¯å¾„ èƒ½åŒ¹é…/depts/1ï¼Œä¸èƒ½åŒ¹é…/depts/1/2ï¼Œ/depts /depts/** /deptsä¸‹çš„ä»»æ„çº§è·¯å¾„ èƒ½åŒ¹é…/deptsï¼Œ/depts/1ï¼Œ/depts/1/2ï¼Œä¸èƒ½åŒ¹é…/emps/1 ä¸‹é¢ä¸»è¦æ¥æ¼”ç¤ºä¸‹/**ä¸/*çš„åŒºåˆ«ï¼š\nä¿®æ”¹æ‹¦æˆªå™¨é…ç½®ï¼ŒæŠŠæ‹¦æˆªè·¯å¾„è®¾ç½®ä¸º/* 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Configuration public class WebConfig implements WebMvcConfigurer { //æ‹¦æˆªå™¨å¯¹è±¡ @Autowired private LoginCheckInterceptor loginCheckInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) { //æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡ registry.addInterceptor(loginCheckInterceptor) .addPathPatterns(\u0026#34;/*\u0026#34;) .excludePathPatterns(\u0026#34;/login\u0026#34;);//è®¾ç½®ä¸æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ } } ä½¿ç”¨postmanæµ‹è¯•ï¼šhttp://localhost:8080/emps/1\næ§åˆ¶å°æ²¡æœ‰è¾“å‡ºæ‹¦æˆªå™¨ä¸­çš„æ—¥å¿—ä¿¡æ¯ï¼Œè¯´æ˜/*æ²¡æœ‰åŒ¹é…åˆ°æ‹¦æˆªè·¯å¾„/emp/1 ã€‚\næ‰§è¡Œæµç¨‹ ä»‹ç»å®Œæ‹¦æˆªè·¯å¾„çš„é…ç½®ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥ä»‹ç»æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹ã€‚é€šè¿‡æ‰§è¡Œæµç¨‹ï¼Œå¤§å®¶å°±èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶æœºã€‚\nå½“æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨æ¥è®¿é—®éƒ¨ç½²åœ¨webæœåŠ¡å™¨å½“ä¸­çš„webåº”ç”¨æ—¶ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰€å®šä¹‰çš„è¿‡æ»¤å™¨ä¼šæ‹¦æˆªåˆ°è¿™æ¬¡è¯·æ±‚ã€‚æ‹¦æˆªåˆ°è¿™æ¬¡è¯·æ±‚ä¹‹åï¼Œå®ƒä¼šå…ˆæ‰§è¡Œæ”¾è¡Œå‰çš„é€»è¾‘ï¼Œç„¶åå†æ‰§è¡Œæ”¾è¡Œæ“ä½œã€‚è€Œç”±äºæˆ‘ä»¬å½“å‰æ˜¯åŸºäºspringbootå¼€å‘çš„ï¼Œæ‰€ä»¥æ”¾è¡Œä¹‹åæ˜¯è¿›å…¥åˆ°äº†springçš„ç¯å¢ƒå½“ä¸­ï¼Œä¹Ÿå°±æ˜¯è¦æ¥è®¿é—®æˆ‘ä»¬æ‰€å®šä¹‰çš„controllerå½“ä¸­çš„æ¥å£æ–¹æ³•ã€‚ Tomcatå¹¶ä¸è¯†åˆ«æ‰€ç¼–å†™çš„Controllerç¨‹åºï¼Œä½†æ˜¯å®ƒè¯†åˆ«Servletç¨‹åºï¼Œæ‰€ä»¥åœ¨Springçš„Webç¯å¢ƒä¸­æä¾›äº†ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„Servletï¼šDispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šå…ˆè¿›è¡Œåˆ°DispatcherServletï¼Œå†å°†è¯·æ±‚è½¬ç»™Controllerã€‚ å½“æˆ‘ä»¬å®šä¹‰äº†æ‹¦æˆªå™¨åï¼Œä¼šåœ¨æ‰§è¡ŒControllerçš„æ–¹æ³•ä¹‹å‰ï¼Œè¯·æ±‚è¢«æ‹¦æˆªå™¨æ‹¦æˆªä½ã€‚æ‰§è¡ŒpreHandle()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæˆåéœ€è¦è¿”å›ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å€¼ï¼Œå¦‚æœè¿”å›trueï¼Œå°±è¡¨ç¤ºæ”¾è¡Œæœ¬æ¬¡æ“ä½œï¼Œæ‰ä¼šç»§ç»­è®¿é—®controllerä¸­çš„æ–¹æ³•ï¼›å¦‚æœè¿”å›falseï¼Œåˆ™ä¸ä¼šæ”¾è¡Œï¼ˆcontrollerä¸­çš„æ–¹æ³•ä¹Ÿä¸ä¼šæ‰§è¡Œï¼‰ã€‚ åœ¨controllerå½“ä¸­çš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå†å›è¿‡æ¥æ‰§è¡ŒpostHandle()è¿™ä¸ªæ–¹æ³•ä»¥åŠafterCompletion() æ–¹æ³•ï¼Œç„¶åå†è¿”å›ç»™DispatcherServletï¼Œæœ€ç»ˆå†æ¥æ‰§è¡Œè¿‡æ»¤å™¨å½“ä¸­æ”¾è¡Œåçš„è¿™ä¸€éƒ¨åˆ†é€»è¾‘çš„é€»è¾‘ã€‚æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæœ€ç»ˆç»™æµè§ˆå™¨å“åº”æ•°æ®ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥æ¼”ç¤ºä¸‹è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨åŒæ—¶å­˜åœ¨çš„æ‰§è¡Œæµç¨‹ï¼š\nå¼€å¯LoginCheckInterceptoræ‹¦æˆªå™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @Component public class LoginCheckInterceptor implements HandlerInterceptor { @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { System.out.println(\u0026#34;preHandle .... \u0026#34;); return true; //trueè¡¨ç¤ºæ”¾è¡Œ } @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception { System.out.println(\u0026#34;postHandle ... \u0026#34;); } @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { System.out.println(\u0026#34;afterCompletion .... \u0026#34;); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Configuration public class WebConfig implements WebMvcConfigurer { //æ‹¦æˆªå™¨å¯¹è±¡ @Autowired private LoginCheckInterceptor loginCheckInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) { //æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡ registry.addInterceptor(loginCheckInterceptor) .addPathPatterns(\u0026#34;/**\u0026#34;)//æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ .excludePathPatterns(\u0026#34;/login\u0026#34;);//ä¸æ‹¦æˆªç™»å½•è¯·æ±‚ } } å¼€å¯DemoFilterè¿‡æ»¤å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 @WebFilter(urlPatterns = \u0026#34;/*\u0026#34;) public class DemoFilter implements Filter { @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { System.out.println(\u0026#34;DemoFilter æ”¾è¡Œå‰é€»è¾‘.....\u0026#34;); //æ”¾è¡Œè¯·æ±‚ filterChain.doFilter(servletRequest,servletResponse); System.out.println(\u0026#34;DemoFilter æ”¾è¡Œåé€»è¾‘.....\u0026#34;); } } é‡å¯SpringBootæœåŠ¡åï¼Œæ¸…ç©ºæ—¥å¿—ï¼Œæ‰“å¼€Postmanï¼Œæµ‹è¯•æŸ¥è¯¢éƒ¨é—¨ï¼š\nä»¥ä¸Šå°±æ˜¯æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹ã€‚é€šè¿‡æ‰§è¡Œæµç¨‹åˆ†æï¼Œå¤§å®¶åº”è¯¥å·²ç»æ¸…æ¥šäº†è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨ä¹‹é—´çš„åŒºåˆ«ï¼Œå…¶å®å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¸»è¦æ˜¯ä¸¤ç‚¹ï¼š\næ¥å£è§„èŒƒä¸åŒï¼šè¿‡æ»¤å™¨éœ€è¦å®ç°Filteræ¥å£ï¼Œè€Œæ‹¦æˆªå™¨éœ€è¦å®ç°HandlerInterceptoræ¥å£ã€‚ æ‹¦æˆªèŒƒå›´ä¸åŒï¼šè¿‡æ»¤å™¨Filterä¼šæ‹¦æˆªæ‰€æœ‰çš„èµ„æºï¼Œè€ŒInterceptoråªä¼šæ‹¦æˆªSpringç¯å¢ƒä¸­çš„èµ„æºã€‚ ç™»å½•æ ¡éªŒ-Interceptor-ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨ è®²è§£å®Œäº†æ‹¦æˆªå™¨çš„åŸºæœ¬æ“ä½œä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®Œæˆæœ€åä¸€æ­¥æ“ä½œï¼šé€šè¿‡æ‹¦æˆªå™¨æ¥å®Œæˆæ¡ˆä¾‹å½“ä¸­çš„ç™»å½•æ ¡éªŒåŠŸèƒ½ã€‚\nç™»å½•æ ¡éªŒçš„ä¸šåŠ¡é€»è¾‘ä»¥åŠæ“ä½œæ­¥éª¤æˆ‘ä»¬å‰é¢å·²ç»åˆ†æè¿‡äº†ï¼Œå’Œç™»å½•æ ¡éªŒFilterè¿‡æ»¤å™¨å½“ä¸­çš„é€»è¾‘æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆç”±åŸæ¥çš„è¿‡æ»¤å™¨æ¢æˆæ‹¦æˆªå™¨interceptorå°±å¯ä»¥äº†ã€‚\nç™»å½•æ ¡éªŒæ‹¦æˆªå™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 //è‡ªå®šä¹‰æ‹¦æˆªå™¨ @Component //å½“å‰æ‹¦æˆªå™¨å¯¹è±¡ç”±Springåˆ›å»ºå’Œç®¡ç† @Slf4j public class LoginCheckInterceptor implements HandlerInterceptor { //å‰ç½®æ–¹å¼ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { System.out.println(\u0026#34;preHandle .... \u0026#34;); //1.è·å–è¯·æ±‚url //2.åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œ //3.è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰ String token = request.getHeader(\u0026#34;token\u0026#34;); log.info(\u0026#34;ä»è¯·æ±‚å¤´ä¸­è·å–çš„ä»¤ç‰Œï¼š{}\u0026#34;,token); //4.åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ if(!StringUtils.hasLength(token)){ log.info(\u0026#34;Tokenä¸å­˜åœ¨\u0026#34;); //åˆ›å»ºå“åº”ç»“æœå¯¹è±¡ Result responseResult = Result.error(\u0026#34;NOT_LOGIN\u0026#34;); //æŠŠResultå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼å­—ç¬¦ä¸² (fastjsonæ˜¯é˜¿é‡Œå·´å·´æä¾›çš„ç”¨äºå®ç°å¯¹è±¡å’Œjsonçš„è½¬æ¢å·¥å…·ç±») String json = JSONObject.toJSONString(responseResult); //è®¾ç½®å“åº”å¤´ï¼ˆå‘ŠçŸ¥æµè§ˆå™¨ï¼šå“åº”çš„æ•°æ®ç±»å‹ä¸ºjsonã€å“åº”çš„æ•°æ®ç¼–ç è¡¨ä¸ºutf-8ï¼‰ response.setContentType(\u0026#34;application/json;charset=utf-8\u0026#34;); //å“åº” response.getWriter().write(json); return false;//ä¸æ”¾è¡Œ } //5.è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ try { JwtUtils.parseJWT(token); }catch (Exception e){ log.info(\u0026#34;ä»¤ç‰Œè§£æå¤±è´¥!\u0026#34;); //åˆ›å»ºå“åº”ç»“æœå¯¹è±¡ Result responseResult = Result.error(\u0026#34;NOT_LOGIN\u0026#34;); //æŠŠResultå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼å­—ç¬¦ä¸² (fastjsonæ˜¯é˜¿é‡Œå·´å·´æä¾›çš„ç”¨äºå®ç°å¯¹è±¡å’Œjsonçš„è½¬æ¢å·¥å…·ç±») String json = JSONObject.toJSONString(responseResult); //è®¾ç½®å“åº”å¤´ response.setContentType(\u0026#34;application/json;charset=utf-8\u0026#34;); //å“åº” response.getWriter().write(json); return false; } //6.æ”¾è¡Œ return true; } æ³¨å†Œé…ç½®æ‹¦æˆªå™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Configuration public class WebConfig implements WebMvcConfigurer { //æ‹¦æˆªå™¨å¯¹è±¡ @Autowired private LoginCheckInterceptor loginCheckInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) { //æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡ registry.addInterceptor(loginCheckInterceptor) .addPathPatterns(\u0026#34;/**\u0026#34;) .excludePathPatterns(\u0026#34;/login\u0026#34;); } } ç™»å½•æ ¡éªŒçš„æ‹¦æˆªå™¨ç¼–å†™å®Œæˆåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é‡æ–°å¯åŠ¨æœåŠ¡æ¥åšä¸€ä¸ªæµ‹è¯•ï¼š ï¼ˆå…³é—­ç™»å½•æ ¡éªŒFilterè¿‡æ»¤å™¨ï¼‰\næµ‹è¯•1ï¼šæœªç™»å½•æ˜¯å¦å¯ä»¥è®¿é—®éƒ¨é—¨ç®¡ç†é¡µé¢\né¦–å…ˆå…³é—­æµè§ˆå™¨ï¼Œé‡æ–°æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥ï¼šhttp://localhost:9528/#/system/dept\nç”±äºç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæ ¡éªŒæœºåˆ¶è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå‰ç«¯é¡µé¢æ ¹æ®è¿”å›çš„é”™è¯¯ä¿¡æ¯ç»“æœï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢äº†\næµ‹è¯•2ï¼šå…ˆè¿›è¡Œç™»å½•æ“ä½œï¼Œå†è®¿é—®éƒ¨é—¨ç®¡ç†é¡µé¢ ç™»å½•æ ¡éªŒæˆåŠŸä¹‹åï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ç›¸å…³ä¸šåŠ¡æ“ä½œé¡µé¢\nåˆ°æ­¤æˆ‘ä»¬ä¹Ÿå°±éªŒè¯äº†æ‰€å¼€å‘çš„ç™»å½•æ ¡éªŒçš„æ‹¦æˆªå™¨ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚ç™»å½•æ ¡éªŒçš„è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨å…¶ä¸­çš„ä¸€ç§å°±å¯ä»¥äº†ã€‚\nå¼‚å¸¸å¤„ç† å½“å‰é—®é¢˜ ç™»å½•åŠŸèƒ½å’Œç™»å½•æ ¡éªŒåŠŸèƒ½æˆ‘ä»¬éƒ½å®ç°äº†ï¼Œä¸‹é¢æˆ‘ä»¬å­¦ä¹ ä¸‹ä»Šå¤©æœ€åä¸€å—æŠ€æœ¯ç‚¹ï¼šå¼‚å¸¸å¤„ç†ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå‡ºç°å¼‚å¸¸ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡ï¼Œå†æ¥ä»‹ç»å¼‚å¸¸å¤„ç†çš„æ–¹æ¡ˆã€‚\næˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ç³»ç»Ÿä¸­çš„æ–°å¢éƒ¨é—¨æ“ä½œï¼Œç³»ç»Ÿä¸­å·²ç»æœ‰äº† \u0026ldquo;å°±ä¸šéƒ¨\u0026rdquo; è¿™ä¸ªéƒ¨é—¨ï¼Œæˆ‘ä»¬å†æ¥å¢åŠ ä¸€ä¸ªå°±ä¸šéƒ¨ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡ã€‚\nç‚¹å‡»ç¡®å®šä¹‹åï¼Œçª—å£å…³é—­äº†ï¼Œé¡µé¢æ²¡æœ‰ä»»ä½•ååº”ï¼Œå°±ä¸šéƒ¨ä¹Ÿæ²¡æœ‰æ·»åŠ ä¸Šã€‚ è€Œæ­¤æ—¶ï¼Œå¤§å®¶ä¼šå‘ç°ï¼Œç½‘ç»œè¯·æ±‚æŠ¥é”™äº†ã€‚\nçŠ¶æ€ç ä¸º500ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯å¼‚å¸¸ï¼Œæˆ‘ä»¬æ‰“å¼€ideaï¼Œæ¥çœ‹ä¸€ä¸‹ï¼ŒæœåŠ¡å™¨ç«¯å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚\nä¸Šè¿°é”™è¯¯ä¿¡æ¯çš„å«ä¹‰æ˜¯ï¼Œdeptéƒ¨é—¨è¡¨çš„nameå­—æ®µçš„å€¼ å°±ä¸šéƒ¨ é‡å¤äº†ï¼Œå› ä¸ºåœ¨æ•°æ®åº“è¡¨deptä¸­å·²ç»æœ‰äº†å°±ä¸šéƒ¨ï¼Œæˆ‘ä»¬ä¹‹å‰è®¾è®¡è¿™å¼ è¡¨æ—¶ï¼Œä¸ºnameå­—æ®µå»ºè®®äº†å”¯ä¸€çº¦æŸï¼Œæ‰€ä»¥è¯¥å­—æ®µçš„å€¼æ˜¯ä¸èƒ½é‡å¤çš„ã€‚\nè€Œå½“æˆ‘ä»¬å†æ·»åŠ å°±ä¸šéƒ¨ï¼Œè¿™ä¸ªéƒ¨é—¨æ—¶ï¼Œå°±è¿åäº†å”¯ä¸€çº¦æŸï¼Œæ­¤æ—¶å°±ä¼šæŠ¥é”™ã€‚\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‡ºç°å¼‚å¸¸ä¹‹åï¼Œæœ€ç»ˆæœåŠ¡ç«¯ç»™å‰ç«¯å“åº”å›æ¥çš„æ•°æ®é•¿ä»€ä¹ˆæ ·ã€‚\nå“åº”å›æ¥çš„æ•°æ®æ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®ã€‚ä½†è¿™ç§JSONæ ¼å¼çš„æ•°æ®è¿˜æ˜¯æˆ‘ä»¬å¼€å‘è§„èŒƒå½“ä¸­æ‰€æåˆ°çš„ç»Ÿä¸€å“åº”ç»“æœResultå—ï¼Ÿæ˜¾ç„¶å¹¶ä¸æ˜¯ã€‚ç”±äºè¿”å›çš„æ•°æ®ä¸ç¬¦åˆå¼€å‘è§„èŒƒï¼Œæ‰€ä»¥å‰ç«¯å¹¶ä¸èƒ½è§£æå‡ºå“åº”çš„JSONæ•°æ®ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ€è€ƒçš„æ˜¯å‡ºç°å¼‚å¸¸ä¹‹åï¼Œå½“å‰æ¡ˆä¾‹é¡¹ç›®çš„å¼‚å¸¸æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ\nç­”æ¡ˆï¼šæ²¡æœ‰åšä»»ä½•çš„å¼‚å¸¸å¤„ç† å½“æˆ‘ä»¬æ²¡æœ‰åšä»»ä½•çš„å¼‚å¸¸å¤„ç†æ—¶ï¼Œæˆ‘ä»¬ä¸‰å±‚æ¶æ„å¤„ç†å¼‚å¸¸çš„æ–¹æ¡ˆï¼š\nMapperæ¥å£åœ¨æ“ä½œæ•°æ®åº“çš„æ—¶å€™å‡ºé”™äº†ï¼Œæ­¤æ—¶å¼‚å¸¸ä¼šå¾€ä¸ŠæŠ›(è°è°ƒç”¨Mapperå°±æŠ›ç»™è°)ï¼Œä¼šæŠ›ç»™serviceã€‚ service ä¸­ä¹Ÿå­˜åœ¨å¼‚å¸¸äº†ï¼Œä¼šæŠ›ç»™controllerã€‚ è€Œåœ¨controllerå½“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰åšä»»ä½•çš„å¼‚å¸¸å¤„ç†ï¼Œæ‰€ä»¥æœ€ç»ˆå¼‚å¸¸ä¼šå†å¾€ä¸ŠæŠ›ã€‚æœ€ç»ˆæŠ›ç»™æ¡†æ¶ä¹‹åï¼Œæ¡†æ¶å°±ä¼šè¿”å›ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®ï¼Œé‡Œé¢å°è£…çš„å°±æ˜¯é”™è¯¯çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ¡†æ¶è¿”å›çš„JSONæ ¼å¼çš„æ•°æ®å¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„å¼€å‘è§„èŒƒã€‚ 16.2 è§£å†³æ–¹æ¡ˆ é‚£ä¹ˆåœ¨ä¸‰å±‚æ„æ¶é¡¹ç›®ä¸­ï¼Œå‡ºç°äº†å¼‚å¸¸ï¼Œè¯¥å¦‚ä½•å¤„ç†?\næ–¹æ¡ˆä¸€ï¼šåœ¨æ‰€æœ‰Controllerçš„æ‰€æœ‰æ–¹æ³•ä¸­è¿›è¡Œtryâ€¦catchå¤„ç† ç¼ºç‚¹ï¼šä»£ç è‡ƒè‚¿ï¼ˆä¸æ¨èï¼‰ æ–¹æ¡ˆäºŒï¼šå…¨å±€å¼‚å¸¸å¤„ç†å™¨ å¥½å¤„ï¼šç®€å•ã€ä¼˜é›…ï¼ˆæ¨èï¼‰ å…¨å±€å¼‚å¸¸å¤„ç†å™¨ æˆ‘ä»¬è¯¥æ€ä¹ˆæ ·å®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Ÿ\nå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨éå¸¸ç®€å•ï¼Œå°±æ˜¯å®šä¹‰ä¸€ä¸ªç±»ï¼Œåœ¨ç±»ä¸ŠåŠ ä¸Šä¸€ä¸ªæ³¨è§£@RestControllerAdviceï¼ŒåŠ ä¸Šè¿™ä¸ªæ³¨è§£å°±ä»£è¡¨æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€‚ åœ¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨å½“ä¸­ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªæ–¹æ³•æ¥æ•è·å¼‚å¸¸ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸Šéœ€è¦åŠ ä¸Šæ³¨è§£@ExceptionHandlerã€‚é€šè¿‡@ExceptionHandleræ³¨è§£å½“ä¸­çš„valueå±æ€§æ¥æŒ‡å®šæˆ‘ä»¬è¦æ•è·çš„æ˜¯å“ªä¸€ç±»å‹çš„å¼‚å¸¸ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 @RestControllerAdvice public class GlobalExceptionHandler { //å¤„ç†å¼‚å¸¸ @ExceptionHandler(Exception.class) //æŒ‡å®šèƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ç±»å‹ public Result ex(Exception e){ e.printStackTrace();//æ‰“å°å †æ ˆä¸­çš„å¼‚å¸¸ä¿¡æ¯ //æ•è·åˆ°å¼‚å¸¸ä¹‹åï¼Œå“åº”ä¸€ä¸ªæ ‡å‡†çš„Result return Result.error(\u0026#34;å¯¹ä¸èµ·,æ“ä½œå¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜\u0026#34;); } } @RestControllerAdvice = @ControllerAdvice + @ResponseBody\nå¤„ç†å¼‚å¸¸çš„æ–¹æ³•è¿”å›å€¼ä¼šè½¬æ¢ä¸ºjsonåå†å“åº”ç»™å‰ç«¯\né‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œå†æ¥æµ‹è¯•ä¸€ä¸‹æ·»åŠ éƒ¨é—¨è¿™ä¸ªæ“ä½œï¼Œæˆ‘ä»¬ä¾ç„¶æ·»åŠ å·²å­˜åœ¨çš„ \u0026ldquo;å°±ä¸šéƒ¨\u0026rdquo; è¿™ä¸ªéƒ¨é—¨ï¼š\næ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡ºç°å¼‚å¸¸ä¹‹åï¼Œå¼‚å¸¸å·²ç»è¢«å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·äº†ã€‚ç„¶åè¿”å›çš„é”™è¯¯ä¿¡æ¯ï¼Œè¢«å‰ç«¯ç¨‹åºæ­£å¸¸è§£æï¼Œç„¶åæç¤ºå‡ºäº†å¯¹åº”çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚\nä»¥ä¸Šå°±æ˜¯å…¨å±€å¼‚å¸¸å¤„ç†å™¨çš„ä½¿ç”¨ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªæ³¨è§£ï¼š\n@RestControllerAdvice //è¡¨ç¤ºå½“å‰ç±»ä¸ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨ @ExceptionHandler //æŒ‡å®šå¯ä»¥æ•è·å“ªç§ç±»å‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç† ","date":"2024-04-13T16:01:23+08:00","image":"https://nova-bryan.github.io/p/%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD/image_hu17089168107649188491.png","permalink":"https://nova-bryan.github.io/p/%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD/","title":"ç™»å½•åŠŸèƒ½"}]